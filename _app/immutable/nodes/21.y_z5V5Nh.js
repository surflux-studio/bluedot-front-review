import{k as Q,e as q,A as D,a as G,r as X,l as Z,b as ee}from"../chunks/sign.Ca8vrQ1x.js";import{e as A}from"../chunks/index.C3E6IcWn.js";import{l as te,s as oe,C as F,a as N,g as j,i as k,D as T,f as h,k as x,A as re,B as ne,F as P,t as H,d as L}from"../chunks/scheduler.CAgUjVVh.js";import{g as S}from"../chunks/entry.B7nMElHh.js";import{S as se,i as ae,e as Y,c as w,b as y,m as C,t as b,a as $,d as v,g as ie,f as le}from"../chunks/index.BArRcuOw.js";import{H as ce}from"../chunks/Header.Cr0mjrfa.js";import{V as ue}from"../chunks/Viewer.BMd4hg8O.js";import{F as fe}from"../chunks/Footer.CJJ2NRju.js";import{B as M}from"../chunks/Button.zBe_-iWB.js";import{S as pe}from"../chunks/Select.pzJhrpCD.js";import{p as me}from"../chunks/stores.fjVDwoX3.js";const de=async({fetch:r,url:e})=>{console.warn("viewer/edit/+page.ts load");const o=e.searchParams.get("type");if(o===null||!["post","patch"].includes(o))return A(400,"Bad Request");if(o==="post"){const t=Q();return{posts:[{user_idx:t==null?void 0:t.sub,unique_name:t==null?void 0:t.uni,profile_image_url:t==null?void 0:t.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:te(G),mediaIdx:0,text:""}]}}if(o==="patch"){const t=e.searchParams.get("postIdx");if(t==="null")return q.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),S("/viewer",{replaceState:!0});t||A(404,"Not Found");const n=await r(`${D}/posts/${t}`,{method:"GET",headers:{Authorization:"Bearer "+sessionStorage.getItem("jwt")}}).then(i=>i.json()).then(i=>i.data);return n.error&&A(404,"Not Found"),{posts:[{...n,mediaIdx:0}]}}return A(404,"Not Found")},He=Object.freeze(Object.defineProperty({__proto__:null,load:de},Symbol.toStringTag,{value:"Module"}));var O;(function(r){r.Dark="DARK",r.Light="LIGHT",r.Default="DEFAULT"})(O||(O={}));var E;(function(r){r.Body="body",r.Ionic="ionic",r.Native="native",r.None="none"})(E||(E={}));const B=X("Keyboard");function _e(r){let e,o,t,n;const i=[$e,be],c=[];function f(l,m){return l[3]===!0?0:1}return e=f(r),o=c[e]=i[e](r),{c(){o.c(),t=P()},l(l){o.l(l),t=P()},m(l,m){c[e].m(l,m),k(l,t,m),n=!0},p(l,m){let d=e;e=f(l),e===d?c[e].p(l,m):(ie(),$(c[d],1,1,()=>{c[d]=null}),le(),o=c[e],o?o.p(l,m):(o=c[e]=i[e](l),o.c()),b(o,1),o.m(t.parentNode,t))},i(l){n||(b(o),n=!0)},o(l){$(o),n=!1},d(l){l&&h(t),c[e].d(l)}}}function ge(r){let e,o;return e=new M({props:{backgroundColor:"bg-primary-500",textColor:"text-white",border:"border-none",$$slots:{default:[we]},$$scope:{ctx:r}}}),e.$on("click",r[12]),{c(){w(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,n){C(e,t,n),o=!0},p(t,n){const i={};n&1048576&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){v(e,t)}}}function be(r){let e,o;return e=new M({props:{backgroundColor:"bg-gray-800",textColor:"text-white",border:"border-none",$$slots:{default:[ke]},$$scope:{ctx:r}}}),{c(){w(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,n){C(e,t,n),o=!0},p(t,n){const i={};n&1048576&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){v(e,t)}}}function $e(r){let e,o;return e=new M({props:{backgroundColor:"bg-primary-500",textColor:"text-white",border:"border-none",$$slots:{default:[he]},$$scope:{ctx:r}}}),e.$on("click",r[13]),{c(){w(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,n){C(e,t,n),o=!0},p(t,n){const i={};n&1048576&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){$(e.$$.fragment,t),o=!1},d(t){v(e,t)}}}function ke(r){let e;return{c(){e=H("사진 업로드중")},l(o){e=L(o,"사진 업로드중")},m(o,t){k(o,e,t)},d(o){o&&h(e)}}}function he(r){let e;return{c(){e=H("게시하기")},l(o){e=L(o,"게시하기")},m(o,t){k(o,e,t)},d(o){o&&h(e)}}}function we(r){let e;return{c(){e=H("수정하기")},l(o){e=L(o,"수정하기")},m(o,t){k(o,e,t)},d(o){o&&h(e)}}}function ye(r){let e,o,t,n,i,c,f;function l(s){r[11](s)}let m={options:["전체 공개","팔로워 공개","비공개"]};r[0]!==void 0&&(m.selected=r[0]),e=new pe({props:m}),F.push(()=>Y(e,"selected",l));const d=[ge,_e],_=[];function a(s,p){return s[4]==="patch"?0:s[4]==="post"?1:-1}return~(n=a(r))&&(i=_[n]=d[n](r)),{c(){w(e.$$.fragment),t=N(),i&&i.c(),c=P()},l(s){y(e.$$.fragment,s),t=j(s),i&&i.l(s),c=P()},m(s,p){C(e,s,p),k(s,t,p),~n&&_[n].m(s,p),k(s,c,p),f=!0},p(s,p){const g={};!o&&p&1&&(o=!0,g.selected=s[0],T(()=>o=!1)),e.$set(g),i&&i.p(s,p)},i(s){f||(b(e.$$.fragment,s),b(i),f=!0)},o(s){$(e.$$.fragment,s),$(i),f=!1},d(s){s&&(h(t),h(c)),v(e,s),~n&&_[n].d(s)}}}function Ce(r){let e,o,t,n,i,c,f,l;e=new ce({props:{position:"fixed",leftBack:"white"}});function m(a){r[9](a)}function d(a){r[10](a)}let _={dontMoveVertically:!0};return r[2]!==void 0&&(_.posts=r[2]),r[1]!==void 0&&(_.keyboardY=r[1]),t=new ue({props:_}),F.push(()=>Y(t,"posts",m)),F.push(()=>Y(t,"keyboardY",d)),f=new fe({props:{position:"fixed",bottom:"2rem",$$slots:{default:[ye]},$$scope:{ctx:r}}}),{c(){w(e.$$.fragment),o=N(),w(t.$$.fragment),c=N(),w(f.$$.fragment)},l(a){y(e.$$.fragment,a),o=j(a),y(t.$$.fragment,a),c=j(a),y(f.$$.fragment,a)},m(a,s){C(e,a,s),k(a,o,s),C(t,a,s),k(a,c,s),C(f,a,s),l=!0},p(a,[s]){const p={};!n&&s&4&&(n=!0,p.posts=a[2],T(()=>n=!1)),!i&&s&2&&(i=!0,p.keyboardY=a[1],T(()=>i=!1)),t.$set(p);const g={};s&1048585&&(g.$$scope={dirty:s,ctx:a}),f.$set(g)},i(a){l||(b(e.$$.fragment,a),b(t.$$.fragment,a),b(f.$$.fragment,a),l=!0)},o(a){$(e.$$.fragment,a),$(t.$$.fragment,a),$(f.$$.fragment,a),l=!1},d(a){a&&(h(o),h(c)),v(e,a),v(t,a),v(f,a)}}}function ve(r,e,o){let t,n,i,c,f;x(r,me,u=>o(15,i=u)),x(r,G,u=>o(8,c=u)),x(r,ee,u=>o(3,f=u));const l=Z.getPlatform()!=="web",m=i.url.searchParams.get("type");let{data:d}=e,_;const a={"전체 공개":"public","팔로워 공개":"follower",비공개:"private"};async function s(){var I;(await fetch(`${D}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({placeIdx:i.url.searchParams.get("placeIdx"),text:((I=n.at(0))==null?void 0:I.text)||"",media:t,permission:a[_]})})).ok&&await S("/users/0",{replaceState:!0,invalidateAll:!0})}async function p(){var u;try{const I=await fetch(`${D}/posts/${i.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({text:((u=n.at(0))==null?void 0:u.text)||""})});if(!I.ok){(await I.json()).status===401&&(q.emit("pushSnackbar",{message:"접근할 수 없습니다"}),S(`/viewer?postIdx=${i.url.searchParams.get("postIdx")}`));return}await S("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let g=0;function J(){B.addListener("keyboardWillShow",u=>{o(1,g=u.keyboardHeight*-1)}),B.addListener("keyboardWillHide",()=>{o(1,g=0)})}function U(){B.removeAllListeners()}re(()=>{l&&J()}),ne(()=>{l&&U()});function V(u){n=u,o(2,n),o(7,d)}function z(u){g=u,o(1,g)}function K(u){_=u,o(0,_)}const W=()=>p(),R=()=>s();return r.$$set=u=>{"data"in u&&o(7,d=u.data)},r.$$.update=()=>{r.$$.dirty&256&&(t=c),r.$$.dirty&128&&o(2,n=d.posts)},[_,g,n,f,m,s,p,d,c,V,z,K,W,R]}class Le extends se{constructor(e){super(),ae(this,e,ve,Ce,oe,{data:7})}}export{Le as component,He as universal};
