import{k as ye,e as me,A as ie,g as se,n as ge,C as Ce,m as ce}from"../chunks/sign.D1hvpANE.js";import{e as Z}from"../chunks/index.g5YcAAdQ.js";import{l as Ie,s as be,e as V,c as B,b as P,f as w,v as $,i as j,t as re,a as Y,d as ne,g as T,h as y,A as R,S as Ve,j as fe,n as U,y as G,z as W,k as de,w as Be,x as De,V as Ae,F as Ee,B as ae}from"../chunks/scheduler.BTWb34i-.js";import{g as ee}from"../chunks/entry.C9m624fl.js";import{S as ve,i as we,g as oe,f as le,t as D,a as A,c as F,b as M,m as z,d as H,e as Q}from"../chunks/index.D8fgSKXR.js";import{H as $e}from"../chunks/Header.B4ZdURB9.js";import{V as ke}from"../chunks/Viewer.B8U4U7rE.js";/* empty css                                                   */import{p as xe}from"../chunks/stores.BuR131Dn.js";import{K as te}from"../chunks/index.BYuGGbts.js";import{e as pe,u as Pe,o as Se}from"../chunks/each.Co5Upyp2.js";import{I as Ne}from"../chunks/IconChevronRight.DPmjPHOM.js";import{B as Oe}from"../chunks/BottomNavigationPadder.DwHlk_jT.js";import{V as Ye}from"../chunks/VisibilitySheet.UKRzLLyM.js";import{N as Te}from"../chunks/NavigationBar.xrgyMeCO.js";const je=async({fetch:s,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return Z(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const i=ye();return{posts:[{user_idx:i==null?void 0:i.sub,unique_name:i==null?void 0:i.uni,profile_image_url:i==null?void 0:i.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Ie(ge),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const i=e.searchParams.get("postIdx");if(i==="null")return me.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),ee("/viewer",{replaceState:!0});i||Z(404,"Not Found");const n=await s(`${ie}/posts/${i}`,{method:"GET",headers:{Authorization:"Bearer "+se()}}).then(o=>o.json()).then(o=>o.data);return n.error&&Z(404,"Not Found"),{posts:[{...n,mediaIdx:0}]}}return Z(404,"Not Found")},_t=Object.freeze(Object.defineProperty({__proto__:null,load:je},Symbol.toStringTag,{value:"Module"}));function _e(s,e,t){const i=s.slice();return i[1]=e[t],i[3]=t,i}function Fe(s){let e;return{c(){e=V("div"),this.h()},l(t){e=B(t,"DIV",{class:!0}),P(e).forEach(w),this.h()},h(){$(e,"class","w-0.5")},m(t,i){j(t,e,i)},i:U,o:U,d(t){t&&w(e)}}}function Me(s){let e,t;return e=new Ne({props:{fill:"#6B7280",length:"1.25"}}),{c(){F(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,n){z(e,i,n),t=!0},i(i){t||(D(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){H(e,i)}}}function he(s,e){let t,i,n=e[1].title+"",o,g,a,l,c=e[1].value+"",_,b,r,f,u,h,m,E,S;const x=[Me,Fe],k=[];function J(C,I){return C[1].onClick?0:1}return r=J(e),f=k[r]=x[r](e),{key:s,first:null,c(){t=V("div"),i=V("span"),o=re(n),g=Y(),a=V("div"),l=V("span"),_=re(c),b=Y(),f.c(),u=Y(),this.h()},l(C){t=B(C,"DIV",{class:!0});var I=P(t);i=B(I,"SPAN",{class:!0});var N=P(i);o=ne(N,n),N.forEach(w),g=T(I),a=B(I,"DIV",{class:!0});var O=P(a);l=B(O,"SPAN",{class:!0});var p=P(l);_=ne(p,c),p.forEach(w),b=T(O),f.l(O),O.forEach(w),u=T(I),I.forEach(w),this.h()},h(){$(i,"class","text-white text-sm font-medium"),$(l,"class","text-gray-500 text-xs"),$(a,"class","flex items-center gap-2"),$(t,"class",h=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(C,I){j(C,t,I),y(t,i),y(i,o),y(t,g),y(t,a),y(a,l),y(l,_),y(a,b),k[r].m(a,null),y(t,u),m=!0,E||(S=R(t,"click",function(){Ve(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),E=!0)},p(C,I){e=C,(!m||I&1)&&n!==(n=e[1].title+"")&&fe(o,n),(!m||I&1)&&c!==(c=e[1].value+"")&&fe(_,c);let N=r;r=J(e),r!==N&&(oe(),A(k[N],1,1,()=>{k[N]=null}),le(),f=k[r],f||(f=k[r]=x[r](e),f.c()),D(f,1),f.m(a,null)),(!m||I&1&&h!==(h=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&$(t,"class",h)},i(C){m||(D(f),m=!0)},o(C){A(f),m=!1},d(C){C&&w(t),k[r].d(),E=!1,S()}}}function ze(s){let e,t=[],i=new Map,n,o=pe(s[0]);const g=a=>a[1].id;for(let a=0;a<o.length;a+=1){let l=_e(s,o,a),c=g(l);i.set(c,t[a]=he(c,l))}return{c(){e=V("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=B(a,"DIV",{class:!0});var l=P(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(w),this.h()},h(){$(e,"class","flex flex-col w-full")},m(a,l){j(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,[l]){l&1&&(o=pe(a[0]),oe(),t=Pe(t,l,g,1,a,o,i,e,Se,he,null,_e),le())},i(a){if(!n){for(let l=0;l<o.length;l+=1)D(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)A(t[l]);n=!1},d(a){a&&w(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function He(s,e,t){let{items:i=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return s.$$set=n=>{"items"in n&&t(0,i=n.items)},[i]}class Je extends ve{constructor(e){super(),we(this,e,He,ze,be,{items:0})}}function Ke(s){let e,t,i,n,o,g,a,l;e=new $e({props:{position:"fixed",leftBack:"white",$$slots:{right:[Re],default:[qe]},$$scope:{ctx:s}}});function c(r){s[20](r)}function _(r){s[21](r)}let b={dontMoveVertically:!0,hideActionButtons:!0};return s[1]!==void 0&&(b.posts=s[1]),s[5]!==void 0&&(b.keyboardY=s[5]),i=new ke({props:b}),G.push(()=>Q(i,"posts",c)),G.push(()=>Q(i,"keyboardY",_)),a=new Te({}),{c(){F(e.$$.fragment),t=Y(),F(i.$$.fragment),g=Y(),F(a.$$.fragment)},l(r){M(e.$$.fragment,r),t=T(r),M(i.$$.fragment,r),g=T(r),M(a.$$.fragment,r)},m(r,f){z(e,r,f),j(r,t,f),z(i,r,f),j(r,g,f),z(a,r,f),l=!0},p(r,f){const u={};f&536870912&&(u.$$scope={dirty:f,ctx:r}),e.$set(u);const h={};!n&&f&2&&(n=!0,h.posts=r[1],W(()=>n=!1)),!o&&f&32&&(o=!0,h.keyboardY=r[5],W(()=>o=!1)),i.$set(h)},i(r){l||(D(e.$$.fragment,r),D(i.$$.fragment,r),D(a.$$.fragment,r),l=!0)},o(r){A(e.$$.fragment,r),A(i.$$.fragment,r),A(a.$$.fragment,r),l=!1},d(r){r&&(w(t),w(g)),H(e,r),H(i,r),H(a,r)}}}function Le(s){let e,t,i,n,o,g,a,l,c,_,b=(s[2]||"텍스트 입력하기...")+"",r,f,u,h,m,E,S,x,k,J,C;t=new $e({props:{position:"static",leftBack:"white",$$slots:{right:[Ge]},$$scope:{ctx:s}}});function I(p){s[14](p)}function N(p){s[15](p)}let O={dontMoveVertically:!0,isEdit:!0};return s[1]!==void 0&&(O.posts=s[1]),s[5]!==void 0&&(O.keyboardY=s[5]),o=new ke({props:O}),G.push(()=>Q(o,"posts",I)),G.push(()=>Q(o,"keyboardY",N)),m=new Je({props:{items:[{id:1,title:"장소",value:s[1][0].place_name||""},{id:2,title:"공개 여부",value:ce[s[4]],onClick:s[18]}]}}),x=new Oe({}),{c(){e=V("section"),F(t.$$.fragment),i=Y(),n=V("div"),F(o.$$.fragment),l=Y(),c=V("div"),_=V("div"),r=re(b),u=Y(),h=V("div"),F(m.$$.fragment),E=Y(),S=V("div"),F(x.$$.fragment),this.h()},l(p){e=B(p,"SECTION",{class:!0});var v=P(e);M(t.$$.fragment,v),i=T(v),n=B(v,"DIV",{class:!0});var L=P(n);M(o.$$.fragment,L),L.forEach(w),l=T(v),c=B(v,"DIV",{class:!0});var K=P(c);_=B(K,"DIV",{contenteditable:!0,class:!0});var q=P(_);r=ne(q,b),q.forEach(w),K.forEach(w),u=T(v),h=B(v,"DIV",{class:!0});var X=P(h);M(m.$$.fragment,X),X.forEach(w),E=T(v),S=B(v,"DIV",{class:!0});var d=P(S);M(x.$$.fragment,d),d.forEach(w),v.forEach(w),this.h()},h(){$(n,"class","flex flex-grow"),$(_,"contenteditable","true"),$(_,"class",f=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${s[6]?"text-gray-400":"text-white"}
        `),$(c,"class","h-32 px-5 py-2.5"),$(h,"class",""),$(S,"class","h-40"),$(e,"class","flex flex-col w-full h-screen bg-black")},m(p,v){j(p,e,v),z(t,e,null),y(e,i),y(e,n),z(o,n,null),y(e,l),y(e,c),y(c,_),y(_,r),y(e,u),y(e,h),z(m,h,null),y(e,E),y(e,S),z(x,S,null),k=!0,J||(C=[R(_,"input",s[10]),R(_,"focus",s[16]),R(_,"blur",s[17])],J=!0)},p(p,v){const L={};v&536870913&&(L.$$scope={dirty:v,ctx:p}),t.$set(L);const K={};!g&&v&2&&(g=!0,K.posts=p[1],W(()=>g=!1)),!a&&v&32&&(a=!0,K.keyboardY=p[5],W(()=>a=!1)),o.$set(K),(!k||v&4)&&b!==(b=(p[2]||"텍스트 입력하기...")+"")&&Ae(r,b),(!k||v&64&&f!==(f=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${p[6]?"text-gray-400":"text-white"}
        `))&&$(_,"class",f);const q={};v&26&&(q.items=[{id:1,title:"장소",value:p[1][0].place_name||""},{id:2,title:"공개 여부",value:ce[p[4]],onClick:p[18]}]),m.$set(q)},i(p){k||(D(t.$$.fragment,p),D(o.$$.fragment,p),D(m.$$.fragment,p),D(x.$$.fragment,p),k=!0)},o(p){A(t.$$.fragment,p),A(o.$$.fragment,p),A(m.$$.fragment,p),A(x.$$.fragment,p),k=!1},d(p){p&&w(e),H(t),H(o),H(m),H(x),J=!1,Ee(C)}}}function qe(s){let e,t="미리보기";return{c(){e=V("p"),e.textContent=t,this.h()},l(i){e=B(i,"P",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-1hktwn7"&&(e.textContent=t),this.h()},h(){$(e,"class","text-white text-[0.9375rem] font-semibold")},m(i,n){j(i,e,n)},p:U,d(i){i&&w(e)}}}function Re(s){let e,t="완료",i,n;return{c(){e=V("div"),e.textContent=t,this.h()},l(o){e=B(o,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-11t55ng"&&(e.textContent=t),this.h()},h(){$(e,"slot","right"),$(e,"class","text-white")},m(o,g){j(o,e,g),i||(n=R(e,"click",s[19]),i=!0)},p:U,d(o){o&&w(e),i=!1,n()}}}function Ge(s){let e,t="다음",i,n;return{c(){e=V("div"),e.textContent=t,this.h()},l(o){e=B(o,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){$(e,"slot","right"),$(e,"class","text-white")},m(o,g){j(o,e,g),i||(n=R(e,"click",s[13]),i=!0)},p:U,d(o){o&&w(e),i=!1,n()}}}function We(s){let e,t,i,n,o,g,a;const l=[Le,Ke],c=[];function _(u,h){return u[0]===0?0:u[0]===1?1:-1}~(e=_(s))&&(t=c[e]=l[e](s));function b(u){s[22](u)}function r(u){s[23](u)}let f={};return s[3]!==void 0&&(f.isOpen=s[3]),s[4]!==void 0&&(f.selectedVisibility=s[4]),n=new Ye({props:f}),G.push(()=>Q(n,"isOpen",b)),G.push(()=>Q(n,"selectedVisibility",r)),{c(){t&&t.c(),i=Y(),F(n.$$.fragment)},l(u){t&&t.l(u),i=T(u),M(n.$$.fragment,u)},m(u,h){~e&&c[e].m(u,h),j(u,i,h),z(n,u,h),a=!0},p(u,[h]){let m=e;e=_(u),e===m?~e&&c[e].p(u,h):(t&&(oe(),A(c[m],1,1,()=>{c[m]=null}),le()),~e?(t=c[e],t?t.p(u,h):(t=c[e]=l[e](u),t.c()),D(t,1),t.m(i.parentNode,i)):t=null);const E={};!o&&h&8&&(o=!0,E.isOpen=u[3],W(()=>o=!1)),!g&&h&16&&(g=!0,E.selectedVisibility=u[4],W(()=>g=!1)),n.$set(E)},i(u){a||(D(t),D(n.$$.fragment,u),a=!0)},o(u){A(t),A(n.$$.fragment,u),a=!1},d(u){u&&w(i),~e&&c[e].d(u),H(n,u)}}}function Qe(s){const e=s.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function Ue(s){const e=s.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function Xe(s,e,t){let i,n,o;de(s,xe,d=>t(25,n=d)),de(s,ge,d=>t(12,o=d));const g=Ce.getPlatform()!=="web",a=n.url.searchParams.get("type");let l=0,{data:c}=e,_=c.posts,b=_[0].text||"",r=!1,f="public";async function u(){(await fetch(`${ie}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se()}`},body:JSON.stringify({placeIdx:n.url.searchParams.get("placeIdx"),text:b,media:i,permission:f})})).ok&&await ee("/users/0",{replaceState:!0,invalidateAll:!0})}async function h(){try{const d=await fetch(`${ie}/posts/${n.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se()}`},body:JSON.stringify({text:b})});if(!d.ok){(await d.json()).status===401&&(me.emit("pushSnackbar",{message:"접근할 수 없습니다"}),ee(`/viewer?postIdx=${n.url.searchParams.get("postIdx")}`));return}await ee("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let m=0;function E(){te.addListener("keyboardWillShow",d=>{t(5,m=d.keyboardHeight*-1)}),te.addListener("keyboardWillHide",()=>{t(5,m=0)})}function S(){te.removeAllListeners()}Be(()=>{g&&E()}),De(()=>{g&&S()});function x(d){const ue=d.target;t(2,b=ue.innerText),t(1,_[0]={..._[0],text:b},_)}let k=b.trim()==="";const J=()=>{t(0,l=1)};function C(d){_=d,t(1,_)}function I(d){m=d,t(5,m)}const N=d=>{Qe(d),t(6,k=!1)},O=d=>{Ue(d),t(6,k=!b.trim())},p=()=>{t(3,r=!0)},v=()=>{a==="post"?u():a==="patch"&&h()};function L(d){_=d,t(1,_)}function K(d){m=d,t(5,m)}function q(d){r=d,t(3,r)}function X(d){f=d,t(4,f)}return s.$$set=d=>{"data"in d&&t(11,c=d.data)},s.$$.update=()=>{s.$$.dirty&4096&&(i=o)},[l,_,b,r,f,m,k,a,u,h,x,c,o,J,C,I,N,O,p,v,L,K,q,X]}class ht extends ve{constructor(e){super(),we(this,e,Xe,We,be,{data:11})}}export{ht as component,_t as universal};
