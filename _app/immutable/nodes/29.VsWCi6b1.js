import{l as De,e as ve,A as oe,g as le,m as ke,C as Ae,n as pe,o as re,k as _e}from"../chunks/sign.0aT8s_FQ.js";import{e as ee}from"../chunks/index.g5YcAAdQ.js";import{l as Ee,s as we,e as D,c as A,b as x,f as v,v as w,i as H,t as ue,a as O,d as ce,g as Y,h as $,A as G,S as Pe,j as me,n as se,y as W,z as Q,k as te,w as Se,x as xe,P as ne,V as Ne,F as Te,B as ye}from"../chunks/scheduler.CCBjAsUD.js";import{g as ie}from"../chunks/entry.B-yd-0Ye.js";import{S as $e,i as Ce,g as fe,f as de,t as E,a as P,c as j,b as F,m as M,d as z,e as U}from"../chunks/index.svcsDwjp.js";import{H as Ie}from"../chunks/Header.BZeCYiaQ.js";import{V as Ve}from"../chunks/Viewer.df0r4b2x.js";/* empty css                                                   */import{p as Oe}from"../chunks/stores.CVDMaFqM.js";import{K as ae}from"../chunks/index.B_-3zMYV.js";import{e as he,u as Ye,o as je}from"../chunks/each.D6kHJ57P.js";import{I as Fe}from"../chunks/IconChevronRight.p27myjzK.js";import{B as Me}from"../chunks/BottomNavigationPadder.CxxFKKvp.js";import{V as ze}from"../chunks/VisibilitySheet.BHeiDMtL.js";import{N as He}from"../chunks/NavigationBar.CAkV0E_G.js";const Je=async({fetch:s,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return ee(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const i=De();return{posts:[{user_idx:i==null?void 0:i.sub,unique_name:i==null?void 0:i.uni,profile_image_url:i==null?void 0:i.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Ee(ke),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const i=e.searchParams.get("postIdx");if(i==="null")return ve.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),ie("/viewer",{replaceState:!0});i||ee(404,"Not Found");const o=await s(`${oe}/posts/${i}`,{method:"GET",headers:{Authorization:"Bearer "+le()}}).then(n=>n.json()).then(n=>n.data);return o.error&&ee(404,"Not Found"),{posts:[{...o,mediaIdx:0}]}}return ee(404,"Not Found")},bt=Object.freeze(Object.defineProperty({__proto__:null,load:Je},Symbol.toStringTag,{value:"Module"}));function ge(s,e,t){const i=s.slice();return i[1]=e[t],i[3]=t,i}function Ke(s){let e;return{c(){e=D("div"),this.h()},l(t){e=A(t,"DIV",{class:!0}),x(e).forEach(v),this.h()},h(){w(e,"class","w-0.5")},m(t,i){H(t,e,i)},i:se,o:se,d(t){t&&v(e)}}}function Le(s){let e,t;return e=new Fe({props:{fill:"#6B7280",length:"1.25"}}),{c(){j(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){M(e,i,o),t=!0},i(i){t||(E(e.$$.fragment,i),t=!0)},o(i){P(e.$$.fragment,i),t=!1},d(i){z(e,i)}}}function be(s,e){let t,i,o=e[1].title+"",n,m,a,u,d=e[1].value+"",g,k,r,c,l,_,h,B,C;const S=[Le,Ke],I=[];function J(y,V){return y[1].onClick?0:1}return r=J(e),c=I[r]=S[r](e),{key:s,first:null,c(){t=D("div"),i=D("span"),n=ue(o),m=O(),a=D("div"),u=D("span"),g=ue(d),k=O(),c.c(),l=O(),this.h()},l(y){t=A(y,"DIV",{class:!0});var V=x(t);i=A(V,"SPAN",{class:!0});var N=x(i);n=ce(N,o),N.forEach(v),m=Y(V),a=A(V,"DIV",{class:!0});var T=x(a);u=A(T,"SPAN",{class:!0});var p=x(u);g=ce(p,d),p.forEach(v),k=Y(T),c.l(T),T.forEach(v),l=Y(V),V.forEach(v),this.h()},h(){w(i,"class","text-white text-sm font-medium"),w(u,"class","text-gray-500 text-xs"),w(a,"class","flex items-center gap-2"),w(t,"class",_=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(y,V){H(y,t,V),$(t,i),$(i,n),$(t,m),$(t,a),$(a,u),$(u,g),$(a,k),I[r].m(a,null),$(t,l),h=!0,B||(C=G(t,"click",function(){Pe(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),B=!0)},p(y,V){e=y,(!h||V&1)&&o!==(o=e[1].title+"")&&me(n,o),(!h||V&1)&&d!==(d=e[1].value+"")&&me(g,d);let N=r;r=J(e),r!==N&&(fe(),P(I[N],1,1,()=>{I[N]=null}),de(),c=I[r],c||(c=I[r]=S[r](e),c.c()),E(c,1),c.m(a,null)),(!h||V&1&&_!==(_=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&w(t,"class",_)},i(y){h||(E(c),h=!0)},o(y){P(c),h=!1},d(y){y&&v(t),I[r].d(),B=!1,C()}}}function qe(s){let e,t=[],i=new Map,o,n=he(s[0]);const m=a=>a[1].id;for(let a=0;a<n.length;a+=1){let u=ge(s,n,a),d=m(u);i.set(d,t[a]=be(d,u))}return{c(){e=D("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=A(a,"DIV",{class:!0});var u=x(e);for(let d=0;d<t.length;d+=1)t[d].l(u);u.forEach(v),this.h()},h(){w(e,"class","flex flex-col w-full")},m(a,u){H(a,e,u);for(let d=0;d<t.length;d+=1)t[d]&&t[d].m(e,null);o=!0},p(a,[u]){u&1&&(n=he(a[0]),fe(),t=Ye(t,u,m,1,a,n,i,e,je,be,null,ge),de())},i(a){if(!o){for(let u=0;u<n.length;u+=1)E(t[u]);o=!0}},o(a){for(let u=0;u<t.length;u+=1)P(t[u]);o=!1},d(a){a&&v(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function Re(s,e,t){let{items:i=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return s.$$set=o=>{"items"in o&&t(0,i=o.items)},[i]}class Ge extends $e{constructor(e){super(),Ce(this,e,Re,qe,we,{items:0})}}function We(s){let e,t,i,o,n,m,a,u;e=new Ie({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",$$slots:{right:[Ue]},$$scope:{ctx:s}}});function d(r){s[20](r)}function g(r){s[21](r)}let k={dontMoveVertically:!0,hideActionButtons:!0};return s[1]!==void 0&&(k.posts=s[1]),s[5]!==void 0&&(k.keyboardY=s[5]),i=new Ve({props:k}),W.push(()=>U(i,"posts",d)),W.push(()=>U(i,"keyboardY",g)),a=new He({}),{c(){j(e.$$.fragment),t=O(),j(i.$$.fragment),m=O(),j(a.$$.fragment)},l(r){F(e.$$.fragment,r),t=Y(r),F(i.$$.fragment,r),m=Y(r),F(a.$$.fragment,r)},m(r,c){M(e,r,c),H(r,t,c),M(i,r,c),H(r,m,c),M(a,r,c),u=!0},p(r,c){const l={};c[1]&1&&(l.$$scope={dirty:c,ctx:r}),e.$set(l);const _={};!o&&c[0]&2&&(o=!0,_.posts=r[1],Q(()=>o=!1)),!n&&c[0]&32&&(n=!0,_.keyboardY=r[5],Q(()=>n=!1)),i.$set(_)},i(r){u||(E(e.$$.fragment,r),E(i.$$.fragment,r),E(a.$$.fragment,r),u=!0)},o(r){P(e.$$.fragment,r),P(i.$$.fragment,r),P(a.$$.fragment,r),u=!1},d(r){r&&(v(t),v(m)),z(e,r),z(i,r),z(a,r)}}}function Qe(s){let e,t,i,o,n,m,a,u,d,g,k=(s[2]||"텍스트 입력하기...")+"",r,c,l,_,h,B,C,S,I,J,y;t=new Ie({props:{position:"static",leftBack:"white",$$slots:{right:[Xe]},$$scope:{ctx:s}}});function V(p){s[14](p)}function N(p){s[15](p)}let T={dontMoveVertically:!0,isEdit:!0};return s[1]!==void 0&&(T.posts=s[1]),s[5]!==void 0&&(T.keyboardY=s[5]),n=new Ve({props:T}),W.push(()=>U(n,"posts",V)),W.push(()=>U(n,"keyboardY",N)),h=new Ge({props:{items:[{id:1,title:"장소",value:s[1][0].place_name||""},{id:2,title:"공개 여부",value:_e[s[4]],onClick:s[18]}]}}),S=new Me({}),{c(){e=D("section"),j(t.$$.fragment),i=O(),o=D("div"),j(n.$$.fragment),u=O(),d=D("div"),g=D("div"),r=ue(k),l=O(),_=D("div"),j(h.$$.fragment),B=O(),C=D("div"),j(S.$$.fragment),this.h()},l(p){e=A(p,"SECTION",{class:!0});var b=x(e);F(t.$$.fragment,b),i=Y(b),o=A(b,"DIV",{class:!0});var L=x(o);F(n.$$.fragment,L),L.forEach(v),u=Y(b),d=A(b,"DIV",{class:!0});var K=x(d);g=A(K,"DIV",{contenteditable:!0,class:!0});var q=x(g);r=ce(q,k),q.forEach(v),K.forEach(v),l=Y(b),_=A(b,"DIV",{class:!0});var X=x(_);F(h.$$.fragment,X),X.forEach(v),B=Y(b),C=A(b,"DIV",{class:!0});var Z=x(C);F(S.$$.fragment,Z),Z.forEach(v),b.forEach(v),this.h()},h(){w(o,"class","flex flex-grow"),w(g,"contenteditable","true"),w(g,"class",c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${s[6]?"text-gray-400":"text-white"}
        `),w(d,"class","h-32 px-5 py-2.5"),w(_,"class",""),w(C,"class","h-40"),w(e,"class","flex flex-col w-full h-screen bg-black")},m(p,b){H(p,e,b),M(t,e,null),$(e,i),$(e,o),M(n,o,null),$(e,u),$(e,d),$(d,g),$(g,r),$(e,l),$(e,_),M(h,_,null),$(e,B),$(e,C),M(S,C,null),I=!0,J||(y=[G(g,"input",s[10]),G(g,"focus",s[16]),G(g,"blur",s[17])],J=!0)},p(p,b){const L={};b[0]&1|b[1]&1&&(L.$$scope={dirty:b,ctx:p}),t.$set(L);const K={};!m&&b[0]&2&&(m=!0,K.posts=p[1],Q(()=>m=!1)),!a&&b[0]&32&&(a=!0,K.keyboardY=p[5],Q(()=>a=!1)),n.$set(K),(!I||b[0]&4)&&k!==(k=(p[2]||"텍스트 입력하기...")+"")&&Ne(r,k),(!I||b[0]&64&&c!==(c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${p[6]?"text-gray-400":"text-white"}
        `))&&w(g,"class",c);const q={};b[0]&26&&(q.items=[{id:1,title:"장소",value:p[1][0].place_name||""},{id:2,title:"공개 여부",value:_e[p[4]],onClick:p[18]}]),h.$set(q)},i(p){I||(E(t.$$.fragment,p),E(n.$$.fragment,p),E(h.$$.fragment,p),E(S.$$.fragment,p),I=!0)},o(p){P(t.$$.fragment,p),P(n.$$.fragment,p),P(h.$$.fragment,p),P(S.$$.fragment,p),I=!1},d(p){p&&v(e),z(t),z(n),z(h),z(S),J=!1,Te(y)}}}function Ue(s){let e,t="완료",i,o;return{c(){e=D("div"),e.textContent=t,this.h()},l(n){e=A(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-11t55ng"&&(e.textContent=t),this.h()},h(){w(e,"slot","right"),w(e,"class","text-white")},m(n,m){H(n,e,m),i||(o=G(e,"click",s[19]),i=!0)},p:se,d(n){n&&v(e),i=!1,o()}}}function Xe(s){let e,t="다음",i,o;return{c(){e=D("div"),e.textContent=t,this.h()},l(n){e=A(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){w(e,"slot","right"),w(e,"class","text-white")},m(n,m){H(n,e,m),i||(o=G(e,"click",s[13]),i=!0)},p:se,d(n){n&&v(e),i=!1,o()}}}function Ze(s){let e,t,i,o,n,m,a;const u=[Qe,We],d=[];function g(l,_){return l[0]===0?0:l[0]===1?1:-1}~(e=g(s))&&(t=d[e]=u[e](s));function k(l){s[22](l)}function r(l){s[23](l)}let c={};return s[3]!==void 0&&(c.isOpen=s[3]),s[4]!==void 0&&(c.selectedVisibility=s[4]),o=new ze({props:c}),W.push(()=>U(o,"isOpen",k)),W.push(()=>U(o,"selectedVisibility",r)),{c(){t&&t.c(),i=O(),j(o.$$.fragment)},l(l){t&&t.l(l),i=Y(l),F(o.$$.fragment,l)},m(l,_){~e&&d[e].m(l,_),H(l,i,_),M(o,l,_),a=!0},p(l,_){let h=e;e=g(l),e===h?~e&&d[e].p(l,_):(t&&(fe(),P(d[h],1,1,()=>{d[h]=null}),de()),~e?(t=d[e],t?t.p(l,_):(t=d[e]=u[e](l),t.c()),E(t,1),t.m(i.parentNode,i)):t=null);const B={};!n&&_[0]&8&&(n=!0,B.isOpen=l[3],Q(()=>n=!1)),!m&&_[0]&16&&(m=!0,B.selectedVisibility=l[4],Q(()=>m=!1)),o.$set(B)},i(l){a||(E(t),E(o.$$.fragment,l),a=!0)},o(l){P(t),P(o.$$.fragment,l),a=!1},d(l){l&&v(i),~e&&d[e].d(l),z(o,l)}}}function et(s){const e=s.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function tt(s){const e=s.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function it(s,e,t){let i,o,n,m,a;te(s,pe,f=>t(25,o=f)),te(s,re,f=>t(26,n=f)),te(s,Oe,f=>t(27,m=f)),te(s,ke,f=>t(12,a=f));const u=Ae.getPlatform()!=="web",d=m.url.searchParams.get("type");let g=0,{data:k}=e,r=k.posts,c="",l=!1,_="public";async function h(){const f=r==null?void 0:r.at(0);(await fetch(`${oe}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le()}`},body:JSON.stringify({placeIdx:f.place_idx,text:c,media:i,permission:_})})).ok&&await ie(`/places/${f.place_idx}`,{replaceState:!0,invalidateAll:!0})}async function B(){try{const f=await fetch(`${oe}/posts/${m.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le()}`},body:JSON.stringify({text:c})});if(!f.ok){(await f.json()).status===401&&(ve.emit("pushSnackbar",{message:"접근할 수 없습니다"}),ie(`/viewer?postIdx=${m.url.searchParams.get("postIdx")}`));return}await ie("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let C=0;function S(){ae.addListener("keyboardWillShow",f=>{t(5,C=f.keyboardHeight*-1)}),ae.addListener("keyboardWillHide",()=>{t(5,C=0)})}function I(){ae.removeAllListeners()}Se(()=>{var f,R;u&&S(),n?(t(2,c=n),ne(re,n="",n)):(f=h[0])!=null&&f.text&&t(2,c=(R=h[0])==null?void 0:R.text)}),xe(()=>{u&&I(),ne(re,n="",n),ne(pe,o="",o)});function J(f){const R=f.target;t(2,c=R.innerText),t(1,r[0]={...r[0],text:c},r)}let y=c.trim()==="";const V=()=>{t(0,g=1)};function N(f){r=f,t(1,r)}function T(f){C=f,t(5,C)}const p=f=>{et(f),t(6,y=!1)},b=f=>{tt(f),t(6,y=!c.trim())},L=()=>{t(3,l=!0)},K=()=>{d==="post"?h():d==="patch"&&B()};function q(f){r=f,t(1,r)}function X(f){C=f,t(5,C)}function Z(f){l=f,t(3,l)}function Be(f){_=f,t(4,_)}return s.$$set=f=>{"data"in f&&t(11,k=f.data)},s.$$.update=()=>{s.$$.dirty[0]&4096&&(i=a)},[g,r,c,l,_,C,y,d,h,B,J,k,a,V,N,T,p,b,L,K,q,X,Z,Be]}class vt extends $e{constructor(e){super(),Ce(this,e,it,Ze,we,{data:11},null,[-1,-1])}}export{vt as component,bt as universal};
