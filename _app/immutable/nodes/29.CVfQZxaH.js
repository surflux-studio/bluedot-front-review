import{b as Te,g as te}from"../chunks/sign.BRsHEAVz.js";import{e as Q}from"../chunks/index.HVI8U2Wx.js";import{e as G,A as se,b as ie,g as ge,h as ue,I as be,k as ce}from"../chunks/store.yog8tTTa.js";import{l as Ne,s as ve,e as O,c as V,b as T,f as v,v as $,i as j,t as ne,a as N,d as re,g as x,h as I,A as W,I as xe,j as fe,n as oe,w as J,x as U,k as ee,y as je,B as Fe,U as Me,D as pe,V as He,F as ze,z as Ce,N as de,T as Ke}from"../chunks/scheduler.CIbz-4tf.js";import{g as Z}from"../chunks/entry.8J5CcqAQ.js";import{S as ke,i as we,g as ae,e as le,t as A,a as E,c as M,d as H,m as z,f as K,b as X}from"../chunks/index.gvaMc9LH.js";import{H as ye}from"../chunks/Header.BeQUO8m8.js";import{V as $e}from"../chunks/Viewer.BxN1g7xa.js";/* empty css                                                   */import{p as Le}from"../chunks/stores.m2Z_-5TV.js";import"../chunks/ActionSheet.svelte_svelte_type_style_lang.BjXYEHI1.js";import{C as Re}from"../chunks/device.BuWhri9c.js";import{e as _e,u as Je,o as qe}from"../chunks/each.Cdd7o6io.js";import{I as Ge}from"../chunks/IconChevronRight.Bzgz52r7.js";import{V as We}from"../chunks/VisibilitySheet.Ch_gWixf.js";import{N as Ue}from"../chunks/NavigationBar.DqEn28u7.js";import{A as Xe}from"../chunks/ActionSheetOpenApp.P--K6Dxl.js";import{o as Ye,a as Qe}from"../chunks/ActionSheet.Rw9zQ-jT.js";const Ze=async({fetch:i,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return Q(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const s=Te();return{posts:[{user_idx:s==null?void 0:s.sub,unique_name:s==null?void 0:s.uni,profile_image_url:s==null?void 0:s.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Ne(ge),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const s=e.searchParams.get("postIdx");if(s==="null")return G.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),Z("/viewer",{replaceState:!0});s||Q(404,"Not Found");const a=await i(`${se}/posts/${s}`,{method:"GET",headers:{Authorization:"Bearer "+te(),"x-api-version":ie.POST}}).then(n=>n.json()).then(n=>n.data);return a.error&&Q(404,"Not Found"),{posts:[{...a,mediaIdx:0}]}}return Q(404,"Not Found")},St=Object.freeze(Object.defineProperty({__proto__:null,load:Ze},Symbol.toStringTag,{value:"Module"}));function he(i,e,t){const s=i.slice();return s[1]=e[t],s[3]=t,s}function et(i){let e;return{c(){e=O("div"),this.h()},l(t){e=V(t,"DIV",{class:!0}),T(e).forEach(v),this.h()},h(){$(e,"class","w-0.5")},m(t,s){j(t,e,s)},i:oe,o:oe,d(t){t&&v(e)}}}function tt(i){let e,t;return e=new Ge({props:{fill:"#6B7280",length:"1.25"}}),{c(){M(e.$$.fragment)},l(s){H(e.$$.fragment,s)},m(s,a){z(e,s,a),t=!0},i(s){t||(A(e.$$.fragment,s),t=!0)},o(s){E(e.$$.fragment,s),t=!1},d(s){K(e,s)}}}function me(i,e){let t,s,a=e[1].title+"",n,_,u,l,p=e[1].value+"",h,r,c,g,D,w,B,C,S;const o=[tt,et],b=[];function P(k,y){return k[1].onClick?0:1}return c=P(e),g=b[c]=o[c](e),{key:i,first:null,c(){t=O("div"),s=O("span"),n=ne(a),_=N(),u=O("div"),l=O("span"),h=ne(p),r=N(),g.c(),D=N(),this.h()},l(k){t=V(k,"DIV",{class:!0});var y=T(t);s=V(y,"SPAN",{class:!0});var d=T(s);n=re(d,a),d.forEach(v),_=x(y),u=V(y,"DIV",{class:!0});var m=T(u);l=V(m,"SPAN",{class:!0});var F=T(l);h=re(F,p),F.forEach(v),r=x(m),g.l(m),m.forEach(v),D=x(y),y.forEach(v),this.h()},h(){$(s,"class","text-white text-sm font-medium"),$(l,"class","text-gray-500 text-xs"),$(u,"class","flex items-center gap-2"),$(t,"class",w=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(k,y){j(k,t,y),I(t,s),I(s,n),I(t,_),I(t,u),I(u,l),I(l,h),I(u,r),b[c].m(u,null),I(t,D),B=!0,C||(S=W(t,"click",function(){xe(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),C=!0)},p(k,y){e=k,(!B||y&1)&&a!==(a=e[1].title+"")&&fe(n,a),(!B||y&1)&&p!==(p=e[1].value+"")&&fe(h,p);let d=c;c=P(e),c!==d&&(ae(),E(b[d],1,1,()=>{b[d]=null}),le(),g=b[c],g||(g=b[c]=o[c](e),g.c()),A(g,1),g.m(u,null)),(!B||y&1&&w!==(w=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&$(t,"class",w)},i(k){B||(A(g),B=!0)},o(k){E(g),B=!1},d(k){k&&v(t),b[c].d(),C=!1,S()}}}function st(i){let e,t=[],s=new Map,a,n=_e(i[0]);const _=u=>u[1].id;for(let u=0;u<n.length;u+=1){let l=he(i,n,u),p=_(l);s.set(p,t[u]=me(p,l))}return{c(){e=O("div");for(let u=0;u<t.length;u+=1)t[u].c();this.h()},l(u){e=V(u,"DIV",{class:!0});var l=T(e);for(let p=0;p<t.length;p+=1)t[p].l(l);l.forEach(v),this.h()},h(){$(e,"class","flex flex-col w-full")},m(u,l){j(u,e,l);for(let p=0;p<t.length;p+=1)t[p]&&t[p].m(e,null);a=!0},p(u,[l]){l&1&&(n=_e(u[0]),ae(),t=Je(t,l,_,1,u,n,s,e,qe,me,null,he),le())},i(u){if(!a){for(let l=0;l<n.length;l+=1)A(t[l]);a=!0}},o(u){for(let l=0;l<t.length;l+=1)E(t[l]);a=!1},d(u){u&&v(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function it(i,e,t){let{items:s=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return i.$$set=a=>{"items"in a&&t(0,s=a.items)},[s]}class nt extends ke{constructor(e){super(),we(this,e,it,st,ve,{items:0})}}function rt(i){let e,t,s,a,n,_,u;e=new ye({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",leftBackOnClick:i[25],$$slots:{right:[at]},$$scope:{ctx:i}}});function l(r){i[26](r)}let p={dontMoveVertically:!0,hideActionButtons:!0};i[2]!==void 0&&(p.posts=i[2]),s=new $e({props:p}),J.push(()=>X(s,"posts",l));let h=!be&&lt();return{c(){M(e.$$.fragment),t=N(),M(s.$$.fragment),n=N(),h&&h.c(),_=pe()},l(r){H(e.$$.fragment,r),t=x(r),H(s.$$.fragment,r),n=x(r),h&&h.l(r),_=pe()},m(r,c){z(e,r,c),j(r,t,c),z(s,r,c),j(r,n,c),h&&h.m(r,c),j(r,_,c),u=!0},p(r,c){const g={};c[0]&2&&(g.leftBackOnClick=r[25]),c[0]&288|c[1]&64&&(g.$$scope={dirty:c,ctx:r}),e.$set(g);const D={};!a&&c[0]&4&&(a=!0,D.posts=r[2],U(()=>a=!1)),s.$set(D)},i(r){u||(A(e.$$.fragment,r),A(s.$$.fragment,r),A(h),u=!0)},o(r){E(e.$$.fragment,r),E(s.$$.fragment,r),E(h),u=!1},d(r){r&&(v(t),v(n),v(_)),K(e,r),K(s,r),h&&h.d(r)}}}function ot(i){let e,t,s,a,n,_,u,l,p,h=(i[0]||"텍스트 입력하기...")+"",r,c,g,D,w,B,C,S,o,b,P;t=new ye({props:{position:"sticky",leftBack:"white",backgroundColor:"bg-black",$$slots:{right:[ut]},$$scope:{ctx:i}}});function k(d){i[18](d)}let y={dontMoveVertically:!0,isEdit:!0};return i[2]!==void 0&&(y.posts=i[2]),n=new $e({props:y}),J.push(()=>X(n,"posts",k)),w=new nt({props:{items:[{id:1,title:"장소",value:i[2][0].place_name||""},{id:2,title:"공개 여부",value:ce[i[4]],onClick:i[22]}]}}),{c(){e=O("section"),M(t.$$.fragment),s=N(),a=O("div"),M(n.$$.fragment),u=N(),l=O("div"),p=O("div"),r=ne(h),g=N(),D=O("div"),M(w.$$.fragment),B=N(),C=O("div"),this.h()},l(d){e=V(d,"SECTION",{class:!0,style:!0});var m=T(e);H(t.$$.fragment,m),s=x(m),a=V(m,"DIV",{class:!0});var F=T(a);H(n.$$.fragment,F),F.forEach(v),u=x(m),l=V(m,"DIV",{class:!0});var L=T(l);p=V(L,"DIV",{contenteditable:!0,class:!0});var R=T(p);r=re(R,h),R.forEach(v),L.forEach(v),g=x(m),D=V(m,"DIV",{});var Y=T(D);H(w.$$.fragment,Y),Y.forEach(v),B=x(m),C=V(m,"DIV",{class:!0}),T(C).forEach(v),m.forEach(v),this.h()},h(){$(a,"class","h-72"),$(p,"contenteditable","true"),$(p,"class",c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto
          focus:outline-none 
          whitespace-pre-wrap
          caret-white
          ${i[10]?"text-gray-400":"text-white"}
        `),$(l,"class","h-32 px-5 py-2.5"),$(C,"class","h-[2.625rem]"),$(e,"class","w-screen h-screen bg-black transition-transform duration-100 overflow-y-auto "),$(e,"style",S=`padding-bottom: ${i[9]}px;`)},m(d,m){j(d,e,m),z(t,e,null),I(e,s),I(e,a),z(n,a,null),I(e,u),I(e,l),I(l,p),I(p,r),i[19](p),I(e,g),I(e,D),z(w,D,null),I(e,B),I(e,C),i[23](e),o=!0,b||(P=[W(p,"input",i[14]),W(p,"focus",i[20]),W(p,"blur",i[21])],b=!0)},p(d,m){const F={};m[0]&2|m[1]&64&&(F.$$scope={dirty:m,ctx:d}),t.$set(F);const L={};!_&&m[0]&4&&(_=!0,L.posts=d[2],U(()=>_=!1)),n.$set(L),(!o||m[0]&1)&&h!==(h=(d[0]||"텍스트 입력하기...")+"")&&He(r,h),(!o||m[0]&1024&&c!==(c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto
          focus:outline-none 
          whitespace-pre-wrap
          caret-white
          ${d[10]?"text-gray-400":"text-white"}
        `))&&$(p,"class",c);const R={};m[0]&28&&(R.items=[{id:1,title:"장소",value:d[2][0].place_name||""},{id:2,title:"공개 여부",value:ce[d[4]],onClick:d[22]}]),w.$set(R),(!o||m[0]&512&&S!==(S=`padding-bottom: ${d[9]}px;`))&&$(e,"style",S)},i(d){o||(A(t.$$.fragment,d),A(n.$$.fragment,d),A(w.$$.fragment,d),o=!0)},o(d){E(t.$$.fragment,d),E(n.$$.fragment,d),E(w.$$.fragment,d),o=!1},d(d){d&&v(e),K(t),K(n),i[19](null),K(w),i[23](null),b=!1,ze(P)}}}function at(i){let e,t="완료",s,a;return{c(){e=O("div"),e.textContent=t,this.h()},l(n){e=V(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-ioumnb"&&(e.textContent=t),this.h()},h(){$(e,"slot","right"),$(e,"class","text-white"),de(e,"opacity-50",i[5])},m(n,_){j(n,e,_),s||(a=W(e,"click",i[24]),s=!0)},p(n,_){_[0]&32&&de(e,"opacity-50",n[5])},d(n){n&&v(e),s=!1,a()}}}function lt(i){let e,t;return e=new Ue({}),{c(){M(e.$$.fragment)},l(s){H(e.$$.fragment,s)},m(s,a){z(e,s,a),t=!0},i(s){t||(A(e.$$.fragment,s),t=!0)},o(s){E(e.$$.fragment,s),t=!1},d(s){K(e,s)}}}function ut(i){let e,t="다음",s,a;return{c(){e=O("div"),e.textContent=t,this.h()},l(n){e=V(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),Ce(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){$(e,"slot","right"),$(e,"class","text-white")},m(n,_){j(n,e,_),s||(a=W(e,"click",i[17]),s=!0)},p:oe,d(n){n&&v(e),s=!1,a()}}}function ct(i){let e,t,s,a,n,_,u,l,p,h;const r=[ot,rt],c=[];function g(o,b){return o[1]===0?0:o[1]===1?1:-1}~(e=g(i))&&(t=c[e]=r[e](i));function D(o){i[27](o)}function w(o){i[28](o)}let B={};i[3]!==void 0&&(B.isOpen=i[3]),i[4]!==void 0&&(B.selectedVisibility=i[4]),a=new We({props:B}),J.push(()=>X(a,"isOpen",D)),J.push(()=>X(a,"selectedVisibility",w));function C(o){i[29](o)}let S={};return i[8]!==void 0&&(S.isOpen=i[8]),l=new Xe({props:S}),J.push(()=>X(l,"isOpen",C)),{c(){t&&t.c(),s=N(),M(a.$$.fragment),u=N(),M(l.$$.fragment)},l(o){t&&t.l(o),s=x(o),H(a.$$.fragment,o),u=x(o),H(l.$$.fragment,o)},m(o,b){~e&&c[e].m(o,b),j(o,s,b),z(a,o,b),j(o,u,b),z(l,o,b),h=!0},p(o,b){let P=e;e=g(o),e===P?~e&&c[e].p(o,b):(t&&(ae(),E(c[P],1,1,()=>{c[P]=null}),le()),~e?(t=c[e],t?t.p(o,b):(t=c[e]=r[e](o),t.c()),A(t,1),t.m(s.parentNode,s)):t=null);const k={};!n&&b[0]&8&&(n=!0,k.isOpen=o[3],U(()=>n=!1)),!_&&b[0]&16&&(_=!0,k.selectedVisibility=o[4],U(()=>_=!1)),a.$set(k);const y={};!p&&b[0]&256&&(p=!0,y.isOpen=o[8],U(()=>p=!1)),l.$set(y)},i(o){h||(A(t),A(a.$$.fragment,o),A(l.$$.fragment,o),h=!0)},o(o){E(t),E(a.$$.fragment,o),E(l.$$.fragment,o),h=!1},d(o){o&&(v(s),v(u)),~e&&c[e].d(o),K(a,o),K(l,o)}}}function ft(i){const e=i.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function pt(i){const e=i.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function dt(i,e,t){let s,a,n,_,u;ee(i,ue,f=>t(32,n=f)),ee(i,Le,f=>t(33,_=f)),ee(i,ge,f=>t(16,u=f)),Re.getPlatform();const l=_.url.searchParams.get("type");let p=0,{data:h}=e,r=h.posts,c="",g=!1,D="public",w=!1,B,C,S=0,o=!1;async function b(){try{const f=r==null?void 0:r.at(0);(await fetch(`${se}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te()}`,"x-api-version":ie.POST},body:JSON.stringify({placeIdx:f.place_idx,text:c,media:s,permission:D,reference:n})})).ok&&await Z(`/places/${f.place_idx}`,{replaceState:!0,invalidateAll:!0})}catch(f){console.error(f),G.emit("pushSnackbar",{message:"게시글 업로드에 실패했습니다"})}}async function P(){try{const f=await fetch(`${se}/posts/${_.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te()}`,"x-api-version":ie.POST},body:JSON.stringify({text:c})});if(!f.ok){(await f.json()).status===401&&(G.emit("pushSnackbar",{message:"접근할 수 없습니다"}),Z(`/viewer?postIdx=${_.url.searchParams.get("postIdx")}`));return}await Z("/users/0",{replaceState:!0,invalidateAll:!0})}catch(f){console.error(f),G.emit("pushSnackbar",{message:"게시글 수정에 실패했습니다"})}}let k=0;function y(f){S=f.keyboardHeight,t(9,k=S),Ke().then(()=>{C==null||C.scrollIntoView({behavior:"smooth",block:"start"})})}function d(){t(9,k=0)}je(()=>{var f,q;Ye(()=>{},y,d),n!=null&&n.text?t(0,c=n.text):(f=r[0])!=null&&f.text&&t(0,c=(q=r[0])==null?void 0:q.text),C&&t(7,C.innerHTML=c||"텍스트 입력하기...",C)}),Fe(()=>{Qe(),Me(ue,n=void 0,n)});function m(f){const q=f.target;t(0,c=q.innerText),t(2,r[0]={...r[0],text:c},r)}const F=()=>{t(1,p=1)};function L(f){r=f,t(2,r)}function R(f){J[f?"unshift":"push"](()=>{C=f,t(7,C)})}const Y=f=>{ft(f),t(10,a=!1)},De=f=>{pt(f),t(10,a=!c.trim())},Be=()=>{t(3,g=!0)};function Ie(f){J[f?"unshift":"push"](()=>{B=f,t(6,B)})}const Ae=async()=>{if(be)return t(8,o=!0);w||(t(5,w=!0),G.emit("loading",!0),l==="post"?await b():l==="patch"&&await P(),t(5,w=!1),G.emit("loading",!1))},Ee=()=>{t(1,p=0)};function Oe(f){r=f,t(2,r)}function Ve(f){g=f,t(3,g)}function Se(f){D=f,t(4,D)}function Pe(f){o=f,t(8,o)}return i.$$set=f=>{"data"in f&&t(15,h=f.data)},i.$$.update=()=>{i.$$.dirty[0]&65536&&(s=u),i.$$.dirty[0]&1&&t(10,a=c==="")},[c,p,r,g,D,w,B,C,o,k,a,l,b,P,m,h,u,F,L,R,Y,De,Be,Ie,Ae,Ee,Oe,Ve,Se,Pe]}class Pt extends ke{constructor(e){super(),we(this,e,dt,ct,ve,{data:15},null,[-1,-1])}}export{Pt as component,St as universal};
