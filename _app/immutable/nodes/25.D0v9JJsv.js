import{e as pe}from"../chunks/index.CLfHr-Fw.js";import{a as Ce,g as be}from"../chunks/sign.D9-XLGkJ.js";import{A as ve,I as me}from"../chunks/store.fiQNsqGi.js";import{s as we,w as ye,e as g,a as N,c as C,b,f as m,g as S,z as ee,v as n,i as A,h as d,N as K,A as W,x as Ee,F as $e,t as Be,d as ke,C as de,j as Ie,n as he,q as te,r as se}from"../chunks/scheduler.BS-S8op5.js";import{S as De,i as Ne,b as Se,c as re,d as ae,m as ne,a as z,e as Ae,t as V,f as le,g as Oe}from"../chunks/index.CxHkUi4z.js";import{g as Pe}from"../chunks/entry.QdnnaCyj.js";import{e as j}from"../chunks/emitter.E5P-NQ8u.js";import{H as Te}from"../chunks/Header.DoQLb-H6.js";import{g as qe,u as Fe}from"../chunks/photo.BcPBlU4e.js";import{C as Ue}from"../chunks/CircleImage.CeiTlKJ2.js";import{s as _e}from"../chunks/s32cloudfront.Ci9BJXQZ.js";import{g as ge}from"../chunks/color.C_Jm4JAr.js";import{A as je}from"../chunks/ActionSheetOpenApp.CQ9EV_md.js";const ze=async({params:l,fetch:e,depends:t})=>{if(String(l.idx)!==String(Ce()))throw pe(403,"Forbidden");const f=(await(await e(`${ve}/auth/users/${l.idx}`,{headers:{Authorization:`Bearer ${be()}`}})).json()).data;if(!(f!=null&&f.idx))throw pe(404,"User not found");return{user:f}},it=Object.freeze(Object.defineProperty({__proto__:null,load:ze},Symbol.toStringTag,{value:"Module"}));function Ve(l){let e;return{c(){e=Be("완료")},l(t){e=ke(t,"완료")},m(t,s){A(t,e,s)},d(t){t&&m(e)}}}function He(l){let e,t,s;return{c(){e=te("svg"),t=te("circle"),s=te("path"),this.h()},l(a){e=se(a,"svg",{class:!0,viewBox:!0});var f=b(e);t=se(f,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0}),b(t).forEach(m),s=se(f,"path",{class:!0,fill:!0,d:!0}),b(s).forEach(m),f.forEach(m),this.h()},h(){n(t,"class","opacity-25"),n(t,"cx","12"),n(t,"cy","12"),n(t,"r","10"),n(t,"stroke","currentColor"),n(t,"stroke-width","4"),n(t,"fill","none"),n(s,"class","opacity-75"),n(s,"fill","currentColor"),n(s,"d","M4 12a8 8 0 0 0 8 8v-5l-3-3-5 0z"),n(e,"class","animate-spin h-5 w-5 mr-3 text-white"),n(e,"viewBox","0 0 24 24")},m(a,f){A(a,e,f),d(e,t),d(e,s)},d(a){a&&m(e)}}}function Me(l){let e,t,s,a,f;function p(o,c){return o[3]?He:Ve}let u=p(l),i=u(l);return{c(){e=g("span"),t=g("button"),i.c(),this.h()},l(o){e=C(o,"SPAN",{slot:!0,class:!0});var c=b(e);t=C(c,"BUTTON",{});var y=b(t);i.l(y),y.forEach(m),c.forEach(m),this.h()},h(){t.disabled=l[3],n(e,"slot","right"),n(e,"class",s=`
        text-sm leading-[1.0625rem] font-medium 
        ${l[5]?"text-white":"text-[#3f3f3f]"}
      `)},m(o,c){A(o,e,c),d(e,t),i.m(t,null),a||(f=W(t,"click",l[6]),a=!0)},p(o,c){u!==(u=p(o))&&(i.d(1),i=u(o),i&&(i.c(),i.m(t,null))),c&8&&(t.disabled=o[3]),c&32&&s!==(s=`
        text-sm leading-[1.0625rem] font-medium 
        ${o[5]?"text-white":"text-[#3f3f3f]"}
      `)&&n(e,"class",s)},d(o){o&&m(e),i.d(),a=!1,f()}}}function Je(l){var f;let e,t,s=(((f=l[0])==null?void 0:f.at(0))??"")+"",a;return{c(){e=g("div"),t=g("span"),a=Be(s),this.h()},l(p){e=C(p,"DIV",{class:!0,style:!0});var u=b(e);t=C(u,"SPAN",{class:!0});var i=b(t);a=ke(i,s),i.forEach(m),u.forEach(m),this.h()},h(){n(t,"class","text-2xl font-semibold text-black"),n(e,"class","w-[76px] h-[76px] flex items-center justify-center rounded-full"),de(e,"background-color",ge(l[0]))},m(p,u){A(p,e,u),d(e,t),d(t,a)},p(p,u){var i;u&1&&s!==(s=(((i=p[0])==null?void 0:i.at(0))??"")+"")&&Ie(a,s),u&1&&de(e,"background-color",ge(p[0]))},i:he,o:he,d(p){p&&m(e)}}}function Le(l){let e,t;return e=new Ue({props:{src:_e(l[1],500),width:"76px",strokeWidth:"0"}}),{c(){re(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,a){ne(e,s,a),t=!0},p(s,a){const f={};a&2&&(f.src=_e(s[1],500)),e.$set(f)},i(s){t||(V(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){le(e,s)}}}function Re(l){let e,t,s,a,f,p,u,i,o,c,y,B,H='<svg class="w-3 h-2.5" fill="transparent" stroke="white" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h3l2-3h8l2 3h3a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>',U,k,x,h,$="이메일(변경 불가)",q,v,X,I,O,ie="닉네임",Q,w,M,E,Y,J,Z,oe;a=new Te({props:{position:"static",leftBack:"white",centerTitle:"프로필 편집",$$slots:{right:[Me]},$$scope:{ctx:l}}});const ue=[Le,Je],D=[];function ce(r,_){return r[1]?0:1}o=ce(l),c=D[o]=ue[o](l);function xe(r){l[11](r)}let fe={};return l[4]!==void 0&&(fe.isOpen=l[4]),E=new je({props:fe}),ye.push(()=>Se(E,"isOpen",xe)),{c(){e=g("div"),t=N(),s=g("div"),re(a.$$.fragment),f=N(),p=g("main"),u=g("div"),i=g("div"),c.c(),y=N(),B=g("button"),B.innerHTML=H,U=N(),k=g("div"),x=g("div"),h=g("span"),h.textContent=$,q=N(),v=g("input"),X=N(),I=g("div"),O=g("span"),O.textContent=ie,Q=N(),w=g("input"),M=N(),re(E.$$.fragment),this.h()},l(r){e=C(r,"DIV",{class:!0}),b(e).forEach(m),t=S(r),s=C(r,"DIV",{class:!0});var _=b(s);ae(a.$$.fragment,_),f=S(_),p=C(_,"MAIN",{class:!0});var P=b(p);u=C(P,"DIV",{class:!0});var F=b(u);i=C(F,"DIV",{class:!0});var T=b(i);c.l(T),y=S(T),B=C(T,"BUTTON",{class:!0,"data-svelte-h":!0}),ee(B)!=="svelte-qa1vtb"&&(B.innerHTML=H),T.forEach(m),F.forEach(m),U=S(P),k=C(P,"DIV",{class:!0});var L=b(k);x=C(L,"DIV",{class:!0});var R=b(x);h=C(R,"SPAN",{class:!0,"data-svelte-h":!0}),ee(h)!=="svelte-1gfnk3z"&&(h.textContent=$),q=S(R),v=C(R,"INPUT",{type:!0,class:!0}),R.forEach(m),X=S(L),I=C(L,"DIV",{class:!0});var G=b(I);O=C(G,"SPAN",{class:!0,"data-svelte-h":!0}),ee(O)!=="svelte-2npwwy"&&(O.textContent=ie),Q=S(G),w=C(G,"INPUT",{type:!0,class:!0,placeholder:!0}),G.forEach(m),L.forEach(m),P.forEach(m),_.forEach(m),M=S(r),ae(E.$$.fragment,r),this.h()},h(){n(e,"class","fixed w-full h-full bg-black -z-10"),n(B,"class","absolute bottom-0 right-0 bg-[#222222] rounded-full px-1.5 py-[7px] shadow-[1px_1px_6px_rgba(0,0,0,0.1)]"),n(i,"class","relative"),n(u,"class","flex justify-center my-3.5"),n(h,"class","w-[5.875rem] text-sm font-semibold tracking-[-0.0375rem] text-[#f1f1f1]"),n(v,"type","text"),n(v,"class","flex-grow py-2.5 bg-black border-0 cursor-not-allowed text-sm read-only:text-[#B3B8BD] border-b border-[#3F3F3F] "),v.readOnly=!0,v.disabled=!0,n(x,"class","flex items-center gap-3"),n(O,"class","w-[5.875rem] text-sm font-semibold tracking-[-0.0375rem] text-[#f1f1f1]"),n(w,"type","text"),n(w,"class","flex-grow py-2.5 bg-black border-0 cursor-not-allowed text-sm read-only:text-[#B3B8BD] border-b border-[#3F3F3F] "),n(w,"placeholder","mynickname"),n(I,"class","flex items-center gap-3"),n(k,"class","flex flex-col gap-2.5"),n(p,"class","flex-1 px-5"),n(s,"class","flex flex-col min-h-screen text-white")},m(r,_){A(r,e,_),A(r,t,_),A(r,s,_),ne(a,s,null),d(s,f),d(s,p),d(p,u),d(u,i),D[o].m(i,null),d(i,y),d(i,B),d(p,U),d(p,k),d(k,x),d(x,h),d(x,q),d(x,v),K(v,l[2].email),d(k,X),d(k,I),d(I,O),d(I,Q),d(I,w),K(w,l[0]),A(r,M,_),ne(E,r,_),J=!0,Z||(oe=[W(B,"click",l[7]),W(v,"input",l[9]),W(w,"input",l[10])],Z=!0)},p(r,[_]){const P={};_&16424&&(P.$$scope={dirty:_,ctx:r}),a.$set(P);let F=o;o=ce(r),o===F?D[o].p(r,_):(Oe(),z(D[F],1,1,()=>{D[F]=null}),Ae(),c=D[o],c?c.p(r,_):(c=D[o]=ue[o](r),c.c()),V(c,1),c.m(i,y)),_&4&&v.value!==r[2].email&&K(v,r[2].email),_&1&&w.value!==r[0]&&K(w,r[0]);const T={};!Y&&_&16&&(Y=!0,T.isOpen=r[4],Ee(()=>Y=!1)),E.$set(T)},i(r){J||(V(a.$$.fragment,r),V(c),V(E.$$.fragment,r),J=!0)},o(r){z(a.$$.fragment,r),z(c),z(E.$$.fragment,r),J=!1},d(r){r&&(m(e),m(t),m(s),m(M)),le(a),D[o].d(),le(E,r),Z=!1,$e(oe)}}}function Ge(l,e,t){let s,{data:a}=e,f=a.user,{user:p}=JSON.parse(JSON.stringify(a)),u=p.unique_name||"",i=p.profile_image_url||"",o=!1,c=!1;function y(){return s?u.trim()?/^[a-z0-9._]{1,30}$/.test(u)?!0:(j.emit("pushSnackbar",{message:"Unique Name은 1-30자이며, 영어 소문자, 숫자, ., _ 만 허용됩니다."}),!1):(j.emit("pushSnackbar",{message:"닉네임(Unique Name)은 비어있을 수 없습니다."}),!1):!1}async function B(){if(me)return t(4,c=!0);if(y())try{t(3,o=!0);const h=Ce(),$=await fetch(`${ve}/auth/users/${h}`,{method:"PATCH",headers:{Authorization:`Bearer ${be()}`,"Content-Type":"application/json"},body:JSON.stringify({uniqueName:u,profileImage:i})});if($.ok)j.emit("pushSnackbar",{message:"프로필이 업데이트되었습니다."}),Pe(`/users/${h}`);else{const q=await $.json();console.error(q),j.emit("pushSnackbar",{message:q.message||"프로필 수정에 실패했습니다."})}}catch(h){console.error(h),j.emit("pushSnackbar",{message:"서버와 통신 중 오류가 발생했습니다."})}finally{t(3,o=!1)}}async function H(){if(me)return t(4,c=!0);const h=await qe({limit:1}),$=await Fe(h);$[0]&&t(1,i=$[0])}function U(){p.email=this.value,t(2,p)}function k(){u=this.value,t(0,u)}function x(h){c=h,t(4,c)}return l.$$set=h=>{"data"in h&&t(8,a=h.data)},l.$$.update=()=>{l.$$.dirty&3&&t(5,s=u!==f.unique_name||i!==f.profile_image_url)},[u,i,p,o,c,s,B,H,a,U,k,x]}class ot extends De{constructor(e){super(),Ne(this,e,Ge,Re,we,{data:8})}}export{ot as component,it as universal};
