import{s as ne,m as se,p as ae,a as A,e as W,g as E,c as M,b as R,f as _,q as D,i as C,h as T,k as de,t as z,d as F,r as _e,j as he,n as ge}from"../chunks/scheduler.BiUHV-k5.js";import{S as ie,i as le,e as fe,c as w,a as x,m as v,t as h,b as g,d as y,f as K,g as Q}from"../chunks/index.DaxfEsq8.js";import{e as X,u as be,o as ke}from"../chunks/each.BSmogOji.js";import{g as Y}from"../chunks/entry.BgsWz-jp.js";import{F as ce}from"../chunks/Footer.BFzrXwjq.js";import{H as ue}from"../chunks/Header.BQ6Ln9SD.js";import{M as we}from"../chunks/Map.D36NJeSd.js";import{N as xe}from"../chunks/NavigationBar.BMK5WRjJ.js";import{B as ee}from"../chunks/Button.BoykKRRQ.js";import{g as ve}from"../chunks/searchParams.CLTsvX0n.js";import{e as H,A as ye}from"../chunks/units.PZslUNQa.js";import{p as Oe}from"../chunks/stores.DCGS6bAj.js";import"../chunks/Field.DcDRmg5o.js";/* empty css                                                   *//* empty css                                                   */import{a as Ce}from"../chunks/map.DpOktxgV.js";import"../chunks/ImageShaper.BEKfM5ww.js";import"../chunks/heic2any.nPaJEr-8.js";import"../chunks/store.EKIQFE2P.js";/* empty css                                                            */import{A as Be}from"../chunks/ActionSheet.KA2KR3Ai.js";import{S as Ie}from"../chunks/Search.C13E75je.js";import{H as Se}from"../chunks/HexImage.HQWguL6G.js";import{f as Pe}from"../chunks/search.CbPkpnXo.js";import{f as Ae}from"../chunks/proj.DXH8zrwl.js";import{s as te}from"../chunks/s32cloudfront.DCBkFKUx.js";const Ee=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ne(a){let e,r;return e=new Ie({}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function De(a){let e,r,t;function s(i){a[1](i)}let n={sheetBackground:"bg-[black]/60 backdrop-blur-sm",$$slots:{default:[Ne]},$$scope:{ctx:a}};return a[0]!==void 0&&(n.isOpen=a[0]),e=new Be({props:n}),se.push(()=>fe(e,"isOpen",s)),{c(){w(e.$$.fragment)},l(i){x(e.$$.fragment,i)},m(i,c){v(e,i,c),t=!0},p(i,[c]){const $={};c&4&&($.$$scope={dirty:c,ctx:i}),!r&&c&1&&(r=!0,$.isOpen=i[0],ae(()=>r=!1)),e.$set($)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){g(e.$$.fragment,i),t=!1},d(i){y(e,i)}}}function Te(a,e,r){let{isOpen:t=!1}=e;function s(n){t=n,r(0,t)}return a.$$set=n=>{"isOpen"in n&&r(0,t=n.isOpen)},[t,s]}class We extends ie{constructor(e){super(),le(this,e,Te,De,ne,{isOpen:0})}}const{Map:Me}=Ee;function re(a,e,r){const t=a.slice();return t[13]=e[r],t}function Re(a){let e,r;return e=new ue({props:{position:"fixed",rightFeed:!0}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function Ve(a){let e,r;return e=new ue({props:{position:"fixed",leftBack:!0}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function oe(a,e){var S;let r,t,s,n,i,c=e[13].name+"",$,m,B,b,O;s=new Se({props:{src:te(e[13].image),width:96,height:96,onBorder:e[13].idx===((S=e[2])==null?void 0:S.idx)}});function I(){return e[9](e[13])}return{key:a,first:null,c(){r=W("div"),t=W("div"),w(s.$$.fragment),n=A(),i=W("span"),$=z(c),m=A(),this.h()},l(p){r=M(p,"DIV",{class:!0,"aria-hidden":!0});var f=R(r);t=M(f,"DIV",{class:!0});var d=R(t);x(s.$$.fragment,d),d.forEach(_),n=E(f),i=M(f,"SPAN",{class:!0});var u=R(i);$=F(u,c),u.forEach(_),m=E(f),f.forEach(_),this.h()},h(){D(t,"class","w-24 h-24 relative"),D(i,"class","w-24 truncate text-xs text-gray-700"),D(r,"class","flex-shrink-0 flex flex-col items-center space-y-1"),D(r,"aria-hidden",""),this.first=r},m(p,f){C(p,r,f),T(r,t),v(s,t,null),T(r,n),T(r,i),T(i,$),T(r,m),B=!0,b||(O=_e(r,"click",I),b=!0)},p(p,f){var u;e=p;const d={};f&1&&(d.src=te(e[13].image)),f&5&&(d.onBorder=e[13].idx===((u=e[2])==null?void 0:u.idx)),s.$set(d),(!B||f&1)&&c!==(c=e[13].name+"")&&he($,c)},i(p){B||(h(s.$$.fragment,p),B=!0)},o(p){g(s.$$.fragment,p),B=!1},d(p){p&&_(r),y(s),b=!1,O()}}}function je(a){let e,r;return e=new ce({props:{position:"fixed",leftReposition:!0,centerSearch:!0,right:"add"}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},p:ge,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function He(a){let e,r;return e=new ce({props:{position:"fixed",bottom:"2rem",$$slots:{default:[ze]},$$scope:{ctx:a}}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},p(t,s){const n={};s&65536&&(n.$$scope={dirty:s,ctx:t}),e.$set(n)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function Le(a){let e;return{c(){e=z("이 장소가 아니예요")},l(r){e=F(r,"이 장소가 아니예요")},m(r,t){C(r,e,t)},d(r){r&&_(e)}}}function qe(a){let e;return{c(){e=z("이 장소가 맞아요")},l(r){e=F(r,"이 장소가 맞아요")},m(r,t){C(r,e,t)},d(r){r&&_(e)}}}function ze(a){let e,r,t,s;return e=new ee({props:{backgroundColor:"bg-gray-300",textColor:"text-white",$$slots:{default:[Le]},$$scope:{ctx:a}}}),e.$on("click",a[10]),t=new ee({props:{backgroundColor:"bg-primary-500",textColor:"text-white",$$slots:{default:[qe]},$$scope:{ctx:a}}}),t.$on("click",a[5]),{c(){w(e.$$.fragment),r=A(),w(t.$$.fragment)},l(n){x(e.$$.fragment,n),r=E(n),x(t.$$.fragment,n)},m(n,i){v(e,n,i),C(n,r,i),v(t,n,i),s=!0},p(n,i){const c={};i&65536&&(c.$$scope={dirty:i,ctx:n}),e.$set(c);const $={};i&65536&&($.$$scope={dirty:i,ctx:n}),t.$set($)},i(n){s||(h(e.$$.fragment,n),h(t.$$.fragment,n),s=!0)},o(n){g(e.$$.fragment,n),g(t.$$.fragment,n),s=!1},d(n){n&&_(r),y(e,n),y(t,n)}}}function Fe(a){let e,r,t,s,n,i,c,$,m=[],B=new Me,b,O,I,S,p,f,d,u,P;const G=[Ve,Re],N=[];function U(o,l){return o[4]==="post"||o[4]==="box"||o[3]?0:1}e=U(a),r=N[e]=G[e](a),n=new we({props:{onMoveend:a[6]}});let V=X(a[0]);const Z=o=>o[13].idx;for(let o=0;o<V.length;o+=1){let l=re(a,V,o),k=Z(l);B.set(k,m[o]=oe(k,l))}const me=[He,je],L=[];function pe(o,l){return o[4]==="post"||o[4]==="box"?0:1}O=pe(a),I=L[O]=me[O](a);function $e(o){a[11](o)}let J={};return a[1]!==void 0&&(J.isOpen=a[1]),p=new We({props:J}),se.push(()=>fe(p,"isOpen",$e)),u=new xe({props:{show:a[4]!=="post"}}),{c(){r.c(),t=A(),s=W("div"),w(n.$$.fragment),i=A(),c=W("div"),$=W("div");for(let o=0;o<m.length;o+=1)m[o].c();b=A(),I.c(),S=A(),w(p.$$.fragment),d=A(),w(u.$$.fragment),this.h()},l(o){r.l(o),t=E(o),s=M(o,"DIV",{class:!0});var l=R(s);x(n.$$.fragment,l),l.forEach(_),i=E(o),c=M(o,"DIV",{class:!0});var k=R(c);$=M(k,"DIV",{class:!0});var j=R($);for(let q=0;q<m.length;q+=1)m[q].l(j);j.forEach(_),k.forEach(_),b=E(o),I.l(o),S=E(o),x(p.$$.fragment,o),d=E(o),x(u.$$.fragment,o),this.h()},h(){D(s,"class","fixed top-0 left-0 w-full h-full"),D($,"class","flex space-x-4"),D(c,"class","relative top-4 left-0 overflow-x-auto p-4 z-20")},m(o,l){N[e].m(o,l),C(o,t,l),C(o,s,l),v(n,s,null),C(o,i,l),C(o,c,l),T(c,$);for(let k=0;k<m.length;k+=1)m[k]&&m[k].m($,null);C(o,b,l),L[O].m(o,l),C(o,S,l),v(p,o,l),C(o,d,l),v(u,o,l),P=!0},p(o,[l]){let k=e;e=U(o),e!==k&&(Q(),g(N[k],1,1,()=>{N[k]=null}),K(),r=N[e],r||(r=N[e]=G[e](o),r.c()),h(r,1),r.m(t.parentNode,t)),l&133&&(V=X(o[0]),Q(),m=be(m,l,Z,1,o,V,B,$,ke,oe,null,re),K()),I.p(o,l);const j={};!f&&l&2&&(f=!0,j.isOpen=o[1],ae(()=>f=!1)),p.$set(j)},i(o){if(!P){h(r),h(n.$$.fragment,o);for(let l=0;l<V.length;l+=1)h(m[l]);h(I),h(p.$$.fragment,o),h(u.$$.fragment,o),P=!0}},o(o){g(r),g(n.$$.fragment,o);for(let l=0;l<m.length;l+=1)g(m[l]);g(I),g(p.$$.fragment,o),g(u.$$.fragment,o),P=!1},d(o){o&&(_(t),_(s),_(i),_(c),_(b),_(S),_(d)),N[e].d(o),y(n);for(let l=0;l<m.length;l+=1)m[l].d();L[O].d(o),y(p,o),y(u,o)}}}function Ge(a,e,r){let t,s;de(a,Oe,f=>r(8,s=f));let n=[];const i=s.url.searchParams.get("type");let c=!1;H.on("openSearch",()=>{r(1,c=!0)}),H.on("closeSearch",()=>{r(1,c=!1)});async function $(){if(i==="box"){const f=Number(s.url.searchParams.get("boxIdx"));if(Number.isNaN(f)||!f)return Y("/boxes");(await fetch(`https://azit.surflux.studio/boxes/${f}/places/${s.url.searchParams.get("placeIdx")}`,{method:"PUT",headers:{Authorization:`Bearer ${sessionStorage.getItem("jwt")}`}})).ok||H.emit("pushSnackbar",{message:"장소 추가에 실패했습니다."}),Y(`/boxes/${f}/detail`)}else i==="post"&&ve("/viewer/edit")}let m;async function B(f){try{m&&m.abort("new request"),m=new AbortController;const d=new URL(`${ye}/boxes/boundary?bbox=${f}`),u=await Pe(d,{method:"GET",headers:{Accept:"application/json"}},m);if(!u.ok)return;const P=await u.json();r(0,n=P.data)}catch(d){d.name!=="AbortError"&&console.error(d)}}let b;function O(f){const d=n.find(u=>u.idx===f);if(d){if(Ce.clear(),b&&b.idx===d.idx)return r(2,b=void 0);r(2,b=d),b.places.forEach(u=>{var P;H.emit("addIcon",{idx:Number(u.idx),coordinate:Ae([u.longitude,u.latitude]),image:((P=u.media)==null?void 0:P.at(0))??"",shape:"waterdrop",type:"place",link:`/places/${u.idx}`,rank:1,name:u.name,width:56,height:61})})}}const I=f=>O(f.idx),S=()=>window.history.back();function p(f){c=f,r(1,c)}return a.$$.update=()=>{a.$$.dirty&256&&r(3,t=s.url.searchParams.get("withBack")==="true")},[n,c,b,t,i,$,B,O,s,I,S,p]}class bt extends ie{constructor(e){super(),le(this,e,Ge,Fe,ne,{})}}export{bt as component};
