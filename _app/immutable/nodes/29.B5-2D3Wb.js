import{l as De,e as ve,A as oe,g as le,m as ke,C as Ae,n as pe,o as re,k as _e}from"../chunks/sign.B1Wlxx_i.js";import{e as ee}from"../chunks/index.g5YcAAdQ.js";import{l as Ee,s as we,e as D,c as A,b as P,f as v,v as w,i as H,t as ue,a as T,d as ce,g as Y,h as $,A as G,S as Se,j as me,n as se,y as W,z as U,k as te,w as xe,x as Pe,O as ne,U as Ne,F as Oe,B as ye}from"../chunks/scheduler.CVGJxaOr.js";import{g as ie}from"../chunks/entry.CGrLxdKo.js";import{S as $e,i as Ce,g as fe,f as de,t as E,a as S,c as j,b as F,m as M,d as z,e as Q}from"../chunks/index.1WceP6qL.js";import{H as Ie}from"../chunks/Header.CFLJisAf.js";import{V as Be}from"../chunks/Viewer.D3pSizsj.js";/* empty css                                                   */import{p as Te}from"../chunks/stores.Bjuhv_Ky.js";import{K as ae}from"../chunks/index.Catd5cvG.js";import{e as he,u as Ye,o as je}from"../chunks/each.Xy939NiR.js";import{I as Fe}from"../chunks/IconChevronRight.D1U2u6en.js";import{B as Me}from"../chunks/BottomNavigationPadder.C-a_SJOR.js";import{V as ze}from"../chunks/VisibilitySheet.CFRb4_bW.js";import{N as He}from"../chunks/NavigationBar.BJsKK_b-.js";const Je=async({fetch:s,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return ee(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const i=De();return{posts:[{user_idx:i==null?void 0:i.sub,unique_name:i==null?void 0:i.uni,profile_image_url:i==null?void 0:i.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Ee(ke),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const i=e.searchParams.get("postIdx");if(i==="null")return ve.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),ie("/viewer",{replaceState:!0});i||ee(404,"Not Found");const o=await s(`${oe}/posts/${i}`,{method:"GET",headers:{Authorization:"Bearer "+le()}}).then(n=>n.json()).then(n=>n.data);return o.error&&ee(404,"Not Found"),{posts:[{...o,mediaIdx:0}]}}return ee(404,"Not Found")},bt=Object.freeze(Object.defineProperty({__proto__:null,load:Je},Symbol.toStringTag,{value:"Module"}));function ge(s,e,t){const i=s.slice();return i[1]=e[t],i[3]=t,i}function Ke(s){let e;return{c(){e=D("div"),this.h()},l(t){e=A(t,"DIV",{class:!0}),P(e).forEach(v),this.h()},h(){w(e,"class","w-0.5")},m(t,i){H(t,e,i)},i:se,o:se,d(t){t&&v(e)}}}function Le(s){let e,t;return e=new Fe({props:{fill:"#6B7280",length:"1.25"}}),{c(){j(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,o){M(e,i,o),t=!0},i(i){t||(E(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){z(e,i)}}}function be(s,e){let t,i,o=e[1].title+"",n,m,a,u,d=e[1].value+"",g,k,r,c,l,_,h,V,C;const x=[Le,Ke],I=[];function J(y,B){return y[1].onClick?0:1}return r=J(e),c=I[r]=x[r](e),{key:s,first:null,c(){t=D("div"),i=D("span"),n=ue(o),m=T(),a=D("div"),u=D("span"),g=ue(d),k=T(),c.c(),l=T(),this.h()},l(y){t=A(y,"DIV",{class:!0});var B=P(t);i=A(B,"SPAN",{class:!0});var N=P(i);n=ce(N,o),N.forEach(v),m=Y(B),a=A(B,"DIV",{class:!0});var O=P(a);u=A(O,"SPAN",{class:!0});var p=P(u);g=ce(p,d),p.forEach(v),k=Y(O),c.l(O),O.forEach(v),l=Y(B),B.forEach(v),this.h()},h(){w(i,"class","text-white text-sm font-medium"),w(u,"class","text-gray-500 text-xs"),w(a,"class","flex items-center gap-2"),w(t,"class",_=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(y,B){H(y,t,B),$(t,i),$(i,n),$(t,m),$(t,a),$(a,u),$(u,g),$(a,k),I[r].m(a,null),$(t,l),h=!0,V||(C=G(t,"click",function(){Se(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),V=!0)},p(y,B){e=y,(!h||B&1)&&o!==(o=e[1].title+"")&&me(n,o),(!h||B&1)&&d!==(d=e[1].value+"")&&me(g,d);let N=r;r=J(e),r!==N&&(fe(),S(I[N],1,1,()=>{I[N]=null}),de(),c=I[r],c||(c=I[r]=x[r](e),c.c()),E(c,1),c.m(a,null)),(!h||B&1&&_!==(_=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&w(t,"class",_)},i(y){h||(E(c),h=!0)},o(y){S(c),h=!1},d(y){y&&v(t),I[r].d(),V=!1,C()}}}function qe(s){let e,t=[],i=new Map,o,n=he(s[0]);const m=a=>a[1].id;for(let a=0;a<n.length;a+=1){let u=ge(s,n,a),d=m(u);i.set(d,t[a]=be(d,u))}return{c(){e=D("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=A(a,"DIV",{class:!0});var u=P(e);for(let d=0;d<t.length;d+=1)t[d].l(u);u.forEach(v),this.h()},h(){w(e,"class","flex flex-col w-full")},m(a,u){H(a,e,u);for(let d=0;d<t.length;d+=1)t[d]&&t[d].m(e,null);o=!0},p(a,[u]){u&1&&(n=he(a[0]),fe(),t=Ye(t,u,m,1,a,n,i,e,je,be,null,ge),de())},i(a){if(!o){for(let u=0;u<n.length;u+=1)E(t[u]);o=!0}},o(a){for(let u=0;u<t.length;u+=1)S(t[u]);o=!1},d(a){a&&v(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function Re(s,e,t){let{items:i=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return s.$$set=o=>{"items"in o&&t(0,i=o.items)},[i]}class Ge extends $e{constructor(e){super(),Ce(this,e,Re,qe,we,{items:0})}}function We(s){let e,t,i,o,n,m,a,u;e=new Ie({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",$$slots:{right:[Qe]},$$scope:{ctx:s}}});function d(r){s[20](r)}function g(r){s[21](r)}let k={dontMoveVertically:!0,hideActionButtons:!0};return s[1]!==void 0&&(k.posts=s[1]),s[5]!==void 0&&(k.keyboardY=s[5]),i=new Be({props:k}),W.push(()=>Q(i,"posts",d)),W.push(()=>Q(i,"keyboardY",g)),a=new He({}),{c(){j(e.$$.fragment),t=T(),j(i.$$.fragment),m=T(),j(a.$$.fragment)},l(r){F(e.$$.fragment,r),t=Y(r),F(i.$$.fragment,r),m=Y(r),F(a.$$.fragment,r)},m(r,c){M(e,r,c),H(r,t,c),M(i,r,c),H(r,m,c),M(a,r,c),u=!0},p(r,c){const l={};c[1]&1&&(l.$$scope={dirty:c,ctx:r}),e.$set(l);const _={};!o&&c[0]&2&&(o=!0,_.posts=r[1],U(()=>o=!1)),!n&&c[0]&32&&(n=!0,_.keyboardY=r[5],U(()=>n=!1)),i.$set(_)},i(r){u||(E(e.$$.fragment,r),E(i.$$.fragment,r),E(a.$$.fragment,r),u=!0)},o(r){S(e.$$.fragment,r),S(i.$$.fragment,r),S(a.$$.fragment,r),u=!1},d(r){r&&(v(t),v(m)),z(e,r),z(i,r),z(a,r)}}}function Ue(s){let e,t,i,o,n,m,a,u,d,g,k=(s[2]||"텍스트 입력하기...")+"",r,c,l,_,h,V,C,x,I,J,y;t=new Ie({props:{position:"static",leftBack:"white",$$slots:{right:[Xe]},$$scope:{ctx:s}}});function B(p){s[14](p)}function N(p){s[15](p)}let O={dontMoveVertically:!0,isEdit:!0};return s[1]!==void 0&&(O.posts=s[1]),s[5]!==void 0&&(O.keyboardY=s[5]),n=new Be({props:O}),W.push(()=>Q(n,"posts",B)),W.push(()=>Q(n,"keyboardY",N)),h=new Ge({props:{items:[{id:1,title:"장소",value:s[1][0].place_name||""},{id:2,title:"공개 여부",value:_e[s[4]],onClick:s[18]}]}}),x=new Me({}),{c(){e=D("section"),j(t.$$.fragment),i=T(),o=D("div"),j(n.$$.fragment),u=T(),d=D("div"),g=D("div"),r=ue(k),l=T(),_=D("div"),j(h.$$.fragment),V=T(),C=D("div"),j(x.$$.fragment),this.h()},l(p){e=A(p,"SECTION",{class:!0});var b=P(e);F(t.$$.fragment,b),i=Y(b),o=A(b,"DIV",{class:!0});var L=P(o);F(n.$$.fragment,L),L.forEach(v),u=Y(b),d=A(b,"DIV",{class:!0});var K=P(d);g=A(K,"DIV",{contenteditable:!0,class:!0});var q=P(g);r=ce(q,k),q.forEach(v),K.forEach(v),l=Y(b),_=A(b,"DIV",{class:!0});var X=P(_);F(h.$$.fragment,X),X.forEach(v),V=Y(b),C=A(b,"DIV",{class:!0});var Z=P(C);F(x.$$.fragment,Z),Z.forEach(v),b.forEach(v),this.h()},h(){w(o,"class","flex flex-grow"),w(g,"contenteditable","true"),w(g,"class",c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${s[6]?"text-gray-400":"text-white"}
        `),w(d,"class","h-32 px-5 py-2.5"),w(_,"class",""),w(C,"class","h-40"),w(e,"class","flex flex-col w-full h-screen bg-black")},m(p,b){H(p,e,b),M(t,e,null),$(e,i),$(e,o),M(n,o,null),$(e,u),$(e,d),$(d,g),$(g,r),$(e,l),$(e,_),M(h,_,null),$(e,V),$(e,C),M(x,C,null),I=!0,J||(y=[G(g,"input",s[10]),G(g,"focus",s[16]),G(g,"blur",s[17])],J=!0)},p(p,b){const L={};b[0]&1|b[1]&1&&(L.$$scope={dirty:b,ctx:p}),t.$set(L);const K={};!m&&b[0]&2&&(m=!0,K.posts=p[1],U(()=>m=!1)),!a&&b[0]&32&&(a=!0,K.keyboardY=p[5],U(()=>a=!1)),n.$set(K),(!I||b[0]&4)&&k!==(k=(p[2]||"텍스트 입력하기...")+"")&&Ne(r,k),(!I||b[0]&64&&c!==(c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${p[6]?"text-gray-400":"text-white"}
        `))&&w(g,"class",c);const q={};b[0]&26&&(q.items=[{id:1,title:"장소",value:p[1][0].place_name||""},{id:2,title:"공개 여부",value:_e[p[4]],onClick:p[18]}]),h.$set(q)},i(p){I||(E(t.$$.fragment,p),E(n.$$.fragment,p),E(h.$$.fragment,p),E(x.$$.fragment,p),I=!0)},o(p){S(t.$$.fragment,p),S(n.$$.fragment,p),S(h.$$.fragment,p),S(x.$$.fragment,p),I=!1},d(p){p&&v(e),z(t),z(n),z(h),z(x),J=!1,Oe(y)}}}function Qe(s){let e,t="완료",i,o;return{c(){e=D("div"),e.textContent=t,this.h()},l(n){e=A(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-11t55ng"&&(e.textContent=t),this.h()},h(){w(e,"slot","right"),w(e,"class","text-white")},m(n,m){H(n,e,m),i||(o=G(e,"click",s[19]),i=!0)},p:se,d(n){n&&v(e),i=!1,o()}}}function Xe(s){let e,t="다음",i,o;return{c(){e=D("div"),e.textContent=t,this.h()},l(n){e=A(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){w(e,"slot","right"),w(e,"class","text-white")},m(n,m){H(n,e,m),i||(o=G(e,"click",s[13]),i=!0)},p:se,d(n){n&&v(e),i=!1,o()}}}function Ze(s){let e,t,i,o,n,m,a;const u=[Ue,We],d=[];function g(l,_){return l[0]===0?0:l[0]===1?1:-1}~(e=g(s))&&(t=d[e]=u[e](s));function k(l){s[22](l)}function r(l){s[23](l)}let c={};return s[3]!==void 0&&(c.isOpen=s[3]),s[4]!==void 0&&(c.selectedVisibility=s[4]),o=new ze({props:c}),W.push(()=>Q(o,"isOpen",k)),W.push(()=>Q(o,"selectedVisibility",r)),{c(){t&&t.c(),i=T(),j(o.$$.fragment)},l(l){t&&t.l(l),i=Y(l),F(o.$$.fragment,l)},m(l,_){~e&&d[e].m(l,_),H(l,i,_),M(o,l,_),a=!0},p(l,_){let h=e;e=g(l),e===h?~e&&d[e].p(l,_):(t&&(fe(),S(d[h],1,1,()=>{d[h]=null}),de()),~e?(t=d[e],t?t.p(l,_):(t=d[e]=u[e](l),t.c()),E(t,1),t.m(i.parentNode,i)):t=null);const V={};!n&&_[0]&8&&(n=!0,V.isOpen=l[3],U(()=>n=!1)),!m&&_[0]&16&&(m=!0,V.selectedVisibility=l[4],U(()=>m=!1)),o.$set(V)},i(l){a||(E(t),E(o.$$.fragment,l),a=!0)},o(l){S(t),S(o.$$.fragment,l),a=!1},d(l){l&&v(i),~e&&d[e].d(l),z(o,l)}}}function et(s){const e=s.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function tt(s){const e=s.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function it(s,e,t){let i,o,n,m,a;te(s,pe,f=>t(25,o=f)),te(s,re,f=>t(26,n=f)),te(s,Te,f=>t(27,m=f)),te(s,ke,f=>t(12,a=f));const u=Ae.getPlatform()!=="web",d=m.url.searchParams.get("type");let g=0,{data:k}=e,r=k.posts,c="",l=!1,_="public";async function h(){const f=r==null?void 0:r.at(0);(await fetch(`${oe}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le()}`},body:JSON.stringify({placeIdx:f.place_idx,text:c,media:i,permission:_})})).ok&&await ie(`/places/${f.place_idx}`,{replaceState:!0,invalidateAll:!0})}async function V(){try{const f=await fetch(`${oe}/posts/${m.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le()}`},body:JSON.stringify({text:c})});if(!f.ok){(await f.json()).status===401&&(ve.emit("pushSnackbar",{message:"접근할 수 없습니다"}),ie(`/viewer?postIdx=${m.url.searchParams.get("postIdx")}`));return}await ie("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let C=0;function x(){ae.addListener("keyboardWillShow",f=>{t(5,C=f.keyboardHeight*-1)}),ae.addListener("keyboardWillHide",()=>{t(5,C=0)})}function I(){ae.removeAllListeners()}xe(()=>{var f,R;u&&x(),n?(t(2,c=n),ne(re,n="",n)):(f=h[0])!=null&&f.text&&t(2,c=(R=h[0])==null?void 0:R.text)}),Pe(()=>{u&&I(),ne(re,n="",n),ne(pe,o="",o)});function J(f){const R=f.target;t(2,c=R.innerText),t(1,r[0]={...r[0],text:c},r)}let y=c.trim()==="";const B=()=>{t(0,g=1)};function N(f){r=f,t(1,r)}function O(f){C=f,t(5,C)}const p=f=>{et(f),t(6,y=!1)},b=f=>{tt(f),t(6,y=!c.trim())},L=()=>{t(3,l=!0)},K=()=>{d==="post"?h():d==="patch"&&V()};function q(f){r=f,t(1,r)}function X(f){C=f,t(5,C)}function Z(f){l=f,t(3,l)}function Ve(f){_=f,t(4,_)}return s.$$set=f=>{"data"in f&&t(11,k=f.data)},s.$$.update=()=>{s.$$.dirty[0]&4096&&(i=a)},[g,r,c,l,_,C,y,d,h,V,J,k,a,B,N,O,p,b,L,K,q,X,Z,Ve]}class vt extends $e{constructor(e){super(),Ce(this,e,it,Ze,we,{data:11},null,[-1,-1])}}export{vt as component,bt as universal};
