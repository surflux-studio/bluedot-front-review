import{s as q,m as le,e as N,c as M,b as B,f as k,v as T,J as Y,i as E,A as O,H,G as oe,u as ce,o as fe,p as ue,F as ie,I as U,T as y,w as me,a as G,g as z,x as pe,k as K,y as de,B as _e,D as Z,n as C,h as he}from"../chunks/scheduler.DAfLlBmd.js";import{S as X,i as Q,t as h,a as g,c as S,d as j,m as A,f as L,b as ge,e as x,g as ee}from"../chunks/index.CPgTt4Co.js";import{H as ke}from"../chunks/Header.yhfzDooK.js";import{V as be}from"../chunks/Viewer.DZnVVwrZ.js";import{p as Ie}from"../chunks/stores.B3RMkvZp.js";import{N as we}from"../chunks/NavigationBar.O9s8mYWp.js";import"../chunks/device.Bw-85Nqb.js";import"../chunks/ActionSheet.svelte_svelte_type_style_lang.Ble9I8xD.js";/* empty css                                                   */import{I as $,d as Ee,e as te,A as se}from"../chunks/store.D8rYgsha.js";import{g as $e}from"../chunks/entry.B-O-GRQm.js";import"../chunks/emitter.E5P-NQ8u.js";import{g as Oe}from"../chunks/sign.D-HOBb5V.js";/* empty css                                                   */import{P as Se}from"../chunks/picker.DO1g6OCe.js";import{I as je}from"../chunks/IconSearch.tyl1RP-f.js";import{A as Ae}from"../chunks/ActionSheetOpenApp.DX0cwfQM.js";function Le(i){let e,s,t,n,r;const m=i[5].default,l=le(m,i,i[4],null);return{c(){e=N("div"),l&&l.c(),this.h()},l(a){e=M(a,"DIV",{id:!0,class:!0,"aria-hidden":!0});var u=B(e);l&&l.l(u),u.forEach(k),this.h()},h(){T(e,"id","mask"),T(e,"class",s=Y(`${i[0]?"":"hidden"} ${i[1]}`)+" svelte-eerk6g"),T(e,"aria-hidden","")},m(a,u){E(a,e,u),l&&l.m(e,null),t=!0,n||(r=[O(e,"touchstart",H(oe(i[6]))),O(e,"touchend",i[7],{passive:!0}),O(e,"click",i[8])],n=!0)},p(a,[u]){l&&l.p&&(!t||u&16)&&ce(l,m,a,a[4],t?ue(m,a[4],u,null):fe(a[4]),null),(!t||u&3&&s!==(s=Y(`${a[0]?"":"hidden"} ${a[1]}`)+" svelte-eerk6g"))&&T(e,"class",s)},i(a){t||(h(l,a),t=!0)},o(a){g(l,a),t=!1},d(a){a&&k(e),l&&l.d(a),n=!1,ie(r)}}}function Pe(i,e,s){let{$$slots:t={},$$scope:n}=e,{onMask:r=!1}=e,{position:m="fixed"}=e,{closeOnClick:l=!1}=e,{onTouch:a=void 0}=e;function u(c){U.call(this,i,c)}const p=()=>{l?s(0,r=!1):a&&a()},w=()=>{l?s(0,r=!1):a&&a()};return i.$$set=c=>{"onMask"in c&&s(0,r=c.onMask),"position"in c&&s(1,m=c.position),"closeOnClick"in c&&s(2,l=c.closeOnClick),"onTouch"in c&&s(3,a=c.onTouch),"$$scope"in c&&s(4,n=c.$$scope)},[r,m,l,a,n,t,u,p,w]}class Te extends X{constructor(e){super(),Q(this,e,Pe,Le,q,{onMask:0,position:1,closeOnClick:2,onTouch:3})}}function ve(i){let e,s,t;return{c(){e=N("emoji-picker"),this.h()},l(n){e=M(n,"EMOJI-PICKER",{"aria-hidden":!0,class:!0}),B(e).forEach(k),this.h()},h(){y(e,"aria-hidden",""),y(e,"class",i[0])},m(n,r){E(n,e,r),s||(t=[O(e,"emoji-click",H(oe(i[2]))),O(e,"touchstart",H(i[4])),O(e,"touchend",H(i[5]))],s=!0)},p(n,r){r&1&&y(e,"class",n[0])},d(n){n&&k(e),s=!1,ie(t)}}}function Ce(i){let e,s;return e=new Te({props:{onMask:!0,position:"absolute",onTouch:i[6],$$slots:{default:[ve]},$$scope:{ctx:i}}}),{c(){S(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,n){A(e,t,n),s=!0},p(t,[n]){const r={};n&2&&(r.onTouch=t[6]),n&257&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){s||(h(e.$$.fragment,t),s=!0)},o(t){g(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function Ne(i,e,s){let{classList:t}=e,{onSelect:n}=e,{close:r}=e;function m(p){n(p.detail.unicode)}new Se({emojiVersion:15});function l(p){U.call(this,i,p)}function a(p){U.call(this,i,p)}const u=()=>{r()};return i.$$set=p=>{"classList"in p&&s(0,t=p.classList),"onSelect"in p&&s(3,n=p.onSelect),"close"in p&&s(1,r=p.close)},[t,r,m,n,l,a,u]}class Me extends X{constructor(e){super(),Q(this,e,Ne,Ce,q,{classList:0,onSelect:3,close:1})}}function Be(i){let e,s,t,n,r,m;return t=new je({props:{width:"24",height:"24"}}),{c(){e=N("div"),s=N("button"),S(t.$$.fragment),this.h()},l(l){e=M(l,"DIV",{class:!0});var a=B(e);s=M(a,"BUTTON",{});var u=B(s);j(t.$$.fragment,u),u.forEach(k),a.forEach(k),this.h()},h(){T(e,"class","flex items-center gap-2")},m(l,a){E(l,e,a),he(e,s),A(t,s,null),n=!0,r||(m=O(s,"click",i[9]),r=!0)},i(l){n||(h(t.$$.fragment,l),n=!0)},o(l){g(t.$$.fragment,l),n=!1},d(l){l&&k(e),L(t),r=!1,m()}}}function Re(i){let e,s,t=!$&&Be(i);return{c(){t&&t.c(),e=Z()},l(n){t&&t.l(n),e=Z()},m(n,r){t&&t.m(n,r),E(n,e,r),s=!0},p:C,i(n){s||(h(t),s=!0)},o(n){g(t),s=!1},d(n){n&&k(e),t&&t.d(n)}}}function Ve(i){let e,s;return e=new be({props:{posts:i[0].posts,index:i[0].index,selectedReaction:i[1],whenCancelForExternalLink:i[10]}}),{c(){S(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,n){A(e,t,n),s=!0},p(t,n){const r={};n&1&&(r.posts=t[0].posts),n&1&&(r.index=t[0].index),n&2&&(r.selectedReaction=t[1]),n&4&&(r.whenCancelForExternalLink=t[10]),e.$set(r)},i(t){s||(h(e.$$.fragment,t),s=!0)},o(t){g(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function De(i){let e;return{c(){e=N("div"),this.h()},l(s){e=M(s,"DIV",{class:!0}),B(e).forEach(k),this.h()},h(){T(e,"class","w-full h-full")},m(s,t){E(s,e,t)},p:C,i:C,o:C,d(s){s&&k(e)}}}function Fe(i){let e,s;return e=new we({}),{c(){S(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,n){A(e,t,n),s=!0},i(t){s||(h(e.$$.fragment,t),s=!0)},o(t){g(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function ne(i){let e,s;return e=new Me({props:{classList:"absolute bottom-24 right-0 px-4 z-50",onSelect:i[5],close:i[11]}}),{c(){S(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,n){A(e,t,n),s=!0},p:C,i(t){s||(h(e.$$.fragment,t),s=!0)},o(t){g(e.$$.fragment,t),s=!1},d(t){L(e,t)}}}function Ge(i){let e,s,t,n,r,m,l,a,u,p;e=new ke({props:{position:"fixed",leftLogo:$||i[3],leftBack:!$&&!i[3]?"white":"",$$slots:{right:[Re]},$$scope:{ctx:i}}});const w=[De,Ve],c=[];function R(o,f){return o[0].posts.length===0?0:1}t=R(i),n=c[t]=w[t](i);let b=!$&&Fe(),d=i[4]&&ne(i);function J(o){i[12](o)}let V={};return i[2]!==void 0&&(V.isOpen=i[2]),a=new Ae({props:V}),me.push(()=>ge(a,"isOpen",J)),{c(){S(e.$$.fragment),s=G(),n.c(),r=G(),b&&b.c(),m=G(),d&&d.c(),l=G(),S(a.$$.fragment)},l(o){j(e.$$.fragment,o),s=z(o),n.l(o),r=z(o),b&&b.l(o),m=z(o),d&&d.l(o),l=z(o),j(a.$$.fragment,o)},m(o,f){A(e,o,f),E(o,s,f),c[t].m(o,f),E(o,r,f),b&&b.m(o,f),E(o,m,f),d&&d.m(o,f),E(o,l,f),A(a,o,f),p=!0},p(o,[f]){const I={};f&8&&(I.leftLogo=$||o[3]),f&8&&(I.leftBack=!$&&!o[3]?"white":""),f&32768&&(I.$$scope={dirty:f,ctx:o}),e.$set(I);let v=t;t=R(o),t===v?c[t].p(o,f):(ee(),g(c[v],1,1,()=>{c[v]=null}),x(),n=c[t],n?n.p(o,f):(n=c[t]=w[t](o),n.c()),h(n,1),n.m(r.parentNode,r)),o[4]?d?(d.p(o,f),f&16&&h(d,1)):(d=ne(o),d.c(),h(d,1),d.m(l.parentNode,l)):d&&(ee(),g(d,1,1,()=>{d=null}),x());const D={};!u&&f&4&&(u=!0,D.isOpen=o[2],pe(()=>u=!1)),a.$set(D)},i(o){p||(h(e.$$.fragment,o),h(n),h(b),h(d),h(a.$$.fragment,o),p=!0)},o(o){g(e.$$.fragment,o),g(n),g(b),g(d),g(a.$$.fragment,o),p=!1},d(o){o&&(k(s),k(r),k(m),k(l)),L(e,o),c[t].d(o),b&&b.d(o),d&&d.d(o),L(a,o)}}}function ze(i,e,s){let t,n,r,m,l,a;K(i,Ie,o=>s(8,m=o)),K(i,Ee,o=>s(14,l=o)),K(i,te,o=>s(4,a=o));let u={posts:[],index:0},p,w=!1,c;de(async()=>{let o="";try{o=Oe()}catch{}const f=new URLSearchParams(window.location.search),I=Number(f.get("postIdx")||0);Number(f.get("mediaIdx")||0);const v=0,D=30,ae=`&offset=${v}`,re=`&limit=${D}`;let P=[];(n||t)&&l.length>0?(P=l.map(_=>_.idx===I?{..._,mediaIdx:_.mediaIdx||0}:{..._,mediaIdx:0}),s(0,u.index=P.findIndex(_=>_.idx===String(I)),u)):(c=new AbortController,I&&(P=[await fetch(`${se}/posts/${I}`,{method:"GET",headers:{Authorization:"Bearer "+o},signal:c.signal}).then(_=>_.json()).then(_=>({..._.data,mediaIdx:_.data.mediaIdx||0}))]),P=[...P,...await fetch(`${se}/posts?${ae}${re}`,{method:"GET",headers:{Authorization:"Bearer "+o},signal:c.signal}).then(_=>_.json()).then(_=>{var W;return(W=_.data)==null?void 0:W.posts.filter(F=>F.idx!==String(I)).map(F=>({...F,mediaIdx:F.mediaIdx||0}))})||[]]),s(0,u.posts=P,u)}),_e(()=>{c&&c.abort()});async function R(o){const f=m.url.searchParams.get("postIdx");f&&s(1,p={postIdx:f,reaction:o})}const b=async()=>{await $e("/search")},d=()=>{if($)return s(2,w=!0)},J=()=>{te.set(!1)};function V(o){w=o,s(2,w)}return i.$$.update=()=>{i.$$.dirty&256&&s(6,t=m.url.searchParams.get("placeIdx")),i.$$.dirty&256&&s(7,n=m.url.searchParams.get("userIdx")),i.$$.dirty&192&&s(3,r=!t&&!n)},[u,p,w,r,a,R,t,n,m,b,d,J,V]}class it extends X{constructor(e){super(),Q(this,e,ze,Ge,q,{})}}export{it as component};
