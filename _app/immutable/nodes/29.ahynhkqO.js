import{l as Ae,e as ve,A as oe,g as le,m as we,C as Ee,n as pe,o as re,k as _e}from"../chunks/sign.C_Srd8ra.js";import{e as ee}from"../chunks/index.g5YcAAdQ.js";import{l as Se,s as ke,e as D,c as A,b as P,f as v,v as k,i as H,t as ue,a as T,d as ce,g as Y,h as C,B as G,S as xe,j as me,n as ie,w as W,x as U,k as te,y as Pe,z as Ne,O as ne,U as Oe,F as Te,A as ye}from"../chunks/scheduler.ChiloVl_.js";import{g as se}from"../chunks/entry.CiRIqHzs.js";import{S as $e,i as Ce,g as fe,f as de,t as E,a as S,c as j,d as F,m as M,e as z,b as Q}from"../chunks/index.CeuzkHdt.js";import{H as Ie}from"../chunks/Header.DMczSze-.js";import{V as Be}from"../chunks/Viewer.5BX6yi-f.js";/* empty css                                                   */import{p as Ye}from"../chunks/stores.qPVlOpU7.js";import{K as ae}from"../chunks/index.RJjHHpk4.js";import{e as he,u as je,o as Fe}from"../chunks/each.CYKUTzmH.js";import{I as Me}from"../chunks/IconChevronRight.Dg7MgW8s.js";import{B as ze}from"../chunks/BottomNavigationPadder.V96aixF5.js";import{V as He}from"../chunks/VisibilitySheet.ZzJyihKH.js";import{N as Le}from"../chunks/NavigationBar.DvLZJZcV.js";const Je=async({fetch:i,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return ee(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const s=Ae();return{posts:[{user_idx:s==null?void 0:s.sub,unique_name:s==null?void 0:s.uni,profile_image_url:s==null?void 0:s.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Se(we),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const s=e.searchParams.get("postIdx");if(s==="null")return ve.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),se("/viewer",{replaceState:!0});s||ee(404,"Not Found");const o=await i(`${oe}/posts/${s}`,{method:"GET",headers:{Authorization:"Bearer "+le()}}).then(n=>n.json()).then(n=>n.data);return o.error&&ee(404,"Not Found"),{posts:[{...o,mediaIdx:0}]}}return ee(404,"Not Found")},vt=Object.freeze(Object.defineProperty({__proto__:null,load:Je},Symbol.toStringTag,{value:"Module"}));function ge(i,e,t){const s=i.slice();return s[1]=e[t],s[3]=t,s}function Ke(i){let e;return{c(){e=D("div"),this.h()},l(t){e=A(t,"DIV",{class:!0}),P(e).forEach(v),this.h()},h(){k(e,"class","w-0.5")},m(t,s){H(t,e,s)},i:ie,o:ie,d(t){t&&v(e)}}}function qe(i){let e,t;return e=new Me({props:{fill:"#6B7280",length:"1.25"}}),{c(){j(e.$$.fragment)},l(s){F(e.$$.fragment,s)},m(s,o){M(e,s,o),t=!0},i(s){t||(E(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){z(e,s)}}}function be(i,e){let t,s,o=e[1].title+"",n,m,a,u,d=e[1].value+"",g,w,r,c,l,_,h,I,x;const y=[qe,Ke],B=[];function L(V,$){return V[1].onClick?0:1}return r=L(e),c=B[r]=y[r](e),{key:i,first:null,c(){t=D("div"),s=D("span"),n=ue(o),m=T(),a=D("div"),u=D("span"),g=ue(d),w=T(),c.c(),l=T(),this.h()},l(V){t=A(V,"DIV",{class:!0});var $=P(t);s=A($,"SPAN",{class:!0});var N=P(s);n=ce(N,o),N.forEach(v),m=Y($),a=A($,"DIV",{class:!0});var O=P(a);u=A(O,"SPAN",{class:!0});var p=P(u);g=ce(p,d),p.forEach(v),w=Y(O),c.l(O),O.forEach(v),l=Y($),$.forEach(v),this.h()},h(){k(s,"class","text-white text-sm font-medium"),k(u,"class","text-gray-500 text-xs"),k(a,"class","flex items-center gap-2"),k(t,"class",_=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(V,$){H(V,t,$),C(t,s),C(s,n),C(t,m),C(t,a),C(a,u),C(u,g),C(a,w),B[r].m(a,null),C(t,l),h=!0,I||(x=G(t,"click",function(){xe(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),I=!0)},p(V,$){e=V,(!h||$&1)&&o!==(o=e[1].title+"")&&me(n,o),(!h||$&1)&&d!==(d=e[1].value+"")&&me(g,d);let N=r;r=L(e),r!==N&&(fe(),S(B[N],1,1,()=>{B[N]=null}),de(),c=B[r],c||(c=B[r]=y[r](e),c.c()),E(c,1),c.m(a,null)),(!h||$&1&&_!==(_=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&k(t,"class",_)},i(V){h||(E(c),h=!0)},o(V){S(c),h=!1},d(V){V&&v(t),B[r].d(),I=!1,x()}}}function Re(i){let e,t=[],s=new Map,o,n=he(i[0]);const m=a=>a[1].id;for(let a=0;a<n.length;a+=1){let u=ge(i,n,a),d=m(u);s.set(d,t[a]=be(d,u))}return{c(){e=D("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=A(a,"DIV",{class:!0});var u=P(e);for(let d=0;d<t.length;d+=1)t[d].l(u);u.forEach(v),this.h()},h(){k(e,"class","flex flex-col w-full")},m(a,u){H(a,e,u);for(let d=0;d<t.length;d+=1)t[d]&&t[d].m(e,null);o=!0},p(a,[u]){u&1&&(n=he(a[0]),fe(),t=je(t,u,m,1,a,n,s,e,Fe,be,null,ge),de())},i(a){if(!o){for(let u=0;u<n.length;u+=1)E(t[u]);o=!0}},o(a){for(let u=0;u<t.length;u+=1)S(t[u]);o=!1},d(a){a&&v(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function Ge(i,e,t){let{items:s=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return i.$$set=o=>{"items"in o&&t(0,s=o.items)},[s]}class We extends $e{constructor(e){super(),Ce(this,e,Ge,Re,ke,{items:0})}}function Ue(i){let e,t,s,o,n,m,a,u;e=new Ie({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",$$slots:{right:[Xe]},$$scope:{ctx:i}}});function d(r){i[21](r)}function g(r){i[22](r)}let w={dontMoveVertically:!0,hideActionButtons:!0};return i[1]!==void 0&&(w.posts=i[1]),i[6]!==void 0&&(w.keyboardY=i[6]),s=new Be({props:w}),W.push(()=>Q(s,"posts",d)),W.push(()=>Q(s,"keyboardY",g)),a=new Le({}),{c(){j(e.$$.fragment),t=T(),j(s.$$.fragment),m=T(),j(a.$$.fragment)},l(r){F(e.$$.fragment,r),t=Y(r),F(s.$$.fragment,r),m=Y(r),F(a.$$.fragment,r)},m(r,c){M(e,r,c),H(r,t,c),M(s,r,c),H(r,m,c),M(a,r,c),u=!0},p(r,c){const l={};c[0]&32|c[1]&2&&(l.$$scope={dirty:c,ctx:r}),e.$set(l);const _={};!o&&c[0]&2&&(o=!0,_.posts=r[1],U(()=>o=!1)),!n&&c[0]&64&&(n=!0,_.keyboardY=r[6],U(()=>n=!1)),s.$set(_)},i(r){u||(E(e.$$.fragment,r),E(s.$$.fragment,r),E(a.$$.fragment,r),u=!0)},o(r){S(e.$$.fragment,r),S(s.$$.fragment,r),S(a.$$.fragment,r),u=!1},d(r){r&&(v(t),v(m)),z(e,r),z(s,r),z(a,r)}}}function Qe(i){let e,t,s,o,n,m,a,u,d,g,w=(i[2]||"텍스트 입력하기...")+"",r,c,l,_,h,I,x,y,B,L,V;t=new Ie({props:{position:"static",leftBack:"white",$$slots:{right:[Ze]},$$scope:{ctx:i}}});function $(p){i[15](p)}function N(p){i[16](p)}let O={dontMoveVertically:!0,isEdit:!0};return i[1]!==void 0&&(O.posts=i[1]),i[6]!==void 0&&(O.keyboardY=i[6]),n=new Be({props:O}),W.push(()=>Q(n,"posts",$)),W.push(()=>Q(n,"keyboardY",N)),h=new We({props:{items:[{id:1,title:"장소",value:i[1][0].place_name||""},{id:2,title:"공개 여부",value:_e[i[4]],onClick:i[19]}]}}),y=new ze({}),{c(){e=D("section"),j(t.$$.fragment),s=T(),o=D("div"),j(n.$$.fragment),u=T(),d=D("div"),g=D("div"),r=ue(w),l=T(),_=D("div"),j(h.$$.fragment),I=T(),x=D("div"),j(y.$$.fragment),this.h()},l(p){e=A(p,"SECTION",{class:!0});var b=P(e);F(t.$$.fragment,b),s=Y(b),o=A(b,"DIV",{class:!0});var K=P(o);F(n.$$.fragment,K),K.forEach(v),u=Y(b),d=A(b,"DIV",{class:!0});var J=P(d);g=A(J,"DIV",{contenteditable:!0,class:!0});var q=P(g);r=ce(q,w),q.forEach(v),J.forEach(v),l=Y(b),_=A(b,"DIV",{class:!0});var X=P(_);F(h.$$.fragment,X),X.forEach(v),I=Y(b),x=A(b,"DIV",{class:!0});var Z=P(x);F(y.$$.fragment,Z),Z.forEach(v),b.forEach(v),this.h()},h(){k(o,"class","flex flex-grow"),k(g,"contenteditable","true"),k(g,"class",c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${i[7]?"text-gray-400":"text-white"}
        `),k(d,"class","h-32 px-5 py-2.5"),k(_,"class",""),k(x,"class","h-40"),k(e,"class","flex flex-col w-full h-screen bg-black")},m(p,b){H(p,e,b),M(t,e,null),C(e,s),C(e,o),M(n,o,null),C(e,u),C(e,d),C(d,g),C(g,r),C(e,l),C(e,_),M(h,_,null),C(e,I),C(e,x),M(y,x,null),B=!0,L||(V=[G(g,"input",i[11]),G(g,"focus",i[17]),G(g,"blur",i[18])],L=!0)},p(p,b){const K={};b[0]&1|b[1]&2&&(K.$$scope={dirty:b,ctx:p}),t.$set(K);const J={};!m&&b[0]&2&&(m=!0,J.posts=p[1],U(()=>m=!1)),!a&&b[0]&64&&(a=!0,J.keyboardY=p[6],U(()=>a=!1)),n.$set(J),(!B||b[0]&4)&&w!==(w=(p[2]||"텍스트 입력하기...")+"")&&Oe(r,w),(!B||b[0]&128&&c!==(c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${p[7]?"text-gray-400":"text-white"}
        `))&&k(g,"class",c);const q={};b[0]&26&&(q.items=[{id:1,title:"장소",value:p[1][0].place_name||""},{id:2,title:"공개 여부",value:_e[p[4]],onClick:p[19]}]),h.$set(q)},i(p){B||(E(t.$$.fragment,p),E(n.$$.fragment,p),E(h.$$.fragment,p),E(y.$$.fragment,p),B=!0)},o(p){S(t.$$.fragment,p),S(n.$$.fragment,p),S(h.$$.fragment,p),S(y.$$.fragment,p),B=!1},d(p){p&&v(e),z(t),z(n),z(h),z(y),L=!1,Te(V)}}}function Xe(i){let e,t="완료",s,o;return{c(){e=D("div"),e.textContent=t,this.h()},l(n){e=A(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-19ryuj"&&(e.textContent=t),this.h()},h(){k(e,"slot","right"),k(e,"class","text-white")},m(n,m){H(n,e,m),s||(o=G(e,"click",i[20]),s=!0)},p:ie,d(n){n&&v(e),s=!1,o()}}}function Ze(i){let e,t="다음",s,o;return{c(){e=D("div"),e.textContent=t,this.h()},l(n){e=A(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){k(e,"slot","right"),k(e,"class","text-white")},m(n,m){H(n,e,m),s||(o=G(e,"click",i[14]),s=!0)},p:ie,d(n){n&&v(e),s=!1,o()}}}function et(i){let e,t,s,o,n,m,a;const u=[Qe,Ue],d=[];function g(l,_){return l[0]===0?0:l[0]===1?1:-1}~(e=g(i))&&(t=d[e]=u[e](i));function w(l){i[23](l)}function r(l){i[24](l)}let c={};return i[3]!==void 0&&(c.isOpen=i[3]),i[4]!==void 0&&(c.selectedVisibility=i[4]),o=new He({props:c}),W.push(()=>Q(o,"isOpen",w)),W.push(()=>Q(o,"selectedVisibility",r)),{c(){t&&t.c(),s=T(),j(o.$$.fragment)},l(l){t&&t.l(l),s=Y(l),F(o.$$.fragment,l)},m(l,_){~e&&d[e].m(l,_),H(l,s,_),M(o,l,_),a=!0},p(l,_){let h=e;e=g(l),e===h?~e&&d[e].p(l,_):(t&&(fe(),S(d[h],1,1,()=>{d[h]=null}),de()),~e?(t=d[e],t?t.p(l,_):(t=d[e]=u[e](l),t.c()),E(t,1),t.m(s.parentNode,s)):t=null);const I={};!n&&_[0]&8&&(n=!0,I.isOpen=l[3],U(()=>n=!1)),!m&&_[0]&16&&(m=!0,I.selectedVisibility=l[4],U(()=>m=!1)),o.$set(I)},i(l){a||(E(t),E(o.$$.fragment,l),a=!0)},o(l){S(t),S(o.$$.fragment,l),a=!1},d(l){l&&v(s),~e&&d[e].d(l),z(o,l)}}}function tt(i){const e=i.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function st(i){const e=i.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function it(i,e,t){let s,o,n,m,a;te(i,pe,f=>t(26,o=f)),te(i,re,f=>t(27,n=f)),te(i,Ye,f=>t(28,m=f)),te(i,we,f=>t(13,a=f));const u=Ee.getPlatform()!=="web",d=m.url.searchParams.get("type");let g=0,{data:w}=e,r=w.posts,c="",l=!1,_="public",h=!1;async function I(){const f=r==null?void 0:r.at(0);(await fetch(`${oe}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le()}`},body:JSON.stringify({placeIdx:f.place_idx,text:c,media:s,permission:_})})).ok&&await se(`/places/${f.place_idx}`,{replaceState:!0,invalidateAll:!0})}async function x(){try{const f=await fetch(`${oe}/posts/${m.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le()}`},body:JSON.stringify({text:c})});if(!f.ok){(await f.json()).status===401&&(ve.emit("pushSnackbar",{message:"접근할 수 없습니다"}),se(`/viewer?postIdx=${m.url.searchParams.get("postIdx")}`));return}await se("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let y=0;function B(){ae.addListener("keyboardWillShow",f=>{t(6,y=f.keyboardHeight*-1)}),ae.addListener("keyboardWillHide",()=>{t(6,y=0)})}function L(){ae.removeAllListeners()}Pe(()=>{var f,R;u&&B(),n?(t(2,c=n),ne(re,n="",n)):(f=I[0])!=null&&f.text&&t(2,c=(R=I[0])==null?void 0:R.text)}),Ne(()=>{u&&L(),ne(re,n="",n),ne(pe,o="",o)});function V(f){const R=f.target;t(2,c=R.innerText),t(1,r[0]={...r[0],text:c},r)}let $=c.trim()==="";const N=()=>{t(0,g=1)};function O(f){r=f,t(1,r)}function p(f){y=f,t(6,y)}const b=f=>{tt(f),t(7,$=!1)},K=f=>{st(f),t(7,$=!c.trim())},J=()=>{t(3,l=!0)},q=async()=>{h||(t(5,h=!0),d==="post"?await I():d==="patch"&&await x(),t(5,h=!1))};function X(f){r=f,t(1,r)}function Z(f){y=f,t(6,y)}function Ve(f){l=f,t(3,l)}function De(f){_=f,t(4,_)}return i.$$set=f=>{"data"in f&&t(12,w=f.data)},i.$$.update=()=>{i.$$.dirty[0]&8192&&(s=a)},[g,r,c,l,_,h,y,$,d,I,x,V,w,a,N,O,p,b,K,J,q,X,Z,Ve,De]}class wt extends $e{constructor(e){super(),Ce(this,e,it,et,ke,{data:12},null,[-1,-1])}}export{wt as component,vt as universal};
