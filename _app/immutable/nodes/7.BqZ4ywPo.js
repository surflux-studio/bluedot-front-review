import{s as se,m as ae,p as ie,a as A,e as M,g as E,c as R,b as T,f as _,q as D,i as C,h as W,k as _e,t as F,d as z,r as he,j as ge,n as be}from"../chunks/scheduler.BiUHV-k5.js";import{S as le,i as fe,e as ce,c as w,a as x,m as v,t as h,b as g,d as y,f as Q,g as X}from"../chunks/index.DaxfEsq8.js";import{e as Y,u as ke,o as we}from"../chunks/each.BSmogOji.js";import{g as Z}from"../chunks/entry.2t9bNCUz.js";import{F as ue}from"../chunks/Footer.BMCKURe0.js";import{H as me}from"../chunks/Header.CoYHp0KD.js";import{M as xe}from"../chunks/Map.D5XTczAq.js";import{N as ve}from"../chunks/NavigationBar.CA0knSSt.js";import{B as ee}from"../chunks/Button.BoykKRRQ.js";import{g as ye}from"../chunks/searchParams.B_moJgVT.js";import{e as H,A as te}from"../chunks/units.BAzzBC2f.js";import{p as Oe}from"../chunks/stores.D8IjOea5.js";import"../chunks/Field.DcDRmg5o.js";/* empty css                                                   *//* empty css                                                   */import{a as Ce}from"../chunks/map.FyglWylt.js";import"../chunks/ImageShaper.BEKfM5ww.js";import"../chunks/heic2any.qfZNZFSB.js";import"../chunks/store.BVj3inWO.js";/* empty css                                                            */import{A as Be}from"../chunks/ActionSheet.CUgmOkI7.js";import{S as Ie}from"../chunks/Search.Fx9RCDDc.js";import{H as Pe}from"../chunks/HexImage.HQWguL6G.js";import{f as Se}from"../chunks/search.Cv9BRXkB.js";import{f as Ae}from"../chunks/proj.DXH8zrwl.js";import{s as re}from"../chunks/s32cloudfront.DmVgJy7p.js";const Ee=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ne(a){let e,r;return e=new Ie({}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function De(a){let e,r,t;function s(i){a[1](i)}let n={sheetBackground:"bg-[black]/60 backdrop-blur-sm",$$slots:{default:[Ne]},$$scope:{ctx:a}};return a[0]!==void 0&&(n.isOpen=a[0]),e=new Be({props:n}),ae.push(()=>ce(e,"isOpen",s)),{c(){w(e.$$.fragment)},l(i){x(e.$$.fragment,i)},m(i,c){v(e,i,c),t=!0},p(i,[c]){const $={};c&4&&($.$$scope={dirty:c,ctx:i}),!r&&c&1&&(r=!0,$.isOpen=i[0],ie(()=>r=!1)),e.$set($)},i(i){t||(h(e.$$.fragment,i),t=!0)},o(i){g(e.$$.fragment,i),t=!1},d(i){y(e,i)}}}function We(a,e,r){let{isOpen:t=!1}=e;function s(n){t=n,r(0,t)}return a.$$set=n=>{"isOpen"in n&&r(0,t=n.isOpen)},[t,s]}class Me extends le{constructor(e){super(),fe(this,e,We,De,se,{isOpen:0})}}const{Map:Re}=Ee;function oe(a,e,r){const t=a.slice();return t[13]=e[r],t}function Te(a){let e,r;return e=new me({props:{position:"fixed",rightFeed:!0}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function Ve(a){let e,r;return e=new me({props:{position:"fixed",leftBack:!0}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function ne(a,e){var P;let r,t,s,n,i,c=e[13].name+"",$,m,B,b,O;s=new Pe({props:{src:re(e[13].image),width:96,height:96,onBorder:e[13].idx===((P=e[2])==null?void 0:P.idx)}});function I(){return e[9](e[13])}return{key:a,first:null,c(){r=M("div"),t=M("div"),w(s.$$.fragment),n=A(),i=M("span"),$=F(c),m=A(),this.h()},l(p){r=R(p,"DIV",{class:!0,"aria-hidden":!0});var f=T(r);t=R(f,"DIV",{class:!0});var d=T(t);x(s.$$.fragment,d),d.forEach(_),n=E(f),i=R(f,"SPAN",{class:!0});var u=T(i);$=z(u,c),u.forEach(_),m=E(f),f.forEach(_),this.h()},h(){D(t,"class","w-24 h-24 relative"),D(i,"class","w-24 truncate text-xs text-gray-700"),D(r,"class","flex-shrink-0 flex flex-col items-center space-y-1"),D(r,"aria-hidden",""),this.first=r},m(p,f){C(p,r,f),W(r,t),v(s,t,null),W(r,n),W(r,i),W(i,$),W(r,m),B=!0,b||(O=he(r,"click",I),b=!0)},p(p,f){var u;e=p;const d={};f&1&&(d.src=re(e[13].image)),f&5&&(d.onBorder=e[13].idx===((u=e[2])==null?void 0:u.idx)),s.$set(d),(!B||f&1)&&c!==(c=e[13].name+"")&&ge($,c)},i(p){B||(h(s.$$.fragment,p),B=!0)},o(p){g(s.$$.fragment,p),B=!1},d(p){p&&_(r),y(s),b=!1,O()}}}function je(a){let e,r;return e=new ue({props:{position:"fixed",leftReposition:!0,centerSearch:!0,right:"add"}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},p:be,i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function He(a){let e,r;return e=new ue({props:{position:"fixed",bottom:"2rem",$$slots:{default:[Fe]},$$scope:{ctx:a}}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,s){v(e,t,s),r=!0},p(t,s){const n={};s&65536&&(n.$$scope={dirty:s,ctx:t}),e.$set(n)},i(t){r||(h(e.$$.fragment,t),r=!0)},o(t){g(e.$$.fragment,t),r=!1},d(t){y(e,t)}}}function Le(a){let e;return{c(){e=F("이 장소가 아니예요")},l(r){e=z(r,"이 장소가 아니예요")},m(r,t){C(r,e,t)},d(r){r&&_(e)}}}function qe(a){let e;return{c(){e=F("이 장소가 맞아요")},l(r){e=z(r,"이 장소가 맞아요")},m(r,t){C(r,e,t)},d(r){r&&_(e)}}}function Fe(a){let e,r,t,s;return e=new ee({props:{backgroundColor:"bg-gray-300",textColor:"text-white",$$slots:{default:[Le]},$$scope:{ctx:a}}}),e.$on("click",a[10]),t=new ee({props:{backgroundColor:"bg-primary-500",textColor:"text-white",$$slots:{default:[qe]},$$scope:{ctx:a}}}),t.$on("click",a[5]),{c(){w(e.$$.fragment),r=A(),w(t.$$.fragment)},l(n){x(e.$$.fragment,n),r=E(n),x(t.$$.fragment,n)},m(n,i){v(e,n,i),C(n,r,i),v(t,n,i),s=!0},p(n,i){const c={};i&65536&&(c.$$scope={dirty:i,ctx:n}),e.$set(c);const $={};i&65536&&($.$$scope={dirty:i,ctx:n}),t.$set($)},i(n){s||(h(e.$$.fragment,n),h(t.$$.fragment,n),s=!0)},o(n){g(e.$$.fragment,n),g(t.$$.fragment,n),s=!1},d(n){n&&_(r),y(e,n),y(t,n)}}}function ze(a){let e,r,t,s,n,i,c,$,m=[],B=new Re,b,O,I,P,p,f,d,u,S;const G=[Ve,Te],N=[];function U(o,l){return o[4]==="post"||o[4]==="box"||o[3]?0:1}e=U(a),r=N[e]=G[e](a),n=new xe({props:{onMoveend:a[6]}});let V=Y(a[0]);const J=o=>o[13].idx;for(let o=0;o<V.length;o+=1){let l=oe(a,V,o),k=J(l);B.set(k,m[o]=ne(k,l))}const pe=[He,je],L=[];function $e(o,l){return o[4]==="post"||o[4]==="box"?0:1}O=$e(a),I=L[O]=pe[O](a);function de(o){a[11](o)}let K={};return a[1]!==void 0&&(K.isOpen=a[1]),p=new Me({props:K}),ae.push(()=>ce(p,"isOpen",de)),u=new ve({props:{show:a[4]!=="post"}}),{c(){r.c(),t=A(),s=M("div"),w(n.$$.fragment),i=A(),c=M("div"),$=M("div");for(let o=0;o<m.length;o+=1)m[o].c();b=A(),I.c(),P=A(),w(p.$$.fragment),d=A(),w(u.$$.fragment),this.h()},l(o){r.l(o),t=E(o),s=R(o,"DIV",{class:!0});var l=T(s);x(n.$$.fragment,l),l.forEach(_),i=E(o),c=R(o,"DIV",{class:!0});var k=T(c);$=R(k,"DIV",{class:!0});var j=T($);for(let q=0;q<m.length;q+=1)m[q].l(j);j.forEach(_),k.forEach(_),b=E(o),I.l(o),P=E(o),x(p.$$.fragment,o),d=E(o),x(u.$$.fragment,o),this.h()},h(){D(s,"class","fixed top-0 left-0 w-full h-full"),D($,"class","flex space-x-4"),D(c,"class","relative top-4 left-0 overflow-x-auto p-4 z-20")},m(o,l){N[e].m(o,l),C(o,t,l),C(o,s,l),v(n,s,null),C(o,i,l),C(o,c,l),W(c,$);for(let k=0;k<m.length;k+=1)m[k]&&m[k].m($,null);C(o,b,l),L[O].m(o,l),C(o,P,l),v(p,o,l),C(o,d,l),v(u,o,l),S=!0},p(o,[l]){let k=e;e=U(o),e!==k&&(X(),g(N[k],1,1,()=>{N[k]=null}),Q(),r=N[e],r||(r=N[e]=G[e](o),r.c()),h(r,1),r.m(t.parentNode,t)),l&133&&(V=Y(o[0]),X(),m=ke(m,l,J,1,o,V,B,$,we,ne,null,oe),Q()),I.p(o,l);const j={};!f&&l&2&&(f=!0,j.isOpen=o[1],ie(()=>f=!1)),p.$set(j)},i(o){if(!S){h(r),h(n.$$.fragment,o);for(let l=0;l<V.length;l+=1)h(m[l]);h(I),h(p.$$.fragment,o),h(u.$$.fragment,o),S=!0}},o(o){g(r),g(n.$$.fragment,o);for(let l=0;l<m.length;l+=1)g(m[l]);g(I),g(p.$$.fragment,o),g(u.$$.fragment,o),S=!1},d(o){o&&(_(t),_(s),_(i),_(c),_(b),_(P),_(d)),N[e].d(o),y(n);for(let l=0;l<m.length;l+=1)m[l].d();L[O].d(o),y(p,o),y(u,o)}}}function Ge(a,e,r){let t,s;_e(a,Oe,f=>r(8,s=f));let n=[];const i=s.url.searchParams.get("type");let c=!1;H.on("openSearch",()=>{r(1,c=!0)}),H.on("closeSearch",()=>{r(1,c=!1)});async function $(){if(i==="box"){const f=Number(s.url.searchParams.get("boxIdx"));if(Number.isNaN(f)||!f)return Z("/boxes");(await fetch(`${te}/boxes/${f}/places/${s.url.searchParams.get("placeIdx")}`,{method:"PUT",headers:{Authorization:`Bearer ${sessionStorage.getItem("jwt")}`}})).ok||H.emit("pushSnackbar",{message:"장소 추가에 실패했습니다."}),Z(`/boxes/${f}/detail`)}else i==="post"&&ye("/viewer/edit")}let m;async function B(f){try{m&&m.abort("new request"),m=new AbortController;const d=new URL(`${te}/boxes/boundary?bbox=${f}`),u=await Se(d,{method:"GET",headers:{Accept:"application/json"}},m);if(!u.ok)return;const S=await u.json();r(0,n=S.data)}catch(d){d.name!=="AbortError"&&console.error(d)}}let b;function O(f){const d=n.find(u=>u.idx===f);if(d){if(Ce.clear(),b&&b.idx===d.idx)return r(2,b=void 0);r(2,b=d),b.places.forEach(u=>{var S;H.emit("addIcon",{idx:Number(u.idx),coordinate:Ae([u.longitude,u.latitude]),image:((S=u.media)==null?void 0:S.at(0))??"",shape:"waterdrop",type:"place",link:`/places/${u.idx}`,rank:1,name:u.name,width:56,height:61})})}}const I=f=>O(f.idx),P=()=>window.history.back();function p(f){c=f,r(1,c)}return a.$$.update=()=>{a.$$.dirty&256&&r(3,t=s.url.searchParams.get("withBack")==="true")},[n,c,b,t,i,$,B,O,s,I,P,p]}class bt extends le{constructor(e){super(),fe(this,e,Ge,ze,se,{})}}export{bt as component};
