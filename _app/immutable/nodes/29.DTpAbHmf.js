import{b as Pe,g as te}from"../chunks/sign.CUItAdIG.js";import{e as Q}from"../chunks/index.C5W5gfZx.js";import{e as G,A as se,f as me,g as ae,I as ge,k as ue}from"../chunks/store.C9gcVE2I.js";import{l as Ne,s as be,e as V,c as O,b as N,f as v,v as $,i as j,t as ie,a as T,d as ne,g as x,h as A,A as W,I as Te,j as ce,n as re,w as R,x as U,k as ee,y as xe,B as je,U as Fe,D as fe,V as Me,F as He,z as ve,N as pe,T as ze}from"../chunks/scheduler.CIbz-4tf.js";import{g as Z}from"../chunks/entry.Di29JZxr.js";import{S as Ce,i as ke,g as oe,e as le,t as I,a as E,c as M,d as H,m as z,f as K,b as X}from"../chunks/index.gvaMc9LH.js";import{H as we}from"../chunks/Header.B6oSGUbu.js";import{V as ye}from"../chunks/Viewer.MXK_nVUz.js";/* empty css                                                   */import{p as Ke}from"../chunks/stores.CcN5nOBZ.js";import"../chunks/ActionSheet.svelte_svelte_type_style_lang.BPug75Ph.js";import{C as Le}from"../chunks/device.DknIEsqX.js";import{e as de,u as Je,o as Re}from"../chunks/each.Cdd7o6io.js";import{I as qe}from"../chunks/IconChevronRight.Bzgz52r7.js";import{V as Ge}from"../chunks/VisibilitySheet.CePTVsPD.js";import{N as We}from"../chunks/NavigationBar.CbGomYPw.js";import{A as Ue}from"../chunks/ActionSheetOpenApp.BbBDJ2G9.js";import{o as Xe,a as Ye}from"../chunks/ActionSheet.BIWm96Cn.js";const Qe=async({fetch:i,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return Q(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const s=Pe();return{posts:[{user_idx:s==null?void 0:s.sub,unique_name:s==null?void 0:s.uni,profile_image_url:s==null?void 0:s.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Ne(me),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const s=e.searchParams.get("postIdx");if(s==="null")return G.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),Z("/viewer",{replaceState:!0});s||Q(404,"Not Found");const l=await i(`${se}/posts/${s}`,{method:"GET",headers:{Authorization:"Bearer "+te()}}).then(n=>n.json()).then(n=>n.data);return l.error&&Q(404,"Not Found"),{posts:[{...l,mediaIdx:0}]}}return Q(404,"Not Found")},Ot=Object.freeze(Object.defineProperty({__proto__:null,load:Qe},Symbol.toStringTag,{value:"Module"}));function _e(i,e,t){const s=i.slice();return s[1]=e[t],s[3]=t,s}function Ze(i){let e;return{c(){e=V("div"),this.h()},l(t){e=O(t,"DIV",{class:!0}),N(e).forEach(v),this.h()},h(){$(e,"class","w-0.5")},m(t,s){j(t,e,s)},i:re,o:re,d(t){t&&v(e)}}}function et(i){let e,t;return e=new qe({props:{fill:"#6B7280",length:"1.25"}}),{c(){M(e.$$.fragment)},l(s){H(e.$$.fragment,s)},m(s,l){z(e,s,l),t=!0},i(s){t||(I(e.$$.fragment,s),t=!0)},o(s){E(e.$$.fragment,s),t=!1},d(s){K(e,s)}}}function he(i,e){let t,s,l=e[1].title+"",n,_,u,a,p=e[1].value+"",h,r,c,g,D,w,B,C,S;const o=[et,Ze],b=[];function P(k,y){return k[1].onClick?0:1}return c=P(e),g=b[c]=o[c](e),{key:i,first:null,c(){t=V("div"),s=V("span"),n=ie(l),_=T(),u=V("div"),a=V("span"),h=ie(p),r=T(),g.c(),D=T(),this.h()},l(k){t=O(k,"DIV",{class:!0});var y=N(t);s=O(y,"SPAN",{class:!0});var d=N(s);n=ne(d,l),d.forEach(v),_=x(y),u=O(y,"DIV",{class:!0});var m=N(u);a=O(m,"SPAN",{class:!0});var F=N(a);h=ne(F,p),F.forEach(v),r=x(m),g.l(m),m.forEach(v),D=x(y),y.forEach(v),this.h()},h(){$(s,"class","text-white text-sm font-medium"),$(a,"class","text-gray-500 text-xs"),$(u,"class","flex items-center gap-2"),$(t,"class",w=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(k,y){j(k,t,y),A(t,s),A(s,n),A(t,_),A(t,u),A(u,a),A(a,h),A(u,r),b[c].m(u,null),A(t,D),B=!0,C||(S=W(t,"click",function(){Te(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),C=!0)},p(k,y){e=k,(!B||y&1)&&l!==(l=e[1].title+"")&&ce(n,l),(!B||y&1)&&p!==(p=e[1].value+"")&&ce(h,p);let d=c;c=P(e),c!==d&&(oe(),E(b[d],1,1,()=>{b[d]=null}),le(),g=b[c],g||(g=b[c]=o[c](e),g.c()),I(g,1),g.m(u,null)),(!B||y&1&&w!==(w=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&$(t,"class",w)},i(k){B||(I(g),B=!0)},o(k){E(g),B=!1},d(k){k&&v(t),b[c].d(),C=!1,S()}}}function tt(i){let e,t=[],s=new Map,l,n=de(i[0]);const _=u=>u[1].id;for(let u=0;u<n.length;u+=1){let a=_e(i,n,u),p=_(a);s.set(p,t[u]=he(p,a))}return{c(){e=V("div");for(let u=0;u<t.length;u+=1)t[u].c();this.h()},l(u){e=O(u,"DIV",{class:!0});var a=N(e);for(let p=0;p<t.length;p+=1)t[p].l(a);a.forEach(v),this.h()},h(){$(e,"class","flex flex-col w-full")},m(u,a){j(u,e,a);for(let p=0;p<t.length;p+=1)t[p]&&t[p].m(e,null);l=!0},p(u,[a]){a&1&&(n=de(u[0]),oe(),t=Je(t,a,_,1,u,n,s,e,Re,he,null,_e),le())},i(u){if(!l){for(let a=0;a<n.length;a+=1)I(t[a]);l=!0}},o(u){for(let a=0;a<t.length;a+=1)E(t[a]);l=!1},d(u){u&&v(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function st(i,e,t){let{items:s=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return i.$$set=l=>{"items"in l&&t(0,s=l.items)},[s]}class it extends Ce{constructor(e){super(),ke(this,e,st,tt,be,{items:0})}}function nt(i){let e,t,s,l,n,_,u;e=new we({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",leftBackOnClick:i[25],$$slots:{right:[ot]},$$scope:{ctx:i}}});function a(r){i[26](r)}let p={dontMoveVertically:!0,hideActionButtons:!0};i[2]!==void 0&&(p.posts=i[2]),s=new ye({props:p}),R.push(()=>X(s,"posts",a));let h=!ge&&lt();return{c(){M(e.$$.fragment),t=T(),M(s.$$.fragment),n=T(),h&&h.c(),_=fe()},l(r){H(e.$$.fragment,r),t=x(r),H(s.$$.fragment,r),n=x(r),h&&h.l(r),_=fe()},m(r,c){z(e,r,c),j(r,t,c),z(s,r,c),j(r,n,c),h&&h.m(r,c),j(r,_,c),u=!0},p(r,c){const g={};c[0]&2&&(g.leftBackOnClick=r[25]),c[0]&288|c[1]&64&&(g.$$scope={dirty:c,ctx:r}),e.$set(g);const D={};!l&&c[0]&4&&(l=!0,D.posts=r[2],U(()=>l=!1)),s.$set(D)},i(r){u||(I(e.$$.fragment,r),I(s.$$.fragment,r),I(h),u=!0)},o(r){E(e.$$.fragment,r),E(s.$$.fragment,r),E(h),u=!1},d(r){r&&(v(t),v(n),v(_)),K(e,r),K(s,r),h&&h.d(r)}}}function rt(i){let e,t,s,l,n,_,u,a,p,h=(i[0]||"텍스트 입력하기...")+"",r,c,g,D,w,B,C,S,o,b,P;t=new we({props:{position:"sticky",leftBack:"white",backgroundColor:"bg-black",$$slots:{right:[at]},$$scope:{ctx:i}}});function k(d){i[18](d)}let y={dontMoveVertically:!0,isEdit:!0};return i[2]!==void 0&&(y.posts=i[2]),n=new ye({props:y}),R.push(()=>X(n,"posts",k)),w=new it({props:{items:[{id:1,title:"장소",value:i[2][0].place_name||""},{id:2,title:"공개 여부",value:ue[i[4]],onClick:i[22]}]}}),{c(){e=V("section"),M(t.$$.fragment),s=T(),l=V("div"),M(n.$$.fragment),u=T(),a=V("div"),p=V("div"),r=ie(h),g=T(),D=V("div"),M(w.$$.fragment),B=T(),C=V("div"),this.h()},l(d){e=O(d,"SECTION",{class:!0,style:!0});var m=N(e);H(t.$$.fragment,m),s=x(m),l=O(m,"DIV",{class:!0});var F=N(l);H(n.$$.fragment,F),F.forEach(v),u=x(m),a=O(m,"DIV",{class:!0});var L=N(a);p=O(L,"DIV",{contenteditable:!0,class:!0});var J=N(p);r=ne(J,h),J.forEach(v),L.forEach(v),g=x(m),D=O(m,"DIV",{});var Y=N(D);H(w.$$.fragment,Y),Y.forEach(v),B=x(m),C=O(m,"DIV",{class:!0}),N(C).forEach(v),m.forEach(v),this.h()},h(){$(l,"class","h-72"),$(p,"contenteditable","true"),$(p,"class",c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto
          focus:outline-none 
          whitespace-pre-wrap
          caret-white
          ${i[10]?"text-gray-400":"text-white"}
        `),$(a,"class","h-32 px-5 py-2.5"),$(C,"class","h-[2.625rem]"),$(e,"class","w-screen h-screen bg-black transition-transform duration-100 overflow-y-auto "),$(e,"style",S=`padding-bottom: ${i[9]}px;`)},m(d,m){j(d,e,m),z(t,e,null),A(e,s),A(e,l),z(n,l,null),A(e,u),A(e,a),A(a,p),A(p,r),i[19](p),A(e,g),A(e,D),z(w,D,null),A(e,B),A(e,C),i[23](e),o=!0,b||(P=[W(p,"input",i[14]),W(p,"focus",i[20]),W(p,"blur",i[21])],b=!0)},p(d,m){const F={};m[0]&2|m[1]&64&&(F.$$scope={dirty:m,ctx:d}),t.$set(F);const L={};!_&&m[0]&4&&(_=!0,L.posts=d[2],U(()=>_=!1)),n.$set(L),(!o||m[0]&1)&&h!==(h=(d[0]||"텍스트 입력하기...")+"")&&Me(r,h),(!o||m[0]&1024&&c!==(c=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto
          focus:outline-none 
          whitespace-pre-wrap
          caret-white
          ${d[10]?"text-gray-400":"text-white"}
        `))&&$(p,"class",c);const J={};m[0]&28&&(J.items=[{id:1,title:"장소",value:d[2][0].place_name||""},{id:2,title:"공개 여부",value:ue[d[4]],onClick:d[22]}]),w.$set(J),(!o||m[0]&512&&S!==(S=`padding-bottom: ${d[9]}px;`))&&$(e,"style",S)},i(d){o||(I(t.$$.fragment,d),I(n.$$.fragment,d),I(w.$$.fragment,d),o=!0)},o(d){E(t.$$.fragment,d),E(n.$$.fragment,d),E(w.$$.fragment,d),o=!1},d(d){d&&v(e),K(t),K(n),i[19](null),K(w),i[23](null),b=!1,He(P)}}}function ot(i){let e,t="완료",s,l;return{c(){e=V("div"),e.textContent=t,this.h()},l(n){e=O(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-ioumnb"&&(e.textContent=t),this.h()},h(){$(e,"slot","right"),$(e,"class","text-white"),pe(e,"opacity-50",i[5])},m(n,_){j(n,e,_),s||(l=W(e,"click",i[24]),s=!0)},p(n,_){_[0]&32&&pe(e,"opacity-50",n[5])},d(n){n&&v(e),s=!1,l()}}}function lt(i){let e,t;return e=new We({}),{c(){M(e.$$.fragment)},l(s){H(e.$$.fragment,s)},m(s,l){z(e,s,l),t=!0},i(s){t||(I(e.$$.fragment,s),t=!0)},o(s){E(e.$$.fragment,s),t=!1},d(s){K(e,s)}}}function at(i){let e,t="다음",s,l;return{c(){e=V("div"),e.textContent=t,this.h()},l(n){e=O(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ve(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){$(e,"slot","right"),$(e,"class","text-white")},m(n,_){j(n,e,_),s||(l=W(e,"click",i[17]),s=!0)},p:re,d(n){n&&v(e),s=!1,l()}}}function ut(i){let e,t,s,l,n,_,u,a,p,h;const r=[rt,nt],c=[];function g(o,b){return o[1]===0?0:o[1]===1?1:-1}~(e=g(i))&&(t=c[e]=r[e](i));function D(o){i[27](o)}function w(o){i[28](o)}let B={};i[3]!==void 0&&(B.isOpen=i[3]),i[4]!==void 0&&(B.selectedVisibility=i[4]),l=new Ge({props:B}),R.push(()=>X(l,"isOpen",D)),R.push(()=>X(l,"selectedVisibility",w));function C(o){i[29](o)}let S={};return i[8]!==void 0&&(S.isOpen=i[8]),a=new Ue({props:S}),R.push(()=>X(a,"isOpen",C)),{c(){t&&t.c(),s=T(),M(l.$$.fragment),u=T(),M(a.$$.fragment)},l(o){t&&t.l(o),s=x(o),H(l.$$.fragment,o),u=x(o),H(a.$$.fragment,o)},m(o,b){~e&&c[e].m(o,b),j(o,s,b),z(l,o,b),j(o,u,b),z(a,o,b),h=!0},p(o,b){let P=e;e=g(o),e===P?~e&&c[e].p(o,b):(t&&(oe(),E(c[P],1,1,()=>{c[P]=null}),le()),~e?(t=c[e],t?t.p(o,b):(t=c[e]=r[e](o),t.c()),I(t,1),t.m(s.parentNode,s)):t=null);const k={};!n&&b[0]&8&&(n=!0,k.isOpen=o[3],U(()=>n=!1)),!_&&b[0]&16&&(_=!0,k.selectedVisibility=o[4],U(()=>_=!1)),l.$set(k);const y={};!p&&b[0]&256&&(p=!0,y.isOpen=o[8],U(()=>p=!1)),a.$set(y)},i(o){h||(I(t),I(l.$$.fragment,o),I(a.$$.fragment,o),h=!0)},o(o){E(t),E(l.$$.fragment,o),E(a.$$.fragment,o),h=!1},d(o){o&&(v(s),v(u)),~e&&c[e].d(o),K(l,o),K(a,o)}}}function ct(i){const e=i.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function ft(i){const e=i.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function pt(i,e,t){let s,l,n,_,u;ee(i,ae,f=>t(32,n=f)),ee(i,Ke,f=>t(33,_=f)),ee(i,me,f=>t(16,u=f)),Le.getPlatform();const a=_.url.searchParams.get("type");let p=0,{data:h}=e,r=h.posts,c="",g=!1,D="public",w=!1,B,C,S=0,o=!1;async function b(){try{const f=r==null?void 0:r.at(0);(await fetch(`${se}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te()}`},body:JSON.stringify({placeIdx:f.place_idx,text:c,media:s,permission:D,reference:n})})).ok&&await Z(`/places/${f.place_idx}`,{replaceState:!0,invalidateAll:!0})}catch(f){console.error(f),G.emit("pushSnackbar",{message:"게시글 업로드에 실패했습니다"})}}async function P(){try{const f=await fetch(`${se}/posts/${_.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${te()}`},body:JSON.stringify({text:c})});if(!f.ok){(await f.json()).status===401&&(G.emit("pushSnackbar",{message:"접근할 수 없습니다"}),Z(`/viewer?postIdx=${_.url.searchParams.get("postIdx")}`));return}await Z("/users/0",{replaceState:!0,invalidateAll:!0})}catch(f){console.error(f),G.emit("pushSnackbar",{message:"게시글 수정에 실패했습니다"})}}let k=0;function y(f){S=f.keyboardHeight,t(9,k=S),ze().then(()=>{C==null||C.scrollIntoView({behavior:"smooth",block:"start"})})}function d(){t(9,k=0)}xe(()=>{var f,q;Xe(()=>{},y,d),n!=null&&n.text?t(0,c=n.text):(f=r[0])!=null&&f.text&&t(0,c=(q=r[0])==null?void 0:q.text),C&&t(7,C.innerHTML=c||"텍스트 입력하기...",C)}),je(()=>{Ye(),Fe(ae,n=void 0,n)});function m(f){const q=f.target;t(0,c=q.innerText),t(2,r[0]={...r[0],text:c},r)}const F=()=>{t(1,p=1)};function L(f){r=f,t(2,r)}function J(f){R[f?"unshift":"push"](()=>{C=f,t(7,C)})}const Y=f=>{ct(f),t(10,l=!1)},$e=f=>{ft(f),t(10,l=!c.trim())},De=()=>{t(3,g=!0)};function Be(f){R[f?"unshift":"push"](()=>{B=f,t(6,B)})}const Ae=async()=>{if(ge)return t(8,o=!0);w||(t(5,w=!0),G.emit("loading",!0),a==="post"?await b():a==="patch"&&await P(),t(5,w=!1),G.emit("loading",!1))},Ie=()=>{t(1,p=0)};function Ee(f){r=f,t(2,r)}function Ve(f){g=f,t(3,g)}function Oe(f){D=f,t(4,D)}function Se(f){o=f,t(8,o)}return i.$$set=f=>{"data"in f&&t(15,h=f.data)},i.$$.update=()=>{i.$$.dirty[0]&65536&&(s=u),i.$$.dirty[0]&1&&t(10,l=c==="")},[c,p,r,g,D,w,B,C,o,k,l,a,b,P,m,h,u,F,L,J,Y,$e,De,Be,Ae,Ie,Ee,Ve,Oe,Se]}class St extends Ce{constructor(e){super(),ke(this,e,pt,ut,be,{data:15},null,[-1,-1])}}export{St as component,Ot as universal};
