import{g as ue}from"../chunks/entry.CDO5ILmd.js";import{g as Ve,e as W,l as Be,C as Ne,s as he,A as je}from"../chunks/sign.DblNfy3K.js";import{s as ze,y as be,e as C,a as O,t as xe,c as x,b as k,g as A,f as p,B as ge,d as ve,v as b,i as U,h as d,O as De,A as ce,z as _e,j as He,F as Ue,k as Le,n as ie,P as Ee}from"../chunks/scheduler.BTWb34i-.js";import{S as Me,i as qe,e as Ce,c as q,b as R,m as J,a as V,f as Re,t as N,d as G,g as Je}from"../chunks/index.D8fgSKXR.js";import{H as Ge}from"../chunks/Header.Ct40339A.js";import{F as We}from"../chunks/Field.cvwonUDa.js";import{g as Xe,t as Ke}from"../chunks/photo.1IDORitT.js";import{s as Se}from"../chunks/s32cloudfront.DtEvgbF3.js";import"../chunks/ActionSheet.svelte_svelte_type_style_lang.DKdopKpc.js";import{C as Qe}from"../chunks/CircleImage.Bdg0rf02.js";import{V as Ye}from"../chunks/VisibilitySheet.DlvswPzP.js";import{C as Ze,I as Ie,a as Oe}from"../chunks/IconCamera.DJxCDEP4.js";import{N as et}from"../chunks/NavigationBar.xaQi5JYm.js";const tt=async({params:a,parent:e})=>{var D;const t=a.idx,i=`/boxes/${t}`,n=t==="-1",o=Ve();if(o===null&&!n)return ue(i,{replaceState:!0});if(n)return{box:{idx:"-1",name:"",description:"",image:null,role:null},jwt:o,paramIdx:t};const u=await e();if(u.error||!u.data)return W.emit("pushSnackbar",{message:"접근할 수 없습니다."}),ue("/boxes",{replaceState:!0});const l=(D=u.data)==null?void 0:D.box;return(l==null?void 0:l.role)!=="owner"?(W.emit("pushSnackbar",{message:"접근할 수 없습니다."}),ue(i,{replaceState:!0})):{box:l,jwt:o,paramIdx:t}},Ft=Object.freeze(Object.defineProperty({__proto__:null,load:tt},Symbol.toStringTag,{value:"Module"}));function it(a){let e,t=a[3]?"박스 추가":"박스 편집",i;return{c(){e=C("p"),i=xe(t),this.h()},l(n){e=x(n,"P",{class:!0});var o=k(e);i=ve(o,t),o.forEach(p),this.h()},h(){b(e,"class","text-white text-[15px] font-semibold")},m(n,o){U(n,e,o),d(e,i)},p:ie,d(n){n&&p(e)}}}function st(a){let e,t,i,n,o;return{c(){e=C("button"),t=xe("완료"),this.h()},l(u){e=x(u,"BUTTON",{class:!0});var l=k(e);t=ve(l,"완료"),l.forEach(p),this.h()},h(){b(e,"class","font-medium text-sm leading-[17px] text-white disabled:text-[#3F3F3F] align-text-top"),e.disabled=i=a[0].name.trim()===""},m(u,l){U(u,e,l),d(e,t),n||(o=ce(e,"click",a[6]),n=!0)},p(u,l){l&1&&i!==(i=u[0].name.trim()==="")&&(e.disabled=i)},d(u){u&&p(e),n=!1,o()}}}function nt(a){let e,t=a[3]&&st(a);return{c(){e=C("div"),t&&t.c(),this.h()},l(i){e=x(i,"DIV",{slot:!0});var n=k(e);t&&t.l(n),n.forEach(p),this.h()},h(){b(e,"slot","right")},m(i,n){U(i,e,n),t&&t.m(e,null)},p(i,n){i[3]&&t.p(i,n)},d(i){i&&p(e),t&&t.d()}}}function at(a){let e;return{c(){e=C("div"),this.h()},l(t){e=x(t,"DIV",{class:!0}),k(e).forEach(p),this.h()},h(){b(e,"class","w-full h-full bg-[#D9D9D9] rounded-full")},m(t,i){U(t,e,i)},p:ie,i:ie,o:ie,d(t){t&&p(e)}}}function ot(a){let e,t;return e=new Qe({props:{src:Se(a[0].image??"",500),width:"78px",strokeWidth:"0"}}),{c(){q(e.$$.fragment)},l(i){R(e.$$.fragment,i)},m(i,n){J(e,i,n),t=!0},p(i,n){const o={};n&1&&(o.src=Se(i[0].image??"",500)),e.$set(o)},i(i){t||(N(e.$$.fragment,i),t=!0)},o(i){V(e.$$.fragment,i),t=!1},d(i){G(e,i)}}}function rt(a){let e,t,i;return t=new Oe({props:{fill:"white",length:"1"}}),{c(){e=C("button"),q(t.$$.fragment),this.h()},l(n){e=x(n,"BUTTON",{class:!0});var o=k(e);R(t.$$.fragment,o),o.forEach(p),this.h()},h(){b(e,"class","absolute bottom-0 right-0 bg-[#3F3F3F] w-6 h-6 rounded-[40px] shadow-[1px_1px_6px_rgba(0,0,0,0.1)] flex justify-center items-center")},m(n,o){U(n,e,o),J(t,e,null),i=!0},p:ie,i(n){i||(N(t.$$.fragment,n),i=!0)},o(n){V(t.$$.fragment,n),i=!1},d(n){n&&p(e),G(t)}}}function lt(a){let e,t,i,n,o,u,l,D,v,r,h,F,E,se="박스 이름",X,w,K,Q,S,P,ne='<p class="text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]">박스 설명</p>',Y,y,c,m,g,_="공개 여부",$,B,Z=Be[a[1]]+"",ae,oe,L,re,I,fe,me,ee,de,$e;t=new Ge({props:{position:"static",leftBack:!0,contentPosition:"items-center",$$slots:{right:[nt],default:[it]},$$scope:{ctx:a}}});const ke=[ot,at],j=[];function Fe(s,f){return s[0].image?0:1}u=Fe(a),l=j[u]=ke[u](a),v=new Ze({props:{shrink:!1,items:a[4],$$slots:{default:[rt]},$$scope:{ctx:a}}});function Ae(s){a[8](s)}let we={padding:"",border:"border-b-[0.5px] border-[#3F3F3F] py-2.5",backgroundColor:"bg-transparent",fontSize:"text-sm font-normal leading-5",fontColor:"text-[#F1F1F1]",limit:20,useCounter:!1};a[0].name!==void 0&&(we.value=a[0].name),w=new We({props:we}),be.push(()=>Ce(w,"value",Ae)),L=new et({});function Pe(s){a[11](s)}function Te(s){a[12](s)}let pe={};return a[2]!==void 0&&(pe.isOpen=a[2]),a[1]!==void 0&&(pe.selectedVisibility=a[1]),I=new Ye({props:pe}),be.push(()=>Ce(I,"isOpen",Pe)),be.push(()=>Ce(I,"selectedVisibility",Te)),{c(){e=C("div"),q(t.$$.fragment),i=O(),n=C("section"),o=C("div"),l.c(),D=O(),q(v.$$.fragment),r=O(),h=C("section"),F=C("section"),E=C("p"),E.textContent=se,X=O(),q(w.$$.fragment),Q=O(),S=C("section"),P=C("div"),P.innerHTML=ne,Y=O(),y=C("textarea"),c=O(),m=C("section"),g=C("p"),g.textContent=_,$=O(),B=C("div"),ae=xe(Z),oe=O(),q(L.$$.fragment),re=O(),q(I.$$.fragment),this.h()},l(s){e=x(s,"DIV",{class:!0});var f=k(e);R(t.$$.fragment,f),i=A(f),n=x(f,"SECTION",{class:!0});var te=k(n);o=x(te,"DIV",{class:!0});var z=k(o);l.l(z),D=A(z),R(v.$$.fragment,z),z.forEach(p),te.forEach(p),r=A(f),h=x(f,"SECTION",{class:!0});var T=k(h);F=x(T,"SECTION",{class:!0});var M=k(F);E=x(M,"P",{class:!0,"data-svelte-h":!0}),ge(E)!=="svelte-1kbmcgb"&&(E.textContent=se),X=A(M),R(w.$$.fragment,M),M.forEach(p),Q=A(T),S=x(T,"SECTION",{class:!0});var H=k(S);P=x(H,"DIV",{class:!0,"data-svelte-h":!0}),ge(P)!=="svelte-sqw6c9"&&(P.innerHTML=ne),Y=A(H),y=x(H,"TEXTAREA",{class:!0}),k(y).forEach(p),H.forEach(p),c=A(T),m=x(T,"SECTION",{class:!0});var le=k(m);g=x(le,"P",{class:!0,"data-svelte-h":!0}),ge(g)!=="svelte-18l855b"&&(g.textContent=_),$=A(le),B=x(le,"DIV",{class:!0,"aria-hidden":!0});var ye=k(B);ae=ve(ye,Z),ye.forEach(p),le.forEach(p),T.forEach(p),f.forEach(p),oe=A(s),R(L.$$.fragment,s),re=A(s),R(I.$$.fragment,s),this.h()},h(){b(o,"class","w-[78px] h-[78px] relative"),b(n,"class","box-image relative w-full flex justify-center"),b(E,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),b(F,"class","box-name flex gap-[15px] h-10 items-center"),b(P,"class","flex-none h-10 flex items-center"),b(y,"class","auto-height w-full bg-transparent border-x-0 border-t-0 focus:ring-0 focus:border-[#3F3F3F] border-b-[0.5px] border-[#3F3F3F] py-2.5 px-0 text-sm font-normal leading-5 text-[#F1F1F1] resize-none svelte-oekuck"),b(S,"class","box-description flex gap-[15px] min-h-10 items-start"),b(g,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),b(B,"class","w-full border-b-[0.5px] border-[#3F3F3F] py-2.5 text-xs font-normal leading-4 text-gray-03 svelte-oekuck"),b(B,"aria-hidden",""),b(m,"class","box-name flex gap-[15px] h-10 items-center"),b(h,"class","box-setting p-5 text-white"),b(e,"class","min-h-dvh bg-black")},m(s,f){U(s,e,f),J(t,e,null),d(e,i),d(e,n),d(n,o),j[u].m(o,null),d(o,D),J(v,o,null),d(e,r),d(e,h),d(h,F),d(F,E),d(F,X),J(w,F,null),d(h,Q),d(h,S),d(S,P),d(S,Y),d(S,y),De(y,a[0].description),d(h,c),d(h,m),d(m,g),d(m,$),d(m,B),d(B,ae),U(s,oe,f),J(L,s,f),U(s,re,f),J(I,s,f),ee=!0,de||($e=[ce(y,"input",a[9]),ce(y,"input",a[5]),ce(B,"click",a[10])],de=!0)},p(s,[f]){const te={};f&2097153&&(te.$$scope={dirty:f,ctx:s}),t.$set(te);let z=u;u=Fe(s),u===z?j[u].p(s,f):(Je(),V(j[z],1,1,()=>{j[z]=null}),Re(),l=j[u],l?l.p(s,f):(l=j[u]=ke[u](s),l.c()),N(l,1),l.m(o,D));const T={};f&2097152&&(T.$$scope={dirty:f,ctx:s}),v.$set(T);const M={};!K&&f&1&&(K=!0,M.value=s[0].name,_e(()=>K=!1)),w.$set(M),f&1&&De(y,s[0].description),(!ee||f&2)&&Z!==(Z=Be[s[1]]+"")&&He(ae,Z);const H={};!fe&&f&4&&(fe=!0,H.isOpen=s[2],_e(()=>fe=!1)),!me&&f&2&&(me=!0,H.selectedVisibility=s[1],_e(()=>me=!1)),I.$set(H)},i(s){ee||(N(t.$$.fragment,s),N(l),N(v.$$.fragment,s),N(w.$$.fragment,s),N(L.$$.fragment,s),N(I.$$.fragment,s),ee=!0)},o(s){V(t.$$.fragment,s),V(l),V(v.$$.fragment,s),V(w.$$.fragment,s),V(L.$$.fragment,s),V(I.$$.fragment,s),ee=!1},d(s){s&&(p(e),p(oe),p(re)),G(t),j[u].d(),G(v),G(w),G(L,s),G(I,s),de=!1,Ue($e)}}}const ut=120;function ct(a,e,t){let i;Le(a,he,c=>t(14,i=c));const n=`${je}/boxes`;let{data:o}=e;const u=o.paramIdx,l=u==="-1";let D=o.jwt,v=o.box,r={...v,description:v.description??""},h=r.visibility??"follower",F=!1;async function E(){var m;const c=await Xe({limit:1});(m=c[0])!=null&&m.file&&w(c[0].file)}async function se(){var m;const c=await Ke();(m=c[0])!=null&&m.file&&w(c[0].file)}const X=Ne.isNativePlatform()?[{name:"사진 선택",icon:Ie,onClick:E},{name:"사진 촬영",icon:Oe,onClick:se}]:[{name:"사진 선택",icon:Ie,onClick:E}];async function w(c){var m;try{const g=new FormData;g.append("image",c);const _=await fetch(`${n}/image`,{method:"POST",body:g,headers:{Authorization:`Bearer ${D}`}});if(!_.ok)return W.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});const $=await _.json();t(0,r.image=((m=$.data)==null?void 0:m.image)??null,r)}catch{}}function K(){let c=r.description??"",m=0,g="";for(let _ of c){let $=_.charCodeAt(0),B=$>=44032&&$<=55203?2:1;if(m+B>ut)break;m+=B,g+=_}t(0,r.description=g,r)}async function Q(){if(t(0,r.name=r.name.trim(),r),!r.name)return;const{url:c,method:m}=l?{url:n,method:"POST"}:{url:`${n}/${u}`,method:"PATCH"},g=await fetch(c,{method:m,headers:{"Content-Type":"application/json",Authorization:`Bearer ${D}`},body:JSON.stringify({name:r.name,description:r.description,image:r.image,visibility:h})});if(!g.ok)return W.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});l?(g.json().then(_=>{const $=_.data;$.role="owner",$.visibility=h,$.is_subcribed=!1,$.place_count="0",$.member_count="1",Ee(he,i=[$,...i],i)}),W.emit("pushSnackbar",{message:"새 박스를 만들었습니다"}),ue("/boxes")):(v.name=r.name,v.description=r.description,v.image=r.image,v.visibility=h,Ee(he,i=i.map(_=>(_.idx===r.idx&&(_.name=r.name,_.description=r.description,_.image=r.image,_.visibility=h),_)),i),W.emit("pushSnackbar",{message:"박스를 수정했습니다."}))}function S(c){a.$$.not_equal(r.name,c)&&(r.name=c,t(0,r))}function P(){r.description=this.value,t(0,r)}const ne=()=>t(2,F=!0);function Y(c){F=c,t(2,F)}function y(c){h=c,t(1,h)}return a.$$set=c=>{"data"in c&&t(7,o=c.data)},[r,h,F,l,X,K,Q,o,S,P,ne,Y,y]}class wt extends Me{constructor(e){super(),qe(this,e,ct,lt,ze,{data:7})}}export{wt as component,Ft as universal};
