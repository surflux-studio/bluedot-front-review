import{s as G,m as ne,e as N,c as B,b as O,f as g,v as E,L as H,i as w,B as S,J as V,I as Y,u as oe,o as ae,p as ie,F as Z,K as z,T as y,a as A,D as K,g as D,k as R,y as re,z as le,h as ce,n as M}from"../chunks/scheduler.BVPf9D5l.js";import{S as J,i as x,t as b,a as I,c as $,d as P,m as v,e as T,f as q,g as U}from"../chunks/index.CyEs2R8T.js";import{H as fe}from"../chunks/Header.D1U0DLlI.js";import{V as ue}from"../chunks/Viewer.BYJuVL-f.js";import{p as me}from"../chunks/stores.R4GZrN42.js";import{N as de}from"../chunks/NavigationBar.BAoOI6VZ.js";import{h as he,j as Q,g as _e,A as W}from"../chunks/sign.Dh6oTB_X.js";import"../chunks/ActionSheet.DtN69HrT.js";/* empty css                                                   */import{g as pe}from"../chunks/entry.065KSUm9.js";import{P as ge,S as ke}from"../chunks/index.7SMDlQ9F.js";import{I as be}from"../chunks/IconSearch.LrVg_stw.js";function Ie(o){let e,s,t,n,l;const f=o[5].default,r=ne(f,o,o[4],null);return{c(){e=N("div"),r&&r.c(),this.h()},l(i){e=B(i,"DIV",{id:!0,class:!0,"aria-hidden":!0});var u=O(e);r&&r.l(u),u.forEach(g),this.h()},h(){E(e,"id","mask"),E(e,"class",s=H(`${o[0]?"":"hidden"} ${o[1]}`)+" svelte-eerk6g"),E(e,"aria-hidden","")},m(i,u){w(i,e,u),r&&r.m(e,null),t=!0,n||(l=[S(e,"touchstart",V(Y(o[6]))),S(e,"touchend",o[7],{passive:!0}),S(e,"click",o[8])],n=!0)},p(i,[u]){r&&r.p&&(!t||u&16)&&oe(r,f,i,i[4],t?ie(f,i[4],u,null):ae(i[4]),null),(!t||u&3&&s!==(s=H(`${i[0]?"":"hidden"} ${i[1]}`)+" svelte-eerk6g"))&&E(e,"class",s)},i(i){t||(b(r,i),t=!0)},o(i){I(r,i),t=!1},d(i){i&&g(e),r&&r.d(i),n=!1,Z(l)}}}function we(o,e,s){let{$$slots:t={},$$scope:n}=e,{onMask:l=!1}=e,{position:f="fixed"}=e,{closeOnClick:r=!1}=e,{onTouch:i=void 0}=e;function u(h){z.call(this,o,h)}const d=()=>{r?s(0,l=!1):i&&i()},_=()=>{r?s(0,l=!1):i&&i()};return o.$$set=h=>{"onMask"in h&&s(0,l=h.onMask),"position"in h&&s(1,f=h.position),"closeOnClick"in h&&s(2,r=h.closeOnClick),"onTouch"in h&&s(3,i=h.onTouch),"$$scope"in h&&s(4,n=h.$$scope)},[l,f,r,i,n,t,u,d,_]}class Ee extends J{constructor(e){super(),x(this,e,we,Ie,G,{onMask:0,position:1,closeOnClick:2,onTouch:3})}}function Se(o){let e,s,t;return{c(){e=N("emoji-picker"),this.h()},l(n){e=B(n,"EMOJI-PICKER",{"aria-hidden":!0,class:!0}),O(e).forEach(g),this.h()},h(){y(e,"aria-hidden",""),y(e,"class",o[0])},m(n,l){w(n,e,l),s||(t=[S(e,"emoji-click",V(Y(o[2]))),S(e,"touchstart",V(o[4])),S(e,"touchend",V(o[5]))],s=!0)},p(n,l){l&1&&y(e,"class",n[0])},d(n){n&&g(e),s=!1,Z(t)}}}function je(o){let e,s;return e=new Ee({props:{onMask:!0,position:"absolute",onTouch:o[6],$$slots:{default:[Se]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,n){v(e,t,n),s=!0},p(t,[n]){const l={};n&2&&(l.onTouch=t[6]),n&257&&(l.$$scope={dirty:n,ctx:t}),e.$set(l)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){T(e,t)}}}function $e(o,e,s){let{classList:t}=e,{onSelect:n}=e,{close:l}=e;function f(d){n(d.detail.unicode)}new ge({emojiVersion:15});function r(d){z.call(this,o,d)}function i(d){z.call(this,o,d)}const u=()=>{l()};return o.$$set=d=>{"classList"in d&&s(0,t=d.classList),"onSelect"in d&&s(3,n=d.onSelect),"close"in d&&s(1,l=d.close)},[t,l,f,n,r,i,u]}class Pe extends J{constructor(e){super(),x(this,e,$e,je,G,{classList:0,onSelect:3,close:1})}}function ve(o){let e,s,t,n,l,f;return t=new be({props:{width:"24",height:"24"}}),{c(){e=N("div"),s=N("button"),$(t.$$.fragment),this.h()},l(r){e=B(r,"DIV",{slot:!0,class:!0});var i=O(e);s=B(i,"BUTTON",{});var u=O(s);P(t.$$.fragment,u),u.forEach(g),i.forEach(g),this.h()},h(){E(e,"slot","right"),E(e,"class","flex items-center gap-2")},m(r,i){w(r,e,i),ce(e,s),v(t,s,null),n=!0,l||(f=S(s,"click",o[8]),l=!0)},p:M,i(r){n||(b(t.$$.fragment,r),n=!0)},o(r){I(t.$$.fragment,r),n=!1},d(r){r&&g(e),T(t),l=!1,f()}}}function Te(o){let e,s;return e=new ue({props:{posts:o[0].posts,index:o[0].index,selectedReaction:o[1]}}),{c(){$(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,n){v(e,t,n),s=!0},p(t,n){const l={};n&1&&(l.posts=t[0].posts),n&1&&(l.index=t[0].index),n&2&&(l.selectedReaction=t[1]),e.$set(l)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){T(e,t)}}}function Ce(o){let e;return{c(){e=N("div"),this.h()},l(s){e=B(s,"DIV",{class:!0}),O(e).forEach(g),this.h()},h(){E(e,"class","w-full h-full")},m(s,t){w(s,e,t)},p:M,i:M,o:M,d(s){s&&g(e)}}}function X(o){let e,s;return e=new Pe({props:{classList:"absolute bottom-24 right-0 px-4 z-50",onSelect:o[4],close:o[9]}}),{c(){$(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,n){v(e,t,n),s=!0},p:M,i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){T(e,t)}}}function Me(o){let e,s,t,n,l,f,r,i,u;e=new fe({props:{position:"fixed",leftBack:o[2]?"":"white",$$slots:{right:[ve]},$$scope:{ctx:o}}});const d=[Ce,Te],_=[];function h(a,c){return a[0].posts.length===0?0:1}t=h(o),n=_[t]=d[t](o),f=new de({});let m=o[3]&&X(o);return{c(){$(e.$$.fragment),s=A(),n.c(),l=A(),$(f.$$.fragment),r=A(),m&&m.c(),i=K()},l(a){P(e.$$.fragment,a),s=D(a),n.l(a),l=D(a),P(f.$$.fragment,a),r=D(a),m&&m.l(a),i=K()},m(a,c){v(e,a,c),w(a,s,c),_[t].m(a,c),w(a,l,c),v(f,a,c),w(a,r,c),m&&m.m(a,c),w(a,i,c),u=!0},p(a,[c]){const k={};c&4&&(k.leftBack=a[2]?"":"white"),c&4096&&(k.$$scope={dirty:c,ctx:a}),e.$set(k);let C=t;t=h(a),t===C?_[t].p(a,c):(U(),I(_[C],1,1,()=>{_[C]=null}),q(),n=_[t],n?n.p(a,c):(n=_[t]=d[t](a),n.c()),b(n,1),n.m(l.parentNode,l)),a[3]?m?(m.p(a,c),c&8&&b(m,1)):(m=X(a),m.c(),b(m,1),m.m(i.parentNode,i)):m&&(U(),I(m,1,1,()=>{m=null}),q())},i(a){u||(b(e.$$.fragment,a),b(n),b(f.$$.fragment,a),b(m),u=!0)},o(a){I(e.$$.fragment,a),I(n),I(f.$$.fragment,a),I(m),u=!1},d(a){a&&(g(s),g(l),g(r),g(i)),T(e,a),_[t].d(a),T(f,a),m&&m.d(a)}}}function Ne(o,e,s){let t,n,l,f,r,i;R(o,me,c=>s(7,f=c)),R(o,he,c=>s(11,r=c)),R(o,Q,c=>s(3,i=c));let u={posts:[],index:0},d,_;re(async()=>{await ke.hide();let c="";try{c=_e()}catch{}const k=Number(f.url.searchParams.get("postIdx")||0);Number(f.url.searchParams.get("mediaIdx")||0);const C=0,ee=30,te=`&offset=${C}`,se=`&limit=${ee}`;let j=[];(n||t)&&r.length>0?(j=r.map(p=>p.idx===k?{...p,mediaIdx:p.mediaIdx||0}:{...p,mediaIdx:0}),s(0,u.index=j.findIndex(p=>p.idx===String(k)),u)):(_=new AbortController,k&&(j=[await fetch(`${W}/posts/${k}`,{method:"GET",headers:{Authorization:"Bearer "+c},signal:_.signal}).then(p=>p.json()).then(p=>({...p.data,mediaIdx:p.data.mediaIdx||0}))]),j=[...j,...await fetch(`${W}/posts?${te}${se}`,{method:"GET",headers:{Authorization:"Bearer "+c},signal:_.signal}).then(p=>p.json()).then(p=>{var F;return(F=p.data)==null?void 0:F.posts.filter(L=>L.idx!==String(k)).map(L=>({...L,mediaIdx:L.mediaIdx||0}))})||[]]),s(0,u.posts=j,u)}),le(()=>{_&&_.abort()});async function h(c){const k=f.url.searchParams.get("postIdx");k&&s(1,d={postIdx:k,reaction:c})}const m=async()=>{await pe("/search")},a=()=>{Q.set(!1)};return o.$$.update=()=>{o.$$.dirty&128&&s(5,t=f.url.searchParams.get("placeIdx")),o.$$.dirty&128&&s(6,n=f.url.searchParams.get("userIdx")),o.$$.dirty&96&&s(2,l=!t&&!n)},[u,d,l,i,h,t,n,f,m,a]}class Fe extends J{constructor(e){super(),x(this,e,Ne,Me,G,{})}}export{Fe as component};
