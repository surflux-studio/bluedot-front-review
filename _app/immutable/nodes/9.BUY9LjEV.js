import{g as de}from"../chunks/entry.BAk9_nuu.js";import{e as W}from"../chunks/emitter.E5P-NQ8u.js";import{g as Me}from"../chunks/sign.DiAfnco2.js";import{s as Re,w as fe,e as v,a as D,t as Ne,c as $,b as y,g as E,f as m,z as $e,d as Ve,v as _,i as Y,h as p,N as Se,A as Ce,x as pe,j as qe,F as Ue,k as Je,n as he,Q as De}from"../chunks/scheduler.BS-S8op5.js";import{S as Xe,i as Ge,b as me,c as U,d as J,m as X,a as I,e as Ke,t as T,f as G,g as Qe}from"../chunks/index.CxHkUi4z.js";import{H as We}from"../chunks/Header.DF1eskYZ.js";import{F as Ye}from"../chunks/Field.BFM0eGOB.js";import{g as Ze,t as et}from"../chunks/photo.B3y7g8aS.js";import{k as Ee,I as le,s as ke,A as tt}from"../chunks/store.CbrX_Ibb.js";import{s as Ie}from"../chunks/s32cloudfront.CnSB3H_v.js";import{C as st}from"../chunks/CircleImage.CeiTlKJ2.js";import{V as nt}from"../chunks/VisibilitySheet.CEs7Jv5V.js";import{C as it,I as Te,a as Pe}from"../chunks/IconCamera.D4iC1QqQ.js";import{C as at}from"../chunks/device.D4-0d2Hs.js";import{N as ot}from"../chunks/NavigationBar.CDc2WUPv.js";import{A as rt}from"../chunks/ActionSheetOpenApp.pgTeSObf.js";const lt=async({params:i,parent:t})=>{var b;const e=i.idx,n=`/boxes/${e}`,a=e==="-1",l=Me();if(l===null&&!a)return de(n,{replaceState:!0});if(a)return{box:{idx:"-1",name:"",description:"",image:null,role:null},jwt:l,paramIdx:e};const f=await t();if(f.error||!f.data)return W.emit("pushSnackbar",{message:"접근할 수 없습니다."}),de("/boxes",{replaceState:!0});const r=(b=f.data)==null?void 0:b.box;return(r==null?void 0:r.role)!=="owner"?(W.emit("pushSnackbar",{message:"접근할 수 없습니다."}),de(n,{replaceState:!0})):{box:r,jwt:l,paramIdx:e}},It=Object.freeze(Object.defineProperty({__proto__:null,load:lt},Symbol.toStringTag,{value:"Module"}));function ut(i){let t,e,n,a,l,f;return{c(){t=v("div"),e=v("button"),n=Ne("완료"),this.h()},l(r){t=$(r,"DIV",{slot:!0});var b=y(t);e=$(b,"BUTTON",{class:!0});var o=y(e);n=Ve(o,"완료"),o.forEach(m),b.forEach(m),this.h()},h(){_(e,"class","font-medium text-sm leading-[17px] text-white disabled:text-[#3F3F3F] align-text-top"),e.disabled=a=i[0].name.trim()==="",_(t,"slot","right")},m(r,b){Y(r,t,b),p(t,e),p(e,n),l||(f=Ce(e,"click",i[7]),l=!0)},p(r,b){b&1&&a!==(a=r[0].name.trim()==="")&&(e.disabled=a)},d(r){r&&m(t),l=!1,f()}}}function ct(i){let t;return{c(){t=v("div"),this.h()},l(e){t=$(e,"DIV",{class:!0}),y(t).forEach(m),this.h()},h(){_(t,"class","w-full h-full bg-[#D9D9D9] rounded-full")},m(e,n){Y(e,t,n)},p:he,i:he,o:he,d(e){e&&m(t)}}}function ft(i){let t,e;return t=new st({props:{src:Ie(i[0].image??"",500),width:"78px",strokeWidth:"0"}}),{c(){U(t.$$.fragment)},l(n){J(t.$$.fragment,n)},m(n,a){X(t,n,a),e=!0},p(n,a){const l={};a&1&&(l.src=Ie(n[0].image??"",500)),t.$set(l)},i(n){e||(T(t.$$.fragment,n),e=!0)},o(n){I(t.$$.fragment,n),e=!1},d(n){G(t,n)}}}function pt(i){let t,e,n;return e=new Pe({props:{fill:"white",length:"1"}}),{c(){t=v("button"),U(e.$$.fragment),this.h()},l(a){t=$(a,"BUTTON",{class:!0});var l=y(t);J(e.$$.fragment,l),l.forEach(m),this.h()},h(){_(t,"class","absolute bottom-0 right-0 bg-[#3F3F3F] w-6 h-6 rounded-[40px] shadow-[1px_1px_6px_rgba(0,0,0,0.1)] flex justify-center items-center")},m(a,l){Y(a,t,l),X(e,t,null),n=!0},p:he,i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){I(e.$$.fragment,a),n=!1},d(a){a&&m(t),G(e)}}}function mt(i){let t,e;return t=new ot({}),{c(){U(t.$$.fragment)},l(n){J(t.$$.fragment,n)},m(n,a){X(t,n,a),e=!0},i(n){e||(T(t.$$.fragment,n),e=!0)},o(n){I(t.$$.fragment,n),e=!1},d(n){G(t,n)}}}function dt(i){let t,e,n,a,l,f,r,b,o,N,x,B,k,ee="박스 이름",te,A,Z,se,O,j,ue='<p class="text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]">박스 설명</p>',ne,S,ie,V,L,c="공개 여부",g,d,C=Ee[i[1]]+"",w,h,ae,F,ge,be,ce,z,_e,oe,xe,we;e=new We({props:{position:"static",leftBack:!0,centerTitle:i[4]?"박스 추가":"박스 편집",$$slots:{right:[ut]},$$scope:{ctx:i}}});const Be=[ft,ct],R=[];function Fe(s,u){return s[0].image?0:1}f=Fe(i),r=R[f]=Be[f](i),o=new it({props:{shrink:!1,className:"absolute",ydistance:14,items:i[5],$$slots:{default:[pt]},$$scope:{ctx:i}}});function je(s){i[9](s)}let ye={padding:"",border:"border-b-[0.5px] border-[#3F3F3F] py-2.5",backgroundColor:"bg-transparent",fontSize:"text-sm font-normal leading-5",fontColor:"text-[#F1F1F1]",limit:20,useCounter:!1};i[0].name!==void 0&&(ye.value=i[0].name),A=new Ye({props:ye}),fe.push(()=>me(A,"value",je));let P=!le&&mt();function Le(s){i[13](s)}function ze(s){i[14](s)}let ve={onChange:i[12]};i[2]!==void 0&&(ve.isOpen=i[2]),i[1]!==void 0&&(ve.selectedVisibility=i[1]),F=new nt({props:ve}),fe.push(()=>me(F,"isOpen",Le)),fe.push(()=>me(F,"selectedVisibility",ze));function He(s){i[15](s)}let Ae={};return i[3]!==void 0&&(Ae.isOpen=i[3]),z=new rt({props:Ae}),fe.push(()=>me(z,"isOpen",He)),{c(){t=v("div"),U(e.$$.fragment),n=D(),a=v("section"),l=v("div"),r.c(),b=D(),U(o.$$.fragment),N=D(),x=v("section"),B=v("section"),k=v("p"),k.textContent=ee,te=D(),U(A.$$.fragment),se=D(),O=v("section"),j=v("div"),j.innerHTML=ue,ne=D(),S=v("textarea"),ie=D(),V=v("section"),L=v("p"),L.textContent=c,g=D(),d=v("div"),w=Ne(C),h=D(),P&&P.c(),ae=D(),U(F.$$.fragment),ce=D(),U(z.$$.fragment),this.h()},l(s){t=$(s,"DIV",{class:!0});var u=y(t);J(e.$$.fragment,u),n=E(u),a=$(u,"SECTION",{class:!0});var re=y(a);l=$(re,"DIV",{class:!0});var q=y(l);r.l(q),b=E(q),J(o.$$.fragment,q),q.forEach(m),re.forEach(m),N=E(u),x=$(u,"SECTION",{class:!0});var H=y(x);B=$(H,"SECTION",{class:!0});var K=y(B);k=$(K,"P",{class:!0,"data-svelte-h":!0}),$e(k)!=="svelte-1kbmcgb"&&(k.textContent=ee),te=E(K),J(A.$$.fragment,K),K.forEach(m),se=E(H),O=$(H,"SECTION",{class:!0});var M=y(O);j=$(M,"DIV",{class:!0,"data-svelte-h":!0}),$e(j)!=="svelte-sqw6c9"&&(j.innerHTML=ue),ne=E(M),S=$(M,"TEXTAREA",{class:!0}),y(S).forEach(m),M.forEach(m),ie=E(H),V=$(H,"SECTION",{class:!0});var Q=y(V);L=$(Q,"P",{class:!0,"data-svelte-h":!0}),$e(L)!=="svelte-18l855b"&&(L.textContent=c),g=E(Q),d=$(Q,"DIV",{class:!0,"aria-hidden":!0});var Oe=y(d);w=Ve(Oe,C),Oe.forEach(m),Q.forEach(m),H.forEach(m),u.forEach(m),h=E(s),P&&P.l(s),ae=E(s),J(F.$$.fragment,s),ce=E(s),J(z.$$.fragment,s),this.h()},h(){_(l,"class","w-[78px] h-[78px] relative"),_(a,"class","box-image relative w-full flex justify-center"),_(k,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),_(B,"class","box-name flex gap-[15px] h-10 items-center"),_(j,"class","flex-none h-10 flex items-center"),_(S,"class","auto-height w-full bg-transparent border-x-0 border-t-0 focus:ring-0 focus:border-[#3F3F3F] border-b-[0.5px] border-[#3F3F3F] py-2.5 px-0 text-sm font-normal leading-5 text-[#F1F1F1] resize-none svelte-oekuck"),_(O,"class","box-description flex gap-[15px] min-h-10 items-start"),_(L,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),_(d,"class","w-full border-b-[0.5px] border-[#3F3F3F] py-2.5 text-xs font-normal leading-4 text-gray-03 svelte-oekuck"),_(d,"aria-hidden",""),_(V,"class","box-name flex gap-[15px] h-10 items-center"),_(x,"class","box-setting p-5 text-white"),_(t,"class","min-h-dvh bg-black")},m(s,u){Y(s,t,u),X(e,t,null),p(t,n),p(t,a),p(a,l),R[f].m(l,null),p(l,b),X(o,l,null),p(t,N),p(t,x),p(x,B),p(B,k),p(B,te),X(A,B,null),p(x,se),p(x,O),p(O,j),p(O,ne),p(O,S),Se(S,i[0].description),p(x,ie),p(x,V),p(V,L),p(V,g),p(V,d),p(d,w),Y(s,h,u),P&&P.m(s,u),Y(s,ae,u),X(F,s,u),Y(s,ce,u),X(z,s,u),oe=!0,xe||(we=[Ce(S,"input",i[10]),Ce(S,"input",i[6]),Ce(d,"click",i[11])],xe=!0)},p(s,[u]){const re={};u&16777217&&(re.$$scope={dirty:u,ctx:s}),e.$set(re);let q=f;f=Fe(s),f===q?R[f].p(s,u):(Qe(),I(R[q],1,1,()=>{R[q]=null}),Ke(),r=R[f],r?r.p(s,u):(r=R[f]=Be[f](s),r.c()),T(r,1),r.m(l,b));const H={};u&16777216&&(H.$$scope={dirty:u,ctx:s}),o.$set(H);const K={};!Z&&u&1&&(Z=!0,K.value=s[0].name,pe(()=>Z=!1)),A.$set(K),u&1&&Se(S,s[0].description),(!oe||u&2)&&C!==(C=Ee[s[1]]+"")&&qe(w,C);const M={};u&4&&(M.onChange=s[12]),!ge&&u&4&&(ge=!0,M.isOpen=s[2],pe(()=>ge=!1)),!be&&u&2&&(be=!0,M.selectedVisibility=s[1],pe(()=>be=!1)),F.$set(M);const Q={};!_e&&u&8&&(_e=!0,Q.isOpen=s[3],pe(()=>_e=!1)),z.$set(Q)},i(s){oe||(T(e.$$.fragment,s),T(r),T(o.$$.fragment,s),T(A.$$.fragment,s),T(P),T(F.$$.fragment,s),T(z.$$.fragment,s),oe=!0)},o(s){I(e.$$.fragment,s),I(r),I(o.$$.fragment,s),I(A.$$.fragment,s),I(P),I(F.$$.fragment,s),I(z.$$.fragment,s),oe=!1},d(s){s&&(m(t),m(h),m(ae),m(ce)),G(e),R[f].d(),G(o),G(A),P&&P.d(s),G(F,s),G(z,s),xe=!1,Ue(we)}}}const Ct=120;function ht(i,t,e){let n;Je(i,ke,c=>e(17,n=c));let{data:a}=t;const l=`${tt}/boxes`,f=a.paramIdx,r=f==="-1";let b=a.jwt,o={...a.box,description:a.box.description??""},N=o.visibility??"follower",x=!1,B=!1,k=!1;async function ee(){var g;if(le)return e(3,k=!0);const c=await Ze({limit:1});(g=c[0])!=null&&g.file&&Z(c[0].file)}async function te(){var g;if(le)return e(3,k=!0);const c=await et();(g=c[0])!=null&&g.file&&Z(c[0].file)}const A=at.isNativePlatform()?[{name:"사진 선택",icon:Te,onClick:ee},{name:"사진 촬영",icon:Pe,onClick:te}]:[{name:"사진 선택",icon:Te,onClick:ee}];async function Z(c){var g;try{const d=new FormData;d.append("image",c);const C=await fetch(`${l}/image`,{method:"POST",body:d,headers:{Authorization:`Bearer ${b}`}});if(!C.ok)return W.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});const h=(g=(await C.json()).data)==null?void 0:g.image;if(!h)return W.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});if(e(0,o.image=h,o),r)return;O()}catch{}}function se(){let c=o.description??"",g=0,d=0,C="";for(let w of c){let h=w.charCodeAt(0);if(h===10&&(g++,d=0),g===3)break;let F=h>=4352&&h<=4607||h>=12592&&h<=12687||h>=43360&&h<=43391||h>=44032&&h<=55215||h>=55216&&h<=55295?2:1;if(d+F>Ct/3*(3-g))break;d+=F,C+=w}e(0,o.description=C,o)}async function O(){if(le)return e(3,k=!0);if(e(0,o.name=o.name.trim(),o),!o.name||B)return;B=!0;const{url:c,method:g}=r?{url:l,method:"POST"}:{url:`${l}/${f}`,method:"PATCH"},d=await fetch(c,{method:g,headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({name:o.name,description:o.description,image:o.image,visibility:N})});if(!d.ok)return B=!1,W.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});if(r){const w=(await d.json()).data;w.role="owner",w.visibility=N,w.is_subcribed=!1,w.place_count="0",w.follower_count="0",De(ke,n=[w,...n],n),W.emit("pushSnackbar",{message:"새 박스를 만들었습니다"}),de("/boxes")}else De(ke,n=n.map(C=>(C.idx===o.idx&&(C.name=o.name,C.description=o.description,C.image=o.image,C.visibility=N),C)),n),W.emit("pushSnackbar",{message:"박스를 수정했습니다."});B=!1}function j(c){i.$$.not_equal(o.name,c)&&(o.name=c,e(0,o))}function ue(){o.description=this.value,e(0,o)}const ne=()=>{if(le)return e(3,k=!0);e(2,x=!0)},S=()=>e(2,x=!1);function ie(c){x=c,e(2,x)}function V(c){N=c,e(1,N)}function L(c){k=c,e(3,k)}return i.$$set=c=>{"data"in c&&e(8,a=c.data)},[o,N,x,k,r,A,se,O,a,j,ue,ne,S,ie,V,L]}class Tt extends Xe{constructor(t){super(),Ge(this,t,ht,dt,Re,{data:8})}}export{Tt as component,It as universal};
