import{g as de}from"../chunks/entry.DkKUt85L.js";import{e as Q,k as Se,I as le,s as $e,b as Ee,A as Me}from"../chunks/store.mQmyAdCo.js";import{g as Xe}from"../chunks/sign.MjN5cNxG.js";import{s as qe,w as fe,e as v,a as E,t as Ve,c as $,b as O,g as I,f as m,z as ke,d as Pe,v as _,i as Y,h as p,S as Ie,A as Ce,x as pe,j as Ue,I as Je,k as We,n as he,W as De}from"../chunks/scheduler.CXaZJLX8.js";import{S as Ge,i as Ke,b as me,c as q,d as U,m as J,a as D,e as Qe,t as T,f as W,g as Ye}from"../chunks/index.BKOkOgp0.js";import{H as Ze}from"../chunks/Header.Up7H--wX.js";import{F as et}from"../chunks/Field.CeCU-VKa.js";import{g as tt,t as st}from"../chunks/photo.B_P8CKZB.js";import{s as Te}from"../chunks/s32cloudfront.DPtLQakp.js";import{C as nt}from"../chunks/CircleImage.DfILX9QQ.js";import{V as it}from"../chunks/VisibilitySheet.Cf7WvrHf.js";import{C as at,I as Ne,a as je}from"../chunks/IconCamera.TT9gk9SA.js";import{C as ot}from"../chunks/device.vong-IOQ.js";import{N as rt}from"../chunks/NavigationBar.CacLP1LW.js";import{A as lt}from"../chunks/ActionSheetOpenApp.D51_icIt.js";const ut=async({params:i,parent:t})=>{var b;const e=i.idx,n=`/boxes/${e}`,a=e==="-1",l=Xe();if(l===null&&!a)return de(n,{replaceState:!0});if(a)return{box:{idx:"-1",name:"",description:"",image:null,role:null},jwt:l,paramIdx:e};const f=await t();if(f.error||!f.data)return Q.emit("pushSnackbar",{message:"접근할 수 없습니다."}),de("/boxes",{replaceState:!0});const r=(b=f.data)==null?void 0:b.box;return(r==null?void 0:r.role)!=="owner"?(Q.emit("pushSnackbar",{message:"접근할 수 없습니다."}),de(n,{replaceState:!0})):{box:r,jwt:l,paramIdx:e}},Dt=Object.freeze(Object.defineProperty({__proto__:null,load:ut},Symbol.toStringTag,{value:"Module"}));function ct(i){let t,e,n,a,l,f;return{c(){t=v("div"),e=v("button"),n=Ve("완료"),this.h()},l(r){t=$(r,"DIV",{slot:!0});var b=O(t);e=$(b,"BUTTON",{class:!0});var o=O(e);n=Pe(o,"완료"),o.forEach(m),b.forEach(m),this.h()},h(){_(e,"class","font-medium text-sm leading-[17px] text-white disabled:text-[#3F3F3F] align-text-top"),e.disabled=a=i[0].name.trim()==="",_(t,"slot","right")},m(r,b){Y(r,t,b),p(t,e),p(e,n),l||(f=Ce(e,"click",i[7]),l=!0)},p(r,b){b&1&&a!==(a=r[0].name.trim()==="")&&(e.disabled=a)},d(r){r&&m(t),l=!1,f()}}}function ft(i){let t;return{c(){t=v("div"),this.h()},l(e){t=$(e,"DIV",{class:!0}),O(t).forEach(m),this.h()},h(){_(t,"class","w-full h-full bg-[#D9D9D9] rounded-full")},m(e,n){Y(e,t,n)},p:he,i:he,o:he,d(e){e&&m(t)}}}function pt(i){let t,e;return t=new nt({props:{src:Te(i[0].image??"",500),width:"78px",strokeWidth:"0"}}),{c(){q(t.$$.fragment)},l(n){U(t.$$.fragment,n)},m(n,a){J(t,n,a),e=!0},p(n,a){const l={};a&1&&(l.src=Te(n[0].image??"",500)),t.$set(l)},i(n){e||(T(t.$$.fragment,n),e=!0)},o(n){D(t.$$.fragment,n),e=!1},d(n){W(t,n)}}}function mt(i){let t,e,n;return e=new je({props:{fill:"white",length:"1"}}),{c(){t=v("button"),q(e.$$.fragment),this.h()},l(a){t=$(a,"BUTTON",{class:!0});var l=O(t);U(e.$$.fragment,l),l.forEach(m),this.h()},h(){_(t,"class","absolute bottom-0 right-0 bg-[#3F3F3F] w-6 h-6 rounded-[40px] shadow-[1px_1px_6px_rgba(0,0,0,0.1)] flex justify-center items-center")},m(a,l){Y(a,t,l),J(e,t,null),n=!0},p:he,i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){D(e.$$.fragment,a),n=!1},d(a){a&&m(t),W(e)}}}function dt(i){let t,e;return t=new rt({}),{c(){q(t.$$.fragment)},l(n){U(t.$$.fragment,n)},m(n,a){J(t,n,a),e=!0},i(n){e||(T(t.$$.fragment,n),e=!0)},o(n){D(t.$$.fragment,n),e=!1},d(n){W(t,n)}}}function Ct(i){let t,e,n,a,l,f,r,b,o,N,x,B,k,ee="박스 이름",te,y,Z,se,A,j,ue='<p class="text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]">박스 설명</p>',ne,S,ie,V,L,c="공개 여부",g,d,C=Se[i[1]]+"",w,h,ae,F,ge,be,ce,z,_e,oe,xe,we;e=new Ze({props:{position:"static",leftBack:!0,centerTitle:i[4]?"박스 추가":"박스 편집",$$slots:{right:[ct]},$$scope:{ctx:i}}});const Be=[pt,ft],M=[];function Fe(s,u){return s[0].image?0:1}f=Fe(i),r=M[f]=Be[f](i),o=new at({props:{shrink:!1,className:"absolute",ydistance:14,items:i[5],$$slots:{default:[mt]},$$scope:{ctx:i}}});function Le(s){i[9](s)}let Oe={padding:"",border:"border-b-[0.5px] border-[#3F3F3F] py-2.5",backgroundColor:"bg-transparent",fontSize:"text-sm font-normal leading-5",fontColor:"text-[#F1F1F1]",limit:20,useCounter:!1};i[0].name!==void 0&&(Oe.value=i[0].name),y=new et({props:Oe}),fe.push(()=>me(y,"value",Le));let P=!le&&dt();function ze(s){i[13](s)}function He(s){i[14](s)}let ve={onChange:i[12]};i[2]!==void 0&&(ve.isOpen=i[2]),i[1]!==void 0&&(ve.selectedVisibility=i[1]),F=new it({props:ve}),fe.push(()=>me(F,"isOpen",ze)),fe.push(()=>me(F,"selectedVisibility",He));function Re(s){i[15](s)}let ye={};return i[3]!==void 0&&(ye.isOpen=i[3]),z=new lt({props:ye}),fe.push(()=>me(z,"isOpen",Re)),{c(){t=v("div"),q(e.$$.fragment),n=E(),a=v("section"),l=v("div"),r.c(),b=E(),q(o.$$.fragment),N=E(),x=v("section"),B=v("section"),k=v("p"),k.textContent=ee,te=E(),q(y.$$.fragment),se=E(),A=v("section"),j=v("div"),j.innerHTML=ue,ne=E(),S=v("textarea"),ie=E(),V=v("section"),L=v("p"),L.textContent=c,g=E(),d=v("div"),w=Ve(C),h=E(),P&&P.c(),ae=E(),q(F.$$.fragment),ce=E(),q(z.$$.fragment),this.h()},l(s){t=$(s,"DIV",{class:!0});var u=O(t);U(e.$$.fragment,u),n=I(u),a=$(u,"SECTION",{class:!0});var re=O(a);l=$(re,"DIV",{class:!0});var X=O(l);r.l(X),b=I(X),U(o.$$.fragment,X),X.forEach(m),re.forEach(m),N=I(u),x=$(u,"SECTION",{class:!0});var H=O(x);B=$(H,"SECTION",{class:!0});var G=O(B);k=$(G,"P",{class:!0,"data-svelte-h":!0}),ke(k)!=="svelte-1kbmcgb"&&(k.textContent=ee),te=I(G),U(y.$$.fragment,G),G.forEach(m),se=I(H),A=$(H,"SECTION",{class:!0});var R=O(A);j=$(R,"DIV",{class:!0,"data-svelte-h":!0}),ke(j)!=="svelte-sqw6c9"&&(j.innerHTML=ue),ne=I(R),S=$(R,"TEXTAREA",{class:!0}),O(S).forEach(m),R.forEach(m),ie=I(H),V=$(H,"SECTION",{class:!0});var K=O(V);L=$(K,"P",{class:!0,"data-svelte-h":!0}),ke(L)!=="svelte-18l855b"&&(L.textContent=c),g=I(K),d=$(K,"DIV",{class:!0,"aria-hidden":!0});var Ae=O(d);w=Pe(Ae,C),Ae.forEach(m),K.forEach(m),H.forEach(m),u.forEach(m),h=I(s),P&&P.l(s),ae=I(s),U(F.$$.fragment,s),ce=I(s),U(z.$$.fragment,s),this.h()},h(){_(l,"class","w-[78px] h-[78px] relative"),_(a,"class","box-image relative w-full flex justify-center"),_(k,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),_(B,"class","box-name flex gap-[15px] h-10 items-center"),_(j,"class","flex-none h-10 flex items-center"),_(S,"class","auto-height w-full bg-transparent border-x-0 border-t-0 focus:ring-0 focus:border-[#3F3F3F] border-b-[0.5px] border-[#3F3F3F] py-2.5 px-0 text-sm font-normal leading-5 text-[#F1F1F1] resize-none svelte-oekuck"),_(A,"class","box-description flex gap-[15px] min-h-10 items-start"),_(L,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),_(d,"class","w-full border-b-[0.5px] border-[#3F3F3F] py-2.5 text-xs font-normal leading-4 text-gray-03 svelte-oekuck"),_(d,"aria-hidden",""),_(V,"class","box-name flex gap-[15px] h-10 items-center"),_(x,"class","box-setting p-5 text-white"),_(t,"class","min-h-dvh bg-black")},m(s,u){Y(s,t,u),J(e,t,null),p(t,n),p(t,a),p(a,l),M[f].m(l,null),p(l,b),J(o,l,null),p(t,N),p(t,x),p(x,B),p(B,k),p(B,te),J(y,B,null),p(x,se),p(x,A),p(A,j),p(A,ne),p(A,S),Ie(S,i[0].description),p(x,ie),p(x,V),p(V,L),p(V,g),p(V,d),p(d,w),Y(s,h,u),P&&P.m(s,u),Y(s,ae,u),J(F,s,u),Y(s,ce,u),J(z,s,u),oe=!0,xe||(we=[Ce(S,"input",i[10]),Ce(S,"input",i[6]),Ce(d,"click",i[11])],xe=!0)},p(s,[u]){const re={};u&16777217&&(re.$$scope={dirty:u,ctx:s}),e.$set(re);let X=f;f=Fe(s),f===X?M[f].p(s,u):(Ye(),D(M[X],1,1,()=>{M[X]=null}),Qe(),r=M[f],r?r.p(s,u):(r=M[f]=Be[f](s),r.c()),T(r,1),r.m(l,b));const H={};u&16777216&&(H.$$scope={dirty:u,ctx:s}),o.$set(H);const G={};!Z&&u&1&&(Z=!0,G.value=s[0].name,pe(()=>Z=!1)),y.$set(G),u&1&&Ie(S,s[0].description),(!oe||u&2)&&C!==(C=Se[s[1]]+"")&&Ue(w,C);const R={};u&4&&(R.onChange=s[12]),!ge&&u&4&&(ge=!0,R.isOpen=s[2],pe(()=>ge=!1)),!be&&u&2&&(be=!0,R.selectedVisibility=s[1],pe(()=>be=!1)),F.$set(R);const K={};!_e&&u&8&&(_e=!0,K.isOpen=s[3],pe(()=>_e=!1)),z.$set(K)},i(s){oe||(T(e.$$.fragment,s),T(r),T(o.$$.fragment,s),T(y.$$.fragment,s),T(P),T(F.$$.fragment,s),T(z.$$.fragment,s),oe=!0)},o(s){D(e.$$.fragment,s),D(r),D(o.$$.fragment,s),D(y.$$.fragment,s),D(P),D(F.$$.fragment,s),D(z.$$.fragment,s),oe=!1},d(s){s&&(m(t),m(h),m(ae),m(ce)),W(e),M[f].d(),W(o),W(y),P&&P.d(s),W(F,s),W(z,s),xe=!1,Je(we)}}}const ht=120;function gt(i,t,e){let n;We(i,$e,c=>e(17,n=c));let{data:a}=t;const l=`${Me}/boxes`,f=a.paramIdx,r=f==="-1";let b=a.jwt,o={...a.box,description:a.box.description??""},N=o.visibility??"follower",x=!1,B=!1,k=!1;async function ee(){var g;if(le)return e(3,k=!0);const c=await tt({limit:1});(g=c[0])!=null&&g.file&&Z(c[0].file)}async function te(){var g;if(le)return e(3,k=!0);const c=await st();(g=c[0])!=null&&g.file&&Z(c[0].file)}const y=ot.isNativePlatform()?[{name:"사진 선택",icon:Ne,onClick:ee},{name:"사진 촬영",icon:je,onClick:te}]:[{name:"사진 선택",icon:Ne,onClick:ee}];async function Z(c){var g;try{const d=new FormData;d.append("image",c);const C=await fetch(`${l}/image`,{method:"POST",body:d,headers:{Authorization:`Bearer ${b}`,"x-api-version":Ee.BOX}});if(!C.ok)return Q.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});const h=(g=(await C.json()).data)==null?void 0:g.image;if(!h)return Q.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});if(e(0,o.image=h,o),r)return;A()}catch{}}function se(){let c=o.description??"",g=0,d=0,C="";for(let w of c){let h=w.charCodeAt(0);if(h===10&&(g++,d=0),g===3)break;let F=h>=4352&&h<=4607||h>=12592&&h<=12687||h>=43360&&h<=43391||h>=44032&&h<=55215||h>=55216&&h<=55295?2:1;if(d+F>ht/3*(3-g))break;d+=F,C+=w}e(0,o.description=C,o)}async function A(){if(le)return e(3,k=!0);if(e(0,o.name=o.name.trim(),o),!o.name||B)return;B=!0;const{url:c,method:g}=r?{url:l,method:"POST"}:{url:`${l}/${f}`,method:"PATCH"},d=await fetch(c,{method:g,headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`,"x-api-version":Ee.BOX},body:JSON.stringify({name:o.name,description:o.description,image:o.image,visibility:N})});if(!d.ok)return B=!1,Q.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});if(r){const w=(await d.json()).data;w.role="owner",w.visibility=N,w.is_subcribed=!1,w.place_count="0",w.follower_count="0",De($e,n=[w,...n],n),Q.emit("pushSnackbar",{message:"새 박스를 만들었습니다"}),de("/boxes")}else De($e,n=n.map(C=>(C.idx===o.idx&&(C.name=o.name,C.description=o.description,C.image=o.image,C.visibility=N),C)),n),Q.emit("pushSnackbar",{message:"박스를 수정했습니다."});B=!1}function j(c){i.$$.not_equal(o.name,c)&&(o.name=c,e(0,o))}function ue(){o.description=this.value,e(0,o)}const ne=()=>{if(le)return e(3,k=!0);e(2,x=!0)},S=()=>e(2,x=!1);function ie(c){x=c,e(2,x)}function V(c){N=c,e(1,N)}function L(c){k=c,e(3,k)}return i.$$set=c=>{"data"in c&&e(8,a=c.data)},[o,N,x,k,r,y,se,A,a,j,ue,ne,S,ie,V,L]}class Tt extends Ge{constructor(t){super(),Ke(this,t,gt,Ct,qe,{data:8})}}export{Tt as component,Dt as universal};
