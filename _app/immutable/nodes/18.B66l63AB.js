import{l as fe,e as K,A as E,s as R,f as _e,H as pe,m as de,a as me}from"../chunks/Header.BCFYnwU0.js";import{e as P}from"../chunks/index.BzNNCyU8.js";import{R as ge,s as X,e as Q,c as Z,b as ee,f as g,q as be,V as he,i as $,W as Y,r as H,n as q,D as ke,o as te,t as B,d as D,P as V,h as $e,j as ye,E as we,X as Ce,m as T,a as F,g as O,p as x,k as N,l as ve,w as A}from"../chunks/scheduler.BnheM4g2.js";import{g as S}from"../chunks/entry.W3sjn9Cn.js";import{S as oe,i as re,e as L,c as y,a as w,m as C,t as h,b as k,d as v,g as Ie,f as Pe}from"../chunks/index.CP53dWnj.js";import{V as Se}from"../chunks/Viewer.BnYiQ7C5.js";import{F as Ae}from"../chunks/Footer.8giEwWnd.js";import{B as M}from"../chunks/Button.CEczC82a.js";import{e as G,u as Be,d as De}from"../chunks/each.B4pMeuX4.js";import{p as Ne}from"../chunks/stores.BwZnzf5s.js";const je=async({fetch:r,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return P(400,"Bad Request");if(t==="post"){const o=fe();return{posts:[{user_idx:o==null?void 0:o.sub,unique_name:o==null?void 0:o.uni,profile_image_url:o==null?void 0:o.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:ge(R),mediaIdx:0,text:""}]}}if(t==="patch"){const o=e.searchParams.get("postIdx");if(o==="null")return K.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),S("/viewer",{replaceState:!0});o||P(404,"Not Found");const n=await r(`${E}/posts/${o}`,{method:"GET",headers:{Authorization:"Bearer "+sessionStorage.getItem("jwt")}}).then(a=>a.json()).then(a=>a.data);return n.error&&P(404,"Not Found"),{posts:[{...n,mediaIdx:0}]}}return P(404,"Not Found")},rt=Object.freeze(Object.defineProperty({__proto__:null,load:je},Symbol.toStringTag,{value:"Module"}));function J(r,e,t){const o=r.slice();return o[5]=e[t],o[7]=t,o}function U(r,e){let t,o=e[5]+"",n,a;return{key:r,first:null,c(){t=Q("option"),n=B(o),this.h()},l(l){t=Z(l,"OPTION",{});var u=ee(t);n=D(u,o),u.forEach(g),this.h()},h(){t.__value=a=e[5],V(t,t.__value),this.first=t},m(l,u){$(l,t,u),$e(t,n)},p(l,u){e=l,u&2&&o!==(o=e[5]+"")&&ye(n,o),u&2&&a!==(a=e[5])&&(t.__value=a,V(t,t.__value))},d(l){l&&g(t)}}}function Ee(r){let e,t=[],o=new Map,n,a,l=G(r[1]);const u=s=>s[7];for(let s=0;s<l.length;s+=1){let f=J(r,l,s),_=u(f);o.set(_,t[s]=U(_,f))}return{c(){e=Q("select");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=Z(s,"SELECT",{class:!0});var f=ee(e);for(let _=0;_<t.length;_+=1)t[_].l(f);f.forEach(g),this.h()},h(){be(e,"class","border border-gray-200 rounded-[4.75rem] py-[0.38rem] px-[0.88rem] typo-body3 text-gray-900 bg-gray-100"),e.disabled=r[2],r[0]===void 0&&he(()=>r[4].call(e))},m(s,f){$(s,e,f);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);Y(e,r[0],!0),n||(a=[H(e,"change",r[4]),H(e,"change",r[3])],n=!0)},p(s,[f]){f&2&&(l=G(s[1]),t=Be(t,f,u,1,s,l,o,e,De,U,null,J)),f&4&&(e.disabled=s[2]),f&3&&Y(e,s[0])},i:q,o:q,d(s){s&&g(e);for(let f=0;f<t.length;f+=1)t[f].d();n=!1,ke(a)}}}function Te(r,e,t){let{selected:o=""}=e,{options:n=[]}=e,{disabled:a=!1}=e;te(()=>{n.length>0&&t(0,o=n[0])});function l(s){we.call(this,r,s)}function u(){o=Ce(this),t(0,o),t(1,n)}return r.$$set=s=>{"selected"in s&&t(0,o=s.selected),"options"in s&&t(1,n=s.options),"disabled"in s&&t(2,a=s.disabled)},[o,n,a,l,u]}class Fe extends oe{constructor(e){super(),re(this,e,Te,Ee,X,{selected:0,options:1,disabled:2})}}var W;(function(r){r.Dark="DARK",r.Light="LIGHT",r.Default="DEFAULT"})(W||(W={}));var z;(function(r){r.Body="body",r.Ionic="ionic",r.Native="native",r.None="none"})(z||(z={}));const j=_e("Keyboard");function Oe(r){let e,t,o,n;const a=[Me,Le],l=[];function u(s,f){return s[3]===!0?0:1}return e=u(r),t=l[e]=a[e](r),{c(){t.c(),o=A()},l(s){t.l(s),o=A()},m(s,f){l[e].m(s,f),$(s,o,f),n=!0},p(s,f){let _=e;e=u(s),e===_?l[e].p(s,f):(Ie(),k(l[_],1,1,()=>{l[_]=null}),Pe(),t=l[e],t?t.p(s,f):(t=l[e]=a[e](s),t.c()),h(t,1),t.m(o.parentNode,o))},i(s){n||(h(t),n=!0)},o(s){k(t),n=!1},d(s){s&&g(o),l[e].d(s)}}}function xe(r){let e,t;return e=new M({props:{backgroundColor:"bg-primary-500",textColor:"text-white",border:"border-none",$$slots:{default:[qe]},$$scope:{ctx:r}}}),e.$on("click",r[12]),{c(){y(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,n){C(e,o,n),t=!0},p(o,n){const a={};n&1048576&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(h(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){v(e,o)}}}function Le(r){let e,t;return e=new M({props:{backgroundColor:"bg-gray-800",textColor:"text-white",border:"border-none",$$slots:{default:[Ye]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,n){C(e,o,n),t=!0},p(o,n){const a={};n&1048576&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(h(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){v(e,o)}}}function Me(r){let e,t;return e=new M({props:{backgroundColor:"bg-primary-500",textColor:"text-white",border:"border-none",$$slots:{default:[He]},$$scope:{ctx:r}}}),e.$on("click",r[13]),{c(){y(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,n){C(e,o,n),t=!0},p(o,n){const a={};n&1048576&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(o){t||(h(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){v(e,o)}}}function Ye(r){let e;return{c(){e=B("사진 업로드중")},l(t){e=D(t,"사진 업로드중")},m(t,o){$(t,e,o)},d(t){t&&g(e)}}}function He(r){let e;return{c(){e=B("게시하기")},l(t){e=D(t,"게시하기")},m(t,o){$(t,e,o)},d(t){t&&g(e)}}}function qe(r){let e;return{c(){e=B("수정하기")},l(t){e=D(t,"수정하기")},m(t,o){$(t,e,o)},d(t){t&&g(e)}}}function Ve(r){let e,t,o,n,a,l,u;function s(i){r[11](i)}let f={options:["전체 공개","팔로워 공개","비공개"],disabled:!0};r[0]!==void 0&&(f.selected=r[0]),e=new Fe({props:f}),T.push(()=>L(e,"selected",s));const _=[xe,Oe],m=[];function c(i,d){return i[4]==="patch"?0:i[4]==="post"?1:-1}return~(n=c(r))&&(a=m[n]=_[n](r)),{c(){y(e.$$.fragment),o=F(),a&&a.c(),l=A()},l(i){w(e.$$.fragment,i),o=O(i),a&&a.l(i),l=A()},m(i,d){C(e,i,d),$(i,o,d),~n&&m[n].m(i,d),$(i,l,d),u=!0},p(i,d){const b={};!t&&d&1&&(t=!0,b.selected=i[0],x(()=>t=!1)),e.$set(b),a&&a.p(i,d)},i(i){u||(h(e.$$.fragment,i),h(a),u=!0)},o(i){k(e.$$.fragment,i),k(a),u=!1},d(i){i&&(g(o),g(l)),v(e,i),~n&&m[n].d(i)}}}function Ge(r){let e,t,o,n,a,l,u,s;e=new pe({props:{position:"fixed",leftBack:"white"}});function f(c){r[9](c)}function _(c){r[10](c)}let m={dontMoveVertically:!0};return r[2]!==void 0&&(m.posts=r[2]),r[1]!==void 0&&(m.keyboardY=r[1]),o=new Se({props:m}),T.push(()=>L(o,"posts",f)),T.push(()=>L(o,"keyboardY",_)),u=new Ae({props:{position:"fixed",bottom:"2rem",$$slots:{default:[Ve]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment),t=F(),y(o.$$.fragment),l=F(),y(u.$$.fragment)},l(c){w(e.$$.fragment,c),t=O(c),w(o.$$.fragment,c),l=O(c),w(u.$$.fragment,c)},m(c,i){C(e,c,i),$(c,t,i),C(o,c,i),$(c,l,i),C(u,c,i),s=!0},p(c,[i]){const d={};!n&&i&4&&(n=!0,d.posts=c[2],x(()=>n=!1)),!a&&i&2&&(a=!0,d.keyboardY=c[1],x(()=>a=!1)),o.$set(d);const b={};i&1048585&&(b.$$scope={dirty:i,ctx:c}),u.$set(b)},i(c){s||(h(e.$$.fragment,c),h(o.$$.fragment,c),h(u.$$.fragment,c),s=!0)},o(c){k(e.$$.fragment,c),k(o.$$.fragment,c),k(u.$$.fragment,c),s=!1},d(c){c&&(g(t),g(l)),v(e,c),v(o,c),v(u,c)}}}function Je(r,e,t){let o,n,a,l,u;N(r,Ne,p=>t(15,a=p)),N(r,R,p=>t(8,l=p)),N(r,me,p=>t(3,u=p));const s=de.getPlatform()!=="web",f=a.url.searchParams.get("type");let{data:_}=e,m;const c={"전체 공개":"public","팔로워 공개":"follower",비공개:"private"};async function i(){var I;(await fetch(`${E}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({placeIdx:a.url.searchParams.get("placeIdx"),text:((I=n.at(0))==null?void 0:I.text)||"",media:o,permission:c[m]})})).ok&&await S("/users/0",{replaceState:!0,invalidateAll:!0})}async function d(){var p;try{const I=await fetch(`${E}/posts/${a.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({text:((p=n.at(0))==null?void 0:p.text)||""})});if(!I.ok){(await I.json()).status===401&&(K.emit("pushSnackbar",{message:"접근할 수 없습니다"}),S(`/viewer?postIdx=${a.url.searchParams.get("postIdx")}`));return}await S("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let b=0;function se(){j.addListener("keyboardWillShow",p=>{t(1,b=p.keyboardHeight*-1)}),j.addListener("keyboardWillHide",()=>{t(1,b=0)})}function ne(){j.removeAllListeners()}te(()=>{s&&se()}),ve(()=>{s&&ne()});function ae(p){n=p,t(2,n),t(7,_)}function ie(p){b=p,t(1,b)}function le(p){m=p,t(0,m)}const ce=()=>d(),ue=()=>i();return r.$$set=p=>{"data"in p&&t(7,_=p.data)},r.$$.update=()=>{r.$$.dirty&256&&(o=l),r.$$.dirty&128&&t(2,n=_.posts)},[m,b,n,u,f,i,d,_,l,ae,ie,le,ce,ue]}class st extends oe{constructor(e){super(),re(this,e,Je,Ge,X,{data:7})}}export{st as component,rt as universal};
