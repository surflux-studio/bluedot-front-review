import{g as me}from"../chunks/entry.D1smK8x5.js";import{e as K,k as Oe,s as ve,A as He}from"../chunks/store.BNSvZl0c.js";import{g as Me}from"../chunks/sign.Bk7Ra2hF.js";import{s as Ue,w as ce,e as v,a as S,t as Te,c as x,b as F,g as E,f as m,z as xe,d as Ne,v as _,i as Y,h as p,Q as De,A as de,x as fe,j as qe,F as Re,k as Je,n as Ce,U as Se}from"../chunks/scheduler.CIbz-4tf.js";import{S as Ge,i as Qe,b as pe,c as R,d as J,m as G,a as I,e as We,t as T,f as Q,g as Xe}from"../chunks/index.gvaMc9LH.js";import{H as Ke}from"../chunks/Header.wc4vbHxx.js";import{F as Ye}from"../chunks/Field.sEKQ2dwN.js";import{g as Ze,t as et}from"../chunks/photo.BsqFRtFJ.js";import{s as Ee}from"../chunks/s32cloudfront.DKUgsqvV.js";import{C as tt}from"../chunks/CircleImage.CZpdYjea.js";import{V as st}from"../chunks/VisibilitySheet.BpQg1LAY.js";import{C as nt,I as Ie,a as Ve}from"../chunks/IconCamera.MP3a_bBh.js";import{C as it}from"../chunks/device.C5oMyxqL.js";import{N as at}from"../chunks/NavigationBar.DHQMOQvd.js";import{A as ot}from"../chunks/ActionSheetOpenApp.IOpRtyeg.js";const rt=async({params:i,parent:t})=>{var b;const e=i.idx,n=`/boxes/${e}`,a=e==="-1",l=Me();if(l===null&&!a)return me(n,{replaceState:!0});if(a)return{box:{idx:"-1",name:"",description:"",image:null,role:null},jwt:l,paramIdx:e};const f=await t();if(f.error||!f.data)return K.emit("pushSnackbar",{message:"접근할 수 없습니다."}),me("/boxes",{replaceState:!0});const r=(b=f.data)==null?void 0:b.box;return(r==null?void 0:r.role)!=="owner"?(K.emit("pushSnackbar",{message:"접근할 수 없습니다."}),me(n,{replaceState:!0})):{box:r,jwt:l,paramIdx:e}},St=Object.freeze(Object.defineProperty({__proto__:null,load:rt},Symbol.toStringTag,{value:"Module"}));function lt(i){let t,e,n,a,l,f;return{c(){t=v("div"),e=v("button"),n=Te("완료"),this.h()},l(r){t=x(r,"DIV",{slot:!0});var b=F(t);e=x(b,"BUTTON",{class:!0});var o=F(e);n=Ne(o,"완료"),o.forEach(m),b.forEach(m),this.h()},h(){_(e,"class","font-medium text-sm leading-[17px] text-white disabled:text-[#3F3F3F] align-text-top"),e.disabled=a=i[0].name.trim()==="",_(t,"slot","right")},m(r,b){Y(r,t,b),p(t,e),p(e,n),l||(f=de(e,"click",i[7]),l=!0)},p(r,b){b&1&&a!==(a=r[0].name.trim()==="")&&(e.disabled=a)},d(r){r&&m(t),l=!1,f()}}}function ut(i){let t;return{c(){t=v("div"),this.h()},l(e){t=x(e,"DIV",{class:!0}),F(t).forEach(m),this.h()},h(){_(t,"class","w-full h-full bg-[#D9D9D9] rounded-full")},m(e,n){Y(e,t,n)},p:Ce,i:Ce,o:Ce,d(e){e&&m(t)}}}function ct(i){let t,e;return t=new tt({props:{src:Ee(i[0].image??"",500),width:"78px",strokeWidth:"0"}}),{c(){R(t.$$.fragment)},l(n){J(t.$$.fragment,n)},m(n,a){G(t,n,a),e=!0},p(n,a){const l={};a&1&&(l.src=Ee(n[0].image??"",500)),t.$set(l)},i(n){e||(T(t.$$.fragment,n),e=!0)},o(n){I(t.$$.fragment,n),e=!1},d(n){Q(t,n)}}}function ft(i){let t,e,n;return e=new Ve({props:{fill:"white",length:"1"}}),{c(){t=v("button"),R(e.$$.fragment),this.h()},l(a){t=x(a,"BUTTON",{class:!0});var l=F(t);J(e.$$.fragment,l),l.forEach(m),this.h()},h(){_(t,"class","absolute bottom-0 right-0 bg-[#3F3F3F] w-6 h-6 rounded-[40px] shadow-[1px_1px_6px_rgba(0,0,0,0.1)] flex justify-center items-center")},m(a,l){Y(a,t,l),G(e,t,null),n=!0},p:Ce,i(a){n||(T(e.$$.fragment,a),n=!0)},o(a){I(e.$$.fragment,a),n=!1},d(a){a&&m(t),Q(e)}}}function pt(i){let t,e;return t=new at({}),{c(){R(t.$$.fragment)},l(n){J(t.$$.fragment,n)},m(n,a){G(t,n,a),e=!0},i(n){e||(T(t.$$.fragment,n),e=!0)},o(n){I(t.$$.fragment,n),e=!1},d(n){Q(t,n)}}}function mt(i){let t,e,n,a,l,f,r,b,o,N,$,w,y,ee="박스 이름",te,A,Z,se,O,j,le='<p class="text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]">박스 설명</p>',ne,D,ie,V,L,c="공개 여부",g,d,C=Oe[i[1]]+"",k,h,ae,B,he,ge,ue,z,be,oe,_e,ke;e=new Ke({props:{position:"static",leftBack:!0,centerTitle:i[4]?"박스 추가":"박스 편집",$$slots:{right:[lt]},$$scope:{ctx:i}}});const we=[ct,ut],U=[];function Be(s,u){return s[0].image?0:1}f=Be(i),r=U[f]=we[f](i),o=new nt({props:{shrink:!1,className:"absolute",ydistance:14,items:i[5],$$slots:{default:[ft]},$$scope:{ctx:i}}});function Pe(s){i[9](s)}let Fe={padding:"",border:"border-b-[0.5px] border-[#3F3F3F] py-2.5",backgroundColor:"bg-transparent",fontSize:"text-sm font-normal leading-5",fontColor:"text-[#F1F1F1]",limit:20,useCounter:!1};i[0].name!==void 0&&(Fe.value=i[0].name),A=new Ye({props:Fe}),ce.push(()=>pe(A,"value",Pe));let P=pt();function je(s){i[13](s)}function Le(s){i[14](s)}let $e={onChange:i[12]};i[2]!==void 0&&($e.isOpen=i[2]),i[1]!==void 0&&($e.selectedVisibility=i[1]),B=new st({props:$e}),ce.push(()=>pe(B,"isOpen",je)),ce.push(()=>pe(B,"selectedVisibility",Le));function ze(s){i[15](s)}let ye={};return i[3]!==void 0&&(ye.isOpen=i[3]),z=new ot({props:ye}),ce.push(()=>pe(z,"isOpen",ze)),{c(){t=v("div"),R(e.$$.fragment),n=S(),a=v("section"),l=v("div"),r.c(),b=S(),R(o.$$.fragment),N=S(),$=v("section"),w=v("section"),y=v("p"),y.textContent=ee,te=S(),R(A.$$.fragment),se=S(),O=v("section"),j=v("div"),j.innerHTML=le,ne=S(),D=v("textarea"),ie=S(),V=v("section"),L=v("p"),L.textContent=c,g=S(),d=v("div"),k=Te(C),h=S(),P&&P.c(),ae=S(),R(B.$$.fragment),ue=S(),R(z.$$.fragment),this.h()},l(s){t=x(s,"DIV",{class:!0});var u=F(t);J(e.$$.fragment,u),n=E(u),a=x(u,"SECTION",{class:!0});var re=F(a);l=x(re,"DIV",{class:!0});var q=F(l);r.l(q),b=E(q),J(o.$$.fragment,q),q.forEach(m),re.forEach(m),N=E(u),$=x(u,"SECTION",{class:!0});var H=F($);w=x(H,"SECTION",{class:!0});var W=F(w);y=x(W,"P",{class:!0,"data-svelte-h":!0}),xe(y)!=="svelte-1kbmcgb"&&(y.textContent=ee),te=E(W),J(A.$$.fragment,W),W.forEach(m),se=E(H),O=x(H,"SECTION",{class:!0});var M=F(O);j=x(M,"DIV",{class:!0,"data-svelte-h":!0}),xe(j)!=="svelte-sqw6c9"&&(j.innerHTML=le),ne=E(M),D=x(M,"TEXTAREA",{class:!0}),F(D).forEach(m),M.forEach(m),ie=E(H),V=x(H,"SECTION",{class:!0});var X=F(V);L=x(X,"P",{class:!0,"data-svelte-h":!0}),xe(L)!=="svelte-18l855b"&&(L.textContent=c),g=E(X),d=x(X,"DIV",{class:!0,"aria-hidden":!0});var Ae=F(d);k=Ne(Ae,C),Ae.forEach(m),X.forEach(m),H.forEach(m),u.forEach(m),h=E(s),P&&P.l(s),ae=E(s),J(B.$$.fragment,s),ue=E(s),J(z.$$.fragment,s),this.h()},h(){_(l,"class","w-[78px] h-[78px] relative"),_(a,"class","box-image relative w-full flex justify-center"),_(y,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),_(w,"class","box-name flex gap-[15px] h-10 items-center"),_(j,"class","flex-none h-10 flex items-center"),_(D,"class","auto-height w-full bg-transparent border-x-0 border-t-0 focus:ring-0 focus:border-[#3F3F3F] border-b-[0.5px] border-[#3F3F3F] py-2.5 px-0 text-sm font-normal leading-5 text-[#F1F1F1] resize-none svelte-oekuck"),_(O,"class","box-description flex gap-[15px] min-h-10 items-start"),_(L,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),_(d,"class","w-full border-b-[0.5px] border-[#3F3F3F] py-2.5 text-xs font-normal leading-4 text-gray-03 svelte-oekuck"),_(d,"aria-hidden",""),_(V,"class","box-name flex gap-[15px] h-10 items-center"),_($,"class","box-setting p-5 text-white"),_(t,"class","min-h-dvh bg-black")},m(s,u){Y(s,t,u),G(e,t,null),p(t,n),p(t,a),p(a,l),U[f].m(l,null),p(l,b),G(o,l,null),p(t,N),p(t,$),p($,w),p(w,y),p(w,te),G(A,w,null),p($,se),p($,O),p(O,j),p(O,ne),p(O,D),De(D,i[0].description),p($,ie),p($,V),p(V,L),p(V,g),p(V,d),p(d,k),Y(s,h,u),P&&P.m(s,u),Y(s,ae,u),G(B,s,u),Y(s,ue,u),G(z,s,u),oe=!0,_e||(ke=[de(D,"input",i[10]),de(D,"input",i[6]),de(d,"click",i[11])],_e=!0)},p(s,[u]){const re={};u&16777217&&(re.$$scope={dirty:u,ctx:s}),e.$set(re);let q=f;f=Be(s),f===q?U[f].p(s,u):(Xe(),I(U[q],1,1,()=>{U[q]=null}),We(),r=U[f],r?r.p(s,u):(r=U[f]=we[f](s),r.c()),T(r,1),r.m(l,b));const H={};u&16777216&&(H.$$scope={dirty:u,ctx:s}),o.$set(H);const W={};!Z&&u&1&&(Z=!0,W.value=s[0].name,fe(()=>Z=!1)),A.$set(W),u&1&&De(D,s[0].description),(!oe||u&2)&&C!==(C=Oe[s[1]]+"")&&qe(k,C);const M={};u&4&&(M.onChange=s[12]),!he&&u&4&&(he=!0,M.isOpen=s[2],fe(()=>he=!1)),!ge&&u&2&&(ge=!0,M.selectedVisibility=s[1],fe(()=>ge=!1)),B.$set(M);const X={};!be&&u&8&&(be=!0,X.isOpen=s[3],fe(()=>be=!1)),z.$set(X)},i(s){oe||(T(e.$$.fragment,s),T(r),T(o.$$.fragment,s),T(A.$$.fragment,s),T(P),T(B.$$.fragment,s),T(z.$$.fragment,s),oe=!0)},o(s){I(e.$$.fragment,s),I(r),I(o.$$.fragment,s),I(A.$$.fragment,s),I(P),I(B.$$.fragment,s),I(z.$$.fragment,s),oe=!1},d(s){s&&(m(t),m(h),m(ae),m(ue)),Q(e),U[f].d(),Q(o),Q(A),P&&P.d(s),Q(B,s),Q(z,s),_e=!1,Re(ke)}}}const dt=120;function Ct(i,t,e){let n;Je(i,ve,c=>e(17,n=c));let{data:a}=t;const l=`${He}/boxes`,f=a.paramIdx,r=f==="-1";let b=a.jwt,o={...a.box,description:a.box.description??""},N=o.visibility??"follower",$=!1,w=!1,y=!1;async function ee(){var g;const c=await Ze({limit:1});(g=c[0])!=null&&g.file&&Z(c[0].file)}async function te(){var g;const c=await et();(g=c[0])!=null&&g.file&&Z(c[0].file)}const A=it.isNativePlatform()?[{name:"사진 선택",icon:Ie,onClick:ee},{name:"사진 촬영",icon:Ve,onClick:te}]:[{name:"사진 선택",icon:Ie,onClick:ee}];async function Z(c){var g;try{const d=new FormData;d.append("image",c);const C=await fetch(`${l}/image`,{method:"POST",body:d,headers:{Authorization:`Bearer ${b}`}});if(!C.ok)return K.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});const h=(g=(await C.json()).data)==null?void 0:g.image;if(!h)return K.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});if(e(0,o.image=h,o),r)return;O()}catch{}}function se(){let c=o.description??"",g=0,d=0,C="";for(let k of c){let h=k.charCodeAt(0);if(h===10&&(g++,d=0),g===3)break;let B=h>=4352&&h<=4607||h>=12592&&h<=12687||h>=43360&&h<=43391||h>=44032&&h<=55215||h>=55216&&h<=55295?2:1;if(d+B>dt/3*(3-g))break;d+=B,C+=k}e(0,o.description=C,o)}async function O(){if(e(0,o.name=o.name.trim(),o),!o.name||w)return;w=!0;const{url:c,method:g}=r?{url:l,method:"POST"}:{url:`${l}/${f}`,method:"PATCH"},d=await fetch(c,{method:g,headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({name:o.name,description:o.description,image:o.image,visibility:N})});if(!d.ok)return w=!1,K.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});if(r){const k=(await d.json()).data;k.role="owner",k.visibility=N,k.is_subcribed=!1,k.place_count="0",k.follower_count="0",Se(ve,n=[k,...n],n),K.emit("pushSnackbar",{message:"새 박스를 만들었습니다"}),me("/boxes")}else Se(ve,n=n.map(C=>(C.idx===o.idx&&(C.name=o.name,C.description=o.description,C.image=o.image,C.visibility=N),C)),n),K.emit("pushSnackbar",{message:"박스를 수정했습니다."});w=!1}function j(c){i.$$.not_equal(o.name,c)&&(o.name=c,e(0,o))}function le(){o.description=this.value,e(0,o)}const ne=()=>{e(2,$=!0)},D=()=>e(2,$=!1);function ie(c){$=c,e(2,$)}function V(c){N=c,e(1,N)}function L(c){y=c,e(3,y)}return i.$$set=c=>{"data"in c&&e(8,a=c.data)},[o,N,$,y,r,A,se,O,a,j,le,ne,D,ie,V,L]}class Et extends Ge{constructor(t){super(),Qe(this,t,Ct,mt,Ue,{data:8})}}export{Et as component,St as universal};
