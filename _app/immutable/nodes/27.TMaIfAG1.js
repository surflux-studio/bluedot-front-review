import{s as J,e as O,c as q,b as K,f as b,Q as B,i as I,A as C,G as L,H as Y,F as Z,I as T,a as M,C as V,g as R,k as y,w as ee,x as te,n as A,v as se}from"../chunks/scheduler.DobTUrUU.js";import{S as Q,i as U,c as w,b as x,m as j,t as h,a as g,d as E,f as z,g as H}from"../chunks/index.BzbOx6Bd.js";import{H as oe}from"../chunks/Header.BWVlw1P1.js";import{V as ne}from"../chunks/Viewer.C7AyG-0h.js";import"../chunks/entry.72j06AYb.js";import{j as re,k as v,g as ae,A as D}from"../chunks/sign.D2LB2NXZ.js";/* empty css                                                   *//* empty css                                                     */import{p as ie}from"../chunks/stores.B22jY-hJ.js";import{N as le}from"../chunks/NavigationBar.Ccwdi6Tw.js";import"../chunks/ActionSheet.BeV2j9V7.js";/* empty css                                                   */import{M as ce}from"../chunks/Mask.BqR0TKk4.js";import{P as me}from"../chunks/picker.DO1g6OCe.js";function fe(r){let e,o,t;return{c(){e=O("emoji-picker"),this.h()},l(n){e=q(n,"EMOJI-PICKER",{"aria-hidden":!0,class:!0}),K(e).forEach(b),this.h()},h(){B(e,"aria-hidden",""),B(e,"class",r[0])},m(n,a){I(n,e,a),o||(t=[C(e,"emoji-click",L(Y(r[2]))),C(e,"touchstart",L(r[4])),C(e,"touchend",L(r[5]))],o=!0)},p(n,a){a&1&&B(e,"class",n[0])},d(n){n&&b(e),o=!1,Z(t)}}}function ue(r){let e,o;return e=new ce({props:{onMask:!0,position:"absolute",onTouch:r[6],$$slots:{default:[fe]},$$scope:{ctx:r}}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,n){j(e,t,n),o=!0},p(t,[n]){const a={};n&2&&(a.onTouch=t[6]),n&257&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){o||(h(e.$$.fragment,t),o=!0)},o(t){g(e.$$.fragment,t),o=!1},d(t){E(e,t)}}}function pe(r,e,o){let{classList:t}=e,{onSelect:n}=e,{close:a}=e;function m(c){n(c.detail.unicode)}new me({emojiVersion:15});function _(c){T.call(this,r,c)}function d(c){T.call(this,r,c)}const p=()=>{a()};return r.$$set=c=>{"classList"in c&&o(0,t=c.classList),"onSelect"in c&&o(3,n=c.onSelect),"close"in c&&o(1,a=c.close)},[t,a,m,n,_,d,p]}class de extends Q{constructor(e){super(),U(this,e,pe,ue,J,{classList:0,onSelect:3,close:1})}}function _e(r){let e,o;return e=new ne({props:{posts:r[0].posts,index:r[0].index,selectedReaction:r[1]}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,n){j(e,t,n),o=!0},p(t,n){const a={};n&1&&(a.posts=t[0].posts),n&1&&(a.index=t[0].index),n&2&&(a.selectedReaction=t[1]),e.$set(a)},i(t){o||(h(e.$$.fragment,t),o=!0)},o(t){g(e.$$.fragment,t),o=!1},d(t){E(e,t)}}}function he(r){let e;return{c(){e=O("div"),this.h()},l(o){e=q(o,"DIV",{class:!0}),K(e).forEach(b),this.h()},h(){se(e,"class","w-full h-full")},m(o,t){I(o,e,t)},p:A,i:A,o:A,d(o){o&&b(e)}}}function F(r){let e,o;return e=new de({props:{classList:"absolute bottom-24 right-0 px-4 z-50",onSelect:r[4],close:r[8]}}),{c(){w(e.$$.fragment)},l(t){x(e.$$.fragment,t)},m(t,n){j(e,t,n),o=!0},p:A,i(t){o||(h(e.$$.fragment,t),o=!0)},o(t){g(e.$$.fragment,t),o=!1},d(t){E(e,t)}}}function ge(r){let e,o,t,n,a,m,_,d,p;e=new oe({props:{position:"fixed",leftBack:r[2]?"":"white",rightSearch:"white"}});const c=[he,_e],u=[];function P(s,i){return s[0].posts.length===0?0:1}t=P(r),n=u[t]=c[t](r),m=new le({});let l=r[3]&&F(r);return{c(){w(e.$$.fragment),o=M(),n.c(),a=M(),w(m.$$.fragment),_=M(),l&&l.c(),d=V()},l(s){x(e.$$.fragment,s),o=R(s),n.l(s),a=R(s),x(m.$$.fragment,s),_=R(s),l&&l.l(s),d=V()},m(s,i){j(e,s,i),I(s,o,i),u[t].m(s,i),I(s,a,i),j(m,s,i),I(s,_,i),l&&l.m(s,i),I(s,d,i),p=!0},p(s,[i]){const S={};i&4&&(S.leftBack=s[2]?"":"white"),e.$set(S);let $=t;t=P(s),t===$?u[t].p(s,i):(H(),g(u[$],1,1,()=>{u[$]=null}),z(),n=u[t],n?n.p(s,i):(n=u[t]=c[t](s),n.c()),h(n,1),n.m(a.parentNode,a)),s[3]?l?(l.p(s,i),i&8&&h(l,1)):(l=F(s),l.c(),h(l,1),l.m(d.parentNode,d)):l&&(H(),g(l,1,1,()=>{l=null}),z())},i(s){p||(h(e.$$.fragment,s),h(n),h(m.$$.fragment,s),h(l),p=!0)},o(s){g(e.$$.fragment,s),g(n),g(m.$$.fragment,s),g(l),p=!1},d(s){s&&(b(o),b(a),b(_),b(d)),E(e,s),u[t].d(s),E(m,s),l&&l.d(s)}}}function be(r,e,o){let t,n,a,m,_,d;y(r,ie,s=>o(7,m=s)),y(r,re,s=>o(10,_=s)),y(r,v,s=>o(3,d=s));let p={posts:[],index:0},c,u;ee(async()=>{let s="";try{s=ae()}catch{}const i=Number(m.url.searchParams.get("postIdx")||0);Number(m.url.searchParams.get("mediaIdx")||0);const S=0,$=30,W=`&offset=${S}`,X=`&limit=${$}`;let k=[];(n||t)&&_.length>0?(k=_.map(f=>f.idx===i?{...f,mediaIdx:f.mediaIdx||0}:{...f,mediaIdx:0}),o(0,p.index=k.findIndex(f=>f.idx===String(i)),p)):(u=new AbortController,i&&(k=[await fetch(`${D}/posts/${i}`,{method:"GET",headers:{Authorization:"Bearer "+s},signal:u.signal}).then(f=>f.json()).then(f=>({...f.data,mediaIdx:f.data.mediaIdx||0}))]),k=[...k,...await fetch(`${D}/posts?${W}${X}`,{method:"GET",headers:{Authorization:"Bearer "+s},signal:u.signal}).then(f=>f.json()).then(f=>{var G;return(G=f.data)==null?void 0:G.posts.filter(N=>N.idx!==String(i)).map(N=>({...N,mediaIdx:N.mediaIdx||0}))})||[]]),o(0,p.posts=k,p)}),te(()=>{u&&u.abort()});async function P(s){const i=m.url.searchParams.get("postIdx");i&&o(1,c={postIdx:i,reaction:s})}const l=()=>{v.set(!1)};return r.$$.update=()=>{r.$$.dirty&128&&o(5,t=m.url.searchParams.get("placeIdx")),r.$$.dirty&128&&o(6,n=m.url.searchParams.get("userIdx")),r.$$.dirty&96&&o(2,a=!t&&!n)},[p,c,a,d,P,t,n,m,l]}class Me extends Q{constructor(e){super(),U(this,e,be,ge,J,{})}}export{Me as component};
