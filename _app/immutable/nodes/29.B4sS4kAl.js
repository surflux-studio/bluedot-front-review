import{l as ye,e as me,A as se,g as re,m as he,C as Ce,k as ue}from"../chunks/sign.FXUqjdDN.js";import{e as X}from"../chunks/index.g5YcAAdQ.js";import{l as Ie,s as ge,e as V,c as B,b as P,f as $,v as k,i as H,t as ne,a as T,d as ae,g as Y,h as y,A as R,S as Ve,j as ce,n as ee,y as G,z as W,k as fe,w as Be,x as De,V as Ae,F as Ee,B as be}from"../chunks/scheduler.BTWb34i-.js";import{g as Z}from"../chunks/entry.BCQ5qs3h.js";import{S as ve,i as $e,g as oe,f as le,t as D,a as A,c as j,b as F,m as M,d as z,e as Q}from"../chunks/index.D8fgSKXR.js";import{H as ke}from"../chunks/Header.BJ_WNx7K.js";import{V as we}from"../chunks/Viewer.CHDy-O-T.js";/* empty css                                                   */import{p as Se}from"../chunks/stores.CAFNgcVH.js";import{K as ie}from"../chunks/index.BC0l96Qw.js";import{e as de,u as Pe,o as xe}from"../chunks/each.Co5Upyp2.js";import{I as Ne}from"../chunks/IconChevronRight.DPmjPHOM.js";import{B as Oe}from"../chunks/BottomNavigationPadder.DwHlk_jT.js";import{V as Te}from"../chunks/VisibilitySheet.B74q1dKM.js";import{N as Ye}from"../chunks/NavigationBar.CcQzzCkF.js";const je=async({fetch:s,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return X(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const i=ye();return{posts:[{user_idx:i==null?void 0:i.sub,unique_name:i==null?void 0:i.uni,profile_image_url:i==null?void 0:i.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Ie(he),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const i=e.searchParams.get("postIdx");if(i==="null")return me.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),Z("/viewer",{replaceState:!0});i||X(404,"Not Found");const a=await s(`${se}/posts/${i}`,{method:"GET",headers:{Authorization:"Bearer "+re()}}).then(o=>o.json()).then(o=>o.data);return a.error&&X(404,"Not Found"),{posts:[{...a,mediaIdx:0}]}}return X(404,"Not Found")},pt=Object.freeze(Object.defineProperty({__proto__:null,load:je},Symbol.toStringTag,{value:"Module"}));function pe(s,e,t){const i=s.slice();return i[1]=e[t],i[3]=t,i}function Fe(s){let e;return{c(){e=V("div"),this.h()},l(t){e=B(t,"DIV",{class:!0}),P(e).forEach($),this.h()},h(){k(e,"class","w-0.5")},m(t,i){H(t,e,i)},i:ee,o:ee,d(t){t&&$(e)}}}function Me(s){let e,t;return e=new Ne({props:{fill:"#6B7280",length:"1.25"}}),{c(){j(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){M(e,i,a),t=!0},i(i){t||(D(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){z(e,i)}}}function _e(s,e){let t,i,a=e[1].title+"",o,g,n,l,c=e[1].value+"",p,b,r,f,u,m,h,E,x;const S=[Me,Fe],w=[];function J(C,I){return C[1].onClick?0:1}return r=J(e),f=w[r]=S[r](e),{key:s,first:null,c(){t=V("div"),i=V("span"),o=ne(a),g=T(),n=V("div"),l=V("span"),p=ne(c),b=T(),f.c(),u=T(),this.h()},l(C){t=B(C,"DIV",{class:!0});var I=P(t);i=B(I,"SPAN",{class:!0});var N=P(i);o=ae(N,a),N.forEach($),g=Y(I),n=B(I,"DIV",{class:!0});var O=P(n);l=B(O,"SPAN",{class:!0});var _=P(l);p=ae(_,c),_.forEach($),b=Y(O),f.l(O),O.forEach($),u=Y(I),I.forEach($),this.h()},h(){k(i,"class","text-white text-sm font-medium"),k(l,"class","text-gray-500 text-xs"),k(n,"class","flex items-center gap-2"),k(t,"class",m=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(C,I){H(C,t,I),y(t,i),y(i,o),y(t,g),y(t,n),y(n,l),y(l,p),y(n,b),w[r].m(n,null),y(t,u),h=!0,E||(x=R(t,"click",function(){Ve(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),E=!0)},p(C,I){e=C,(!h||I&1)&&a!==(a=e[1].title+"")&&ce(o,a),(!h||I&1)&&c!==(c=e[1].value+"")&&ce(p,c);let N=r;r=J(e),r!==N&&(oe(),A(w[N],1,1,()=>{w[N]=null}),le(),f=w[r],f||(f=w[r]=S[r](e),f.c()),D(f,1),f.m(n,null)),(!h||I&1&&m!==(m=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&k(t,"class",m)},i(C){h||(D(f),h=!0)},o(C){A(f),h=!1},d(C){C&&$(t),w[r].d(),E=!1,x()}}}function ze(s){let e,t=[],i=new Map,a,o=de(s[0]);const g=n=>n[1].id;for(let n=0;n<o.length;n+=1){let l=pe(s,o,n),c=g(l);i.set(c,t[n]=_e(c,l))}return{c(){e=V("div");for(let n=0;n<t.length;n+=1)t[n].c();this.h()},l(n){e=B(n,"DIV",{class:!0});var l=P(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach($),this.h()},h(){k(e,"class","flex flex-col w-full")},m(n,l){H(n,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);a=!0},p(n,[l]){l&1&&(o=de(n[0]),oe(),t=Pe(t,l,g,1,n,o,i,e,xe,_e,null,pe),le())},i(n){if(!a){for(let l=0;l<o.length;l+=1)D(t[l]);a=!0}},o(n){for(let l=0;l<t.length;l+=1)A(t[l]);a=!1},d(n){n&&$(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function He(s,e,t){let{items:i=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return s.$$set=a=>{"items"in a&&t(0,i=a.items)},[i]}class Je extends ve{constructor(e){super(),$e(this,e,He,ze,ge,{items:0})}}function Ke(s){let e,t,i,a,o,g,n,l;e=new ke({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",$$slots:{right:[qe]},$$scope:{ctx:s}}});function c(r){s[20](r)}function p(r){s[21](r)}let b={dontMoveVertically:!0,hideActionButtons:!0};return s[1]!==void 0&&(b.posts=s[1]),s[5]!==void 0&&(b.keyboardY=s[5]),i=new we({props:b}),G.push(()=>Q(i,"posts",c)),G.push(()=>Q(i,"keyboardY",p)),n=new Ye({}),{c(){j(e.$$.fragment),t=T(),j(i.$$.fragment),g=T(),j(n.$$.fragment)},l(r){F(e.$$.fragment,r),t=Y(r),F(i.$$.fragment,r),g=Y(r),F(n.$$.fragment,r)},m(r,f){M(e,r,f),H(r,t,f),M(i,r,f),H(r,g,f),M(n,r,f),l=!0},p(r,f){const u={};f&536870912&&(u.$$scope={dirty:f,ctx:r}),e.$set(u);const m={};!a&&f&2&&(a=!0,m.posts=r[1],W(()=>a=!1)),!o&&f&32&&(o=!0,m.keyboardY=r[5],W(()=>o=!1)),i.$set(m)},i(r){l||(D(e.$$.fragment,r),D(i.$$.fragment,r),D(n.$$.fragment,r),l=!0)},o(r){A(e.$$.fragment,r),A(i.$$.fragment,r),A(n.$$.fragment,r),l=!1},d(r){r&&($(t),$(g)),z(e,r),z(i,r),z(n,r)}}}function Le(s){let e,t,i,a,o,g,n,l,c,p,b=(s[2]||"텍스트 입력하기...")+"",r,f,u,m,h,E,x,S,w,J,C;t=new ke({props:{position:"static",leftBack:"white",$$slots:{right:[Re]},$$scope:{ctx:s}}});function I(_){s[14](_)}function N(_){s[15](_)}let O={dontMoveVertically:!0,isEdit:!0};return s[1]!==void 0&&(O.posts=s[1]),s[5]!==void 0&&(O.keyboardY=s[5]),o=new we({props:O}),G.push(()=>Q(o,"posts",I)),G.push(()=>Q(o,"keyboardY",N)),h=new Je({props:{items:[{id:1,title:"장소",value:s[1][0].place_name||""},{id:2,title:"공개 여부",value:ue[s[4]],onClick:s[18]}]}}),S=new Oe({}),{c(){e=V("section"),j(t.$$.fragment),i=T(),a=V("div"),j(o.$$.fragment),l=T(),c=V("div"),p=V("div"),r=ne(b),u=T(),m=V("div"),j(h.$$.fragment),E=T(),x=V("div"),j(S.$$.fragment),this.h()},l(_){e=B(_,"SECTION",{class:!0});var v=P(e);F(t.$$.fragment,v),i=Y(v),a=B(v,"DIV",{class:!0});var L=P(a);F(o.$$.fragment,L),L.forEach($),l=Y(v),c=B(v,"DIV",{class:!0});var K=P(c);p=B(K,"DIV",{contenteditable:!0,class:!0});var q=P(p);r=ae(q,b),q.forEach($),K.forEach($),u=Y(v),m=B(v,"DIV",{class:!0});var U=P(m);F(h.$$.fragment,U),U.forEach($),E=Y(v),x=B(v,"DIV",{class:!0});var d=P(x);F(S.$$.fragment,d),d.forEach($),v.forEach($),this.h()},h(){k(a,"class","flex flex-grow"),k(p,"contenteditable","true"),k(p,"class",f=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${s[6]?"text-gray-400":"text-white"}
        `),k(c,"class","h-32 px-5 py-2.5"),k(m,"class",""),k(x,"class","h-40"),k(e,"class","flex flex-col w-full h-screen bg-black")},m(_,v){H(_,e,v),M(t,e,null),y(e,i),y(e,a),M(o,a,null),y(e,l),y(e,c),y(c,p),y(p,r),y(e,u),y(e,m),M(h,m,null),y(e,E),y(e,x),M(S,x,null),w=!0,J||(C=[R(p,"input",s[10]),R(p,"focus",s[16]),R(p,"blur",s[17])],J=!0)},p(_,v){const L={};v&536870913&&(L.$$scope={dirty:v,ctx:_}),t.$set(L);const K={};!g&&v&2&&(g=!0,K.posts=_[1],W(()=>g=!1)),!n&&v&32&&(n=!0,K.keyboardY=_[5],W(()=>n=!1)),o.$set(K),(!w||v&4)&&b!==(b=(_[2]||"텍스트 입력하기...")+"")&&Ae(r,b),(!w||v&64&&f!==(f=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${_[6]?"text-gray-400":"text-white"}
        `))&&k(p,"class",f);const q={};v&26&&(q.items=[{id:1,title:"장소",value:_[1][0].place_name||""},{id:2,title:"공개 여부",value:ue[_[4]],onClick:_[18]}]),h.$set(q)},i(_){w||(D(t.$$.fragment,_),D(o.$$.fragment,_),D(h.$$.fragment,_),D(S.$$.fragment,_),w=!0)},o(_){A(t.$$.fragment,_),A(o.$$.fragment,_),A(h.$$.fragment,_),A(S.$$.fragment,_),w=!1},d(_){_&&$(e),z(t),z(o),z(h),z(S),J=!1,Ee(C)}}}function qe(s){let e,t="완료",i,a;return{c(){e=V("div"),e.textContent=t,this.h()},l(o){e=B(o,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),be(e)!=="svelte-11t55ng"&&(e.textContent=t),this.h()},h(){k(e,"slot","right"),k(e,"class","text-white")},m(o,g){H(o,e,g),i||(a=R(e,"click",s[19]),i=!0)},p:ee,d(o){o&&$(e),i=!1,a()}}}function Re(s){let e,t="다음",i,a;return{c(){e=V("div"),e.textContent=t,this.h()},l(o){e=B(o,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),be(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){k(e,"slot","right"),k(e,"class","text-white")},m(o,g){H(o,e,g),i||(a=R(e,"click",s[13]),i=!0)},p:ee,d(o){o&&$(e),i=!1,a()}}}function Ge(s){let e,t,i,a,o,g,n;const l=[Le,Ke],c=[];function p(u,m){return u[0]===0?0:u[0]===1?1:-1}~(e=p(s))&&(t=c[e]=l[e](s));function b(u){s[22](u)}function r(u){s[23](u)}let f={};return s[3]!==void 0&&(f.isOpen=s[3]),s[4]!==void 0&&(f.selectedVisibility=s[4]),a=new Te({props:f}),G.push(()=>Q(a,"isOpen",b)),G.push(()=>Q(a,"selectedVisibility",r)),{c(){t&&t.c(),i=T(),j(a.$$.fragment)},l(u){t&&t.l(u),i=Y(u),F(a.$$.fragment,u)},m(u,m){~e&&c[e].m(u,m),H(u,i,m),M(a,u,m),n=!0},p(u,[m]){let h=e;e=p(u),e===h?~e&&c[e].p(u,m):(t&&(oe(),A(c[h],1,1,()=>{c[h]=null}),le()),~e?(t=c[e],t?t.p(u,m):(t=c[e]=l[e](u),t.c()),D(t,1),t.m(i.parentNode,i)):t=null);const E={};!o&&m&8&&(o=!0,E.isOpen=u[3],W(()=>o=!1)),!g&&m&16&&(g=!0,E.selectedVisibility=u[4],W(()=>g=!1)),a.$set(E)},i(u){n||(D(t),D(a.$$.fragment,u),n=!0)},o(u){A(t),A(a.$$.fragment,u),n=!1},d(u){u&&$(i),~e&&c[e].d(u),z(a,u)}}}function We(s){const e=s.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function Qe(s){const e=s.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function Ue(s,e,t){let i,a,o;fe(s,Se,d=>t(25,a=d)),fe(s,he,d=>t(12,o=d));const g=Ce.getPlatform()!=="web",n=a.url.searchParams.get("type");let l=0,{data:c}=e,p=c.posts,b=p[0].text||"",r=!1,f="public";async function u(){const d=p==null?void 0:p.at(0);(await fetch(`${se}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${re()}`},body:JSON.stringify({placeIdx:d.place_idx,text:b,media:i,permission:f})})).ok&&await Z(`/places/${d.place_idx}`,{replaceState:!0,invalidateAll:!0})}async function m(){try{const d=await fetch(`${se}/posts/${a.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${re()}`},body:JSON.stringify({text:b})});if(!d.ok){(await d.json()).status===401&&(me.emit("pushSnackbar",{message:"접근할 수 없습니다"}),Z(`/viewer?postIdx=${a.url.searchParams.get("postIdx")}`));return}await Z("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let h=0;function E(){ie.addListener("keyboardWillShow",d=>{t(5,h=d.keyboardHeight*-1)}),ie.addListener("keyboardWillHide",()=>{t(5,h=0)})}function x(){ie.removeAllListeners()}Be(()=>{g&&E()}),De(()=>{g&&x()});function S(d){const te=d.target;t(2,b=te.innerText),t(1,p[0]={...p[0],text:b},p)}let w=b.trim()==="";const J=()=>{t(0,l=1)};function C(d){p=d,t(1,p)}function I(d){h=d,t(5,h)}const N=d=>{We(d),t(6,w=!1)},O=d=>{Qe(d),t(6,w=!b.trim())},_=()=>{t(3,r=!0)},v=()=>{n==="post"?u():n==="patch"&&m()};function L(d){p=d,t(1,p)}function K(d){h=d,t(5,h)}function q(d){r=d,t(3,r)}function U(d){f=d,t(4,f)}return s.$$set=d=>{"data"in d&&t(11,c=d.data)},s.$$.update=()=>{s.$$.dirty&4096&&(i=o)},[l,p,b,r,f,h,w,n,u,m,S,c,o,J,C,I,N,O,_,v,L,K,q,U]}class _t extends ve{constructor(e){super(),$e(this,e,Ue,Ge,ge,{data:11})}}export{_t as component,pt as universal};
