import{s as Q,e as M,c as T,b as R,f as I,P as V,i as w,y as v,G as y,H as te,D as se,I as z,a as B,A as H,g as L,k as C,q as ne,r as re,x as D,h as O,n as N}from"../chunks/scheduler.B6RFReyk.js";import{S as W,i as X,c as E,b as j,m as x,t as g,a as $,d as P,f as q,g as F}from"../chunks/index.DLC1-nrr.js";import{H as oe,I as ae}from"../chunks/Header.DwDN9eoa.js";import{V as ie}from"../chunks/Viewer.B--DGS5m.js";import{g as le}from"../chunks/entry.CNKC8QBQ.js";import{d as ce,f as J,A as K}from"../chunks/sign.DAu4KAMA.js";/* empty css                                                   *//* empty css                                                     */import{p as fe}from"../chunks/stores.dPe_C5Z7.js";import{N as me}from"../chunks/NavigationBar.CxvNezLZ.js";import"../chunks/ActionSheet.Cc-yrJos.js";/* empty css                                                   */import{M as ue}from"../chunks/Mask.CDgatY7I.js";import{P as pe}from"../chunks/picker.DO1g6OCe.js";import{I as de}from"../chunks/IconAlarmLine.D8fyXQsx.js";function he(o){let e,s,t;return{c(){e=M("emoji-picker"),this.h()},l(n){e=T(n,"EMOJI-PICKER",{"aria-hidden":!0,class:!0}),R(e).forEach(I),this.h()},h(){V(e,"aria-hidden",""),V(e,"class",o[0])},m(n,a){w(n,e,a),s||(t=[v(e,"emoji-click",y(te(o[2]))),v(e,"touchstart",y(o[4])),v(e,"touchend",y(o[5]))],s=!0)},p(n,a){a&1&&V(e,"class",n[0])},d(n){n&&I(e),s=!1,se(t)}}}function _e(o){let e,s;return e=new ue({props:{onMask:!0,position:"absolute",onTouch:o[6],$$slots:{default:[he]},$$scope:{ctx:o}}}),{c(){E(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,n){x(e,t,n),s=!0},p(t,[n]){const a={};n&2&&(a.onTouch=t[6]),n&257&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){s||(g(e.$$.fragment,t),s=!0)},o(t){$(e.$$.fragment,t),s=!1},d(t){P(e,t)}}}function ge(o,e,s){let{classList:t}=e,{onSelect:n}=e,{close:a}=e;function c(i){n(i.detail.unicode)}new pe({emojiVersion:15});function d(i){z.call(this,o,i)}function h(i){z.call(this,o,i)}const l=()=>{a()};return o.$$set=i=>{"classList"in i&&s(0,t=i.classList),"onSelect"in i&&s(3,n=i.onSelect),"close"in i&&s(1,a=i.close)},[t,a,c,n,d,h,l]}class $e extends W{constructor(e){super(),X(this,e,ge,_e,Q,{classList:0,onSelect:3,close:1})}}function Ie(o){let e,s,t,n,a,c,d,h;return s=new de({props:{length:"1.5",fill:"white"}}),a=new ae({props:{fill:"white",alt:"search"}}),{c(){e=M("div"),E(s.$$.fragment),t=B(),n=M("button"),E(a.$$.fragment),this.h()},l(l){e=T(l,"DIV",{slot:!0,class:!0});var i=R(e);j(s.$$.fragment,i),t=L(i),n=T(i,"BUTTON",{});var _=R(n);j(a.$$.fragment,_),_.forEach(I),i.forEach(I),this.h()},h(){D(e,"slot","right"),D(e,"class","flex items-center gap-2")},m(l,i){w(l,e,i),x(s,e,null),O(e,t),O(e,n),x(a,n,null),c=!0,d||(h=v(n,"click",o[8]),d=!0)},p:N,i(l){c||(g(s.$$.fragment,l),g(a.$$.fragment,l),c=!0)},o(l){$(s.$$.fragment,l),$(a.$$.fragment,l),c=!1},d(l){l&&I(e),P(s),P(a),d=!1,h()}}}function be(o){let e,s;return e=new ie({props:{posts:o[0].posts,index:o[0].index,selectedReaction:o[1]}}),{c(){E(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,n){x(e,t,n),s=!0},p(t,n){const a={};n&1&&(a.posts=t[0].posts),n&1&&(a.index=t[0].index),n&2&&(a.selectedReaction=t[1]),e.$set(a)},i(t){s||(g(e.$$.fragment,t),s=!0)},o(t){$(e.$$.fragment,t),s=!1},d(t){P(e,t)}}}function ke(o){let e;return{c(){e=M("div"),this.h()},l(s){e=T(s,"DIV",{class:!0}),R(e).forEach(I),this.h()},h(){D(e,"class","w-full h-full")},m(s,t){w(s,e,t)},p:N,i:N,o:N,d(s){s&&I(e)}}}function U(o){let e,s;return e=new $e({props:{classList:"absolute bottom-24 right-0 px-4 z-50",onSelect:o[4],close:o[9]}}),{c(){E(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,n){x(e,t,n),s=!0},p:N,i(t){s||(g(e.$$.fragment,t),s=!0)},o(t){$(e.$$.fragment,t),s=!1},d(t){P(e,t)}}}function we(o){let e,s,t,n,a,c,d,h,l;e=new oe({props:{position:"fixed",leftBack:o[2]?"":"white",$$slots:{right:[Ie]},$$scope:{ctx:o}}});const i=[ke,be],_=[];function b(r,m){return r[0].posts.length===0?0:1}t=b(o),n=_[t]=i[t](o),c=new me({});let f=o[3]&&U(o);return{c(){E(e.$$.fragment),s=B(),n.c(),a=B(),E(c.$$.fragment),d=B(),f&&f.c(),h=H()},l(r){j(e.$$.fragment,r),s=L(r),n.l(r),a=L(r),j(c.$$.fragment,r),d=L(r),f&&f.l(r),h=H()},m(r,m){x(e,r,m),w(r,s,m),_[t].m(r,m),w(r,a,m),x(c,r,m),w(r,d,m),f&&f.m(r,m),w(r,h,m),l=!0},p(r,[m]){const u={};m&4&&(u.leftBack=r[2]?"":"white"),m&8192&&(u.$$scope={dirty:m,ctx:r}),e.$set(u);let k=t;t=b(r),t===k?_[t].p(r,m):(F(),$(_[k],1,1,()=>{_[k]=null}),q(),n=_[t],n?n.p(r,m):(n=_[t]=i[t](r),n.c()),g(n,1),n.m(a.parentNode,a)),r[3]?f?(f.p(r,m),m&8&&g(f,1)):(f=U(r),f.c(),g(f,1),f.m(h.parentNode,h)):f&&(F(),$(f,1,1,()=>{f=null}),q())},i(r){l||(g(e.$$.fragment,r),g(n),g(c.$$.fragment,r),g(f),l=!0)},o(r){$(e.$$.fragment,r),$(n),$(c.$$.fragment,r),$(f),l=!1},d(r){r&&(I(s),I(a),I(d),I(h)),P(e,r),_[t].d(r),P(c,r),f&&f.d(r)}}}function Ee(o,e,s){let t,n,a,c,d,h;C(o,fe,u=>s(7,c=u)),C(o,ce,u=>s(11,d=u)),C(o,J,u=>s(3,h=u));let l={posts:[],index:0};const i=sessionStorage.getItem("jwt");let _,b;ne(async()=>{const u=Number(c.url.searchParams.get("postIdx")||0);Number(c.url.searchParams.get("mediaIdx")||0);const k=0,Y=30,Z=`&offset=${k}`,ee=`&limit=${Y}`;let S=[];(n||t)&&d.length>0?(S=d.map(p=>p.idx===u?{...p,mediaIdx:p.mediaIdx||0}:{...p,mediaIdx:0}),s(0,l.index=S.findIndex(p=>p.idx===String(u)),l)):(b=new AbortController,u&&(S=[await fetch(`${K}/posts/${u}`,{method:"GET",headers:{Authorization:"Bearer "+i},signal:b.signal}).then(p=>p.json()).then(p=>({...p.data,mediaIdx:p.data.mediaIdx||0}))]),S=[...S,...await fetch(`${K}/posts?${Z}${ee}`,{method:"GET",headers:{Authorization:"Bearer "+i},signal:b.signal}).then(p=>p.json()).then(p=>{var G;return(G=p.data)==null?void 0:G.posts.filter(A=>A.idx!==String(u)).map(A=>({...A,mediaIdx:A.mediaIdx||0}))})||[]]),s(0,l.posts=S,l)}),re(()=>{b&&b.abort()});async function f(u){const k=c.url.searchParams.get("postIdx");k&&s(1,_={postIdx:k,reaction:u})}const r=async()=>{await le("/search")},m=()=>{J.set(!1)};return o.$$.update=()=>{o.$$.dirty&128&&s(5,t=c.url.searchParams.get("placeIdx")),o.$$.dirty&128&&s(6,n=c.url.searchParams.get("userIdx")),o.$$.dirty&96&&s(2,a=!t&&!n)},[l,_,a,h,f,t,n,c,r,m]}class De extends W{constructor(e){super(),X(this,e,Ee,we,Q,{})}}export{De as component};
