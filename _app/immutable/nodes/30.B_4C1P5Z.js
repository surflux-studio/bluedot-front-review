import{m as Ve,e as G,A as oe,g as le,n as ke,C as Se,o as _e,p as re,k as me}from"../chunks/sign.Dh6oTB_X.js";import{e as te}from"../chunks/index.g5YcAAdQ.js";import{l as Pe,s as we,e as A,c as E,b as x,f as v,v as k,i as z,t as ue,a as T,d as ce,g as Y,h as $,B as W,R as xe,j as he,n as fe,w as Q,x as U,k as se,y as Ne,z as Oe,O as ne,V as Te,F as Ye,A as ye,H as ge}from"../chunks/scheduler.BVPf9D5l.js";import{g as ie}from"../chunks/entry.065KSUm9.js";import{S as $e,i as Be,g as pe,f as de,t as V,a as S,c as j,d as F,m as M,e as H,b as X}from"../chunks/index.CyEs2R8T.js";import{H as De}from"../chunks/Header.D1U0DLlI.js";import{V as Ie}from"../chunks/Viewer.BYJuVL-f.js";/* empty css                                                   */import{p as je}from"../chunks/stores.R4GZrN42.js";import{K as ae}from"../chunks/ActionSheet.DtN69HrT.js";import{e as be,u as Fe,o as Me}from"../chunks/each.Vm2qp2eY.js";import{I as He}from"../chunks/IconChevronRight.5YVw89ub.js";import{B as ze}from"../chunks/BottomNavigationPadder.Bq4mOP7_.js";import{V as Le}from"../chunks/VisibilitySheet.BNdAKOJC.js";import{N as Je}from"../chunks/NavigationBar.BAoOI6VZ.js";const Ke=async({fetch:i,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return te(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const s=Ve();return{posts:[{user_idx:s==null?void 0:s.sub,unique_name:s==null?void 0:s.uni,profile_image_url:s==null?void 0:s.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Pe(ke),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const s=e.searchParams.get("postIdx");if(s==="null")return G.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),ie("/viewer",{replaceState:!0});s||te(404,"Not Found");const o=await i(`${oe}/posts/${s}`,{method:"GET",headers:{Authorization:"Bearer "+le()}}).then(n=>n.json()).then(n=>n.data);return o.error&&te(404,"Not Found"),{posts:[{...o,mediaIdx:0}]}}return te(404,"Not Found")},Ct=Object.freeze(Object.defineProperty({__proto__:null,load:Ke},Symbol.toStringTag,{value:"Module"}));function ve(i,e,t){const s=i.slice();return s[1]=e[t],s[3]=t,s}function Re(i){let e;return{c(){e=A("div"),this.h()},l(t){e=E(t,"DIV",{class:!0}),x(e).forEach(v),this.h()},h(){k(e,"class","w-0.5")},m(t,s){z(t,e,s)},i:fe,o:fe,d(t){t&&v(e)}}}function qe(i){let e,t;return e=new He({props:{fill:"#6B7280",length:"1.25"}}),{c(){j(e.$$.fragment)},l(s){F(e.$$.fragment,s)},m(s,o){M(e,s,o),t=!0},i(s){t||(V(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Ce(i,e){let t,s,o=e[1].title+"",n,_,a,u,p=e[1].value+"",g,C,r,f,l,m,h,B,P;const w=[qe,Re],D=[];function L(I,y){return I[1].onClick?0:1}return r=L(e),f=D[r]=w[r](e),{key:i,first:null,c(){t=A("div"),s=A("span"),n=ue(o),_=T(),a=A("div"),u=A("span"),g=ue(p),C=T(),f.c(),l=T(),this.h()},l(I){t=E(I,"DIV",{class:!0});var y=x(t);s=E(y,"SPAN",{class:!0});var N=x(s);n=ce(N,o),N.forEach(v),_=Y(y),a=E(y,"DIV",{class:!0});var O=x(a);u=E(O,"SPAN",{class:!0});var d=x(u);g=ce(d,p),d.forEach(v),C=Y(O),f.l(O),O.forEach(v),l=Y(y),y.forEach(v),this.h()},h(){k(s,"class","text-white text-sm font-medium"),k(u,"class","text-gray-500 text-xs"),k(a,"class","flex items-center gap-2"),k(t,"class",m=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(I,y){z(I,t,y),$(t,s),$(s,n),$(t,_),$(t,a),$(a,u),$(u,g),$(a,C),D[r].m(a,null),$(t,l),h=!0,B||(P=W(t,"click",function(){xe(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),B=!0)},p(I,y){e=I,(!h||y&1)&&o!==(o=e[1].title+"")&&he(n,o),(!h||y&1)&&p!==(p=e[1].value+"")&&he(g,p);let N=r;r=L(e),r!==N&&(pe(),S(D[N],1,1,()=>{D[N]=null}),de(),f=D[r],f||(f=D[r]=w[r](e),f.c()),V(f,1),f.m(a,null)),(!h||y&1&&m!==(m=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&k(t,"class",m)},i(I){h||(V(f),h=!0)},o(I){S(f),h=!1},d(I){I&&v(t),D[r].d(),B=!1,P()}}}function Ge(i){let e,t=[],s=new Map,o,n=be(i[0]);const _=a=>a[1].id;for(let a=0;a<n.length;a+=1){let u=ve(i,n,a),p=_(u);s.set(p,t[a]=Ce(p,u))}return{c(){e=A("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=E(a,"DIV",{class:!0});var u=x(e);for(let p=0;p<t.length;p+=1)t[p].l(u);u.forEach(v),this.h()},h(){k(e,"class","flex flex-col w-full")},m(a,u){z(a,e,u);for(let p=0;p<t.length;p+=1)t[p]&&t[p].m(e,null);o=!0},p(a,[u]){u&1&&(n=be(a[0]),pe(),t=Fe(t,u,_,1,a,n,s,e,Me,Ce,null,ve),de())},i(a){if(!o){for(let u=0;u<n.length;u+=1)V(t[u]);o=!0}},o(a){for(let u=0;u<t.length;u+=1)S(t[u]);o=!1},d(a){a&&v(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function We(i,e,t){let{items:s=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return i.$$set=o=>{"items"in o&&t(0,s=o.items)},[s]}class Qe extends $e{constructor(e){super(),Be(this,e,We,Ge,we,{items:0})}}function Ue(i){let e,t,s,o,n,_,a,u;e=new De({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",$$slots:{right:[Ze]},$$scope:{ctx:i}}});function p(r){i[21](r)}function g(r){i[22](r)}let C={dontMoveVertically:!0,hideActionButtons:!0};return i[1]!==void 0&&(C.posts=i[1]),i[6]!==void 0&&(C.keyboardY=i[6]),s=new Ie({props:C}),Q.push(()=>X(s,"posts",p)),Q.push(()=>X(s,"keyboardY",g)),a=new Je({}),{c(){j(e.$$.fragment),t=T(),j(s.$$.fragment),_=T(),j(a.$$.fragment)},l(r){F(e.$$.fragment,r),t=Y(r),F(s.$$.fragment,r),_=Y(r),F(a.$$.fragment,r)},m(r,f){M(e,r,f),z(r,t,f),M(s,r,f),z(r,_,f),M(a,r,f),u=!0},p(r,f){const l={};f[0]&32|f[1]&2&&(l.$$scope={dirty:f,ctx:r}),e.$set(l);const m={};!o&&f[0]&2&&(o=!0,m.posts=r[1],U(()=>o=!1)),!n&&f[0]&64&&(n=!0,m.keyboardY=r[6],U(()=>n=!1)),s.$set(m)},i(r){u||(V(e.$$.fragment,r),V(s.$$.fragment,r),V(a.$$.fragment,r),u=!0)},o(r){S(e.$$.fragment,r),S(s.$$.fragment,r),S(a.$$.fragment,r),u=!1},d(r){r&&(v(t),v(_)),H(e,r),H(s,r),H(a,r)}}}function Xe(i){let e,t,s,o,n,_,a,u,p,g,C=(i[2]||"텍스트 입력하기...")+"",r,f,l,m,h,B,P,w,D,L,I;t=new De({props:{position:"static",leftBack:"white",$$slots:{right:[et]},$$scope:{ctx:i}}});function y(d){i[15](d)}function N(d){i[16](d)}let O={dontMoveVertically:!0,isEdit:!0};return i[1]!==void 0&&(O.posts=i[1]),i[6]!==void 0&&(O.keyboardY=i[6]),n=new Ie({props:O}),Q.push(()=>X(n,"posts",y)),Q.push(()=>X(n,"keyboardY",N)),h=new Qe({props:{items:[{id:1,title:"장소",value:i[1][0].place_name||""},{id:2,title:"공개 여부",value:me[i[4]],onClick:i[19]}]}}),w=new ze({}),{c(){e=A("section"),j(t.$$.fragment),s=T(),o=A("div"),j(n.$$.fragment),u=T(),p=A("div"),g=A("div"),r=ue(C),l=T(),m=A("div"),j(h.$$.fragment),B=T(),P=A("div"),j(w.$$.fragment),this.h()},l(d){e=E(d,"SECTION",{class:!0});var b=x(e);F(t.$$.fragment,b),s=Y(b),o=E(b,"DIV",{class:!0});var K=x(o);F(n.$$.fragment,K),K.forEach(v),u=Y(b),p=E(b,"DIV",{class:!0});var J=x(p);g=E(J,"DIV",{contenteditable:!0,class:!0});var R=x(g);r=ce(R,C),R.forEach(v),J.forEach(v),l=Y(b),m=E(b,"DIV",{class:!0});var Z=x(m);F(h.$$.fragment,Z),Z.forEach(v),B=Y(b),P=E(b,"DIV",{class:!0});var ee=x(P);F(w.$$.fragment,ee),ee.forEach(v),b.forEach(v),this.h()},h(){k(o,"class","flex flex-grow"),k(g,"contenteditable","true"),k(g,"class",f=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${i[7]?"text-gray-400":"text-white"}
        `),k(p,"class","h-32 px-5 py-2.5"),k(m,"class",""),k(P,"class","h-40"),k(e,"class","flex flex-col w-full h-screen bg-black")},m(d,b){z(d,e,b),M(t,e,null),$(e,s),$(e,o),M(n,o,null),$(e,u),$(e,p),$(p,g),$(g,r),$(e,l),$(e,m),M(h,m,null),$(e,B),$(e,P),M(w,P,null),D=!0,L||(I=[W(g,"input",i[11]),W(g,"focus",i[17]),W(g,"blur",i[18])],L=!0)},p(d,b){const K={};b[0]&1|b[1]&2&&(K.$$scope={dirty:b,ctx:d}),t.$set(K);const J={};!_&&b[0]&2&&(_=!0,J.posts=d[1],U(()=>_=!1)),!a&&b[0]&64&&(a=!0,J.keyboardY=d[6],U(()=>a=!1)),n.$set(J),(!D||b[0]&4)&&C!==(C=(d[2]||"텍스트 입력하기...")+"")&&Te(r,C),(!D||b[0]&128&&f!==(f=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${d[7]?"text-gray-400":"text-white"}
        `))&&k(g,"class",f);const R={};b[0]&26&&(R.items=[{id:1,title:"장소",value:d[1][0].place_name||""},{id:2,title:"공개 여부",value:me[d[4]],onClick:d[19]}]),h.$set(R)},i(d){D||(V(t.$$.fragment,d),V(n.$$.fragment,d),V(h.$$.fragment,d),V(w.$$.fragment,d),D=!0)},o(d){S(t.$$.fragment,d),S(n.$$.fragment,d),S(h.$$.fragment,d),S(w.$$.fragment,d),D=!1},d(d){d&&v(e),H(t),H(n),H(h),H(w),L=!1,Ye(I)}}}function Ze(i){let e,t="완료",s,o;return{c(){e=A("div"),e.textContent=t,this.h()},l(n){e=E(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-yednau"&&(e.textContent=t),this.h()},h(){k(e,"slot","right"),k(e,"class","text-white"),ge(e,"opacity-50",i[5])},m(n,_){z(n,e,_),s||(o=W(e,"click",i[20]),s=!0)},p(n,_){_[0]&32&&ge(e,"opacity-50",n[5])},d(n){n&&v(e),s=!1,o()}}}function et(i){let e,t="다음",s,o;return{c(){e=A("div"),e.textContent=t,this.h()},l(n){e=E(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ye(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){k(e,"slot","right"),k(e,"class","text-white")},m(n,_){z(n,e,_),s||(o=W(e,"click",i[14]),s=!0)},p:fe,d(n){n&&v(e),s=!1,o()}}}function tt(i){let e,t,s,o,n,_,a;const u=[Xe,Ue],p=[];function g(l,m){return l[0]===0?0:l[0]===1?1:-1}~(e=g(i))&&(t=p[e]=u[e](i));function C(l){i[23](l)}function r(l){i[24](l)}let f={};return i[3]!==void 0&&(f.isOpen=i[3]),i[4]!==void 0&&(f.selectedVisibility=i[4]),o=new Le({props:f}),Q.push(()=>X(o,"isOpen",C)),Q.push(()=>X(o,"selectedVisibility",r)),{c(){t&&t.c(),s=T(),j(o.$$.fragment)},l(l){t&&t.l(l),s=Y(l),F(o.$$.fragment,l)},m(l,m){~e&&p[e].m(l,m),z(l,s,m),M(o,l,m),a=!0},p(l,m){let h=e;e=g(l),e===h?~e&&p[e].p(l,m):(t&&(pe(),S(p[h],1,1,()=>{p[h]=null}),de()),~e?(t=p[e],t?t.p(l,m):(t=p[e]=u[e](l),t.c()),V(t,1),t.m(s.parentNode,s)):t=null);const B={};!n&&m[0]&8&&(n=!0,B.isOpen=l[3],U(()=>n=!1)),!_&&m[0]&16&&(_=!0,B.selectedVisibility=l[4],U(()=>_=!1)),o.$set(B)},i(l){a||(V(t),V(o.$$.fragment,l),a=!0)},o(l){S(t),S(o.$$.fragment,l),a=!1},d(l){l&&v(s),~e&&p[e].d(l),H(o,l)}}}function st(i){const e=i.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function it(i){const e=i.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function rt(i,e,t){let s,o,n,_,a;se(i,_e,c=>t(26,o=c)),se(i,re,c=>t(27,n=c)),se(i,je,c=>t(28,_=c)),se(i,ke,c=>t(13,a=c));const u=Se.getPlatform()!=="web",p=_.url.searchParams.get("type");let g=0,{data:C}=e,r=C.posts,f="",l=!1,m="public",h=!1;async function B(){try{const c=r==null?void 0:r.at(0);(await fetch(`${oe}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le()}`},body:JSON.stringify({placeIdx:c.place_idx,text:f,media:s,permission:m})})).ok&&await ie(`/places/${c.place_idx}`,{replaceState:!0,invalidateAll:!0})}catch(c){console.error(c),G.emit("pushSnackbar",{message:"게시글 업로드에 실패했습니다"})}}async function P(){try{const c=await fetch(`${oe}/posts/${_.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${le()}`},body:JSON.stringify({text:f})});if(!c.ok){(await c.json()).status===401&&(G.emit("pushSnackbar",{message:"접근할 수 없습니다"}),ie(`/viewer?postIdx=${_.url.searchParams.get("postIdx")}`));return}await ie("/users/0",{replaceState:!0,invalidateAll:!0})}catch(c){console.error(c),G.emit("pushSnackbar",{message:"게시글 수정에 실패했습니다"})}}let w=0;function D(){ae.addListener("keyboardWillShow",c=>{t(6,w=c.keyboardHeight*-1)}),ae.addListener("keyboardWillHide",()=>{t(6,w=0)})}function L(){ae.removeAllListeners()}Ne(()=>{var c,q;u&&D(),n?(t(2,f=n),ne(re,n="",n)):(c=B[0])!=null&&c.text&&t(2,f=(q=B[0])==null?void 0:q.text)}),Oe(()=>{u&&L(),ne(re,n="",n),ne(_e,o="",o)});function I(c){const q=c.target;t(2,f=q.innerText),t(1,r[0]={...r[0],text:f},r)}let y=f.trim()==="";const N=()=>{t(0,g=1)};function O(c){r=c,t(1,r)}function d(c){w=c,t(6,w)}const b=c=>{st(c),t(7,y=!1)},K=c=>{it(c),t(7,y=!f.trim())},J=()=>{t(3,l=!0)},R=async()=>{h||(t(5,h=!0),G.emit("loading",!0),p==="post"?await B():p==="patch"&&await P(),t(5,h=!1),G.emit("loading",!1))};function Z(c){r=c,t(1,r)}function ee(c){w=c,t(6,w)}function Ae(c){l=c,t(3,l)}function Ee(c){m=c,t(4,m)}return i.$$set=c=>{"data"in c&&t(12,C=c.data)},i.$$.update=()=>{i.$$.dirty[0]&8192&&(s=a)},[g,r,f,l,m,h,w,y,p,B,P,I,C,a,N,O,d,b,K,J,R,Z,ee,Ae,Ee]}class kt extends $e{constructor(e){super(),Be(this,e,rt,tt,we,{data:12},null,[-1,-1])}}export{kt as component,Ct as universal};
