import{g as I}from"../chunks/entry.Cn8bzhtR.js";import{s as D,a as N,D as E,g as P,i as $,f as d,k as V,y as A,B as C,e as B,t as H,c as F,b as M,d as q,v as S,h as z,n as O,A as K}from"../chunks/scheduler.DAfLlBmd.js";import{S as R,i as U,c as x,d as w,m as v,t as g,a as _,f as y}from"../chunks/index.CPgTt4Co.js";import{F as X,I as Z}from"../chunks/IconLocation.CTrPOXI4.js";import{H as G}from"../chunks/Header.D6D4iAqE.js";import{M as J}from"../chunks/Map.CSMsuf8p.js";import{N as Q}from"../chunks/NavigationBar.01Iv32ga.js";import{s as b,v as W}from"../chunks/map.CABo9SJ6.js";import{p as Y}from"../chunks/stores.BAQxrYTs.js";import{e as L}from"../chunks/emitter.E5P-NQ8u.js";import{f as tt}from"../chunks/proj.DXH8zrwl.js";import{s as T}from"../chunks/s32cloudfront.CfcW0GAj.js";import{i as et}from"../chunks/isVideoFile.DGBlGWVm.js";import{I as nt}from"../chunks/store.CJmM3jzm.js";const at=async({params:l,parent:t})=>{var o;if(l.idx==="-1")return I("/boxes");const n=await t();return n.error||!n.data?I("/boxes"):(o=n.data)!=null&&o.hasPermission?n.data:I(`/boxes/${l.idx}`)},kt=Object.freeze(Object.defineProperty({__proto__:null,load:at},Symbol.toStringTag,{value:"Module"}));function ot(l){let t,a=(l[0].name??"")+"",n;return{c(){t=B("p"),n=H(a),this.h()},l(o){t=F(o,"P",{class:!0});var r=M(t);n=q(r,a),r.forEach(d),this.h()},h(){S(t,"class","font-semibold text-[15px] leading-[18px] text-black")},m(o,r){$(o,t,r),z(t,n)},p:O,d(o){o&&d(t)}}}function rt(l){let t,a,n,o,r;return a=new Z({}),{c(){t=B("button"),x(a.$$.fragment),this.h()},l(i){t=F(i,"BUTTON",{slot:!0,class:!0});var m=M(t);w(a.$$.fragment,m),m.forEach(d),this.h()},h(){S(t,"slot","right"),S(t,"class","flex justify-center items-center w-10 h-10 rounded-full bg-[rgba(56,56,56,0.7)] pointer-events-auto")},m(i,m){$(i,t,m),v(a,t,null),n=!0,o||(r=K(t,"click",l[2]),o=!0)},p:O,i(i){n||(g(a.$$.fragment,i),n=!0)},o(i){_(a.$$.fragment,i),n=!1},d(i){i&&d(t),y(a),o=!1,r()}}}function it(l){let t,a;return t=new Q({}),{c(){x(t.$$.fragment)},l(n){w(t.$$.fragment,n)},m(n,o){v(t,n,o),a=!0},i(n){a||(g(t.$$.fragment,n),a=!0)},o(n){_(t.$$.fragment,n),a=!1},d(n){y(t,n)}}}function st(l){let t,a,n,o,r,i,m,p;t=new G({props:{position:"fixed",leftBack:"black",$$slots:{default:[ot]},$$scope:{ctx:l}}}),n=new J({}),r=new X({props:{position:"fixed",$$slots:{right:[rt]},$$scope:{ctx:l}}});let c=!nt&&it();return{c(){x(t.$$.fragment),a=N(),x(n.$$.fragment),o=N(),x(r.$$.fragment),i=N(),c&&c.c(),m=E()},l(e){w(t.$$.fragment,e),a=P(e),w(n.$$.fragment,e),o=P(e),w(r.$$.fragment,e),i=P(e),c&&c.l(e),m=E()},m(e,f){v(t,e,f),$(e,a,f),v(n,e,f),$(e,o,f),v(r,e,f),$(e,i,f),c&&c.m(e,f),$(e,m,f),p=!0},p(e,[f]){const u={};f&512&&(u.$$scope={dirty:f,ctx:e}),t.$set(u);const s={};f&512&&(s.$$scope={dirty:f,ctx:e}),r.$set(s)},i(e){p||(g(t.$$.fragment,e),g(n.$$.fragment,e),g(r.$$.fragment,e),g(c),p=!0)},o(e){_(t.$$.fragment,e),_(n.$$.fragment,e),_(r.$$.fragment,e),_(c),p=!1},d(e){e&&(d(a),d(o),d(i),d(m)),y(t,e),y(n,e),y(r,e),c&&c.d(e)}}}const k=60;function ft(l,t,a){let n;V(l,Y,u=>a(4,n=u));let{data:o}=t,r=o.box,i=o.places;A(async()=>{await c()}),C(()=>{b.un("change",e)});const m=[];let p=[];async function c(){var u;if(i.length!==0){p=i.filter(s=>!s.longitude||!s.latitude||m.includes(s.idx)?!1:(m.push(s.idx),!0)),!n.url.searchParams.get("location")&&p.length>0&&b.on("change",e);for await(let s of p){let h=(u=s.media)==null?void 0:u.at(0);if(!String(h).includes("youtu")){const j=T(h);await et(j)&&(h=h+"-thumbnail")}s.thumbnail=h}L.emit("addIcons",p.map(s=>({idx:Number(s.idx),coordinate:tt([s.longitude,s.latitude]),image:T(s.thumbnail||"",500),shape:"point",type:"place",link:`/places/${s.idx}?boxIdx=${r.idx}`,rank:1,name:s.name,width:38,height:46})))}}function e(){if(b.getFeatures().length!==p.length)return;b.un("change",e);const u=b.getExtent();W.fit(u,{padding:[k,k,k,k],duration:500,maxZoom:16})}const f=()=>{L.emit("flyToCurrentPosition")};return l.$$set=u=>{"data"in u&&a(1,o=u.data)},[r,o,f]}class It extends R{constructor(t){super(),U(this,t,ft,st,D,{data:1})}}export{It as component,kt as universal};
