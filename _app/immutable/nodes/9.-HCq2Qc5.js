import{g as le}from"../chunks/entry.B9SH3PBZ.js";import{g as Ve,e as R,k as Be,C as Pe,s as Ce,A as je}from"../chunks/sign.DGdpB9NJ.js";import{s as ze,y as he,e as v,a as A,t as Se,c as $,b as w,g as I,f as C,B as be,d as Ae,v as _,i as Y,h as p,N as Fe,A as ue,z as ge,j as Le,F as He,k as Me,n as ce,O as ye}from"../chunks/scheduler.CVGJxaOr.js";import{S as qe,i as Re,e as _e,c as U,b as J,m as G,a as P,f as Ue,t as j,d as W,g as Je}from"../chunks/index.1WceP6qL.js";import{H as Ge}from"../chunks/Header.QA-SyU_y.js";import{F as We}from"../chunks/Field.lhqZVZcd.js";import{g as Xe,t as Ke}from"../chunks/photo.BSLCVPMW.js";import{s as De}from"../chunks/s32cloudfront.BC_qV2gr.js";import{C as Qe}from"../chunks/CircleImage.Cp2cIWzb.js";import{V as Ye}from"../chunks/VisibilitySheet.BMT36yao.js";import{C as Ze,I as Ee,a as Ie}from"../chunks/IconCamera.D94Qxyd1.js";import{N as et}from"../chunks/NavigationBar.Bg5E0jmJ.js";const tt=async({params:n,parent:t})=>{var b;const e=n.idx,i=`/boxes/${e}`,o=e==="-1",r=Ve();if(r===null&&!o)return le(i,{replaceState:!0});if(o)return{box:{idx:"-1",name:"",description:"",image:null,role:null},jwt:r,paramIdx:e};const d=await t();if(d.error||!d.data)return R.emit("pushSnackbar",{message:"접근할 수 없습니다."}),le("/boxes",{replaceState:!0});const l=(b=d.data)==null?void 0:b.box;return(l==null?void 0:l.role)!=="owner"?(R.emit("pushSnackbar",{message:"접근할 수 없습니다."}),le(i,{replaceState:!0})):{box:l,jwt:r,paramIdx:e}},vt=Object.freeze(Object.defineProperty({__proto__:null,load:tt},Symbol.toStringTag,{value:"Module"}));function st(n){let t,e,i,o,r,d;return{c(){t=v("div"),e=v("button"),i=Se("완료"),this.h()},l(l){t=$(l,"DIV",{slot:!0});var b=w(t);e=$(b,"BUTTON",{class:!0});var a=w(e);i=Ae(a,"완료"),a.forEach(C),b.forEach(C),this.h()},h(){_(e,"class","font-medium text-sm leading-[17px] text-white disabled:text-[#3F3F3F] align-text-top"),e.disabled=o=n[0].name.trim()==="",_(t,"slot","right")},m(l,b){Y(l,t,b),p(t,e),p(e,i),r||(d=ue(e,"click",n[6]),r=!0)},p(l,b){b&1&&o!==(o=l[0].name.trim()==="")&&(e.disabled=o)},d(l){l&&C(t),r=!1,d()}}}function it(n){let t;return{c(){t=v("div"),this.h()},l(e){t=$(e,"DIV",{class:!0}),w(t).forEach(C),this.h()},h(){_(t,"class","w-full h-full bg-[#D9D9D9] rounded-full")},m(e,i){Y(e,t,i)},p:ce,i:ce,o:ce,d(e){e&&C(t)}}}function nt(n){let t,e;return t=new Qe({props:{src:De(n[0].image??"",500),width:"78px",strokeWidth:"0"}}),{c(){U(t.$$.fragment)},l(i){J(t.$$.fragment,i)},m(i,o){G(t,i,o),e=!0},p(i,o){const r={};o&1&&(r.src=De(i[0].image??"",500)),t.$set(r)},i(i){e||(j(t.$$.fragment,i),e=!0)},o(i){P(t.$$.fragment,i),e=!1},d(i){W(t,i)}}}function at(n){let t,e,i;return e=new Ie({props:{fill:"white",length:"1"}}),{c(){t=v("button"),U(e.$$.fragment),this.h()},l(o){t=$(o,"BUTTON",{class:!0});var r=w(t);J(e.$$.fragment,r),r.forEach(C),this.h()},h(){_(t,"class","absolute bottom-0 right-0 bg-[#3F3F3F] w-6 h-6 rounded-[40px] shadow-[1px_1px_6px_rgba(0,0,0,0.1)] flex justify-center items-center")},m(o,r){Y(o,t,r),G(e,t,null),i=!0},p:ce,i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){P(e.$$.fragment,o),i=!1},d(o){o&&C(t),W(e)}}}function ot(n){let t,e,i,o,r,d,l,b,a,D,x,B,O,ie="박스 이름",X,F,K,Z,E,T,ne='<p class="text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]">박스 설명</p>',ee,y,u,f,h,g="공개 여부",k,m,Q=Be[n[1]]+"",H,ae,M,oe,S,fe,me,te,de,xe;e=new Ge({props:{position:"static",leftBack:!0,centerTitle:n[3]?"박스 추가":"박스 편집",$$slots:{right:[st]},$$scope:{ctx:n}}});const ve=[nt,it],z=[];function $e(s,c){return s[0].image?0:1}d=$e(n),l=z[d]=ve[d](n),a=new Ze({props:{shrink:!1,className:"absolute",ydistance:14,items:n[4],$$slots:{default:[at]},$$scope:{ctx:n}}});function Oe(s){n[8](s)}let ke={padding:"",border:"border-b-[0.5px] border-[#3F3F3F] py-2.5",backgroundColor:"bg-transparent",fontSize:"text-sm font-normal leading-5",fontColor:"text-[#F1F1F1]",limit:20,useCounter:!1};n[0].name!==void 0&&(ke.value=n[0].name),F=new We({props:ke}),he.push(()=>_e(F,"value",Oe)),M=new et({});function Te(s){n[12](s)}function Ne(s){n[13](s)}let pe={onChange:n[11]};return n[2]!==void 0&&(pe.isOpen=n[2]),n[1]!==void 0&&(pe.selectedVisibility=n[1]),S=new Ye({props:pe}),he.push(()=>_e(S,"isOpen",Te)),he.push(()=>_e(S,"selectedVisibility",Ne)),{c(){t=v("div"),U(e.$$.fragment),i=A(),o=v("section"),r=v("div"),l.c(),b=A(),U(a.$$.fragment),D=A(),x=v("section"),B=v("section"),O=v("p"),O.textContent=ie,X=A(),U(F.$$.fragment),Z=A(),E=v("section"),T=v("div"),T.innerHTML=ne,ee=A(),y=v("textarea"),u=A(),f=v("section"),h=v("p"),h.textContent=g,k=A(),m=v("div"),H=Se(Q),ae=A(),U(M.$$.fragment),oe=A(),U(S.$$.fragment),this.h()},l(s){t=$(s,"DIV",{class:!0});var c=w(t);J(e.$$.fragment,c),i=I(c),o=$(c,"SECTION",{class:!0});var se=w(o);r=$(se,"DIV",{class:!0});var L=w(r);l.l(L),b=I(L),J(a.$$.fragment,L),L.forEach(C),se.forEach(C),D=I(c),x=$(c,"SECTION",{class:!0});var N=w(x);B=$(N,"SECTION",{class:!0});var q=w(B);O=$(q,"P",{class:!0,"data-svelte-h":!0}),be(O)!=="svelte-1kbmcgb"&&(O.textContent=ie),X=I(q),J(F.$$.fragment,q),q.forEach(C),Z=I(N),E=$(N,"SECTION",{class:!0});var V=w(E);T=$(V,"DIV",{class:!0,"data-svelte-h":!0}),be(T)!=="svelte-sqw6c9"&&(T.innerHTML=ne),ee=I(V),y=$(V,"TEXTAREA",{class:!0}),w(y).forEach(C),V.forEach(C),u=I(N),f=$(N,"SECTION",{class:!0});var re=w(f);h=$(re,"P",{class:!0,"data-svelte-h":!0}),be(h)!=="svelte-18l855b"&&(h.textContent=g),k=I(re),m=$(re,"DIV",{class:!0,"aria-hidden":!0});var we=w(m);H=Ae(we,Q),we.forEach(C),re.forEach(C),N.forEach(C),c.forEach(C),ae=I(s),J(M.$$.fragment,s),oe=I(s),J(S.$$.fragment,s),this.h()},h(){_(r,"class","w-[78px] h-[78px] relative"),_(o,"class","box-image relative w-full flex justify-center"),_(O,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),_(B,"class","box-name flex gap-[15px] h-10 items-center"),_(T,"class","flex-none h-10 flex items-center"),_(y,"class","auto-height w-full bg-transparent border-x-0 border-t-0 focus:ring-0 focus:border-[#3F3F3F] border-b-[0.5px] border-[#3F3F3F] py-2.5 px-0 text-sm font-normal leading-5 text-[#F1F1F1] resize-none svelte-oekuck"),_(E,"class","box-description flex gap-[15px] min-h-10 items-start"),_(h,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),_(m,"class","w-full border-b-[0.5px] border-[#3F3F3F] py-2.5 text-xs font-normal leading-4 text-gray-03 svelte-oekuck"),_(m,"aria-hidden",""),_(f,"class","box-name flex gap-[15px] h-10 items-center"),_(x,"class","box-setting p-5 text-white"),_(t,"class","min-h-dvh bg-black")},m(s,c){Y(s,t,c),G(e,t,null),p(t,i),p(t,o),p(o,r),z[d].m(r,null),p(r,b),G(a,r,null),p(t,D),p(t,x),p(x,B),p(B,O),p(B,X),G(F,B,null),p(x,Z),p(x,E),p(E,T),p(E,ee),p(E,y),Fe(y,n[0].description),p(x,u),p(x,f),p(f,h),p(f,k),p(f,m),p(m,H),Y(s,ae,c),G(M,s,c),Y(s,oe,c),G(S,s,c),te=!0,de||(xe=[ue(y,"input",n[9]),ue(y,"input",n[5]),ue(m,"click",n[10])],de=!0)},p(s,[c]){const se={};c&2097153&&(se.$$scope={dirty:c,ctx:s}),e.$set(se);let L=d;d=$e(s),d===L?z[d].p(s,c):(Je(),P(z[L],1,1,()=>{z[L]=null}),Ue(),l=z[d],l?l.p(s,c):(l=z[d]=ve[d](s),l.c()),j(l,1),l.m(r,b));const N={};c&2097152&&(N.$$scope={dirty:c,ctx:s}),a.$set(N);const q={};!K&&c&1&&(K=!0,q.value=s[0].name,ge(()=>K=!1)),F.$set(q),c&1&&Fe(y,s[0].description),(!te||c&2)&&Q!==(Q=Be[s[1]]+"")&&Le(H,Q);const V={};c&4&&(V.onChange=s[11]),!fe&&c&4&&(fe=!0,V.isOpen=s[2],ge(()=>fe=!1)),!me&&c&2&&(me=!0,V.selectedVisibility=s[1],ge(()=>me=!1)),S.$set(V)},i(s){te||(j(e.$$.fragment,s),j(l),j(a.$$.fragment,s),j(F.$$.fragment,s),j(M.$$.fragment,s),j(S.$$.fragment,s),te=!0)},o(s){P(e.$$.fragment,s),P(l),P(a.$$.fragment,s),P(F.$$.fragment,s),P(M.$$.fragment,s),P(S.$$.fragment,s),te=!1},d(s){s&&(C(t),C(ae),C(oe)),W(e),z[d].d(),W(a),W(F),W(M,s),W(S,s),de=!1,He(xe)}}}const rt=120;function lt(n,t,e){let i;Me(n,Ce,u=>e(14,i=u));const o=`${je}/boxes`;let{data:r}=t;const d=r.paramIdx,l=d==="-1";let b=r.jwt,a={...r.box,description:r.box.description??""},D=a.visibility??"follower",x=!1;async function B(){var f;const u=await Xe({limit:1});(f=u[0])!=null&&f.file&&X(u[0].file)}async function O(){var f;const u=await Ke();(f=u[0])!=null&&f.file&&X(u[0].file)}const ie=Pe.isNativePlatform()?[{name:"사진 선택",icon:Ee,onClick:B},{name:"사진 촬영",icon:Ie,onClick:O}]:[{name:"사진 선택",icon:Ee,onClick:B}];async function X(u){var f;try{const h=new FormData;h.append("image",u);const g=await fetch(`${o}/image`,{method:"POST",body:h,headers:{Authorization:`Bearer ${b}`}});if(!g.ok)return R.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});const m=(f=(await g.json()).data)==null?void 0:f.image;if(!m)return R.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});if(e(0,a.image=m,a),l)return;K()}catch{}}function F(){let u=a.description??"",f=0,h=0,g="";for(let k of u){let m=k.charCodeAt(0);if(m===10&&(f++,h=0),f===3)break;let H=m>=4352&&m<=4607||m>=12592&&m<=12687||m>=43360&&m<=43391||m>=44032&&m<=55215||m>=55216&&m<=55295?2:1;if(h+H>rt/3*(3-f))break;h+=H,g+=k}e(0,a.description=g,a)}async function K(){if(e(0,a.name=a.name.trim(),a),!a.name)return;const{url:u,method:f}=l?{url:o,method:"POST"}:{url:`${o}/${d}`,method:"PATCH"},h=await fetch(u,{method:f,headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify({name:a.name,description:a.description,image:a.image,visibility:D})});if(!h.ok)return R.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});l?(h.json().then(g=>{const k=g.data;k.role="owner",k.visibility=D,k.is_subcribed=!1,k.place_count="0",k.follower_count="0",ye(Ce,i=[k,...i],i)}),R.emit("pushSnackbar",{message:"새 박스를 만들었습니다"}),le("/boxes")):(ye(Ce,i=i.map(g=>(g.idx===a.idx&&(g.name=a.name,g.description=a.description,g.image=a.image,g.visibility=D),g)),i),R.emit("pushSnackbar",{message:"박스를 수정했습니다."}))}function Z(u){n.$$.not_equal(a.name,u)&&(a.name=u,e(0,a))}function E(){a.description=this.value,e(0,a)}const T=()=>e(2,x=!0),ne=()=>e(2,x=!1);function ee(u){x=u,e(2,x)}function y(u){D=u,e(1,D)}return n.$$set=u=>{"data"in u&&e(7,r=u.data)},[a,D,x,l,ie,F,K,r,Z,E,T,ne,ee,y]}class $t extends qe{constructor(t){super(),Re(this,t,lt,ot,ze,{data:7})}}export{$t as component,vt as universal};
