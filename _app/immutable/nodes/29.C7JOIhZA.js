import{s as z,m as ne,e as N,c as B,b as O,f as g,v as E,J as F,i as w,y as S,H as y,G as Y,u as oe,o as ie,p as ae,F as Z,I as G,U as A,a as D,D as U,g as L,k as R,w as re,B as le,h as ce,n as M}from"../chunks/scheduler.CbwPF6wx.js";import{S as H,i as J,t as b,a as I,c as $,b as P,m as v,e as T,d as q,g as K}from"../chunks/index.DiLw73rm.js";import{H as fe}from"../chunks/Header.DYE9AcUq.js";import{V as ue}from"../chunks/Viewer.Zsa7Pi2e.js";import{p as me}from"../chunks/stores.BlI0YQd1.js";import{N as de}from"../chunks/NavigationBar.CbS_PS8M.js";import{h as he,j as Q,g as _e,A as W}from"../chunks/sign.CS6T-EoU.js";import"../chunks/ActionSheet.svelte_svelte_type_style_lang.CWV4GBph.js";/* empty css                                                   */import{g as pe}from"../chunks/entry.EH7-kFbC.js";/* empty css                                                   */import{P as ge,S as ke}from"../chunks/index.CHUmxizJ.js";import{I as be}from"../chunks/IconSearch.DumFY3Ao.js";function Ie(o){let e,s,t,n,l;const f=o[5].default,r=ne(f,o,o[4],null);return{c(){e=N("div"),r&&r.c(),this.h()},l(a){e=B(a,"DIV",{id:!0,class:!0,"aria-hidden":!0});var u=O(e);r&&r.l(u),u.forEach(g),this.h()},h(){E(e,"id","mask"),E(e,"class",s=F(`${o[0]?"":"hidden"} ${o[1]}`)+" svelte-eerk6g"),E(e,"aria-hidden","")},m(a,u){w(a,e,u),r&&r.m(e,null),t=!0,n||(l=[S(e,"touchstart",y(Y(o[6]))),S(e,"touchend",o[7],{passive:!0}),S(e,"click",o[8])],n=!0)},p(a,[u]){r&&r.p&&(!t||u&16)&&oe(r,f,a,a[4],t?ae(f,a[4],u,null):ie(a[4]),null),(!t||u&3&&s!==(s=F(`${a[0]?"":"hidden"} ${a[1]}`)+" svelte-eerk6g"))&&E(e,"class",s)},i(a){t||(b(r,a),t=!0)},o(a){I(r,a),t=!1},d(a){a&&g(e),r&&r.d(a),n=!1,Z(l)}}}function we(o,e,s){let{$$slots:t={},$$scope:n}=e,{onMask:l=!1}=e,{position:f="fixed"}=e,{closeOnClick:r=!1}=e,{onTouch:a=void 0}=e;function u(h){G.call(this,o,h)}const d=()=>{r?s(0,l=!1):a&&a()},_=()=>{r?s(0,l=!1):a&&a()};return o.$$set=h=>{"onMask"in h&&s(0,l=h.onMask),"position"in h&&s(1,f=h.position),"closeOnClick"in h&&s(2,r=h.closeOnClick),"onTouch"in h&&s(3,a=h.onTouch),"$$scope"in h&&s(4,n=h.$$scope)},[l,f,r,a,n,t,u,d,_]}class Ee extends H{constructor(e){super(),J(this,e,we,Ie,z,{onMask:0,position:1,closeOnClick:2,onTouch:3})}}function Se(o){let e,s,t;return{c(){e=N("emoji-picker"),this.h()},l(n){e=B(n,"EMOJI-PICKER",{"aria-hidden":!0,class:!0}),O(e).forEach(g),this.h()},h(){A(e,"aria-hidden",""),A(e,"class",o[0])},m(n,l){w(n,e,l),s||(t=[S(e,"emoji-click",y(Y(o[2]))),S(e,"touchstart",y(o[4])),S(e,"touchend",y(o[5]))],s=!0)},p(n,l){l&1&&A(e,"class",n[0])},d(n){n&&g(e),s=!1,Z(t)}}}function je(o){let e,s;return e=new Ee({props:{onMask:!0,position:"absolute",onTouch:o[6],$$slots:{default:[Se]},$$scope:{ctx:o}}}),{c(){$(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,n){v(e,t,n),s=!0},p(t,[n]){const l={};n&2&&(l.onTouch=t[6]),n&257&&(l.$$scope={dirty:n,ctx:t}),e.$set(l)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){T(e,t)}}}function $e(o,e,s){let{classList:t}=e,{onSelect:n}=e,{close:l}=e;function f(d){n(d.detail.unicode)}new ge({emojiVersion:15});function r(d){G.call(this,o,d)}function a(d){G.call(this,o,d)}const u=()=>{l()};return o.$$set=d=>{"classList"in d&&s(0,t=d.classList),"onSelect"in d&&s(3,n=d.onSelect),"close"in d&&s(1,l=d.close)},[t,l,f,n,r,a,u]}class Pe extends H{constructor(e){super(),J(this,e,$e,je,z,{classList:0,onSelect:3,close:1})}}function ve(o){let e,s,t,n,l,f;return t=new be({props:{width:"24",height:"24"}}),{c(){e=N("div"),s=N("button"),$(t.$$.fragment),this.h()},l(r){e=B(r,"DIV",{slot:!0,class:!0});var a=O(e);s=B(a,"BUTTON",{});var u=O(s);P(t.$$.fragment,u),u.forEach(g),a.forEach(g),this.h()},h(){E(e,"slot","right"),E(e,"class","flex items-center gap-2")},m(r,a){w(r,e,a),ce(e,s),v(t,s,null),n=!0,l||(f=S(s,"click",o[8]),l=!0)},p:M,i(r){n||(b(t.$$.fragment,r),n=!0)},o(r){I(t.$$.fragment,r),n=!1},d(r){r&&g(e),T(t),l=!1,f()}}}function Te(o){let e,s;return e=new ue({props:{posts:o[0].posts,index:o[0].index,selectedReaction:o[1]}}),{c(){$(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,n){v(e,t,n),s=!0},p(t,n){const l={};n&1&&(l.posts=t[0].posts),n&1&&(l.index=t[0].index),n&2&&(l.selectedReaction=t[1]),e.$set(l)},i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){T(e,t)}}}function Ce(o){let e;return{c(){e=N("div"),this.h()},l(s){e=B(s,"DIV",{class:!0}),O(e).forEach(g),this.h()},h(){E(e,"class","w-full h-full")},m(s,t){w(s,e,t)},p:M,i:M,o:M,d(s){s&&g(e)}}}function X(o){let e,s;return e=new Pe({props:{classList:"absolute bottom-24 right-0 px-4 z-50",onSelect:o[4],close:o[9]}}),{c(){$(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,n){v(e,t,n),s=!0},p:M,i(t){s||(b(e.$$.fragment,t),s=!0)},o(t){I(e.$$.fragment,t),s=!1},d(t){T(e,t)}}}function Me(o){let e,s,t,n,l,f,r,a,u;e=new fe({props:{position:"fixed",leftBack:o[2]?"":"white",$$slots:{right:[ve]},$$scope:{ctx:o}}});const d=[Ce,Te],_=[];function h(i,c){return i[0].posts.length===0?0:1}t=h(o),n=_[t]=d[t](o),f=new de({});let m=o[3]&&X(o);return{c(){$(e.$$.fragment),s=D(),n.c(),l=D(),$(f.$$.fragment),r=D(),m&&m.c(),a=U()},l(i){P(e.$$.fragment,i),s=L(i),n.l(i),l=L(i),P(f.$$.fragment,i),r=L(i),m&&m.l(i),a=U()},m(i,c){v(e,i,c),w(i,s,c),_[t].m(i,c),w(i,l,c),v(f,i,c),w(i,r,c),m&&m.m(i,c),w(i,a,c),u=!0},p(i,[c]){const k={};c&4&&(k.leftBack=i[2]?"":"white"),c&4096&&(k.$$scope={dirty:c,ctx:i}),e.$set(k);let C=t;t=h(i),t===C?_[t].p(i,c):(K(),I(_[C],1,1,()=>{_[C]=null}),q(),n=_[t],n?n.p(i,c):(n=_[t]=d[t](i),n.c()),b(n,1),n.m(l.parentNode,l)),i[3]?m?(m.p(i,c),c&8&&b(m,1)):(m=X(i),m.c(),b(m,1),m.m(a.parentNode,a)):m&&(K(),I(m,1,1,()=>{m=null}),q())},i(i){u||(b(e.$$.fragment,i),b(n),b(f.$$.fragment,i),b(m),u=!0)},o(i){I(e.$$.fragment,i),I(n),I(f.$$.fragment,i),I(m),u=!1},d(i){i&&(g(s),g(l),g(r),g(a)),T(e,i),_[t].d(i),T(f,i),m&&m.d(i)}}}function Ne(o,e,s){let t,n,l,f,r,a;R(o,me,c=>s(7,f=c)),R(o,he,c=>s(11,r=c)),R(o,Q,c=>s(3,a=c));let u={posts:[],index:0},d,_;re(async()=>{await ke.hide();let c="";try{c=_e()}catch{}const k=Number(f.url.searchParams.get("postIdx")||0);Number(f.url.searchParams.get("mediaIdx")||0);const C=0,ee=30,te=`&offset=${C}`,se=`&limit=${ee}`;let j=[];(n||t)&&r.length>0?(j=r.map(p=>p.idx===k?{...p,mediaIdx:p.mediaIdx||0}:{...p,mediaIdx:0}),s(0,u.index=j.findIndex(p=>p.idx===String(k)),u)):(_=new AbortController,k&&(j=[await fetch(`${W}/posts/${k}`,{method:"GET",headers:{Authorization:"Bearer "+c},signal:_.signal}).then(p=>p.json()).then(p=>({...p.data,mediaIdx:p.data.mediaIdx||0}))]),j=[...j,...await fetch(`${W}/posts?${te}${se}`,{method:"GET",headers:{Authorization:"Bearer "+c},signal:_.signal}).then(p=>p.json()).then(p=>{var x;return(x=p.data)==null?void 0:x.posts.filter(V=>V.idx!==String(k)).map(V=>({...V,mediaIdx:V.mediaIdx||0}))})||[]]),s(0,u.posts=j,u)}),le(()=>{_&&_.abort()});async function h(c){const k=f.url.searchParams.get("postIdx");k&&s(1,d={postIdx:k,reaction:c})}const m=async()=>{await pe("/search")},i=()=>{Q.set(!1)};return o.$$.update=()=>{o.$$.dirty&128&&s(5,t=f.url.searchParams.get("placeIdx")),o.$$.dirty&128&&s(6,n=f.url.searchParams.get("userIdx")),o.$$.dirty&96&&s(2,l=!t&&!n)},[u,d,l,a,h,t,n,f,m,i]}class Fe extends H{constructor(e){super(),J(this,e,Ne,Me,z,{})}}export{Fe as component};
