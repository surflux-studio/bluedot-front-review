import{g as ue}from"../chunks/entry.C9m624fl.js";import{g as Ve,e as K,m as ye,C as Ne,s as he,A as je}from"../chunks/sign.D1hvpANE.js";import{s as ze,y as Ce,e as _,a as I,t as ve,c as v,b as $,g as O,f as p,B as be,d as xe,v as g,i as H,h as d,O as De,A as ce,z as ge,j as Le,F as He,k as Me,n as ne,P as Ee}from"../chunks/scheduler.BTWb34i-.js";import{S as Ue,i as qe,e as _e,c as J,b as G,m as W,a as V,f as Re,t as N,d as X,g as Je}from"../chunks/index.D8fgSKXR.js";import{H as Ge}from"../chunks/Header.B4ZdURB9.js";import{F as We}from"../chunks/Field.cvwonUDa.js";import{g as Xe,t as Ke}from"../chunks/photo.I-o-mD7f.js";import{s as Se}from"../chunks/s32cloudfront.r_FDhqrw.js";import{C as Qe}from"../chunks/CircleImage.Bdg0rf02.js";import{V as Ye}from"../chunks/VisibilitySheet.UKRzLLyM.js";import{C as Ze,I as Ae,a as Ie}from"../chunks/IconCamera.DJxCDEP4.js";import{N as et}from"../chunks/NavigationBar.xrgyMeCO.js";const tt=async({params:a,parent:e})=>{var D;const t=a.idx,i=`/boxes/${t}`,n=t==="-1",o=Ve();if(o===null&&!n)return ue(i,{replaceState:!0});if(n)return{box:{idx:"-1",name:"",description:"",image:null,role:null},jwt:o,paramIdx:t};const c=await e();if(c.error||!c.data)return K.emit("pushSnackbar",{message:"접근할 수 없습니다."}),ue("/boxes",{replaceState:!0});const u=(D=c.data)==null?void 0:D.box;return(u==null?void 0:u.role)!=="owner"?(K.emit("pushSnackbar",{message:"접근할 수 없습니다."}),ue(i,{replaceState:!0})):{box:u,jwt:o,paramIdx:t}},kt=Object.freeze(Object.defineProperty({__proto__:null,load:tt},Symbol.toStringTag,{value:"Module"}));function it(a){let e,t=a[3]?"박스 추가":"박스 편집",i;return{c(){e=_("p"),i=ve(t),this.h()},l(n){e=v(n,"P",{class:!0});var o=$(e);i=xe(o,t),o.forEach(p),this.h()},h(){g(e,"class","text-white text-[15px] font-semibold")},m(n,o){H(n,e,o),d(e,i)},p:ne,d(n){n&&p(e)}}}function st(a){let e,t,i,n,o;return{c(){e=_("button"),t=ve("완료"),this.h()},l(c){e=v(c,"BUTTON",{class:!0});var u=$(e);t=xe(u,"완료"),u.forEach(p),this.h()},h(){g(e,"class","font-medium text-sm leading-[17px] text-white disabled:text-[#3F3F3F] align-text-top"),e.disabled=i=a[0].name.trim()===""},m(c,u){H(c,e,u),d(e,t),n||(o=ce(e,"click",a[6]),n=!0)},p(c,u){u&1&&i!==(i=c[0].name.trim()==="")&&(e.disabled=i)},d(c){c&&p(e),n=!1,o()}}}function nt(a){let e,t=a[3]&&st(a);return{c(){e=_("div"),t&&t.c(),this.h()},l(i){e=v(i,"DIV",{slot:!0});var n=$(e);t&&t.l(n),n.forEach(p),this.h()},h(){g(e,"slot","right")},m(i,n){H(i,e,n),t&&t.m(e,null)},p(i,n){i[3]&&t.p(i,n)},d(i){i&&p(e),t&&t.d()}}}function at(a){let e;return{c(){e=_("div"),this.h()},l(t){e=v(t,"DIV",{class:!0}),$(e).forEach(p),this.h()},h(){g(e,"class","w-full h-full bg-[#D9D9D9] rounded-full")},m(t,i){H(t,e,i)},p:ne,i:ne,o:ne,d(t){t&&p(e)}}}function ot(a){let e,t;return e=new Qe({props:{src:Se(a[0].image??"",500),width:"78px",strokeWidth:"0"}}),{c(){J(e.$$.fragment)},l(i){G(e.$$.fragment,i)},m(i,n){W(e,i,n),t=!0},p(i,n){const o={};n&1&&(o.src=Se(i[0].image??"",500)),e.$set(o)},i(i){t||(N(e.$$.fragment,i),t=!0)},o(i){V(e.$$.fragment,i),t=!1},d(i){X(e,i)}}}function rt(a){let e,t,i;return t=new Ie({props:{fill:"white",length:"1"}}),{c(){e=_("button"),J(t.$$.fragment),this.h()},l(n){e=v(n,"BUTTON",{class:!0});var o=$(e);G(t.$$.fragment,o),o.forEach(p),this.h()},h(){g(e,"class","absolute bottom-0 right-0 bg-[#3F3F3F] w-6 h-6 rounded-[40px] shadow-[1px_1px_6px_rgba(0,0,0,0.1)] flex justify-center items-center")},m(n,o){H(n,e,o),W(t,e,null),i=!0},p:ne,i(n){i||(N(t.$$.fragment,n),i=!0)},o(n){V(t.$$.fragment,n),i=!1},d(n){n&&p(e),X(t)}}}function lt(a){let e,t,i,n,o,c,u,D,r,E,x,w,S,ae="박스 이름",Q,F,Y,M,B,T,oe='<p class="text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]">박스 설명</p>',Z,y,ee,l,m,k="공개 여부",b,C,h=ye[a[1]]+"",te,U,q,re,A,fe,me,ie,de,$e;t=new Ge({props:{position:"static",leftBack:!0,contentPosition:"items-center",$$slots:{right:[nt],default:[it]},$$scope:{ctx:a}}});const ke=[ot,at],j=[];function we(s,f){return s[0].image?0:1}c=we(a),u=j[c]=ke[c](a),r=new Ze({props:{shrink:!1,items:a[4],$$slots:{default:[rt]},$$scope:{ctx:a}}});function Oe(s){a[9](s)}let Fe={padding:"",border:"border-b-[0.5px] border-[#3F3F3F] py-2.5",backgroundColor:"bg-transparent",fontSize:"text-sm font-normal leading-5",fontColor:"text-[#F1F1F1]",limit:20,useCounter:!1,onInput:a[7]};a[0].name!==void 0&&(Fe.value=a[0].name),F=new We({props:Fe}),Ce.push(()=>_e(F,"value",Oe)),q=new et({});function Te(s){a[12](s)}function Pe(s){a[13](s)}let pe={onChange:a[7]};return a[2]!==void 0&&(pe.isOpen=a[2]),a[1]!==void 0&&(pe.selectedVisibility=a[1]),A=new Ye({props:pe}),Ce.push(()=>_e(A,"isOpen",Te)),Ce.push(()=>_e(A,"selectedVisibility",Pe)),{c(){e=_("div"),J(t.$$.fragment),i=I(),n=_("section"),o=_("div"),u.c(),D=I(),J(r.$$.fragment),E=I(),x=_("section"),w=_("section"),S=_("p"),S.textContent=ae,Q=I(),J(F.$$.fragment),M=I(),B=_("section"),T=_("div"),T.innerHTML=oe,Z=I(),y=_("textarea"),ee=I(),l=_("section"),m=_("p"),m.textContent=k,b=I(),C=_("div"),te=ve(h),U=I(),J(q.$$.fragment),re=I(),J(A.$$.fragment),this.h()},l(s){e=v(s,"DIV",{class:!0});var f=$(e);G(t.$$.fragment,f),i=O(f),n=v(f,"SECTION",{class:!0});var se=$(n);o=v(se,"DIV",{class:!0});var z=$(o);u.l(z),D=O(z),G(r.$$.fragment,z),z.forEach(p),se.forEach(p),E=O(f),x=v(f,"SECTION",{class:!0});var P=$(x);w=v(P,"SECTION",{class:!0});var R=$(w);S=v(R,"P",{class:!0,"data-svelte-h":!0}),be(S)!=="svelte-1kbmcgb"&&(S.textContent=ae),Q=O(R),G(F.$$.fragment,R),R.forEach(p),M=O(P),B=v(P,"SECTION",{class:!0});var L=$(B);T=v(L,"DIV",{class:!0,"data-svelte-h":!0}),be(T)!=="svelte-sqw6c9"&&(T.innerHTML=oe),Z=O(L),y=v(L,"TEXTAREA",{class:!0}),$(y).forEach(p),L.forEach(p),ee=O(P),l=v(P,"SECTION",{class:!0});var le=$(l);m=v(le,"P",{class:!0,"data-svelte-h":!0}),be(m)!=="svelte-18l855b"&&(m.textContent=k),b=O(le),C=v(le,"DIV",{class:!0,"aria-hidden":!0});var Be=$(C);te=xe(Be,h),Be.forEach(p),le.forEach(p),P.forEach(p),f.forEach(p),U=O(s),G(q.$$.fragment,s),re=O(s),G(A.$$.fragment,s),this.h()},h(){g(o,"class","w-[78px] h-[78px] relative"),g(n,"class","box-image relative w-full flex justify-center"),g(S,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),g(w,"class","box-name flex gap-[15px] h-10 items-center"),g(T,"class","flex-none h-10 flex items-center"),g(y,"class","auto-height w-full bg-transparent border-x-0 border-t-0 focus:ring-0 focus:border-[#3F3F3F] border-b-[0.5px] border-[#3F3F3F] py-2.5 px-0 text-sm font-normal leading-5 text-[#F1F1F1] resize-none svelte-oekuck"),g(B,"class","box-description flex gap-[15px] min-h-10 items-start"),g(m,"class","flex-none text-[#F1F1F1] text-sm font-semibold leading-[22px] tracking-[-0.6px]"),g(C,"class","w-full border-b-[0.5px] border-[#3F3F3F] py-2.5 text-xs font-normal leading-4 text-gray-03 svelte-oekuck"),g(C,"aria-hidden",""),g(l,"class","box-name flex gap-[15px] h-10 items-center"),g(x,"class","box-setting p-5 text-white"),g(e,"class","min-h-dvh bg-black")},m(s,f){H(s,e,f),W(t,e,null),d(e,i),d(e,n),d(n,o),j[c].m(o,null),d(o,D),W(r,o,null),d(e,E),d(e,x),d(x,w),d(w,S),d(w,Q),W(F,w,null),d(x,M),d(x,B),d(B,T),d(B,Z),d(B,y),De(y,a[0].description),d(x,ee),d(x,l),d(l,m),d(l,b),d(l,C),d(C,te),H(s,U,f),W(q,s,f),H(s,re,f),W(A,s,f),ie=!0,de||($e=[ce(y,"input",a[10]),ce(y,"input",a[5]),ce(C,"click",a[11])],de=!0)},p(s,[f]){const se={};f&4194305&&(se.$$scope={dirty:f,ctx:s}),t.$set(se);let z=c;c=we(s),c===z?j[c].p(s,f):(Je(),V(j[z],1,1,()=>{j[z]=null}),Re(),u=j[c],u?u.p(s,f):(u=j[c]=ke[c](s),u.c()),N(u,1),u.m(o,D));const P={};f&4194304&&(P.$$scope={dirty:f,ctx:s}),r.$set(P);const R={};!Y&&f&1&&(Y=!0,R.value=s[0].name,ge(()=>Y=!1)),F.$set(R),f&1&&De(y,s[0].description),(!ie||f&2)&&h!==(h=ye[s[1]]+"")&&Le(te,h);const L={};!fe&&f&4&&(fe=!0,L.isOpen=s[2],ge(()=>fe=!1)),!me&&f&2&&(me=!0,L.selectedVisibility=s[1],ge(()=>me=!1)),A.$set(L)},i(s){ie||(N(t.$$.fragment,s),N(u),N(r.$$.fragment,s),N(F.$$.fragment,s),N(q.$$.fragment,s),N(A.$$.fragment,s),ie=!0)},o(s){V(t.$$.fragment,s),V(u),V(r.$$.fragment,s),V(F.$$.fragment,s),V(q.$$.fragment,s),V(A.$$.fragment,s),ie=!1},d(s){s&&(p(e),p(U),p(re)),X(t),j[c].d(),X(r),X(F),X(q,s),X(A,s),de=!1,He($e)}}}const ut=120;function ct(a,e,t){let i;Me(a,he,l=>t(15,i=l));const n=`${je}/boxes`;let{data:o}=e;const c=o.paramIdx,u=c==="-1";let D=o.jwt,r={...o.box,description:o.box.description??""},E=r.visibility??"follower",x=!1,w;async function S(){var m;const l=await Xe({limit:1});(m=l[0])!=null&&m.file&&F(l[0].file)}async function ae(){var m;const l=await Ke();(m=l[0])!=null&&m.file&&F(l[0].file)}const Q=Ne.isNativePlatform()?[{name:"사진 선택",icon:Ae,onClick:S},{name:"사진 촬영",icon:Ie,onClick:ae}]:[{name:"사진 선택",icon:Ae,onClick:S}];async function F(l){var m;try{const k=new FormData;k.append("image",l);const b=await fetch(`${n}/image`,{method:"POST",body:k,headers:{Authorization:`Bearer ${D}`}});if(!b.ok)return K.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});const h=(m=(await b.json()).data)==null?void 0:m.image;if(!h)return K.emit("pushSnackbar",{message:"일시적인 장애로 사진이 변경되지 않았습니다."});if(t(0,r.image=h,r),u)return;M()}catch{}}function Y(){let l=r.description??"",m=0,k=0,b="";for(let C of l){let h=C.charCodeAt(0);if(h===10&&(m++,k=0),m===3)break;let U=h>=4352&&h<=4607||h>=12592&&h<=12687||h>=43360&&h<=43391||h>=44032&&h<=55215||h>=55216&&h<=55295?2:1;if(k+U>ut/3*(3-m))break;k+=U,b+=C}t(0,r.description=b,r),B()}async function M(){if(t(0,r.name=r.name.trim(),r),!r.name)return;const{url:l,method:m}=u?{url:n,method:"POST"}:{url:`${n}/${c}`,method:"PATCH"},k=await fetch(l,{method:m,headers:{"Content-Type":"application/json",Authorization:`Bearer ${D}`},body:JSON.stringify({name:r.name,description:r.description,image:r.image,visibility:E})});if(!k.ok)return K.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});u?(k.json().then(b=>{const C=b.data;C.role="owner",C.visibility=E,C.is_subcribed=!1,C.place_count="0",C.follower_count="0",Ee(he,i=[C,...i],i)}),K.emit("pushSnackbar",{message:"새 박스를 만들었습니다"}),ue("/boxes")):Ee(he,i=i.map(b=>(b.idx===r.idx&&(b.name=r.name,b.description=r.description,b.image=r.image,b.visibility=E),b)),i)}function B(){u||(w&&clearTimeout(w),w=setTimeout(M,1e3))}function T(l){a.$$.not_equal(r.name,l)&&(r.name=l,t(0,r))}function oe(){r.description=this.value,t(0,r)}const Z=()=>t(2,x=!0);function y(l){x=l,t(2,x)}function ee(l){E=l,t(1,E)}return a.$$set=l=>{"data"in l&&t(8,o=l.data)},[r,E,x,u,Q,Y,M,B,o,T,oe,Z,y,ee]}class wt extends Ue{constructor(e){super(),qe(this,e,ct,lt,ze,{data:8})}}export{wt as component,kt as universal};
