import{l as Ie,e as ge,A as ne,g as ae,m as be,C as Ve,n as fe,k as de}from"../chunks/sign.BuMHTy3f.js";import{e as ee}from"../chunks/index.g5YcAAdQ.js";import{l as Be,s as ve,e as B,c as D,b as S,f as k,v as y,i as J,t as oe,a as Y,d as le,g as j,h as $,A as G,S as De,j as pe,n as ie,y as W,z as Q,k as se,w as Ae,x as Ee,P as Pe,V as Se,F as xe,B as ke}from"../chunks/scheduler.CCBjAsUD.js";import{g as te}from"../chunks/entry.CxXW_0BZ.js";import{S as we,i as ye,g as ue,f as ce,t as A,a as E,c as F,b as M,m as z,d as H,e as U}from"../chunks/index.svcsDwjp.js";import{H as $e}from"../chunks/Header.BN86B4ik.js";import{V as Ce}from"../chunks/Viewer.DhMDxUGz.js";/* empty css                                                   */import{p as Te}from"../chunks/stores.Dy06BmHj.js";import{K as re}from"../chunks/index.BKaX_-ct.js";import{e as _e,u as Ne,o as Oe}from"../chunks/each.D6kHJ57P.js";import{I as Ye}from"../chunks/IconChevronRight.p27myjzK.js";import{B as je}from"../chunks/BottomNavigationPadder.CxxFKKvp.js";import{V as Fe}from"../chunks/VisibilitySheet.DFe6Gc9p.js";import{N as Me}from"../chunks/NavigationBar.CTlQAmqa.js";const ze=async({fetch:s,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return ee(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const i=Ie();return{posts:[{user_idx:i==null?void 0:i.sub,unique_name:i==null?void 0:i.uni,profile_image_url:i==null?void 0:i.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Be(be),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const i=e.searchParams.get("postIdx");if(i==="null")return ge.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),te("/viewer",{replaceState:!0});i||ee(404,"Not Found");const n=await s(`${ne}/posts/${i}`,{method:"GET",headers:{Authorization:"Bearer "+ae()}}).then(o=>o.json()).then(o=>o.data);return n.error&&ee(404,"Not Found"),{posts:[{...n,mediaIdx:0}]}}return ee(404,"Not Found")},ht=Object.freeze(Object.defineProperty({__proto__:null,load:ze},Symbol.toStringTag,{value:"Module"}));function me(s,e,t){const i=s.slice();return i[1]=e[t],i[3]=t,i}function He(s){let e;return{c(){e=B("div"),this.h()},l(t){e=D(t,"DIV",{class:!0}),S(e).forEach(k),this.h()},h(){y(e,"class","w-0.5")},m(t,i){J(t,e,i)},i:ie,o:ie,d(t){t&&k(e)}}}function Je(s){let e,t;return e=new Ye({props:{fill:"#6B7280",length:"1.25"}}),{c(){F(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,n){z(e,i,n),t=!0},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){E(e.$$.fragment,i),t=!1},d(i){H(e,i)}}}function he(s,e){let t,i,n=e[1].title+"",o,m,a,l,c=e[1].value+"",g,h,r,d,u,_,b,w,x;const P=[Je,He],C=[];function T(I,V){return I[1].onClick?0:1}return r=T(e),d=C[r]=P[r](e),{key:s,first:null,c(){t=B("div"),i=B("span"),o=oe(n),m=Y(),a=B("div"),l=B("span"),g=oe(c),h=Y(),d.c(),u=Y(),this.h()},l(I){t=D(I,"DIV",{class:!0});var V=S(t);i=D(V,"SPAN",{class:!0});var N=S(i);o=le(N,n),N.forEach(k),m=j(V),a=D(V,"DIV",{class:!0});var O=S(a);l=D(O,"SPAN",{class:!0});var p=S(l);g=le(p,c),p.forEach(k),h=j(O),d.l(O),O.forEach(k),u=j(V),V.forEach(k),this.h()},h(){y(i,"class","text-white text-sm font-medium"),y(l,"class","text-gray-500 text-xs"),y(a,"class","flex items-center gap-2"),y(t,"class",_=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(I,V){J(I,t,V),$(t,i),$(i,o),$(t,m),$(t,a),$(a,l),$(l,g),$(a,h),C[r].m(a,null),$(t,u),b=!0,w||(x=G(t,"click",function(){De(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),w=!0)},p(I,V){e=I,(!b||V&1)&&n!==(n=e[1].title+"")&&pe(o,n),(!b||V&1)&&c!==(c=e[1].value+"")&&pe(g,c);let N=r;r=T(e),r!==N&&(ue(),E(C[N],1,1,()=>{C[N]=null}),ce(),d=C[r],d||(d=C[r]=P[r](e),d.c()),A(d,1),d.m(a,null)),(!b||V&1&&_!==(_=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&y(t,"class",_)},i(I){b||(A(d),b=!0)},o(I){E(d),b=!1},d(I){I&&k(t),C[r].d(),w=!1,x()}}}function Ke(s){let e,t=[],i=new Map,n,o=_e(s[0]);const m=a=>a[1].id;for(let a=0;a<o.length;a+=1){let l=me(s,o,a),c=m(l);i.set(c,t[a]=he(c,l))}return{c(){e=B("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=D(a,"DIV",{class:!0});var l=S(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(k),this.h()},h(){y(e,"class","flex flex-col w-full")},m(a,l){J(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,[l]){l&1&&(o=_e(a[0]),ue(),t=Ne(t,l,m,1,a,o,i,e,Oe,he,null,me),ce())},i(a){if(!n){for(let l=0;l<o.length;l+=1)A(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)E(t[l]);n=!1},d(a){a&&k(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function Le(s,e,t){let{items:i=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return s.$$set=n=>{"items"in n&&t(0,i=n.items)},[i]}class qe extends we{constructor(e){super(),ye(this,e,Le,Ke,ve,{items:0})}}function Re(s){let e,t,i,n,o,m,a,l;e=new $e({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",$$slots:{right:[We]},$$scope:{ctx:s}}});function c(r){s[20](r)}function g(r){s[21](r)}let h={dontMoveVertically:!0,hideActionButtons:!0};return s[1]!==void 0&&(h.posts=s[1]),s[5]!==void 0&&(h.keyboardY=s[5]),i=new Ce({props:h}),W.push(()=>U(i,"posts",c)),W.push(()=>U(i,"keyboardY",g)),a=new Me({}),{c(){F(e.$$.fragment),t=Y(),F(i.$$.fragment),m=Y(),F(a.$$.fragment)},l(r){M(e.$$.fragment,r),t=j(r),M(i.$$.fragment,r),m=j(r),M(a.$$.fragment,r)},m(r,d){z(e,r,d),J(r,t,d),z(i,r,d),J(r,m,d),z(a,r,d),l=!0},p(r,d){const u={};d&1073741824&&(u.$$scope={dirty:d,ctx:r}),e.$set(u);const _={};!n&&d&2&&(n=!0,_.posts=r[1],Q(()=>n=!1)),!o&&d&32&&(o=!0,_.keyboardY=r[5],Q(()=>o=!1)),i.$set(_)},i(r){l||(A(e.$$.fragment,r),A(i.$$.fragment,r),A(a.$$.fragment,r),l=!0)},o(r){E(e.$$.fragment,r),E(i.$$.fragment,r),E(a.$$.fragment,r),l=!1},d(r){r&&(k(t),k(m)),H(e,r),H(i,r),H(a,r)}}}function Ge(s){let e,t,i,n,o,m,a,l,c,g,h=(s[2]||"텍스트 입력하기...")+"",r,d,u,_,b,w,x,P,C,T,I;t=new $e({props:{position:"static",leftBack:"white",$$slots:{right:[Qe]},$$scope:{ctx:s}}});function V(p){s[14](p)}function N(p){s[15](p)}let O={dontMoveVertically:!0,isEdit:!0};return s[1]!==void 0&&(O.posts=s[1]),s[5]!==void 0&&(O.keyboardY=s[5]),o=new Ce({props:O}),W.push(()=>U(o,"posts",V)),W.push(()=>U(o,"keyboardY",N)),b=new qe({props:{items:[{id:1,title:"장소",value:s[1][0].place_name||""},{id:2,title:"공개 여부",value:de[s[4]],onClick:s[18]}]}}),P=new je({}),{c(){e=B("section"),F(t.$$.fragment),i=Y(),n=B("div"),F(o.$$.fragment),l=Y(),c=B("div"),g=B("div"),r=oe(h),u=Y(),_=B("div"),F(b.$$.fragment),w=Y(),x=B("div"),F(P.$$.fragment),this.h()},l(p){e=D(p,"SECTION",{class:!0});var v=S(e);M(t.$$.fragment,v),i=j(v),n=D(v,"DIV",{class:!0});var L=S(n);M(o.$$.fragment,L),L.forEach(k),l=j(v),c=D(v,"DIV",{class:!0});var K=S(c);g=D(K,"DIV",{contenteditable:!0,class:!0});var q=S(g);r=le(q,h),q.forEach(k),K.forEach(k),u=j(v),_=D(v,"DIV",{class:!0});var X=S(_);M(b.$$.fragment,X),X.forEach(k),w=j(v),x=D(v,"DIV",{class:!0});var Z=S(x);M(P.$$.fragment,Z),Z.forEach(k),v.forEach(k),this.h()},h(){y(n,"class","flex flex-grow"),y(g,"contenteditable","true"),y(g,"class",d=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${s[6]?"text-gray-400":"text-white"}
        `),y(c,"class","h-32 px-5 py-2.5"),y(_,"class",""),y(x,"class","h-40"),y(e,"class","flex flex-col w-full h-screen bg-black")},m(p,v){J(p,e,v),z(t,e,null),$(e,i),$(e,n),z(o,n,null),$(e,l),$(e,c),$(c,g),$(g,r),$(e,u),$(e,_),z(b,_,null),$(e,w),$(e,x),z(P,x,null),C=!0,T||(I=[G(g,"input",s[10]),G(g,"focus",s[16]),G(g,"blur",s[17])],T=!0)},p(p,v){const L={};v&1073741825&&(L.$$scope={dirty:v,ctx:p}),t.$set(L);const K={};!m&&v&2&&(m=!0,K.posts=p[1],Q(()=>m=!1)),!a&&v&32&&(a=!0,K.keyboardY=p[5],Q(()=>a=!1)),o.$set(K),(!C||v&4)&&h!==(h=(p[2]||"텍스트 입력하기...")+"")&&Se(r,h),(!C||v&64&&d!==(d=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${p[6]?"text-gray-400":"text-white"}
        `))&&y(g,"class",d);const q={};v&26&&(q.items=[{id:1,title:"장소",value:p[1][0].place_name||""},{id:2,title:"공개 여부",value:de[p[4]],onClick:p[18]}]),b.$set(q)},i(p){C||(A(t.$$.fragment,p),A(o.$$.fragment,p),A(b.$$.fragment,p),A(P.$$.fragment,p),C=!0)},o(p){E(t.$$.fragment,p),E(o.$$.fragment,p),E(b.$$.fragment,p),E(P.$$.fragment,p),C=!1},d(p){p&&k(e),H(t),H(o),H(b),H(P),T=!1,xe(I)}}}function We(s){let e,t="완료",i,n;return{c(){e=B("div"),e.textContent=t,this.h()},l(o){e=D(o,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ke(e)!=="svelte-11t55ng"&&(e.textContent=t),this.h()},h(){y(e,"slot","right"),y(e,"class","text-white")},m(o,m){J(o,e,m),i||(n=G(e,"click",s[19]),i=!0)},p:ie,d(o){o&&k(e),i=!1,n()}}}function Qe(s){let e,t="다음",i,n;return{c(){e=B("div"),e.textContent=t,this.h()},l(o){e=D(o,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ke(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){y(e,"slot","right"),y(e,"class","text-white")},m(o,m){J(o,e,m),i||(n=G(e,"click",s[13]),i=!0)},p:ie,d(o){o&&k(e),i=!1,n()}}}function Ue(s){let e,t,i,n,o,m,a;const l=[Ge,Re],c=[];function g(u,_){return u[0]===0?0:u[0]===1?1:-1}~(e=g(s))&&(t=c[e]=l[e](s));function h(u){s[22](u)}function r(u){s[23](u)}let d={};return s[3]!==void 0&&(d.isOpen=s[3]),s[4]!==void 0&&(d.selectedVisibility=s[4]),n=new Fe({props:d}),W.push(()=>U(n,"isOpen",h)),W.push(()=>U(n,"selectedVisibility",r)),{c(){t&&t.c(),i=Y(),F(n.$$.fragment)},l(u){t&&t.l(u),i=j(u),M(n.$$.fragment,u)},m(u,_){~e&&c[e].m(u,_),J(u,i,_),z(n,u,_),a=!0},p(u,[_]){let b=e;e=g(u),e===b?~e&&c[e].p(u,_):(t&&(ue(),E(c[b],1,1,()=>{c[b]=null}),ce()),~e?(t=c[e],t?t.p(u,_):(t=c[e]=l[e](u),t.c()),A(t,1),t.m(i.parentNode,i)):t=null);const w={};!o&&_&8&&(o=!0,w.isOpen=u[3],Q(()=>o=!1)),!m&&_&16&&(m=!0,w.selectedVisibility=u[4],Q(()=>m=!1)),n.$set(w)},i(u){a||(A(t),A(n.$$.fragment,u),a=!0)},o(u){E(t),E(n.$$.fragment,u),a=!1},d(u){u&&k(i),~e&&c[e].d(u),H(n,u)}}}function Xe(s){const e=s.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function Ze(s){const e=s.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function et(s,e,t){let i,n,o,m;se(s,fe,f=>t(25,n=f)),se(s,Te,f=>t(26,o=f)),se(s,be,f=>t(12,m=f));const a=Ve.getPlatform()!=="web",l=o.url.searchParams.get("type");let c=0,{data:g}=e,h=g.posts,r="",d=!1,u="public";async function _(){const f=h==null?void 0:h.at(0);(await fetch(`${ne}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ae()}`},body:JSON.stringify({placeIdx:f.place_idx,text:r,media:i,permission:u})})).ok&&await te(`/places/${f.place_idx}`,{replaceState:!0,invalidateAll:!0})}async function b(){try{const f=await fetch(`${ne}/posts/${o.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ae()}`},body:JSON.stringify({text:r})});if(!f.ok){(await f.json()).status===401&&(ge.emit("pushSnackbar",{message:"접근할 수 없습니다"}),te(`/viewer?postIdx=${o.url.searchParams.get("postIdx")}`));return}await te("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let w=0;function x(){re.addListener("keyboardWillShow",f=>{t(5,w=f.keyboardHeight*-1)}),re.addListener("keyboardWillHide",()=>{t(5,w=0)})}function P(){re.removeAllListeners()}Ae(()=>{var f,R;a&&x(),n?(t(2,r=n),Pe(fe,n="",n)):(f=_[0])!=null&&f.text&&t(2,r=(R=_[0])==null?void 0:R.text)}),Ee(()=>{a&&P()});function C(f){const R=f.target;t(2,r=R.innerText),t(1,h[0]={...h[0],text:r},h)}let T=r.trim()==="";const I=()=>{t(0,c=1)};function V(f){h=f,t(1,h)}function N(f){w=f,t(5,w)}const O=f=>{Xe(f),t(6,T=!1)},p=f=>{Ze(f),t(6,T=!r.trim())},v=()=>{t(3,d=!0)},L=()=>{l==="post"?_():l==="patch"&&b()};function K(f){h=f,t(1,h)}function q(f){w=f,t(5,w)}function X(f){d=f,t(3,d)}function Z(f){u=f,t(4,u)}return s.$$set=f=>{"data"in f&&t(11,g=f.data)},s.$$.update=()=>{s.$$.dirty&4096&&(i=m)},[c,h,r,d,u,w,T,l,_,b,C,g,m,I,V,N,O,p,v,L,K,q,X,Z]}class gt extends we{constructor(e){super(),ye(this,e,et,Ue,ve,{data:11})}}export{gt as component,ht as universal};
