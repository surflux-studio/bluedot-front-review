import{b as Ne,g as oe}from"../chunks/sign.BIJUp9Rl.js";import{e as X}from"../chunks/index.DFAChBrO.js";import{A as le,f as we,g as me,h as ne,k as _e}from"../chunks/store.CcXt-7Z5.js";import{l as Oe,s as ye,e as A,c as E,b as P,f as y,v as C,i as Y,t as ue,a as O,d as ce,g as T,h as B,y as W,S as Te,j as he,n as fe,z as Q,A as se,k as ee,w as je,B as Fe,U as re,Z as He,F as Me,x as ke,Q as ge}from"../chunks/scheduler.DH3jNSXp.js";import{e as G,C as ze}from"../chunks/emitter.BXk6yX7e.js";import{g as te}from"../chunks/entry.C1Dtvdv9.js";import{S as $e,i as Be,g as pe,d as de,t as V,a as x,c as H,b as M,m as z,e as L,f as ie}from"../chunks/index.DhGy8j-A.js";import{H as De}from"../chunks/Header.Dm4qwQoe.js";import{V as Ie}from"../chunks/Viewer.h0_8Cjnh.js";/* empty css                                                   */import{p as Le}from"../chunks/stores.DD8BCgn7.js";import{K as ae}from"../chunks/ActionSheet.svelte_svelte_type_style_lang.mMoCM23U.js";import{e as be,u as Ye,o as Je}from"../chunks/each.CFpgwcA3.js";import{I as Ke}from"../chunks/IconChevronRight.DbnsrWO8.js";import{B as Re}from"../chunks/BottomNavigationPadder.Bx8LAw9j.js";import{V as qe}from"../chunks/VisibilitySheet.CGx5vuc-.js";import{N as Ge}from"../chunks/NavigationBar.C4m3TTGz.js";const We=async({fetch:i,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return X(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const s=Ne();return{posts:[{user_idx:s==null?void 0:s.sub,unique_name:s==null?void 0:s.uni,profile_image_url:s==null?void 0:s.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Oe(we),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const s=e.searchParams.get("postIdx");if(s==="null")return G.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),te("/viewer",{replaceState:!0});s||X(404,"Not Found");const a=await i(`${le}/posts/${s}`,{method:"GET",headers:{Authorization:"Bearer "+oe()}}).then(n=>n.json()).then(n=>n.data);return a.error&&X(404,"Not Found"),{posts:[{...a,mediaIdx:0}]}}return X(404,"Not Found")},Dt=Object.freeze(Object.defineProperty({__proto__:null,load:We},Symbol.toStringTag,{value:"Module"}));function ve(i,e,t){const s=i.slice();return s[1]=e[t],s[3]=t,s}function Qe(i){let e;return{c(){e=A("div"),this.h()},l(t){e=E(t,"DIV",{class:!0}),P(e).forEach(y),this.h()},h(){C(e,"class","w-0.5")},m(t,s){Y(t,e,s)},i:fe,o:fe,d(t){t&&y(e)}}}function Ue(i){let e,t;return e=new Ke({props:{fill:"#6B7280",length:"1.25"}}),{c(){H(e.$$.fragment)},l(s){M(e.$$.fragment,s)},m(s,a){z(e,s,a),t=!0},i(s){t||(V(e.$$.fragment,s),t=!0)},o(s){x(e.$$.fragment,s),t=!1},d(s){L(e,s)}}}function Ce(i,e){let t,s,a=e[1].title+"",n,m,o,f,u=e[1].value+"",r,h,p,_,l,b,v,w,j;const S=[Ue,Qe],$=[];function I(k,D){return k[1].onClick?0:1}return p=I(e),_=$[p]=S[p](e),{key:i,first:null,c(){t=A("div"),s=A("span"),n=ue(a),m=O(),o=A("div"),f=A("span"),r=ue(u),h=O(),_.c(),l=O(),this.h()},l(k){t=E(k,"DIV",{class:!0});var D=P(t);s=E(D,"SPAN",{class:!0});var N=P(s);n=ce(N,a),N.forEach(y),m=T(D),o=E(D,"DIV",{class:!0});var F=P(o);f=E(F,"SPAN",{class:!0});var d=P(f);r=ce(d,u),d.forEach(y),h=T(F),_.l(F),F.forEach(y),l=T(D),D.forEach(y),this.h()},h(){C(s,"class","text-white text-sm font-medium"),C(f,"class","text-gray-500 text-xs"),C(o,"class","flex items-center gap-2"),C(t,"class",b=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(k,D){Y(k,t,D),B(t,s),B(s,n),B(t,m),B(t,o),B(o,f),B(f,r),B(o,h),$[p].m(o,null),B(t,l),v=!0,w||(j=W(t,"click",function(){Te(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),w=!0)},p(k,D){e=k,(!v||D&1)&&a!==(a=e[1].title+"")&&he(n,a),(!v||D&1)&&u!==(u=e[1].value+"")&&he(r,u);let N=p;p=I(e),p!==N&&(pe(),x($[N],1,1,()=>{$[N]=null}),de(),_=$[p],_||(_=$[p]=S[p](e),_.c()),V(_,1),_.m(o,null)),(!v||D&1&&b!==(b=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&C(t,"class",b)},i(k){v||(V(_),v=!0)},o(k){x(_),v=!1},d(k){k&&y(t),$[p].d(),w=!1,j()}}}function Ze(i){let e,t=[],s=new Map,a,n=be(i[0]);const m=o=>o[1].id;for(let o=0;o<n.length;o+=1){let f=ve(i,n,o),u=m(f);s.set(u,t[o]=Ce(u,f))}return{c(){e=A("div");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){e=E(o,"DIV",{class:!0});var f=P(e);for(let u=0;u<t.length;u+=1)t[u].l(f);f.forEach(y),this.h()},h(){C(e,"class","flex flex-col w-full")},m(o,f){Y(o,e,f);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(e,null);a=!0},p(o,[f]){f&1&&(n=be(o[0]),pe(),t=Ye(t,f,m,1,o,n,s,e,Je,Ce,null,ve),de())},i(o){if(!a){for(let f=0;f<n.length;f+=1)V(t[f]);a=!0}},o(o){for(let f=0;f<t.length;f+=1)x(t[f]);a=!1},d(o){o&&y(e);for(let f=0;f<t.length;f+=1)t[f].d()}}}function Xe(i,e,t){let{items:s=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return i.$$set=a=>{"items"in a&&t(0,s=a.items)},[s]}class et extends $e{constructor(e){super(),Be(this,e,Xe,Ze,ye,{items:0})}}function tt(i){let e,t,s,a,n,m,o;e=new De({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",leftBackOnClick:i[22],$$slots:{right:[it]},$$scope:{ctx:i}}});function f(r){i[23](r)}let u={dontMoveVertically:!0,hideActionButtons:!0};return i[1]!==void 0&&(u.posts=i[1]),s=new Ie({props:u}),Q.push(()=>ie(s,"posts",f)),m=new Ge({}),{c(){H(e.$$.fragment),t=O(),H(s.$$.fragment),n=O(),H(m.$$.fragment)},l(r){M(e.$$.fragment,r),t=T(r),M(s.$$.fragment,r),n=T(r),M(m.$$.fragment,r)},m(r,h){z(e,r,h),Y(r,t,h),z(s,r,h),Y(r,n,h),z(m,r,h),o=!0},p(r,h){const p={};h[0]&1&&(p.leftBackOnClick=r[22]),h[0]&32|h[1]&16&&(p.$$scope={dirty:h,ctx:r}),e.$set(p);const _={};!a&&h[0]&2&&(a=!0,_.posts=r[1],se(()=>a=!1)),s.$set(_)},i(r){o||(V(e.$$.fragment,r),V(s.$$.fragment,r),V(m.$$.fragment,r),o=!0)},o(r){x(e.$$.fragment,r),x(s.$$.fragment,r),x(m.$$.fragment,r),o=!1},d(r){r&&(y(t),y(n)),L(e,r),L(s,r),L(m,r)}}}function st(i){let e,t,s,a,n,m,o,f,u,r,h=(i[2]||"텍스트 입력하기...")+"",p,_,l,b,v,w,j,S,$,I,k,D;t=new De({props:{position:"static",leftBack:"white",$$slots:{right:[nt]},$$scope:{ctx:i}}});function N(d){i[16](d)}let F={dontMoveVertically:!0,isEdit:!0};return i[1]!==void 0&&(F.posts=i[1]),n=new Ie({props:F}),Q.push(()=>ie(n,"posts",N)),w=new et({props:{items:[{id:1,title:"장소",value:i[1][0].place_name||""},{id:2,title:"공개 여부",value:_e[i[4]],onClick:i[20]}]}}),$=new Re({}),{c(){e=A("section"),H(t.$$.fragment),s=O(),a=A("div"),H(n.$$.fragment),f=O(),u=A("div"),r=A("div"),p=ue(h),b=O(),v=A("div"),H(w.$$.fragment),j=O(),S=A("div"),H($.$$.fragment),this.h()},l(d){e=E(d,"SECTION",{class:!0});var g=P(e);M(t.$$.fragment,g),s=T(g),a=E(g,"DIV",{class:!0,style:!0});var J=P(a);M(n.$$.fragment,J),J.forEach(y),f=T(g),u=E(g,"DIV",{class:!0,style:!0});var K=P(u);r=E(K,"DIV",{contenteditable:!0,class:!0});var R=P(r);p=ce(R,h),R.forEach(y),K.forEach(y),b=T(g),v=E(g,"DIV",{class:!0});var U=P(v);M(w.$$.fragment,U),U.forEach(y),j=T(g),S=E(g,"DIV",{class:!0});var Z=P(S);M($.$$.fragment,Z),Z.forEach(y),g.forEach(y),this.h()},h(){C(a,"class","flex flex-grow"),C(a,"style",o=`transform: translateY(${i[7]}px);`),C(r,"contenteditable","true"),C(r,"class",_=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${i[8]?"text-gray-400":"text-white"}
        `),C(u,"class","h-32 px-5 py-2.5"),C(u,"style",l=`transform: translateY(${i[7]}px);`),C(v,"class",""),C(S,"class","h-40"),C(e,"class","flex flex-col w-full h-screen bg-black")},m(d,g){Y(d,e,g),z(t,e,null),B(e,s),B(e,a),z(n,a,null),B(e,f),B(e,u),B(u,r),B(r,p),i[17](r),B(e,b),B(e,v),z(w,v,null),B(e,j),B(e,S),z($,S,null),I=!0,k||(D=[W(r,"input",i[12]),W(r,"focus",i[18]),W(r,"blur",i[19])],k=!0)},p(d,g){const J={};g[0]&1|g[1]&16&&(J.$$scope={dirty:g,ctx:d}),t.$set(J);const K={};!m&&g[0]&2&&(m=!0,K.posts=d[1],se(()=>m=!1)),n.$set(K),(!I||g[0]&128&&o!==(o=`transform: translateY(${d[7]}px);`))&&C(a,"style",o),(!I||g[0]&4)&&h!==(h=(d[2]||"텍스트 입력하기...")+"")&&He(p,h),(!I||g[0]&256&&_!==(_=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${d[8]?"text-gray-400":"text-white"}
        `))&&C(r,"class",_),(!I||g[0]&128&&l!==(l=`transform: translateY(${d[7]}px);`))&&C(u,"style",l);const R={};g[0]&26&&(R.items=[{id:1,title:"장소",value:d[1][0].place_name||""},{id:2,title:"공개 여부",value:_e[d[4]],onClick:d[20]}]),w.$set(R)},i(d){I||(V(t.$$.fragment,d),V(n.$$.fragment,d),V(w.$$.fragment,d),V($.$$.fragment,d),I=!0)},o(d){x(t.$$.fragment,d),x(n.$$.fragment,d),x(w.$$.fragment,d),x($.$$.fragment,d),I=!1},d(d){d&&y(e),L(t),L(n),i[17](null),L(w),L($),k=!1,Me(D)}}}function it(i){let e,t="완료",s,a;return{c(){e=A("div"),e.textContent=t,this.h()},l(n){e=E(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ke(e)!=="svelte-yednau"&&(e.textContent=t),this.h()},h(){C(e,"slot","right"),C(e,"class","text-white"),ge(e,"opacity-50",i[5])},m(n,m){Y(n,e,m),s||(a=W(e,"click",i[21]),s=!0)},p(n,m){m[0]&32&&ge(e,"opacity-50",n[5])},d(n){n&&y(e),s=!1,a()}}}function nt(i){let e,t="다음",s,a;return{c(){e=A("div"),e.textContent=t,this.h()},l(n){e=E(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ke(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){C(e,"slot","right"),C(e,"class","text-white")},m(n,m){Y(n,e,m),s||(a=W(e,"click",i[15]),s=!0)},p:fe,d(n){n&&y(e),s=!1,a()}}}function rt(i){let e,t,s,a,n,m,o;const f=[st,tt],u=[];function r(l,b){return l[0]===0?0:l[0]===1?1:-1}~(e=r(i))&&(t=u[e]=f[e](i));function h(l){i[24](l)}function p(l){i[25](l)}let _={};return i[3]!==void 0&&(_.isOpen=i[3]),i[4]!==void 0&&(_.selectedVisibility=i[4]),a=new qe({props:_}),Q.push(()=>ie(a,"isOpen",h)),Q.push(()=>ie(a,"selectedVisibility",p)),{c(){t&&t.c(),s=O(),H(a.$$.fragment)},l(l){t&&t.l(l),s=T(l),M(a.$$.fragment,l)},m(l,b){~e&&u[e].m(l,b),Y(l,s,b),z(a,l,b),o=!0},p(l,b){let v=e;e=r(l),e===v?~e&&u[e].p(l,b):(t&&(pe(),x(u[v],1,1,()=>{u[v]=null}),de()),~e?(t=u[e],t?t.p(l,b):(t=u[e]=f[e](l),t.c()),V(t,1),t.m(s.parentNode,s)):t=null);const w={};!n&&b[0]&8&&(n=!0,w.isOpen=l[3],se(()=>n=!1)),!m&&b[0]&16&&(m=!0,w.selectedVisibility=l[4],se(()=>m=!1)),a.$set(w)},i(l){o||(V(t),V(a.$$.fragment,l),o=!0)},o(l){x(t),x(a.$$.fragment,l),o=!1},d(l){l&&y(s),~e&&u[e].d(l),L(a,l)}}}function at(i){const e=i.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function ot(i){const e=i.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function lt(i,e,t){let s,a,n,m,o;ee(i,me,c=>t(29,a=c)),ee(i,ne,c=>t(30,n=c)),ee(i,Le,c=>t(31,m=c)),ee(i,we,c=>t(14,o=c));const f=ze.getPlatform()!=="web",u=m.url.searchParams.get("type");let r=0,{data:h}=e,p=h.posts,_="",l=!1,b="public",v=!1,w,j=0,S=0;async function $(){try{const c=p==null?void 0:p.at(0);(await fetch(`${le}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${oe()}`},body:JSON.stringify({placeIdx:c.place_idx,text:_,media:s,permission:b})})).ok&&await te(`/places/${c.place_idx}`,{replaceState:!0,invalidateAll:!0})}catch(c){console.error(c),G.emit("pushSnackbar",{message:"게시글 업로드에 실패했습니다"})}}async function I(){try{const c=await fetch(`${le}/posts/${m.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${oe()}`},body:JSON.stringify({text:_})});if(!c.ok){(await c.json()).status===401&&(G.emit("pushSnackbar",{message:"접근할 수 없습니다"}),te(`/viewer?postIdx=${m.url.searchParams.get("postIdx")}`));return}await te("/users/0",{replaceState:!0,invalidateAll:!0})}catch(c){console.error(c),G.emit("pushSnackbar",{message:"게시글 수정에 실패했습니다"})}}let k=0;function D(){const c=w.getBoundingClientRect();S=window.innerHeight-c.bottom,console.log({containerBottomDistance:S}),ae.addListener("keyboardWillShow",Pe=>{j=Pe.keyboardHeight,t(7,k=S-j),console.log({movementY:k})}),ae.addListener("keyboardWillHide",()=>{t(7,k=0)})}function N(){ae.removeAllListeners()}je(()=>{var c,q;f&&D(),n?(t(2,_=n),re(ne,n="",n)):(c=p[0])!=null&&c.text&&t(2,_=(q=p[0])==null?void 0:q.text)}),Fe(()=>{f&&N(),re(ne,n="",n),re(me,a="",a)});function F(c){const q=c.target;t(2,_=q.innerText),t(1,p[0]={...p[0],text:_},p)}let d=_.trim()==="";const g=()=>{t(0,r=1)};function J(c){p=c,t(1,p)}function K(c){Q[c?"unshift":"push"](()=>{w=c,t(6,w)})}const R=c=>{at(c),t(8,d=!1)},U=c=>{ot(c),t(8,d=!_.trim())},Z=()=>{t(3,l=!0)},Ae=async()=>{v||(t(5,v=!0),G.emit("loading",!0),u==="post"?await $():u==="patch"&&await I(),t(5,v=!1),G.emit("loading",!1))},Ee=()=>{t(0,r=0)};function Ve(c){p=c,t(1,p)}function xe(c){l=c,t(3,l)}function Se(c){b=c,t(4,b)}return i.$$set=c=>{"data"in c&&t(13,h=c.data)},i.$$.update=()=>{i.$$.dirty[0]&16384&&(s=o)},[r,p,_,l,b,v,w,k,d,u,$,I,F,h,o,g,J,K,R,U,Z,Ae,Ee,Ve,xe,Se]}class It extends $e{constructor(e){super(),Be(this,e,lt,rt,ye,{data:13},null,[-1,-1])}}export{It as component,Dt as universal};
