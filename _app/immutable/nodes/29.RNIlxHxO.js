import{b as Fe,g as ae}from"../chunks/sign.BBgk6cOM.js";import{e as te}from"../chunks/index.CpVCPPfc.js";import{A as le,f as ke,g as _e,h as ne,I as ye,k as me}from"../chunks/store.BtQMk9df.js";import{l as He,s as $e,e as V,c as S,b as N,f as k,v as w,i as j,t as ue,a as P,d as ce,g as T,h as A,A as W,O as Me,j as he,n as fe,w as Q,x as U,k as se,y as Le,B as ze,Q as re,D as ge,U as Ke,F as Re,z as Be,M as be}from"../chunks/scheduler.DAfLlBmd.js";import{e as G}from"../chunks/emitter.E5P-NQ8u.js";import{g as ie}from"../chunks/entry.DU4lpn5I.js";import{S as De,i as Ae,g as pe,e as de,t as I,a as E,c as H,d as M,m as L,f as z,b as X}from"../chunks/index.CPgTt4Co.js";import{H as Ie}from"../chunks/Header.DLG1rwVR.js";import{V as Ee}from"../chunks/Viewer.CdAnFpvx.js";/* empty css                                                   */import{p as Ye}from"../chunks/stores.l9jxXE9S.js";import{K as oe}from"../chunks/ActionSheet.svelte_svelte_type_style_lang.DPFKRIXC.js";import{C as Je}from"../chunks/device.CQ0dgiQh.js";import{e as ve,u as qe,o as Ge}from"../chunks/each.D2XP5b8G.js";import{I as We}from"../chunks/IconChevronRight.CjKi9yWi.js";import{B as Qe}from"../chunks/BottomNavigationPadder.0TIc1Vg0.js";import{V as Ue}from"../chunks/VisibilitySheet.BTJkTWgL.js";import{N as Xe}from"../chunks/NavigationBar._8OqrYQd.js";import{A as Ze}from"../chunks/ActionSheetOpenApp.1l1rBinh.js";const et=async({fetch:i,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return te(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const s=Fe();return{posts:[{user_idx:s==null?void 0:s.sub,unique_name:s==null?void 0:s.uni,profile_image_url:s==null?void 0:s.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:He(ke),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const s=e.searchParams.get("postIdx");if(s==="null")return G.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),ie("/viewer",{replaceState:!0});s||te(404,"Not Found");const r=await i(`${le}/posts/${s}`,{method:"GET",headers:{Authorization:"Bearer "+ae()}}).then(n=>n.json()).then(n=>n.data);return r.error&&te(404,"Not Found"),{posts:[{...r,mediaIdx:0}]}}return te(404,"Not Found")},Nt=Object.freeze(Object.defineProperty({__proto__:null,load:et},Symbol.toStringTag,{value:"Module"}));function Ce(i,e,t){const s=i.slice();return s[1]=e[t],s[3]=t,s}function tt(i){let e;return{c(){e=V("div"),this.h()},l(t){e=S(t,"DIV",{class:!0}),N(e).forEach(k),this.h()},h(){w(e,"class","w-0.5")},m(t,s){j(t,e,s)},i:fe,o:fe,d(t){t&&k(e)}}}function st(i){let e,t;return e=new We({props:{fill:"#6B7280",length:"1.25"}}),{c(){H(e.$$.fragment)},l(s){M(e.$$.fragment,s)},m(s,r){L(e,s,r),t=!0},i(s){t||(I(e.$$.fragment,s),t=!0)},o(s){E(e.$$.fragment,s),t=!1},d(s){z(e,s)}}}function we(i,e){let t,s,r=e[1].title+"",n,g,l,u,p=e[1].value+"",d,c,a,_,B,O,v,$,x;const o=[st,tt],m=[];function D(y,C){return y[1].onClick?0:1}return a=D(e),_=m[a]=o[a](e),{key:i,first:null,c(){t=V("div"),s=V("span"),n=ue(r),g=P(),l=V("div"),u=V("span"),d=ue(p),c=P(),_.c(),B=P(),this.h()},l(y){t=S(y,"DIV",{class:!0});var C=N(t);s=S(C,"SPAN",{class:!0});var F=N(s);n=ce(F,r),F.forEach(k),g=T(C),l=S(C,"DIV",{class:!0});var K=N(l);u=S(K,"SPAN",{class:!0});var h=N(u);d=ce(h,p),h.forEach(k),c=T(K),_.l(K),K.forEach(k),B=T(C),C.forEach(k),this.h()},h(){w(s,"class","text-white text-sm font-medium"),w(u,"class","text-gray-500 text-xs"),w(l,"class","flex items-center gap-2"),w(t,"class",O=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(y,C){j(y,t,C),A(t,s),A(s,n),A(t,g),A(t,l),A(l,u),A(u,d),A(l,c),m[a].m(l,null),A(t,B),v=!0,$||(x=W(t,"click",function(){Me(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),$=!0)},p(y,C){e=y,(!v||C&1)&&r!==(r=e[1].title+"")&&he(n,r),(!v||C&1)&&p!==(p=e[1].value+"")&&he(d,p);let F=a;a=D(e),a!==F&&(pe(),E(m[F],1,1,()=>{m[F]=null}),de(),_=m[a],_||(_=m[a]=o[a](e),_.c()),I(_,1),_.m(l,null)),(!v||C&1&&O!==(O=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&w(t,"class",O)},i(y){v||(I(_),v=!0)},o(y){E(_),v=!1},d(y){y&&k(t),m[a].d(),$=!1,x()}}}function it(i){let e,t=[],s=new Map,r,n=ve(i[0]);const g=l=>l[1].id;for(let l=0;l<n.length;l+=1){let u=Ce(i,n,l),p=g(u);s.set(p,t[l]=we(p,u))}return{c(){e=V("div");for(let l=0;l<t.length;l+=1)t[l].c();this.h()},l(l){e=S(l,"DIV",{class:!0});var u=N(e);for(let p=0;p<t.length;p+=1)t[p].l(u);u.forEach(k),this.h()},h(){w(e,"class","flex flex-col w-full")},m(l,u){j(l,e,u);for(let p=0;p<t.length;p+=1)t[p]&&t[p].m(e,null);r=!0},p(l,[u]){u&1&&(n=ve(l[0]),pe(),t=qe(t,u,g,1,l,n,s,e,Ge,we,null,Ce),de())},i(l){if(!r){for(let u=0;u<n.length;u+=1)I(t[u]);r=!0}},o(l){for(let u=0;u<t.length;u+=1)E(t[u]);r=!1},d(l){l&&k(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function nt(i,e,t){let{items:s=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return i.$$set=r=>{"items"in r&&t(0,s=r.items)},[s]}class rt extends De{constructor(e){super(),Ae(this,e,nt,it,$e,{items:0})}}function ot(i){let e,t,s,r,n,g,l;e=new Ie({props:{position:"fixed",leftBack:"white",centerTitle:"미리보기",leftBackOnClick:i[23],$$slots:{right:[lt]},$$scope:{ctx:i}}});function u(c){i[24](c)}let p={dontMoveVertically:!0,hideActionButtons:!0};i[1]!==void 0&&(p.posts=i[1]),s=new Ee({props:p}),Q.push(()=>X(s,"posts",u));let d=!ye&&ut();return{c(){H(e.$$.fragment),t=P(),H(s.$$.fragment),n=P(),d&&d.c(),g=ge()},l(c){M(e.$$.fragment,c),t=T(c),M(s.$$.fragment,c),n=T(c),d&&d.l(c),g=ge()},m(c,a){L(e,c,a),j(c,t,a),L(s,c,a),j(c,n,a),d&&d.m(c,a),j(c,g,a),l=!0},p(c,a){const _={};a[0]&1&&(_.leftBackOnClick=c[23]),a[0]&160|a[1]&64&&(_.$$scope={dirty:a,ctx:c}),e.$set(_);const B={};!r&&a[0]&2&&(r=!0,B.posts=c[1],U(()=>r=!1)),s.$set(B)},i(c){l||(I(e.$$.fragment,c),I(s.$$.fragment,c),I(d),l=!0)},o(c){E(e.$$.fragment,c),E(s.$$.fragment,c),E(d),l=!1},d(c){c&&(k(t),k(n),k(g)),z(e,c),z(s,c),d&&d.d(c)}}}function at(i){let e,t,s,r,n,g,l,u,p,d,c=(i[2]||"텍스트 입력하기...")+"",a,_,B,O,v,$,x,o,m,D,y,C;t=new Ie({props:{position:"static",leftBack:"white",$$slots:{right:[ct]},$$scope:{ctx:i}}});function F(h){i[17](h)}let K={dontMoveVertically:!0,isEdit:!0};return i[1]!==void 0&&(K.posts=i[1]),n=new Ee({props:K}),Q.push(()=>X(n,"posts",F)),$=new rt({props:{items:[{id:1,title:"장소",value:i[1][0].place_name||""},{id:2,title:"공개 여부",value:me[i[4]],onClick:i[21]}]}}),m=new Qe({}),{c(){e=V("section"),H(t.$$.fragment),s=P(),r=V("div"),H(n.$$.fragment),u=P(),p=V("div"),d=V("div"),a=ue(c),O=P(),v=V("div"),H($.$$.fragment),x=P(),o=V("div"),H(m.$$.fragment),this.h()},l(h){e=S(h,"SECTION",{class:!0});var b=N(e);M(t.$$.fragment,b),s=T(b),r=S(b,"DIV",{class:!0,style:!0});var R=N(r);M(n.$$.fragment,R),R.forEach(k),u=T(b),p=S(b,"DIV",{class:!0,style:!0});var Y=N(p);d=S(Y,"DIV",{contenteditable:!0,class:!0});var J=N(d);a=ce(J,c),J.forEach(k),Y.forEach(k),O=T(b),v=S(b,"DIV",{class:!0});var Z=N(v);M($.$$.fragment,Z),Z.forEach(k),x=T(b),o=S(b,"DIV",{class:!0});var ee=N(o);M(m.$$.fragment,ee),ee.forEach(k),b.forEach(k),this.h()},h(){w(r,"class","flex flex-grow"),w(r,"style",l=`transform: translateY(${i[8]}px);`),w(d,"contenteditable","true"),w(d,"class",_=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${i[9]?"text-gray-400":"text-white"}
        `),w(p,"class","h-32 px-5 py-2.5"),w(p,"style",B=`transform: translateY(${i[8]}px);`),w(v,"class",""),w(o,"class","h-40"),w(e,"class","flex flex-col w-full h-screen bg-black")},m(h,b){j(h,e,b),L(t,e,null),A(e,s),A(e,r),L(n,r,null),A(e,u),A(e,p),A(p,d),A(d,a),i[18](d),A(e,O),A(e,v),L($,v,null),A(e,x),A(e,o),L(m,o,null),D=!0,y||(C=[W(d,"input",i[13]),W(d,"focus",i[19]),W(d,"blur",i[20])],y=!0)},p(h,b){const R={};b[0]&1|b[1]&64&&(R.$$scope={dirty:b,ctx:h}),t.$set(R);const Y={};!g&&b[0]&2&&(g=!0,Y.posts=h[1],U(()=>g=!1)),n.$set(Y),(!D||b[0]&256&&l!==(l=`transform: translateY(${h[8]}px);`))&&w(r,"style",l),(!D||b[0]&4)&&c!==(c=(h[2]||"텍스트 입력하기...")+"")&&Ke(a,c),(!D||b[0]&512&&_!==(_=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${h[9]?"text-gray-400":"text-white"}
        `))&&w(d,"class",_),(!D||b[0]&256&&B!==(B=`transform: translateY(${h[8]}px);`))&&w(p,"style",B);const J={};b[0]&26&&(J.items=[{id:1,title:"장소",value:h[1][0].place_name||""},{id:2,title:"공개 여부",value:me[h[4]],onClick:h[21]}]),$.$set(J)},i(h){D||(I(t.$$.fragment,h),I(n.$$.fragment,h),I($.$$.fragment,h),I(m.$$.fragment,h),D=!0)},o(h){E(t.$$.fragment,h),E(n.$$.fragment,h),E($.$$.fragment,h),E(m.$$.fragment,h),D=!1},d(h){h&&k(e),z(t),z(n),i[18](null),z($),z(m),y=!1,Re(C)}}}function lt(i){let e,t="완료",s,r;return{c(){e=V("div"),e.textContent=t,this.h()},l(n){e=S(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),Be(e)!=="svelte-ioumnb"&&(e.textContent=t),this.h()},h(){w(e,"slot","right"),w(e,"class","text-white"),be(e,"opacity-50",i[5])},m(n,g){j(n,e,g),s||(r=W(e,"click",i[22]),s=!0)},p(n,g){g[0]&32&&be(e,"opacity-50",n[5])},d(n){n&&k(e),s=!1,r()}}}function ut(i){let e,t;return e=new Xe({}),{c(){H(e.$$.fragment)},l(s){M(e.$$.fragment,s)},m(s,r){L(e,s,r),t=!0},i(s){t||(I(e.$$.fragment,s),t=!0)},o(s){E(e.$$.fragment,s),t=!1},d(s){z(e,s)}}}function ct(i){let e,t="다음",s,r;return{c(){e=V("div"),e.textContent=t,this.h()},l(n){e=S(n,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),Be(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){w(e,"slot","right"),w(e,"class","text-white")},m(n,g){j(n,e,g),s||(r=W(e,"click",i[16]),s=!0)},p:fe,d(n){n&&k(e),s=!1,r()}}}function ft(i){let e,t,s,r,n,g,l,u,p,d;const c=[at,ot],a=[];function _(o,m){return o[0]===0?0:o[0]===1?1:-1}~(e=_(i))&&(t=a[e]=c[e](i));function B(o){i[25](o)}function O(o){i[26](o)}let v={};i[3]!==void 0&&(v.isOpen=i[3]),i[4]!==void 0&&(v.selectedVisibility=i[4]),r=new Ue({props:v}),Q.push(()=>X(r,"isOpen",B)),Q.push(()=>X(r,"selectedVisibility",O));function $(o){i[27](o)}let x={};return i[7]!==void 0&&(x.isOpen=i[7]),u=new Ze({props:x}),Q.push(()=>X(u,"isOpen",$)),{c(){t&&t.c(),s=P(),H(r.$$.fragment),l=P(),H(u.$$.fragment)},l(o){t&&t.l(o),s=T(o),M(r.$$.fragment,o),l=T(o),M(u.$$.fragment,o)},m(o,m){~e&&a[e].m(o,m),j(o,s,m),L(r,o,m),j(o,l,m),L(u,o,m),d=!0},p(o,m){let D=e;e=_(o),e===D?~e&&a[e].p(o,m):(t&&(pe(),E(a[D],1,1,()=>{a[D]=null}),de()),~e?(t=a[e],t?t.p(o,m):(t=a[e]=c[e](o),t.c()),I(t,1),t.m(s.parentNode,s)):t=null);const y={};!n&&m[0]&8&&(n=!0,y.isOpen=o[3],U(()=>n=!1)),!g&&m[0]&16&&(g=!0,y.selectedVisibility=o[4],U(()=>g=!1)),r.$set(y);const C={};!p&&m[0]&128&&(p=!0,C.isOpen=o[7],U(()=>p=!1)),u.$set(C)},i(o){d||(I(t),I(r.$$.fragment,o),I(u.$$.fragment,o),d=!0)},o(o){E(t),E(r.$$.fragment,o),E(u.$$.fragment,o),d=!1},d(o){o&&(k(s),k(l)),~e&&a[e].d(o),z(r,o),z(u,o)}}}function pt(i){const e=i.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function dt(i){const e=i.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function _t(i,e,t){let s,r,n,g,l;se(i,_e,f=>t(31,r=f)),se(i,ne,f=>t(32,n=f)),se(i,Ye,f=>t(33,g=f)),se(i,ke,f=>t(15,l=f));const u=Je.getPlatform()!=="web",p=g.url.searchParams.get("type");let d=0,{data:c}=e,a=c.posts,_="",B=!1,O="public",v=!1,$,x=0,o=0,m=!1;async function D(){try{const f=a==null?void 0:a.at(0);(await fetch(`${le}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ae()}`},body:JSON.stringify({placeIdx:f.place_idx,text:_,media:s,permission:O})})).ok&&await ie(`/places/${f.place_idx}`,{replaceState:!0,invalidateAll:!0})}catch(f){console.error(f),G.emit("pushSnackbar",{message:"게시글 업로드에 실패했습니다"})}}async function y(){try{const f=await fetch(`${le}/posts/${g.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ae()}`},body:JSON.stringify({text:_})});if(!f.ok){(await f.json()).status===401&&(G.emit("pushSnackbar",{message:"접근할 수 없습니다"}),ie(`/viewer?postIdx=${g.url.searchParams.get("postIdx")}`));return}await ie("/users/0",{replaceState:!0,invalidateAll:!0})}catch(f){console.error(f),G.emit("pushSnackbar",{message:"게시글 수정에 실패했습니다"})}}let C=0;function F(){const f=$.getBoundingClientRect();o=window.innerHeight-f.bottom,console.log({containerBottomDistance:o}),oe.addListener("keyboardWillShow",je=>{x=je.keyboardHeight,t(8,C=o-x),console.log({movementY:C})}),oe.addListener("keyboardWillHide",()=>{t(8,C=0)})}function K(){oe.removeAllListeners()}Le(()=>{var f,q;u&&F(),n?(t(2,_=n),re(ne,n="",n)):(f=a[0])!=null&&f.text&&t(2,_=(q=a[0])==null?void 0:q.text)}),ze(()=>{u&&K(),re(ne,n="",n),re(_e,r="",r)});function h(f){const q=f.target;t(2,_=q.innerText),t(1,a[0]={...a[0],text:_},a)}let b=_.trim()==="";const R=()=>{t(0,d=1)};function Y(f){a=f,t(1,a)}function J(f){Q[f?"unshift":"push"](()=>{$=f,t(6,$)})}const Z=f=>{pt(f),t(9,b=!1)},ee=f=>{dt(f),t(9,b=!_.trim())},Oe=()=>{t(3,B=!0)},Ve=async()=>{if(ye)return t(7,m=!0);v||(t(5,v=!0),G.emit("loading",!0),p==="post"?await D():p==="patch"&&await y(),t(5,v=!1),G.emit("loading",!1))},Se=()=>{t(0,d=0)};function xe(f){a=f,t(1,a)}function Ne(f){B=f,t(3,B)}function Pe(f){O=f,t(4,O)}function Te(f){m=f,t(7,m)}return i.$$set=f=>{"data"in f&&t(14,c=f.data)},i.$$.update=()=>{i.$$.dirty[0]&32768&&(s=l)},[d,a,_,B,O,v,$,m,C,b,p,D,y,h,c,l,R,Y,J,Z,ee,Oe,Ve,Se,xe,Ne,Pe,Te]}class Pt extends De{constructor(e){super(),Ae(this,e,_t,ft,$e,{data:14},null,[-1,-1])}}export{Pt as component,Nt as universal};
