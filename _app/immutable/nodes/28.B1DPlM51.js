import{s as z,m as oe,e as N,c as B,b as O,f as g,v as E,J as x,i as S,y as $,H as R,G as Y,u as ie,o as ae,p as re,F as Z,I as G,U as V,a as y,D as F,g as A,k as D,w as le,B as ce,h as fe,n as M}from"../chunks/scheduler.CbwPF6wx.js";import{S as H,i as J,t as k,a as b,c as P,b as v,m as T,e as C,d as q,g as K}from"../chunks/index.DiLw73rm.js";import{H as ue}from"../chunks/Header.CGsHx6su.js";import{V as me}from"../chunks/Viewer.D2g3vHz9.js";import{p as de}from"../chunks/stores.BbbwIbDe.js";import{N as he}from"../chunks/NavigationBar.CI-iHO6o.js";import{h as _e,l as Q,g as pe,A as W}from"../chunks/sign.BAmmjMzc.js";import"../chunks/ActionSheet.svelte_svelte_type_style_lang.U6r6tdTL.js";/* empty css                                                   */import{g as ge}from"../chunks/entry.DIQm4o-V.js";/* empty css                                                   */import{P as ke,S as be}from"../chunks/index.Dgp1wlBS.js";import{I as Ie}from"../chunks/IconSearch.CkulxtYc.js";function we(o){let e,s,t,n,l;const u=o[5].default,r=oe(u,o,o[4],null);return{c(){e=N("div"),r&&r.c(),this.h()},l(a){e=B(a,"DIV",{id:!0,class:!0,"aria-hidden":!0});var f=O(e);r&&r.l(f),f.forEach(g),this.h()},h(){E(e,"id","mask"),E(e,"class",s=x(`${o[0]?"":"hidden"} ${o[1]}`)+" svelte-eerk6g"),E(e,"aria-hidden","")},m(a,f){S(a,e,f),r&&r.m(e,null),t=!0,n||(l=[$(e,"touchstart",R(Y(o[6]))),$(e,"touchend",o[7],{passive:!0}),$(e,"click",o[8])],n=!0)},p(a,[f]){r&&r.p&&(!t||f&16)&&ie(r,u,a,a[4],t?re(u,a[4],f,null):ae(a[4]),null),(!t||f&3&&s!==(s=x(`${a[0]?"":"hidden"} ${a[1]}`)+" svelte-eerk6g"))&&E(e,"class",s)},i(a){t||(k(r,a),t=!0)},o(a){b(r,a),t=!1},d(a){a&&g(e),r&&r.d(a),n=!1,Z(l)}}}function Se(o,e,s){let{$$slots:t={},$$scope:n}=e,{onMask:l=!1}=e,{position:u="fixed"}=e,{closeOnClick:r=!1}=e,{onTouch:a=void 0}=e;function f(h){G.call(this,o,h)}const d=()=>{r?s(0,l=!1):a&&a()},_=()=>{r?s(0,l=!1):a&&a()};return o.$$set=h=>{"onMask"in h&&s(0,l=h.onMask),"position"in h&&s(1,u=h.position),"closeOnClick"in h&&s(2,r=h.closeOnClick),"onTouch"in h&&s(3,a=h.onTouch),"$$scope"in h&&s(4,n=h.$$scope)},[l,u,r,a,n,t,f,d,_]}class Ee extends H{constructor(e){super(),J(this,e,Se,we,z,{onMask:0,position:1,closeOnClick:2,onTouch:3})}}function $e(o){let e,s,t;return{c(){e=N("emoji-picker"),this.h()},l(n){e=B(n,"EMOJI-PICKER",{"aria-hidden":!0,class:!0}),O(e).forEach(g),this.h()},h(){V(e,"aria-hidden",""),V(e,"class",o[0])},m(n,l){S(n,e,l),s||(t=[$(e,"emoji-click",R(Y(o[2]))),$(e,"touchstart",R(o[4])),$(e,"touchend",R(o[5]))],s=!0)},p(n,l){l&1&&V(e,"class",n[0])},d(n){n&&g(e),s=!1,Z(t)}}}function je(o){let e,s;return e=new Ee({props:{onMask:!0,position:"absolute",onTouch:o[6],$$slots:{default:[$e]},$$scope:{ctx:o}}}),{c(){P(e.$$.fragment)},l(t){v(e.$$.fragment,t)},m(t,n){T(e,t,n),s=!0},p(t,[n]){const l={};n&2&&(l.onTouch=t[6]),n&257&&(l.$$scope={dirty:n,ctx:t}),e.$set(l)},i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){b(e.$$.fragment,t),s=!1},d(t){C(e,t)}}}function Pe(o,e,s){let{classList:t}=e,{onSelect:n}=e,{close:l}=e;function u(d){n(d.detail.unicode)}new ke({emojiVersion:15});function r(d){G.call(this,o,d)}function a(d){G.call(this,o,d)}const f=()=>{l()};return o.$$set=d=>{"classList"in d&&s(0,t=d.classList),"onSelect"in d&&s(3,n=d.onSelect),"close"in d&&s(1,l=d.close)},[t,l,u,n,r,a,f]}class ve extends H{constructor(e){super(),J(this,e,Pe,je,z,{classList:0,onSelect:3,close:1})}}function Te(o){let e,s,t,n,l,u;return t=new Ie({props:{width:"24",height:"24"}}),{c(){e=N("div"),s=N("button"),P(t.$$.fragment),this.h()},l(r){e=B(r,"DIV",{slot:!0,class:!0});var a=O(e);s=B(a,"BUTTON",{});var f=O(s);v(t.$$.fragment,f),f.forEach(g),a.forEach(g),this.h()},h(){E(e,"slot","right"),E(e,"class","flex items-center gap-2")},m(r,a){S(r,e,a),fe(e,s),T(t,s,null),n=!0,l||(u=$(s,"click",o[8]),l=!0)},p:M,i(r){n||(k(t.$$.fragment,r),n=!0)},o(r){b(t.$$.fragment,r),n=!1},d(r){r&&g(e),C(t),l=!1,u()}}}function Ce(o){let e,s;return e=new me({props:{posts:o[0].posts,index:o[0].index,selectedReaction:o[1]}}),{c(){P(e.$$.fragment)},l(t){v(e.$$.fragment,t)},m(t,n){T(e,t,n),s=!0},p(t,n){const l={};n&1&&(l.posts=t[0].posts),n&1&&(l.index=t[0].index),n&2&&(l.selectedReaction=t[1]),e.$set(l)},i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){b(e.$$.fragment,t),s=!1},d(t){C(e,t)}}}function Me(o){let e;return{c(){e=N("div"),this.h()},l(s){e=B(s,"DIV",{class:!0}),O(e).forEach(g),this.h()},h(){E(e,"class","w-full h-full")},m(s,t){S(s,e,t)},p:M,i:M,o:M,d(s){s&&g(e)}}}function X(o){let e,s;return e=new ve({props:{classList:"absolute bottom-24 right-0 px-4 z-50",onSelect:o[4],close:o[9]}}),{c(){P(e.$$.fragment)},l(t){v(e.$$.fragment,t)},m(t,n){T(e,t,n),s=!0},p:M,i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){b(e.$$.fragment,t),s=!1},d(t){C(e,t)}}}function Ne(o){let e,s,t,n,l,u,r,a,f;e=new ue({props:{position:"fixed",leftBack:o[2]?"":"white",$$slots:{right:[Te]},$$scope:{ctx:o}}});const d=[Me,Ce],_=[];function h(i,c){return i[0].posts.length===0?0:1}t=h(o),n=_[t]=d[t](o),u=new he({});let m=o[3]&&X(o);return{c(){P(e.$$.fragment),s=y(),n.c(),l=y(),P(u.$$.fragment),r=y(),m&&m.c(),a=F()},l(i){v(e.$$.fragment,i),s=A(i),n.l(i),l=A(i),v(u.$$.fragment,i),r=A(i),m&&m.l(i),a=F()},m(i,c){T(e,i,c),S(i,s,c),_[t].m(i,c),S(i,l,c),T(u,i,c),S(i,r,c),m&&m.m(i,c),S(i,a,c),f=!0},p(i,[c]){const I={};c&4&&(I.leftBack=i[2]?"":"white"),c&4096&&(I.$$scope={dirty:c,ctx:i}),e.$set(I);let w=t;t=h(i),t===w?_[t].p(i,c):(K(),b(_[w],1,1,()=>{_[w]=null}),q(),n=_[t],n?n.p(i,c):(n=_[t]=d[t](i),n.c()),k(n,1),n.m(l.parentNode,l)),i[3]?m?(m.p(i,c),c&8&&k(m,1)):(m=X(i),m.c(),k(m,1),m.m(a.parentNode,a)):m&&(K(),b(m,1,1,()=>{m=null}),q())},i(i){f||(k(e.$$.fragment,i),k(n),k(u.$$.fragment,i),k(m),f=!0)},o(i){b(e.$$.fragment,i),b(n),b(u.$$.fragment,i),b(m),f=!1},d(i){i&&(g(s),g(l),g(r),g(a)),C(e,i),_[t].d(i),C(u,i),m&&m.d(i)}}}function Be(o,e,s){let t,n,l,u,r,a;D(o,de,c=>s(7,u=c)),D(o,_e,c=>s(11,r=c)),D(o,Q,c=>s(3,a=c));let f={posts:[],index:0},d,_;le(async()=>{await be.hide();let c="";try{c=pe()}catch{}const I=new URLSearchParams(window.location.search),w=Number(I.get("postIdx")||0);Number(I.get("mediaIdx")||0);const ee=0,te=30,se=`&offset=${ee}`,ne=`&limit=${te}`;let j=[];(n||t)&&r.length>0?(j=r.map(p=>p.idx===w?{...p,mediaIdx:p.mediaIdx||0}:{...p,mediaIdx:0}),s(0,f.index=j.findIndex(p=>p.idx===String(w)),f)):(_=new AbortController,w&&(j=[await fetch(`${W}/posts/${w}`,{method:"GET",headers:{Authorization:"Bearer "+c},signal:_.signal}).then(p=>p.json()).then(p=>({...p.data,mediaIdx:p.data.mediaIdx||0}))]),j=[...j,...await fetch(`${W}/posts?${se}${ne}`,{method:"GET",headers:{Authorization:"Bearer "+c},signal:_.signal}).then(p=>p.json()).then(p=>{var U;return(U=p.data)==null?void 0:U.posts.filter(L=>L.idx!==String(w)).map(L=>({...L,mediaIdx:L.mediaIdx||0}))})||[]]),s(0,f.posts=j,f)}),ce(()=>{_&&_.abort()});async function h(c){const I=u.url.searchParams.get("postIdx");I&&s(1,d={postIdx:I,reaction:c})}const m=async()=>{await ge("/search")},i=()=>{Q.set(!1)};return o.$$.update=()=>{o.$$.dirty&128&&s(5,t=u.url.searchParams.get("placeIdx")),o.$$.dirty&128&&s(6,n=u.url.searchParams.get("userIdx")),o.$$.dirty&96&&s(2,l=!t&&!n)},[f,d,l,a,h,t,n,u,m,i]}class Fe extends H{constructor(e){super(),J(this,e,Be,Ne,z,{})}}export{Fe as component};
