import{R as Y,s as Q,A as ee,e as f,a as A,c as E,b as O,f as F,g as b,m as w,o as x,i as _,h,p as v,B as k,C as te,v as ue}from"../chunks/scheduler.BRSuf-vg.js";import{S as ie,i as ae,e as oe,c as N,b as V,m as z,t as H,a as J,d as q}from"../chunks/index.C48quBYD.js";import{C as ne}from"../chunks/CardDeck.-uAHUpK8.js";import{f as re,s as W,M as se}from"../chunks/Map.DvPeRn2O.js";import{e as s}from"../chunks/emitter.E5P-NQ8u.js";import{i as Ce,A as le,a as Be,s as de,b as me}from"../chunks/store.0TigkDDx.js";import"../chunks/CardOption.D8YpAZvW.js";import{g as K,a as $,s as pe}from"../chunks/index.Bn3ai4mD.js";import"../chunks/entry.DprQV22C.js";import{C as ce,F as ge,t as he,h as fe}from"../chunks/heic2any.5cvlrJ2N.js";async function Ee(n){return new Promise((i,a)=>{const u=new Image;u.onload=()=>{const e=document.createElement("canvas");let o=u.width,t=u.height;o>t?o>1280&&(t=Math.round(t*1280/o),o=1280):t>720&&(o=Math.round(o*720/t),t=720),e.width=o,e.height=t;const C=e.getContext("2d");if(!C){a(new Error("Canvas context not available"));return}C.drawImage(u,0,0,o,t),i(e.toDataURL("image/jpeg",.9))},u.onerror=()=>a(new Error("Failed to load image")),u.src=n})}async function Fe(n){const i=await fetch(n).then(u=>u.blob()),a=await fe({blob:i,toType:"image/jpeg",quality:.9});return new Promise(u=>{const e=new FileReader;e.onloadend=()=>u(e.result),e.readAsDataURL(a)})}async function xe(){if(Ce){const t=await ce.requestPermissions({permissions:["photos"]});if(t.photos!=="granted"&&t.photos!=="limited")throw s.emit("pushSnackbar",{message:"사진에 접근할 수 없습니다. 권한을 허용해주세요."}),new Error("Photos permission not granted")}const n=(await ge.pickImages({readData:!0,limit:1})).files;if(n.length===0)throw new Error("No images selected");const i=n[0];if(!i.data)throw new Error("No image data");const a=await he.parse(i.data),u=a.latitude,e=a.longitude;u&&e&&s.emit("flyTo",re([e,u]));let o=`data:${i.mimeType};base64,${i.data}`;return(i.mimeType==="image/heic"||i.mimeType==="image/heif")&&(o=await Fe(o)),{base64Url:o,metadata:a}}async function De(n){n=await Ee(n);const a=await(await fetch(n)).blob();return new File([a],"image.jpg",{type:"image/jpeg",lastModified:Date.now()})}async function Z(n,i,a="private",u){const e=new FormData;e.append("image",n),e.append("emojis",i),e.append("visibility",a),u.longitude&&u.latitude&&e.append("location",JSON.stringify({longitude:u.longitude,latitude:u.latitude})),e.append("metadata",JSON.stringify(u));const o=await fetch(`${le}/posts/dots`,{method:"POST",headers:{"x-api-version":Be.DOTS,Authorization:`Bearer ${K()}`},body:e}),t=await o.json();if(!o.ok)throw new Error(t.message||"Failed to create dot");return t.data}function Ae(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const i=crypto.getRandomValues(new Uint8Array(1))[0]&15;return(n==="x"?i:i&3|8).toString(16)})}async function be(){const n=K();let i="",a={},u=null,e=null;if(!n){s.emit("pushCard",{idx:"111",type:"signIn",unflippable:!0});return}let o=Ae();s.emit("pushCard",{idx:o,type:"photo",unflippable:!0,ownerIdx:String($()),image:"/graydot.png",emoji:"",back:"카드 뒷면입니다",left:"나만 볼 수 있게 담아둘게요",onDumpLeft:async()=>{s.emit("loading",!0);const t=await Z(u,(e==null?void 0:e.type)==="photo"?e.emoji:"","private",a);s.emit("loading",!1),s.emit("pushCard",{idx:t.idx,ownerIdx:String($()),type:"photo",image:W(t.image_url),emoji:t.emojis,back:t.text})},right:"모두가 볼 수 있게 남겨요",onDumpRight:async()=>{s.emit("loading",!0);const t=await Z(u,(e==null?void 0:e.type)==="photo"?e.emoji:"","public",a);s.emit("loading",!1),s.emit("pushCard",{idx:t.idx,ownerIdx:String($()),type:"photo",image:W(t.image_url),emoji:t.emojis,back:t.text})},rightColor:"positive",onLoad:async()=>{try{const{base64Url:t,metadata:C}=await xe();if(i=t,a=C,i.length===0)throw new Error("No images selected")}catch{s.emit("removeCardByIdx",{idx:o}),s.emit("pushCard",{idx:"102",type:"message",front:"사진을 불러오지 못했어요",back:"사진을 불러오지 못했어요",left:"넘어갈게",right:"넘어갈게"});return}s.emit("setCardByIdx",{idx:o,card:{image:i}}),de.set({isOpen:!0,type:"emoji"}),u=await De(i),e=Y(me).find(t=>t.idx===o)}})}function ye(n){let i,a,u,e,o,t,C,l,B,j="카드 덱 불러오기",S,m,R="카드 하나 추가하기",I,p,U="로그아웃",T,c,G="카드 신규 등록하기",y,P,L;a=new se({});function X(r){n[2](r)}let M={};return n[0]!==void 0&&(M.cards=n[0]),e=new ne({props:M}),ee.push(()=>oe(e,"cards",X)),{c(){i=f("div"),N(a.$$.fragment),u=A(),N(e.$$.fragment),t=A(),C=f("div"),l=f("div"),B=f("button"),B.textContent=j,S=A(),m=f("button"),m.textContent=R,I=A(),p=f("button"),p.textContent=U,T=A(),c=f("button"),c.textContent=G,this.h()},l(r){i=E(r,"DIV",{class:!0});var d=O(i);V(a.$$.fragment,d),d.forEach(F),u=b(r),V(e.$$.fragment,r),t=b(r),C=E(r,"DIV",{class:!0});var D=O(C);l=E(D,"DIV",{class:!0});var g=O(l);B=E(g,"BUTTON",{class:!0,"data-svelte-h":!0}),w(B)!=="svelte-1ypo7e6"&&(B.textContent=j),S=b(g),m=E(g,"BUTTON",{class:!0,"data-svelte-h":!0}),w(m)!=="svelte-34rce8"&&(m.textContent=R),I=b(g),p=E(g,"BUTTON",{class:!0,"data-svelte-h":!0}),w(p)!=="svelte-697xgu"&&(p.textContent=U),T=b(g),c=E(g,"BUTTON",{class:!0,"data-svelte-h":!0}),w(c)!=="svelte-108817t"&&(c.textContent=G),g.forEach(F),D.forEach(F),this.h()},h(){x(i,"class","fixed inset-0"),x(B,"class","w-full bg-blue-500 text-white p-4 rounded-lg"),x(m,"class","w-full bg-blue-500 text-white p-4 rounded-lg"),x(p,"class","w-full bg-blue-500 text-white p-4 rounded-lg"),x(c,"class","w-full bg-blue-500 text-white p-4 rounded-lg"),x(l,"class","flex gap-4"),x(C,"class","fixed w-full bottom-0 p-6 z-[100]")},m(r,d){_(r,i,d),z(a,i,null),_(r,u,d),z(e,r,d),_(r,t,d),_(r,C,d),h(C,l),h(l,B),h(l,S),h(l,m),h(l,I),h(l,p),h(l,T),h(l,c),y=!0,P||(L=[v(B,"click",k(n[3])),v(m,"click",k(n[4])),v(p,"click",k(n[5])),v(c,"click",k(be))],P=!0)},p(r,[d]){const D={};!o&&d&1&&(o=!0,D.cards=r[0],te(()=>o=!1)),e.$set(D)},i(r){y||(H(a.$$.fragment,r),H(e.$$.fragment,r),y=!0)},o(r){J(a.$$.fragment,r),J(e.$$.fragment,r),y=!1},d(r){r&&(F(i),F(u),F(t),F(C)),q(a),q(e,r),P=!1,ue(L)}}}function we(n,i,a){let u=[{idx:"1",type:"photo",image:"/h1.jpeg",emoji:"🧸🎀✨💎✨🎀",back:"카드 뒷면입니다",left:"넘어갈게",right:"카드 위에서 불러오기",rightColor:"positive",onDumpRight:()=>{s.emit("pushCard",{idx:"10",type:"message",front:"메시지 카드 앞면입니다",back:"카드 뒷면입니다",left:"버리기",right:"버리기",pushAnimation:!0,pushDirection:"top",pushOffset:300})}},{idx:"2",type:"photo",image:"/h2.png",emoji:"🔥🌴😆🚂",back:"카드 뒷면입니다",left:"넘어갈게",right:"카드 오른쪽에서 불러오기",rightColor:"positive",onDumpRight:()=>{s.emit("pushCard",{idx:"9",type:"message",front:"메시지 카드 앞면입니다",back:"카드 뒷면입니다",left:"버리기",right:"버리기",pushAnimation:!0,pushDirection:"right",pushOffset:300})}},{idx:"3",type:"photo",image:"/h1.jpeg",emoji:"🧸🎀✨💎✨🎀",back:"카드 뒷면입니다",left:"넘어갈게",right:"카드 아래에서 불러오기",rightColor:"positive",onDumpRight:()=>{s.emit("pushCard",{idx:"8",type:"message",front:"메시지 카드 앞면입니다",back:"카드 뒷면입니다",left:"버리기",right:"버리기",pushAnimation:!0,pushDirection:"bottom",pushOffset:300})}},{idx:"4",ownerIdx:"5",type:"photo",image:"/h2.png",emoji:"🔥🌴😆🚂",back:"안녕하세요 블루닷입니다 안녕하세요 블루닷입니다 안녕하세요 블루닷입니다 hello nice to meet you 안녕하세요 블루닷입니다 안녕하세요 블루닷입니다 안녕하세요 블루닷입니다 hello nice to meet you 안녕하세요 블루닷입니다 안녕하세요 블루닷입니다 안녕하세요 블루닷입니다 hello very nice to meet you 안녕하세요 블루닷입니다",left:"넘어갈게",right:"카드 왼쪽에서 불러오기",rightColor:"positive",onDumpRight:()=>{s.emit("pushCard",{idx:"7",type:"message",front:"메시지 카드 앞면입니다",back:"카드 뒷면입니다",left:"버리기",right:"버리기",pushAnimation:!0,pushDirection:"left",pushOffset:300})}},{idx:"5",ownerIdx:"5",type:"photo",image:"/h1.jpeg",emoji:"✨️️🎀🧸💎✨️️🎀🧸✨️️🎀🧸💎✨️️🎀🧸✨️️🎀🧸💎✨️️🎀🧸✨️️🎀🧸💎✨",back:"첫눈 오는 날, 눈 코에 묻히고 공 물고 웃던 너. 그 순간이 겨울의 선물 같았어.",metadata:{ISO:1e3,Make:"Apple",Flash:"Flash did not fire, compulsory flash mode",Model:"iPhone 12 mini",FNumber:1.6,GPSSpeed:0,LensInfo:[1.5499999523160568,4.2,1.6,2.4],LensMake:"Apple",Software:"18.4.1",latitude:37.48358888888889,LensModel:"iPhone 12 mini back dual wide camera 4.2mm f/1.6",SceneType:"Directly photographed",TileWidth:512,longitude:127.12267222222222,ColorSpace:65535,CreateDate:"2025-04-20T11:30:05.000Z",ModifyDate:"2025-04-20T11:30:05.000Z",OffsetTime:"+09:00",TileLength:512,ExifVersion:"2.3.2",FocalLength:4.2,GPSAltitude:49.36820199778025,GPSLatitude:[37,29,.92],GPSSpeedRef:"K",Orientation:"Horizontal (normal)",SubjectArea:{0:2015,1:1511,2:2217,3:1330},XResolution:72,YResolution:72,ExposureMode:"Auto",ExposureTime:.06666666666666667,GPSDateStamp:"2025:04:20",GPSLongitude:[127,7,21.62],GPSTimeStamp:"11:30:0",HostComputer:"iPhone 12 mini",MeteringMode:"Pattern",WhiteBalance:"Auto",ApertureValue:1.3561438092556088,SensingMethod:"One-chip color area sensor",CompositeImage:"General Composite Image",CustomRendered:"Portrait",ExifImageWidth:4032,GPSAltitudeRef:{0:0},GPSDestBearing:281.1631162507608,GPSLatitudeRef:"N",ResolutionUnit:"inches",BrightnessValue:-3.649343070856395,ExifImageHeight:3024,ExposureProgram:"Normal program",GPSImgDirection:281.1631162507608,GPSLongitudeRef:"E",DateTimeOriginal:"2025-04-20T11:30:05.000Z",GPSDestBearingRef:"True North",ShutterSpeedValue:3.9070565174779484,GPSImgDirectionRef:"T",OffsetTimeOriginal:"+09:00",SubSecTimeOriginal:"339",OffsetTimeDigitized:"+09:00",SubSecTimeDigitized:"339",ExposureCompensation:0,GPSHPositioningError:25.48698844617212,FocalLengthIn35mmFormat:26},left:"넘어갈게",right:"카드 한장 뿅하고 불러오기",rightColor:"positive",onDumpRight:()=>{s.emit("pushCard",{idx:"6",type:"message",front:"메시지 카드 앞면입니다",back:"카드 뒷면입니다",left:"버리기",right:"버리기"})}}];const e=u;function o(B){u=B,a(0,u)}return[u,e,o,()=>{s.emit("setCards",e)},()=>{s.emit("pushCard",{idx:"10",type:"message",front:"메시지 카드 앞면입니다",back:"카드 뒷면입니다",left:"넘어갈게",right:"넘어갈게"})},()=>{pe()}]}class Re extends ie{constructor(i){super(),ae(this,i,we,ye,Q,{})}}export{Re as component};
