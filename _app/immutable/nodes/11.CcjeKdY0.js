import{s as q,z as Y,a as M,g as N,i as T,A as z,f as v,k as G,w as J,B as R,e as D,t as U,c as y,b as k,x as Q,d as X,v as x,h as _,y as Z}from"../chunks/scheduler.DH3jNSXp.js";import{S as ee,i as te,f as j,c as A,b as w,m as E,t as I,a as P,e as O}from"../chunks/index.DhGy8j-A.js";import{H as ae}from"../chunks/Header.CLSHWa3i.js";import{M as oe}from"../chunks/Map.DGN6Z4Dr.js";import{a as H}from"../chunks/map.BpNHtH6C.js";import{p as se}from"../chunks/stores.CYA_ar22.js";import{A as ne}from"../chunks/ActionSheet.mW9DJXL8.js";import{F as ie}from"../chunks/Field.BZMlBY_y.js";import{A as re}from"../chunks/store.C5jSRtHQ.js";import{C as le,e as h}from"../chunks/emitter.Co9ynRYp.js";import{i as ue}from"../chunks/sign.BovAJDCh.js";import{g as fe}from"../chunks/entry.D39XzYmX.js";import{t as me}from"../chunks/proj.DXH8zrwl.js";import{K}from"../chunks/ActionSheet.svelte_svelte_type_style_lang.B6mFMjYn.js";function pe(i){let o,t,r="이 장소를 뭐라고 부를까요?",d,a,n,m,f,p,e,l,g,C,$,S;function F(u){i[6](u)}let s={clear:!0,clearColor:"#757475",padding:"pb-2.5",border:"border-b border-b-[#757475]",fontSize:"font-normal text-sm",fontColor:"text-white",limit:20,useCounter:!1,backgroundColor:"bg-transparent",placeholder:"장소 이름을 입력하세요",placeholderColor:"#757475"};return i[1]!==void 0&&(s.value=i[1]),n=new ie({props:s}),Y.push(()=>j(n,"value",F)),{c(){o=D("div"),t=D("p"),t.textContent=r,d=M(),a=D("div"),A(n.$$.fragment),f=M(),p=D("div"),e=D("button"),l=U("장소 추가"),this.h()},l(u){o=y(u,"DIV",{class:!0});var c=k(o);t=y(c,"P",{class:!0,"data-svelte-h":!0}),Q(t)!=="svelte-9vo44h"&&(t.textContent=r),d=N(c),a=y(c,"DIV",{class:!0});var b=k(a);w(n.$$.fragment,b),b.forEach(v),f=N(c),p=y(c,"DIV",{class:!0});var L=k(p);e=y(L,"BUTTON",{class:!0});var B=k(e);l=X(B,"장소 추가"),B.forEach(v),L.forEach(v),c.forEach(v),this.h()},h(){x(t,"class","py-2.5 font-semibold text-sm leading-[17px] text-white"),x(a,"class","box-name flex flex-col gap-4 py-2.5"),x(e,"class","w-full p-2.5 rounded-[50px] font-medium text-sm leading-[17px] bg-[#0C79FE] text-white disabled:bg-[#383838]/70 disabled:text-[#757475]"),e.disabled=g=!i[1].trim(),x(p,"class","py-2.5"),x(o,"class","px-4")},m(u,c){T(u,o,c),_(o,t),_(o,d),_(o,a),E(n,a,null),_(o,f),_(o,p),_(p,e),_(e,l),C=!0,$||(S=Z(e,"click",i[4]),$=!0)},p(u,c){const b={};!m&&c&2&&(m=!0,b.value=u[1],z(()=>m=!1)),n.$set(b),(!C||c&2&&g!==(g=!u[1].trim()))&&(e.disabled=g)},i(u){C||(I(n.$$.fragment,u),C=!0)},o(u){P(n.$$.fragment,u),C=!1},d(u){u&&v(o),O(n),$=!1,S()}}}function ce(i){let o,t,r,d,a,n,m;o=new ae({props:{position:"fixed",leftBack:"black"}}),r=new oe({props:{onSelect:i[3],mapY:i[2]}});function f(e){i[7](e)}let p={fixed:!0,noHandle:!0,$$slots:{default:[pe]},$$scope:{ctx:i}};return i[0]!==void 0&&(p.isOpen=i[0]),a=new ne({props:p}),Y.push(()=>j(a,"isOpen",f)),{c(){A(o.$$.fragment),t=M(),A(r.$$.fragment),d=M(),A(a.$$.fragment)},l(e){w(o.$$.fragment,e),t=N(e),w(r.$$.fragment,e),d=N(e),w(a.$$.fragment,e)},m(e,l){E(o,e,l),T(e,t,l),E(r,e,l),T(e,d,l),E(a,e,l),m=!0},p(e,[l]){const g={};l&4&&(g.mapY=e[2]),r.$set(g);const C={};l&16386&&(C.$$scope={dirty:l,ctx:e}),!n&&l&1&&(n=!0,C.isOpen=e[0],z(()=>n=!1)),a.$set(C)},i(e){m||(I(o.$$.fragment,e),I(r.$$.fragment,e),I(a.$$.fragment,e),m=!0)},o(e){P(o.$$.fragment,e),P(r.$$.fragment,e),P(a.$$.fragment,e),m=!1},d(e){e&&(v(t),v(d)),O(o,e),O(r,e),O(a,e)}}}function de(i,o,t){let r;G(i,se,s=>t(9,r=s));const d=le.isNativePlatform();let a=!1,n="",m=!1,f,p=0;function e(){K.addListener("keyboardWillShow",s=>{t(2,p=-200)}),K.addListener("keyboardWillHide",()=>{t(2,p=0)})}function l(){K.removeAllListeners()}J(()=>{let s=r.url.searchParams.get("location");s&&(r.url.searchParams.delete("location"),t(5,f=s.split(",").map(Number)),fe(r.url.toString(),{replaceState:!0,invalidateAll:!1})),d&&e()}),R(()=>{H.setPosition(void 0),d&&l()});function g(s){H.setPosition(s),t(0,a=s!==void 0)}function C(s){t(5,f=s),h.emit("flyTo",f)}function $(){if(!ue())return h.emit("showSignInModal",{removable:!0});if(m)return h.emit("pushSnackbar",{message:"처리중입니다. 잠시 후 다시 시도해주세요"});m=!0;const s=n.trim();if(!s||f===void 0)return;const[u,c]=me(f);fetch(`${re}/places`,{method:"POST",body:JSON.stringify([{name:s,location:{lon:Number(u.toFixed(6)),lat:Number(c.toFixed(6))}}])}).then(async b=>{var V,W;if(!b.ok)return h.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});const B=(W=(V=(await b.json()).data)==null?void 0:V.at(0))==null?void 0:W.idx;t(5,f=void 0),h.emit("pushSnackbar",{message:`'${s}' 장소를 추가했습니다`}),B&&h.emit("addIconByPlaceIdx",B)}).catch(b=>{console.log(b),h.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."})}).finally(()=>{m=!1})}function S(s){n=s,t(1,n),t(0,a)}function F(s){a=s,t(0,a)}return i.$$.update=()=>{i.$$.dirty&1&&(a||(t(1,n=""),m=!1,H.setPosition(void 0))),i.$$.dirty&32&&g(f)},[a,n,p,C,$,f,S,F]}class we extends ee{constructor(o){super(),te(this,o,de,ce,q,{})}}export{we as component};
