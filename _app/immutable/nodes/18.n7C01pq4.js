import{g as T}from"../chunks/sign.CibkwJq2.js";import{e as S}from"../chunks/index.CfhHBTdT.js";import{A as k}from"../chunks/constants.bFPGP2yY.js";import{s as z,e as D,c as J,b as M,f as d,l as Q,R as W,i as m,S as N,u as O,n as I,r as X,v as Y,t as H,d as R,C as j,h as ee,j as te,J as se,T as ae,x as q,a as A,g as P,z as G,k as oe}from"../chunks/scheduler.BRtuPHcG.js";import{S as V,i as L,e as U,c as h,a as b,m as $,t as C,b as w,d as y}from"../chunks/index.B4yC_IY0.js";import{H as ne}from"../chunks/Header.Bwy9bDXz.js";import{V as re}from"../chunks/Viewer.a2iC_0F0.js";import{F as ie}from"../chunks/Footer.9RfCLaiB.js";import{B as le}from"../chunks/Button.05qNbzII.js";import{e as B,u as ue,d as ce}from"../chunks/each.B2RYFZbl.js";import{g as E}from"../chunks/entry.BiFNfNKk.js";import{p as pe}from"../chunks/stores.GOrYKYAx.js";const fe=async({fetch:n,url:s})=>{console.warn("viewer/edit/+page.ts load");const e=s.searchParams.get("type");if(e===null||!["post","patch"].includes(e))return S(400,"Bad Request");if(e==="post")return{posts:[{user_idx:null,display_name:T().display_name,profile_image_url:T().profile_image_url,place_idx:null,place_name:s.searchParams.get("placeName"),media:JSON.parse(sessionStorage.getItem("postMedia")||"[]"),mediaIdx:0,text:""}]};if(e==="patch"){const o=s.searchParams.get("postIdx");o||S(404,"Not Found");const r=await n(`${k}/posts/${o}`,{method:"GET",headers:{Authorization:"Bearer "+sessionStorage.getItem("jwt")}}).then(l=>l.json()).then(l=>l.data);return r.error&&S(404,"Not Found"),{posts:[{...r,mediaIdx:0}]}}return S(404,"Not Found")},je=Object.freeze(Object.defineProperty({__proto__:null,load:fe},Symbol.toStringTag,{value:"Module"}));function F(n,s,e){const o=n.slice();return o[5]=s[e],o[7]=e,o}function x(n,s){let e,o=s[5]+"",r,l;return{key:n,first:null,c(){e=D("option"),r=H(o),this.h()},l(u){e=J(u,"OPTION",{});var c=M(e);r=R(c,o),c.forEach(d),this.h()},h(){e.__value=l=s[5],j(e,e.__value),this.first=e},m(u,c){m(u,e,c),ee(e,r)},p(u,c){s=u,c&2&&o!==(o=s[5]+"")&&te(r,o),c&2&&l!==(l=s[5])&&(e.__value=l,j(e,e.__value))},d(u){u&&d(e)}}}function de(n){let s,e=[],o=new Map,r,l,u=B(n[1]);const c=t=>t[7];for(let t=0;t<u.length;t+=1){let i=F(n,u,t),a=c(i);o.set(a,e[t]=x(a,i))}return{c(){s=D("select");for(let t=0;t<e.length;t+=1)e[t].c();this.h()},l(t){s=J(t,"SELECT",{class:!0});var i=M(s);for(let a=0;a<e.length;a+=1)e[a].l(i);i.forEach(d),this.h()},h(){Q(s,"class","border border-gray-200 rounded-[4.75rem] py-[0.38rem] px-[0.88rem] typo-body3 text-gray-900 bg-gray-100"),s.disabled=n[2],n[0]===void 0&&W(()=>n[4].call(s))},m(t,i){m(t,s,i);for(let a=0;a<e.length;a+=1)e[a]&&e[a].m(s,null);N(s,n[0],!0),r||(l=[O(s,"change",n[4]),O(s,"change",n[3])],r=!0)},p(t,[i]){i&2&&(u=B(t[1]),e=ue(e,i,c,1,t,u,o,s,ce,x,null,F)),i&4&&(s.disabled=t[2]),i&3&&N(s,t[0])},i:I,o:I,d(t){t&&d(s);for(let i=0;i<e.length;i+=1)e[i].d();r=!1,X(l)}}}function me(n,s,e){let{selected:o=""}=s,{options:r=[]}=s,{disabled:l=!1}=s;Y(()=>{r.length>0&&e(0,o=r[0])});function u(t){se.call(this,n,t)}function c(){o=ae(this),e(0,o),e(1,r)}return n.$$set=t=>{"selected"in t&&e(0,o=t.selected),"options"in t&&e(1,r=t.options),"disabled"in t&&e(2,l=t.disabled)},[o,r,l,u,c]}class _e extends V{constructor(s){super(),L(this,s,me,de,z,{selected:0,options:1,disabled:2})}}function ge(n){let s;return{c(){s=H(n[3])},l(e){s=R(e,n[3])},m(e,o){m(e,s,o)},p:I,d(e){e&&d(s)}}}function he(n){let s,e,o,r,l;function u(t){n[8](t)}let c={options:["전체 공개","팔로워 공개","비공개"],disabled:!0};return n[1]!==void 0&&(c.selected=n[1]),s=new _e({props:c}),q.push(()=>U(s,"selected",u)),r=new le({props:{backgroundColor:"bg-primary-500",textColor:"text-white",border:"border-none",$$slots:{default:[ge]},$$scope:{ctx:n}}}),r.$on("click",n[9]),{c(){h(s.$$.fragment),o=A(),h(r.$$.fragment)},l(t){b(s.$$.fragment,t),o=P(t),b(r.$$.fragment,t)},m(t,i){$(s,t,i),m(t,o,i),$(r,t,i),l=!0},p(t,i){const a={};!e&&i&2&&(e=!0,a.selected=t[1],G(()=>e=!1)),s.$set(a);const p={};i&8192&&(p.$$scope={dirty:i,ctx:t}),r.$set(p)},i(t){l||(C(s.$$.fragment,t),C(r.$$.fragment,t),l=!0)},o(t){w(s.$$.fragment,t),w(r.$$.fragment,t),l=!1},d(t){t&&d(o),y(s,t),y(r,t)}}}function be(n){let s,e,o,r,l,u,c;s=new ne({props:{position:"fixed",leftBack:"white"}});function t(a){n[7](a)}let i={};return n[0]!==void 0&&(i.posts=n[0]),o=new re({props:i}),q.push(()=>U(o,"posts",t)),u=new ie({props:{position:"fixed",bottom:"2rem",$$slots:{default:[he]},$$scope:{ctx:n}}}),{c(){h(s.$$.fragment),e=A(),h(o.$$.fragment),l=A(),h(u.$$.fragment)},l(a){b(s.$$.fragment,a),e=P(a),b(o.$$.fragment,a),l=P(a),b(u.$$.fragment,a)},m(a,p){$(s,a,p),m(a,e,p),$(o,a,p),m(a,l,p),$(u,a,p),c=!0},p(a,[p]){const _={};!r&&p&1&&(r=!0,_.posts=a[0],G(()=>r=!1)),o.$set(_);const v={};p&8194&&(v.$$scope={dirty:p,ctx:a}),u.$set(v)},i(a){c||(C(s.$$.fragment,a),C(o.$$.fragment,a),C(u.$$.fragment,a),c=!0)},o(a){w(s.$$.fragment,a),w(o.$$.fragment,a),w(u.$$.fragment,a),c=!1},d(a){a&&(d(e),d(l)),y(s,a),y(o,a),y(u,a)}}}function $e(n,s,e){let o;oe(n,pe,f=>e(10,o=f));const r=JSON.parse(sessionStorage.getItem("postMedia")||"[]"),l=o.url.searchParams.get("type"),u=l==="post"?"게시하기":"수정하기";let{data:c}=s,t=c.posts,i;const a={"전체 공개":"public","팔로워 공개":"follower",비공개:"private"};async function p(){var g;(await fetch(`${k}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({placeIdx:o.url.searchParams.get("placeIdx"),text:((g=t.at(0))==null?void 0:g.text)||"",media:r,permission:a[i]})})).ok&&await E("/users/0",{replaceState:!0,invalidateAll:!0})}async function _(){var g;(await fetch(`${k}/posts/${o.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({text:((g=t.at(0))==null?void 0:g.text)||""})})).ok&&await E("/users/0",{replaceState:!0,invalidateAll:!0})}function v(f){t=f,e(0,t)}function Z(f){i=f,e(1,i)}const K=()=>{l==="post"?p():l==="patch"&&_()};return n.$$set=f=>{"data"in f&&e(6,c=f.data)},[t,i,l,u,p,_,c,v,Z,K]}class Be extends V{constructor(s){super(),L(this,s,$e,be,z,{data:6})}}export{Be as component,je as universal};
