import{b as fe}from"../chunks/sign.Cg-GZlX7.js";import{e as P}from"../chunks/index.DA5NOQ-b.js";import{A as j,s as K,a as ue}from"../chunks/store.BtYvGLBK.js";import{R as _e,s as R,e as X,c as Q,b as Z,f as g,q as pe,V as de,i as $,W as Y,r as H,n as x,D as me,o as ee,t as S,d as N,P as V,h as ge,j as be,E as he,X as ke,m as D,a as E,g as F,p as O,k as B,l as $e,w as A}from"../chunks/scheduler.BnheM4g2.js";import{S as te,i as oe,e as L,c as y,a as w,m as v,t as h,b as k,d as C,g as ye,f as we}from"../chunks/index.CP53dWnj.js";import{a as ve,H as Ce,C as Ie}from"../chunks/Header.C-SSaVVB.js";import{V as Pe}from"../chunks/Viewer.B-SbZjHf.js";import{F as Ae}from"../chunks/Footer.BRTcZZb3.js";import{B as M}from"../chunks/Button.CEczC82a.js";import{e as q,u as Se,d as Ne}from"../chunks/each.B4pMeuX4.js";import{g as G}from"../chunks/entry.BdOYDfWF.js";import{p as Be}from"../chunks/stores.CDPW79G6.js";const Te=async({fetch:n,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return P(400,"Bad Request");if(t==="post"){const o=fe();return{posts:[{user_idx:o==null?void 0:o.sub,display_name:o==null?void 0:o.nam,profile_image_url:o==null?void 0:o.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:_e(K),mediaIdx:0,text:""}]}}if(t==="patch"){const o=e.searchParams.get("postIdx");o||P(404,"Not Found");const s=await n(`${j}/posts/${o}`,{method:"GET",headers:{Authorization:"Bearer "+sessionStorage.getItem("jwt")}}).then(a=>a.json()).then(a=>a.data);return s.error&&P(404,"Not Found"),{posts:[{...s,mediaIdx:0}]}}return P(404,"Not Found")},nt=Object.freeze(Object.defineProperty({__proto__:null,load:Te},Symbol.toStringTag,{value:"Module"}));function J(n,e,t){const o=n.slice();return o[5]=e[t],o[7]=t,o}function U(n,e){let t,o=e[5]+"",s,a;return{key:n,first:null,c(){t=X("option"),s=S(o),this.h()},l(i){t=Q(i,"OPTION",{});var f=Z(t);s=N(f,o),f.forEach(g),this.h()},h(){t.__value=a=e[5],V(t,t.__value),this.first=t},m(i,f){$(i,t,f),ge(t,s)},p(i,f){e=i,f&2&&o!==(o=e[5]+"")&&be(s,o),f&2&&a!==(a=e[5])&&(t.__value=a,V(t,t.__value))},d(i){i&&g(t)}}}function je(n){let e,t=[],o=new Map,s,a,i=q(n[1]);const f=r=>r[7];for(let r=0;r<i.length;r+=1){let u=J(n,i,r),_=f(u);o.set(_,t[r]=U(_,u))}return{c(){e=X("select");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=Q(r,"SELECT",{class:!0});var u=Z(e);for(let _=0;_<t.length;_+=1)t[_].l(u);u.forEach(g),this.h()},h(){pe(e,"class","border border-gray-200 rounded-[4.75rem] py-[0.38rem] px-[0.88rem] typo-body3 text-gray-900 bg-gray-100"),e.disabled=n[2],n[0]===void 0&&de(()=>n[4].call(e))},m(r,u){$(r,e,u);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);Y(e,n[0],!0),s||(a=[H(e,"change",n[4]),H(e,"change",n[3])],s=!0)},p(r,[u]){u&2&&(i=q(r[1]),t=Se(t,u,f,1,r,i,o,e,Ne,U,null,J)),u&4&&(e.disabled=r[2]),u&3&&Y(e,r[0])},i:x,o:x,d(r){r&&g(e);for(let u=0;u<t.length;u+=1)t[u].d();s=!1,me(a)}}}function De(n,e,t){let{selected:o=""}=e,{options:s=[]}=e,{disabled:a=!1}=e;ee(()=>{s.length>0&&t(0,o=s[0])});function i(r){he.call(this,n,r)}function f(){o=ke(this),t(0,o),t(1,s)}return n.$$set=r=>{"selected"in r&&t(0,o=r.selected),"options"in r&&t(1,s=r.options),"disabled"in r&&t(2,a=r.disabled)},[o,s,a,i,f]}class Ee extends te{constructor(e){super(),oe(this,e,De,je,R,{selected:0,options:1,disabled:2})}}var W;(function(n){n.Dark="DARK",n.Light="LIGHT",n.Default="DEFAULT"})(W||(W={}));var z;(function(n){n.Body="body",n.Ionic="ionic",n.Native="native",n.None="none"})(z||(z={}));const T=ve("Keyboard");function Fe(n){let e,t,o,s;const a=[Me,Le],i=[];function f(r,u){return r[3]===!0?0:1}return e=f(n),t=i[e]=a[e](n),{c(){t.c(),o=A()},l(r){t.l(r),o=A()},m(r,u){i[e].m(r,u),$(r,o,u),s=!0},p(r,u){let _=e;e=f(r),e===_?i[e].p(r,u):(ye(),k(i[_],1,1,()=>{i[_]=null}),we(),t=i[e],t?t.p(r,u):(t=i[e]=a[e](r),t.c()),h(t,1),t.m(o.parentNode,o))},i(r){s||(h(t),s=!0)},o(r){k(t),s=!1},d(r){r&&g(o),i[e].d(r)}}}function Oe(n){let e,t;return e=new M({props:{backgroundColor:"bg-primary-500",textColor:"text-white",border:"border-none",$$slots:{default:[xe]},$$scope:{ctx:n}}}),e.$on("click",n[12]),{c(){y(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,s){v(e,o,s),t=!0},p(o,s){const a={};s&1048576&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){t||(h(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function Le(n){let e,t;return e=new M({props:{backgroundColor:"bg-gray-800",textColor:"text-white",border:"border-none",$$slots:{default:[Ye]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,s){v(e,o,s),t=!0},p(o,s){const a={};s&1048576&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){t||(h(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function Me(n){let e,t;return e=new M({props:{backgroundColor:"bg-primary-500",textColor:"text-white",border:"border-none",$$slots:{default:[He]},$$scope:{ctx:n}}}),e.$on("click",n[13]),{c(){y(e.$$.fragment)},l(o){w(e.$$.fragment,o)},m(o,s){v(e,o,s),t=!0},p(o,s){const a={};s&1048576&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(o){t||(h(e.$$.fragment,o),t=!0)},o(o){k(e.$$.fragment,o),t=!1},d(o){C(e,o)}}}function Ye(n){let e;return{c(){e=S("사진 업로드중")},l(t){e=N(t,"사진 업로드중")},m(t,o){$(t,e,o)},d(t){t&&g(e)}}}function He(n){let e;return{c(){e=S("게시하기")},l(t){e=N(t,"게시하기")},m(t,o){$(t,e,o)},d(t){t&&g(e)}}}function xe(n){let e;return{c(){e=S("수정하기")},l(t){e=N(t,"수정하기")},m(t,o){$(t,e,o)},d(t){t&&g(e)}}}function Ve(n){let e,t,o,s,a,i,f;function r(l){n[11](l)}let u={options:["전체 공개","팔로워 공개","비공개"],disabled:!0};n[0]!==void 0&&(u.selected=n[0]),e=new Ee({props:u}),D.push(()=>L(e,"selected",r));const _=[Oe,Fe],m=[];function c(l,d){return l[4]==="patch"?0:l[4]==="post"?1:-1}return~(s=c(n))&&(a=m[s]=_[s](n)),{c(){y(e.$$.fragment),o=E(),a&&a.c(),i=A()},l(l){w(e.$$.fragment,l),o=F(l),a&&a.l(l),i=A()},m(l,d){v(e,l,d),$(l,o,d),~s&&m[s].m(l,d),$(l,i,d),f=!0},p(l,d){const b={};!t&&d&1&&(t=!0,b.selected=l[0],O(()=>t=!1)),e.$set(b),a&&a.p(l,d)},i(l){f||(h(e.$$.fragment,l),h(a),f=!0)},o(l){k(e.$$.fragment,l),k(a),f=!1},d(l){l&&(g(o),g(i)),C(e,l),~s&&m[s].d(l)}}}function qe(n){let e,t,o,s,a,i,f,r;e=new Ce({props:{position:"fixed",leftBack:"white"}});function u(c){n[9](c)}function _(c){n[10](c)}let m={dontMoveVetically:!0};return n[2]!==void 0&&(m.posts=n[2]),n[1]!==void 0&&(m.keyboardY=n[1]),o=new Pe({props:m}),D.push(()=>L(o,"posts",u)),D.push(()=>L(o,"keyboardY",_)),f=new Ae({props:{position:"fixed",bottom:"2rem",$$slots:{default:[Ve]},$$scope:{ctx:n}}}),{c(){y(e.$$.fragment),t=E(),y(o.$$.fragment),i=E(),y(f.$$.fragment)},l(c){w(e.$$.fragment,c),t=F(c),w(o.$$.fragment,c),i=F(c),w(f.$$.fragment,c)},m(c,l){v(e,c,l),$(c,t,l),v(o,c,l),$(c,i,l),v(f,c,l),r=!0},p(c,[l]){const d={};!s&&l&4&&(s=!0,d.posts=c[2],O(()=>s=!1)),!a&&l&2&&(a=!0,d.keyboardY=c[1],O(()=>a=!1)),o.$set(d);const b={};l&1048585&&(b.$$scope={dirty:l,ctx:c}),f.$set(b)},i(c){r||(h(e.$$.fragment,c),h(o.$$.fragment,c),h(f.$$.fragment,c),r=!0)},o(c){k(e.$$.fragment,c),k(o.$$.fragment,c),k(f.$$.fragment,c),r=!1},d(c){c&&(g(t),g(i)),C(e,c),C(o,c),C(f,c)}}}function Ge(n,e,t){let o,s,a,i,f;B(n,Be,p=>t(15,a=p)),B(n,K,p=>t(8,i=p)),B(n,ue,p=>t(3,f=p));const r=Ie.getPlatform()!=="web",u=a.url.searchParams.get("type");let{data:_}=e,m;const c={"전체 공개":"public","팔로워 공개":"follower",비공개:"private"};async function l(){var I;(await fetch(`${j}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({placeIdx:a.url.searchParams.get("placeIdx"),text:((I=s.at(0))==null?void 0:I.text)||"",media:o,permission:c[m]})})).ok&&await G("/users/0",{replaceState:!0,invalidateAll:!0})}async function d(){var I;(await fetch(`${j}/posts/${a.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({text:((I=s.at(0))==null?void 0:I.text)||""})})).ok&&await G("/users/0",{replaceState:!0,invalidateAll:!0})}let b=0;function ne(){T.addListener("keyboardWillShow",p=>{t(1,b=p.keyboardHeight*-1)}),T.addListener("keyboardWillHide",()=>{t(1,b=0)})}function re(){T.removeAllListeners()}ee(()=>{r&&ne()}),$e(()=>{r&&re()});function se(p){s=p,t(2,s),t(7,_)}function ae(p){b=p,t(1,b)}function le(p){m=p,t(0,m)}const ie=()=>d(),ce=()=>l();return n.$$set=p=>{"data"in p&&t(7,_=p.data)},n.$$.update=()=>{n.$$.dirty&256&&(o=i),n.$$.dirty&128&&t(2,s=_.posts)},[m,b,s,f,u,l,d,_,i,se,ae,le,ie,ce]}class rt extends te{constructor(e){super(),oe(this,e,Ge,qe,R,{data:7})}}export{rt as component,nt as universal};
