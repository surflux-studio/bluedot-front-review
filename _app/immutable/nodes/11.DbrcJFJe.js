import{s as q,w as H,a as N,g as M,i as L,x as V,f as h,k as G,y as J,B as U,e as S,t as X,c as D,b as K,z as Q,d as Z,v as E,h as A,A as ee}from"../chunks/scheduler.CIbz-4tf.js";import{S as te,i as ne,b as W,c as w,d as y,m as I,t as k,a as P,f as x}from"../chunks/index.gvaMc9LH.js";import{H as oe}from"../chunks/Header.B6oSGUbu.js";import{M as ae}from"../chunks/Map.qHwjzsuX.js";import{a as T}from"../chunks/map.BryWCP67.js";import{p as se}from"../chunks/stores.CcN5nOBZ.js";import{A as ie,o as re,a as ue}from"../chunks/ActionSheet.BIWm96Cn.js";import{F as le}from"../chunks/Field.sEKQ2dwN.js";import{I as Y,e as O,A as pe}from"../chunks/store.C9gcVE2I.js";import{i as fe}from"../chunks/sign.CUItAdIG.js";import{g as me}from"../chunks/entry.Di29JZxr.js";import{t as ce}from"../chunks/proj.DXH8zrwl.js";import{C as de}from"../chunks/device.DknIEsqX.js";import"../chunks/ActionSheet.svelte_svelte_type_style_lang.BPug75Ph.js";import{A as Ce}from"../chunks/ActionSheetOpenApp.BbBDJ2G9.js";function _e(o){let a,n,f="이 장소를 뭐라고 부를까요?",d,s,r,l,p,m,c,$,C,_,g,e;function u(i){o[8](i)}let b={clear:!0,clearColor:"#757475",padding:"pb-2.5",border:"border-b border-b-[#757475]",fontSize:"font-normal text-sm",fontColor:"text-white",limit:20,useCounter:!1,backgroundColor:"bg-transparent",placeholder:"장소 이름을 입력하세요",placeholderColor:"#757475"};return o[1]!==void 0&&(b.value=o[1]),r=new le({props:b}),H.push(()=>W(r,"value",u)),{c(){a=S("div"),n=S("p"),n.textContent=f,d=N(),s=S("div"),w(r.$$.fragment),p=N(),m=S("div"),c=S("button"),$=X("장소 추가"),this.h()},l(i){a=D(i,"DIV",{class:!0});var t=K(a);n=D(t,"P",{class:!0,"data-svelte-h":!0}),Q(n)!=="svelte-9vo44h"&&(n.textContent=f),d=M(t),s=D(t,"DIV",{class:!0});var v=K(s);y(r.$$.fragment,v),v.forEach(h),p=M(t),m=D(t,"DIV",{class:!0});var F=K(m);c=D(F,"BUTTON",{class:!0});var B=K(c);$=Z(B,"장소 추가"),B.forEach(h),F.forEach(h),t.forEach(h),this.h()},h(){E(n,"class","py-2.5 font-semibold text-sm leading-[17px] text-white"),E(s,"class","box-name flex flex-col gap-4 py-2.5"),E(c,"class","w-full p-2.5 rounded-[50px] font-medium text-sm leading-[17px] bg-[#0C79FE] text-white disabled:bg-[#383838]/70 disabled:text-[#757475]"),c.disabled=C=!o[1].trim(),E(m,"class","py-2.5"),E(a,"class","px-4")},m(i,t){L(i,a,t),A(a,n),A(a,d),A(a,s),I(r,s,null),A(a,p),A(a,m),A(m,c),A(c,$),_=!0,g||(e=ee(c,"click",o[5]),g=!0)},p(i,t){const v={};!l&&t&2&&(l=!0,v.value=i[1],V(()=>l=!1)),r.$set(v),(!_||t&2&&C!==(C=!i[1].trim()))&&(c.disabled=C)},i(i){_||(k(r.$$.fragment,i),_=!0)},o(i){P(r.$$.fragment,i),_=!1},d(i){i&&h(a),x(r),g=!1,e()}}}function ge(o){let a,n,f,d,s,r,l,p,m,c;a=new oe({props:{position:"fixed",leftBack:"black"}}),f=new ae({props:{onSelect:o[4],mapY:o[2],allowEdit:!Y,whenCancelEdit:o[7]}});function $(e){o[9](e)}let C={fixed:!0,noHandle:!0,$$slots:{default:[_e]},$$scope:{ctx:o}};o[0]!==void 0&&(C.isOpen=o[0]),s=new ie({props:C}),H.push(()=>W(s,"isOpen",$));function _(e){o[10](e)}let g={};return o[3]!==void 0&&(g.isOpen=o[3]),p=new Ce({props:g}),H.push(()=>W(p,"isOpen",_)),{c(){w(a.$$.fragment),n=N(),w(f.$$.fragment),d=N(),w(s.$$.fragment),l=N(),w(p.$$.fragment)},l(e){y(a.$$.fragment,e),n=M(e),y(f.$$.fragment,e),d=M(e),y(s.$$.fragment,e),l=M(e),y(p.$$.fragment,e)},m(e,u){I(a,e,u),L(e,n,u),I(f,e,u),L(e,d,u),I(s,e,u),L(e,l,u),I(p,e,u),c=!0},p(e,[u]){const b={};u&4&&(b.mapY=e[2]),u&8&&(b.whenCancelEdit=e[7]),f.$set(b);const i={};u&131074&&(i.$$scope={dirty:u,ctx:e}),!r&&u&1&&(r=!0,i.isOpen=e[0],V(()=>r=!1)),s.$set(i);const t={};!m&&u&8&&(m=!0,t.isOpen=e[3],V(()=>m=!1)),p.$set(t)},i(e){c||(k(a.$$.fragment,e),k(f.$$.fragment,e),k(s.$$.fragment,e),k(p.$$.fragment,e),c=!0)},o(e){P(a.$$.fragment,e),P(f.$$.fragment,e),P(s.$$.fragment,e),P(p.$$.fragment,e),c=!1},d(e){e&&(h(n),h(d),h(l)),x(a,e),x(f,e),x(s,e),x(p,e)}}}function be(o,a,n){let f;G(o,se,t=>n(12,f=t)),de.isNativePlatform();let d=!1,s="",r=!1,l,p=0,m=!1;function c(t){n(2,p=-200)}function $(){n(2,p=0)}J(()=>{let t=f.url.searchParams.get("location");t&&(f.url.searchParams.delete("location"),n(6,l=t.split(",").map(Number)),me(f.url.toString(),{replaceState:!0,invalidateAll:!1})),re(()=>{},c,$)}),U(()=>{T.setPosition(void 0),ue()});function C(t){T.setPosition(t),n(0,d=t!==void 0)}function _(t){n(6,l=t),O.emit("flyTo",l)}function g(){if(Y)return n(3,m=!0);if(!fe())return O.emit("showSignInModal",{removable:!0});if(r)return O.emit("pushSnackbar",{message:"처리중입니다. 잠시 후 다시 시도해주세요"});r=!0;const t=s.trim();if(!t||l===void 0)return;const[v,F]=ce(l);fetch(`${pe}/places`,{method:"POST",body:JSON.stringify([{name:t,location:{lon:Number(v.toFixed(6)),lat:Number(F.toFixed(6))}}])}).then(async B=>{var R,j;if(!B.ok)return O.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."});const z=(j=(R=(await B.json()).data)==null?void 0:R.at(0))==null?void 0:j.idx;n(6,l=void 0),O.emit("pushSnackbar",{message:`'${t}' 장소를 추가했습니다`}),z&&O.emit("addIconByPlaceIdx",z)}).catch(B=>{console.log(B),O.emit("pushSnackbar",{message:"일시적으로 장애가 발생했습니다."})}).finally(()=>{r=!1})}const e=()=>{if(Y)return n(3,m=!0)};function u(t){s=t,n(1,s),n(0,d)}function b(t){d=t,n(0,d)}function i(t){m=t,n(3,m)}return o.$$.update=()=>{o.$$.dirty&1&&(d||(n(1,s=""),r=!1,T.setPosition(void 0))),o.$$.dirty&64&&C(l)},[d,s,p,m,_,g,l,e,u,b,i]}class Me extends te{constructor(a){super(),ne(this,a,be,ge,q,{})}}export{Me as component};
