import{b as j,A as P,a as ne,C as re}from"../chunks/units.BmAtfPLl.js";import{e as A}from"../chunks/index.CfnIZQEA.js";import{s as U,e as z,c as K,b as W,f as g,l as ie,T as le,i as h,U as M,w as F,n as T,r as ue,p as x,t as R,d as Z,L,h as ce,j as fe,G as pe,V as de,u as N,a as B,g as D,v as E,k as _e,q as me}from"../chunks/scheduler.CuQsZbPO.js";import{S as Q,i as X,e as O,c as y,a as w,m as k,t as v,b as $,d as C}from"../chunks/index.Cqam3s4x.js";import{H as ge}from"../chunks/Header.ayC4baF4.js";import{V as he}from"../chunks/Viewer.BkxBtD9c.js";import{F as be}from"../chunks/Footer.CpnOs8aK.js";import{B as ye}from"../chunks/Button.JyaF29-y.js";import{e as Y,u as we,d as ke}from"../chunks/each.ymBi7bvQ.js";import{g as H}from"../chunks/entry.IqVVwzvC.js";import{p as ve}from"../chunks/stores.BkwWLvmj.js";const $e=async({fetch:o,url:s})=>{console.warn("viewer/edit/+page.ts load");const e=s.searchParams.get("type");if(e===null||!["post","patch"].includes(e))return A(400,"Bad Request");if(e==="post")return{posts:[{user_idx:null,display_name:j().display_name,profile_image_url:j().profile_image_url,place_idx:null,place_name:s.searchParams.get("placeName"),media:JSON.parse(sessionStorage.getItem("postMedia")||"[]"),mediaIdx:0,text:""}]};if(e==="patch"){const a=s.searchParams.get("postIdx");a||A(404,"Not Found");const r=await o(`${P}/posts/${a}`,{method:"GET",headers:{Authorization:"Bearer "+sessionStorage.getItem("jwt")}}).then(c=>c.json()).then(c=>c.data);return r.error&&A(404,"Not Found"),{posts:[{...r,mediaIdx:0}]}}return A(404,"Not Found")},Je=Object.freeze(Object.defineProperty({__proto__:null,load:$e},Symbol.toStringTag,{value:"Module"}));function G(o,s,e){const a=o.slice();return a[5]=s[e],a[7]=e,a}function J(o,s){let e,a=s[5]+"",r,c;return{key:o,first:null,c(){e=z("option"),r=R(a),this.h()},l(l){e=K(l,"OPTION",{});var u=W(e);r=Z(u,a),u.forEach(g),this.h()},h(){e.__value=c=s[5],L(e,e.__value),this.first=e},m(l,u){h(l,e,u),ce(e,r)},p(l,u){s=l,u&2&&a!==(a=s[5]+"")&&fe(r,a),u&2&&c!==(c=s[5])&&(e.__value=c,L(e,e.__value))},d(l){l&&g(e)}}}function Ce(o){let s,e=[],a=new Map,r,c,l=Y(o[1]);const u=t=>t[7];for(let t=0;t<l.length;t+=1){let i=G(o,l,t),f=u(i);a.set(f,e[t]=J(f,i))}return{c(){s=z("select");for(let t=0;t<e.length;t+=1)e[t].c();this.h()},l(t){s=K(t,"SELECT",{class:!0});var i=W(s);for(let f=0;f<e.length;f+=1)e[f].l(i);i.forEach(g),this.h()},h(){ie(s,"class","border border-gray-200 rounded-[4.75rem] py-[0.38rem] px-[0.88rem] typo-body3 text-gray-900 bg-gray-100"),s.disabled=o[2],o[0]===void 0&&le(()=>o[4].call(s))},m(t,i){h(t,s,i);for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(s,null);M(s,o[0],!0),r||(c=[F(s,"change",o[4]),F(s,"change",o[3])],r=!0)},p(t,[i]){i&2&&(l=Y(t[1]),e=we(e,i,u,1,t,l,a,s,ke,J,null,G)),i&4&&(s.disabled=t[2]),i&3&&M(s,t[0])},i:T,o:T,d(t){t&&g(s);for(let i=0;i<e.length;i+=1)e[i].d();r=!1,ue(c)}}}function Se(o,s,e){let{selected:a=""}=s,{options:r=[]}=s,{disabled:c=!1}=s;x(()=>{r.length>0&&e(0,a=r[0])});function l(t){pe.call(this,o,t)}function u(){a=de(this),e(0,a),e(1,r)}return o.$$set=t=>{"selected"in t&&e(0,a=t.selected),"options"in t&&e(1,r=t.options),"disabled"in t&&e(2,c=t.disabled)},[a,r,c,l,u]}class Ae extends Q{constructor(s){super(),X(this,s,Se,Ce,U,{selected:0,options:1,disabled:2})}}var V;(function(o){o.Dark="DARK",o.Light="LIGHT",o.Default="DEFAULT"})(V||(V={}));var q;(function(o){o.Body="body",o.Ionic="ionic",o.Native="native",o.None="none"})(q||(q={}));const I=ne("Keyboard");function Ie(o){let s;return{c(){s=R(o[4])},l(e){s=Z(e,o[4])},m(e,a){h(e,s,a)},p:T,d(e){e&&g(s)}}}function Pe(o){let s,e,a,r,c;function l(t){o[10](t)}let u={options:["전체 공개","팔로워 공개","비공개"],disabled:!0};return o[1]!==void 0&&(u.selected=o[1]),s=new Ae({props:u}),N.push(()=>O(s,"selected",l)),r=new ye({props:{backgroundColor:"bg-primary-500",textColor:"text-white",border:"border-none",$$slots:{default:[Ie]},$$scope:{ctx:o}}}),r.$on("click",o[11]),{c(){y(s.$$.fragment),a=B(),y(r.$$.fragment)},l(t){w(s.$$.fragment,t),a=D(t),w(r.$$.fragment,t)},m(t,i){k(s,t,i),h(t,a,i),k(r,t,i),c=!0},p(t,i){const f={};!e&&i&2&&(e=!0,f.selected=t[1],E(()=>e=!1)),s.$set(f);const m={};i&262144&&(m.$$scope={dirty:i,ctx:t}),r.$set(m)},i(t){c||(v(s.$$.fragment,t),v(r.$$.fragment,t),c=!0)},o(t){$(s.$$.fragment,t),$(r.$$.fragment,t),c=!1},d(t){t&&g(a),C(s,t),C(r,t)}}}function Te(o){let s,e,a,r,c,l,u,t;s=new ge({props:{position:"fixed",leftBack:"white"}});function i(n){o[8](n)}function f(n){o[9](n)}let m={dontMoveVetically:!0};return o[0]!==void 0&&(m.posts=o[0]),o[2]!==void 0&&(m.keyboardY=o[2]),a=new he({props:m}),N.push(()=>O(a,"posts",i)),N.push(()=>O(a,"keyboardY",f)),u=new be({props:{position:"fixed",bottom:"2rem",$$slots:{default:[Pe]},$$scope:{ctx:o}}}),{c(){y(s.$$.fragment),e=B(),y(a.$$.fragment),l=B(),y(u.$$.fragment)},l(n){w(s.$$.fragment,n),e=D(n),w(a.$$.fragment,n),l=D(n),w(u.$$.fragment,n)},m(n,d){k(s,n,d),h(n,e,d),k(a,n,d),h(n,l,d),k(u,n,d),t=!0},p(n,[d]){const _={};!r&&d&1&&(r=!0,_.posts=n[0],E(()=>r=!1)),!c&&d&4&&(c=!0,_.keyboardY=n[2],E(()=>c=!1)),a.$set(_);const S={};d&262146&&(S.$$scope={dirty:d,ctx:n}),u.$set(S)},i(n){t||(v(s.$$.fragment,n),v(a.$$.fragment,n),v(u.$$.fragment,n),t=!0)},o(n){$(s.$$.fragment,n),$(a.$$.fragment,n),$(u.$$.fragment,n),t=!1},d(n){n&&(g(e),g(l)),C(s,n),C(a,n),C(u,n)}}}function Ne(o,s,e){let a;_e(o,ve,p=>e(12,a=p));const r=re.getPlatform()!=="web",c=JSON.parse(sessionStorage.getItem("postMedia")||"[]"),l=a.url.searchParams.get("type"),u=l==="post"?"게시하기":"수정하기";let{data:t}=s,i=t.posts,f;const m={"전체 공개":"public","팔로워 공개":"follower",비공개:"private"};async function n(){var b;(await fetch(`${P}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({placeIdx:a.url.searchParams.get("placeIdx"),text:((b=i.at(0))==null?void 0:b.text)||"",media:c,permission:m[f]})})).ok&&await H("/users/0",{replaceState:!0,invalidateAll:!0})}async function d(){var b;(await fetch(`${P}/posts/${a.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},body:JSON.stringify({text:((b=i.at(0))==null?void 0:b.text)||""})})).ok&&await H("/users/0",{replaceState:!0,invalidateAll:!0})}let _=0;function S(){I.addListener("keyboardWillShow",p=>{e(2,_=p.keyboardHeight*-1)}),I.addListener("keyboardWillHide",()=>{e(2,_=0)})}function ee(){I.removeAllListeners()}x(()=>{r&&S()}),me(()=>{r&&ee()});function te(p){i=p,e(0,i)}function se(p){_=p,e(2,_)}function oe(p){f=p,e(1,f)}const ae=()=>{l==="post"?n():l==="patch"&&d()};return o.$$set=p=>{"data"in p&&e(7,t=p.data)},[i,f,_,l,u,n,d,t,te,se,oe,ae]}class Ve extends Q{constructor(s){super(),X(this,s,Ne,Te,U,{data:7})}}export{Ve as component,Je as universal};
