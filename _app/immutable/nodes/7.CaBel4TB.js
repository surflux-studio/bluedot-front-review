import{s as le,o as fe,a as N,e as W,g as A,c as M,b as R,f as $,m as O,i as x,h as T,r as ce,k as ue,t as F,d as G,q as me,j as pe,n as de}from"../chunks/scheduler.C_RmZE3P.js";import{S as _e,i as $e,e as he,c as C,a as B,m as I,b,f as K,t as k,d as P,g as Q}from"../chunks/index.pf-sDz8f.js";import{e as X,u as ge,o as be}from"../chunks/each.hAu5NJDR.js";import{g as Y}from"../chunks/entry.ByILCBPu.js";import{F as oe}from"../chunks/Footer.BYPFrekf.js";import{H as se}from"../chunks/Header.BZ-kdsYO.js";import{M as ke}from"../chunks/Map.BVZR4YrR.js";import{N as we}from"../chunks/NavigationBar.DGkpYgP-.js";import{B as ee}from"../chunks/Button.C61ujhNw.js";import{g as xe}from"../chunks/searchParams.CqMuYFPd.js";import{e as H,A as ve}from"../chunks/units.D6cS1jHK.js";import{p as ye}from"../chunks/stores.Bldzq8Fj.js";import{S as Ce}from"../chunks/SearchSheet.Dg3DV7U0.js";import{H as Be}from"../chunks/HexImage.D_gjbYSA.js";import{f as Ie}from"../chunks/search.D2ADIJNu.js";import{s as Pe}from"../chunks/Chip.svelte_svelte_type_style_lang.YebYFo9-.js";const Se=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,{Map:Ee}=Se;function te(i,e,r){const t=i.slice();return t[13]=e[r],t}function Ne(i){let e,r;return e=new se({props:{position:"fixed",rightFeed:!0}}),{c(){C(e.$$.fragment)},l(t){B(e.$$.fragment,t)},m(t,s){I(e,t,s),r=!0},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){b(e.$$.fragment,t),r=!1},d(t){P(e,t)}}}function Ae(i){let e,r;return e=new se({props:{position:"fixed",leftBack:!0}}),{c(){C(e.$$.fragment)},l(t){B(e.$$.fragment,t)},m(t,s){I(e,t,s),r=!0},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){b(e.$$.fragment,t),r=!1},d(t){P(e,t)}}}function re(i,e){var S;let r,t,s,n,c,p=e[13].name+"",_,u,v,h,w;s=new Be({props:{src:e[13].image,width:96,height:96,onBorder:e[13].idx===((S=e[2])==null?void 0:S.idx)}});function y(){return e[9](e[13])}return{key:i,first:null,c(){r=W("div"),t=W("div"),C(s.$$.fragment),n=N(),c=W("span"),_=F(p),u=N(),this.h()},l(m){r=M(m,"DIV",{class:!0,"aria-hidden":!0});var l=R(r);t=M(l,"DIV",{class:!0});var d=R(t);B(s.$$.fragment,d),d.forEach($),n=A(l),c=M(l,"SPAN",{class:!0});var f=R(c);_=G(f,p),f.forEach($),u=A(l),l.forEach($),this.h()},h(){O(t,"class","w-24 h-24 relative"),O(c,"class","w-24 truncate text-xs text-gray-700"),O(r,"class","flex-shrink-0 flex flex-col items-center space-y-1"),O(r,"aria-hidden",""),this.first=r},m(m,l){x(m,r,l),T(r,t),I(s,t,null),T(r,n),T(r,c),T(c,_),T(r,u),v=!0,h||(w=me(r,"click",y),h=!0)},p(m,l){var f;e=m;const d={};l&1&&(d.src=e[13].image),l&5&&(d.onBorder=e[13].idx===((f=e[2])==null?void 0:f.idx)),s.$set(d),(!v||l&1)&&p!==(p=e[13].name+"")&&pe(_,p)},i(m){v||(k(s.$$.fragment,m),v=!0)},o(m){b(s.$$.fragment,m),v=!1},d(m){m&&$(r),P(s),h=!1,w()}}}function De(i){let e,r;return e=new oe({props:{position:"fixed",leftReposition:!0,centerSearch:!0,right:"add"}}),{c(){C(e.$$.fragment)},l(t){B(e.$$.fragment,t)},m(t,s){I(e,t,s),r=!0},p:de,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){b(e.$$.fragment,t),r=!1},d(t){P(e,t)}}}function Oe(i){let e,r;return e=new oe({props:{position:"fixed",bottom:"2rem",$$slots:{default:[Me]},$$scope:{ctx:i}}}),{c(){C(e.$$.fragment)},l(t){B(e.$$.fragment,t)},m(t,s){I(e,t,s),r=!0},p(t,s){const n={};s&65536&&(n.$$scope={dirty:s,ctx:t}),e.$set(n)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){b(e.$$.fragment,t),r=!1},d(t){P(e,t)}}}function Te(i){let e;return{c(){e=F("이 장소가 아니예요")},l(r){e=G(r,"이 장소가 아니예요")},m(r,t){x(r,e,t)},d(r){r&&$(e)}}}function We(i){let e;return{c(){e=F("이 장소가 맞아요")},l(r){e=G(r,"이 장소가 맞아요")},m(r,t){x(r,e,t)},d(r){r&&$(e)}}}function Me(i){let e,r,t,s;return e=new ee({props:{backgroundColor:"bg-gray-300",textColor:"text-white",$$slots:{default:[Te]},$$scope:{ctx:i}}}),e.$on("click",i[10]),t=new ee({props:{backgroundColor:"bg-primary-500",textColor:"text-white",$$slots:{default:[We]},$$scope:{ctx:i}}}),t.$on("click",i[5]),{c(){C(e.$$.fragment),r=N(),C(t.$$.fragment)},l(n){B(e.$$.fragment,n),r=A(n),B(t.$$.fragment,n)},m(n,c){I(e,n,c),x(n,r,c),I(t,n,c),s=!0},p(n,c){const p={};c&65536&&(p.$$scope={dirty:c,ctx:n}),e.$set(p);const _={};c&65536&&(_.$$scope={dirty:c,ctx:n}),t.$set(_)},i(n){s||(k(e.$$.fragment,n),k(t.$$.fragment,n),s=!0)},o(n){b(e.$$.fragment,n),b(t.$$.fragment,n),s=!1},d(n){n&&$(r),P(e,n),P(t,n)}}}function Re(i){let e,r,t,s,n,c,p,_,u=[],v=new Ee,h,w,y,S,m,l,d,f,E;const L=[Ae,Ne],D=[];function U(o,a){return o[4]==="post"||o[4]==="box"||o[3]?0:1}e=U(i),r=D[e]=L[e](i),n=new ke({props:{onMoveend:i[6]}});let V=X(i[0]);const Z=o=>o[13].idx;for(let o=0;o<V.length;o+=1){let a=te(i,V,o),g=Z(a);v.set(g,u[o]=re(g,a))}const ne=[Oe,De],q=[];function ae(o,a){return o[4]==="post"||o[4]==="box"?0:1}w=ae(i),y=q[w]=ne[w](i);function ie(o){i[11](o)}let J={};return i[1]!==void 0&&(J.isOpen=i[1]),m=new Ce({props:J}),fe.push(()=>he(m,"isOpen",ie)),f=new we({props:{show:i[4]!=="post"}}),{c(){r.c(),t=N(),s=W("div"),C(n.$$.fragment),c=N(),p=W("div"),_=W("div");for(let o=0;o<u.length;o+=1)u[o].c();h=N(),y.c(),S=N(),C(m.$$.fragment),d=N(),C(f.$$.fragment),this.h()},l(o){r.l(o),t=A(o),s=M(o,"DIV",{class:!0});var a=R(s);B(n.$$.fragment,a),a.forEach($),c=A(o),p=M(o,"DIV",{class:!0});var g=R(p);_=M(g,"DIV",{class:!0});var j=R(_);for(let z=0;z<u.length;z+=1)u[z].l(j);j.forEach($),g.forEach($),h=A(o),y.l(o),S=A(o),B(m.$$.fragment,o),d=A(o),B(f.$$.fragment,o),this.h()},h(){O(s,"class","fixed top-0 left-0 w-full h-full"),O(_,"class","flex space-x-4"),O(p,"class","relative top-4 left-0 overflow-x-auto p-4 z-20")},m(o,a){D[e].m(o,a),x(o,t,a),x(o,s,a),I(n,s,null),x(o,c,a),x(o,p,a),T(p,_);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(_,null);x(o,h,a),q[w].m(o,a),x(o,S,a),I(m,o,a),x(o,d,a),I(f,o,a),E=!0},p(o,[a]){let g=e;e=U(o),e!==g&&(Q(),b(D[g],1,1,()=>{D[g]=null}),K(),r=D[e],r||(r=D[e]=L[e](o),r.c()),k(r,1),r.m(t.parentNode,t)),a&133&&(V=X(o[0]),Q(),u=ge(u,a,Z,1,o,V,v,_,be,re,null,te),K()),y.p(o,a);const j={};!l&&a&2&&(l=!0,j.isOpen=o[1],ce(()=>l=!1)),m.$set(j)},i(o){if(!E){k(r),k(n.$$.fragment,o);for(let a=0;a<V.length;a+=1)k(u[a]);k(y),k(m.$$.fragment,o),k(f.$$.fragment,o),E=!0}},o(o){b(r),b(n.$$.fragment,o);for(let a=0;a<u.length;a+=1)b(u[a]);b(y),b(m.$$.fragment,o),b(f.$$.fragment,o),E=!1},d(o){o&&($(t),$(s),$(c),$(p),$(h),$(S),$(d)),D[e].d(o),P(n);for(let a=0;a<u.length;a+=1)u[a].d();q[w].d(o),P(m,o),P(f,o)}}}function Ve(i,e,r){let t,s;ue(i,ye,l=>r(8,s=l));let n=[];const c=s.url.searchParams.get("type");let p=!1;H.on("openSearch",()=>{r(1,p=!0)}),H.on("closeSearch",()=>{r(1,p=!1)});async function _(){if(c==="box"){const l=Number(s.url.searchParams.get("boxIdx"));if(Number.isNaN(l)||!l)return Y("/boxes");(await fetch(`https://azit.surflux.studio/boxes/${l}/places/${s.url.searchParams.get("placeIdx")}`,{method:"PUT",headers:{Authorization:`Bearer ${sessionStorage.getItem("jwt")}`}})).ok||H.emit("pushSnackbar",{message:"장소 추가에 실패했습니다."}),Y(`/boxes/${l}/detail`)}else c==="post"&&xe("/viewer/edit")}let u;async function v(l){try{u&&u.abort("new request"),u=new AbortController;const d=new URL(`${ve}/boxes/boundary?bbox=${l}`),f=await Ie(d,{method:"GET",headers:{Accept:"application/json"}},u);if(!f.ok)return;const E=await f.json();r(0,n=E.data)}catch(d){d.name!=="AbortError"&&console.error(d)}}let h;function w(l){const d=n.find(f=>f.idx===l);if(d){if(Pe.clear(),h&&h.idx===d.idx)return r(2,h=void 0);r(2,h=d),h.places.forEach(f=>{var E;H.emit("addIcon",{idx:Number(f.idx),coordinate:[f.longitude,f.latitude],image:((E=f.media)==null?void 0:E.at(0))??"",shape:"waterdrop",type:"place",link:`/places/${f.idx}`,rank:1,name:f.name,width:56,height:61})})}}const y=l=>w(l.idx),S=()=>window.history.back();function m(l){p=l,r(1,p)}return i.$$.update=()=>{i.$$.dirty&256&&r(3,t=s.url.searchParams.get("withBack")==="true")},[n,p,h,t,c,_,v,w,s,y,S,m]}class rt extends _e{constructor(e){super(),$e(this,e,Ve,Re,le,{})}}export{rt as component};
