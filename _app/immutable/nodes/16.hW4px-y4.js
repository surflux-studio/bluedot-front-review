import{r as ne,A as F,c as le}from"../chunks/units.J-uEF215.js";import{c as W}from"../chunks/store.Dw3K1nE2.js";import{s as J,E as z,F as H,b as $,f as b,q as d,i as P,h as T,n as B,m as X,a as y,g as E,p as Y,k as ae,e as q,c as C,u as Z,r as L,C as ie,R as ee}from"../chunks/scheduler.BiUHV-k5.js";import{L as re}from"../chunks/location.5FajRGpU.js";import{S as K,i as Q,e as te,c as j,a as N,m as A,b as S,f as oe,t as V,d as M,g as fe}from"../chunks/index.DaxfEsq8.js";import{H as ce}from"../chunks/Header.3mUjaqIZ.js";import{V as de}from"../chunks/Viewer.BiS6Jxwz.js";import{g as se}from"../chunks/entry.hzB1vHVB.js";/* empty css                                                   */import"../chunks/heic2any.B8jw32R6.js";/* empty css                                                     */import{p as ue}from"../chunks/stores.XAdzYJVx.js";import{N as he}from"../chunks/NavigationBar.BuT6X88e.js";import{A as me}from"../chunks/ActionSheet.DitSN71O.js";/* empty css                                                   */import{M as ge}from"../chunks/Modal.hti_mWVD.js";function pe(l){let e,t;return{c(){e=z("svg"),t=z("path"),this.h()},l(s){e=H(s,"svg",{xmlns:!0,viewBox:!0,width:!0,height:!0,fill:!0});var n=$(e);t=H(n,"path",{d:!0}),$(t).forEach(b),n.forEach(b),this.h()},h(){d(t,"d","M200-200h57l391-391-57-57-391 391v57Zm-40 80q-17 0-28.5-11.5T120-160v-97q0-16 6-30.5t17-25.5l505-504q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L313-143q-11 11-25.5 17t-30.5 6h-97Zm600-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"viewBox","0 -960 960 960"),d(e,"width",l[1]),d(e,"height",l[1]),d(e,"fill",l[0])},m(s,n){P(s,e,n),T(e,t)},p(s,[n]){n&2&&d(e,"width",s[1]),n&2&&d(e,"height",s[1]),n&1&&d(e,"fill",s[0])},i:B,o:B,d(s){s&&b(e)}}}function _e(l,e,t){let s,{fill:n="#5f6368"}=e,{length:a="1.75"}=e,{alt:c="Edit"}=e;return l.$$set=r=>{"fill"in r&&t(0,n=r.fill),"length"in r&&t(2,a=r.length),"alt"in r&&t(3,c=r.alt)},l.$$.update=()=>{l.$$.dirty&4&&t(1,s=ne(a))},[n,s,a,c]}class be extends K{constructor(e){super(),Q(this,e,_e,pe,J,{fill:0,length:2,alt:3})}}function ve(l){let e,t;return{c(){e=z("svg"),t=z("path"),this.h()},l(s){e=H(s,"svg",{xmlns:!0,viewBox:!0,width:!0,height:!0,fill:!0});var n=$(e);t=H(n,"path",{d:!0}),$(t).forEach(b),n.forEach(b),this.h()},h(){d(t,"d","M280-120q-33 0-56.5-23.5T200-200v-520q-17 0-28.5-11.5T160-760q0-17 11.5-28.5T200-800h160q0-17 11.5-28.5T400-840h160q17 0 28.5 11.5T600-800h160q17 0 28.5 11.5T800-760q0 17-11.5 28.5T760-720v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM400-280q17 0 28.5-11.5T440-320v-280q0-17-11.5-28.5T400-640q-17 0-28.5 11.5T360-600v280q0 17 11.5 28.5T400-280Zm160 0q17 0 28.5-11.5T600-320v-280q0-17-11.5-28.5T560-640q-17 0-28.5 11.5T520-600v280q0 17 11.5 28.5T560-280ZM280-720v520-520Z"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"viewBox","0 -960 960 960"),d(e,"width",l[1]),d(e,"height",l[1]),d(e,"fill",l[0])},m(s,n){P(s,e,n),T(e,t)},p(s,[n]){n&2&&d(e,"width",s[1]),n&2&&d(e,"height",s[1]),n&1&&d(e,"fill",s[0])},i:B,o:B,d(s){s&&b(e)}}}function xe(l,e,t){let s,{fill:n="#5f6368"}=e,{length:a="1.75"}=e,{alt:c="Delete"}=e;return l.$$set=r=>{"fill"in r&&t(0,n=r.fill),"length"in r&&t(2,a=r.length),"alt"in r&&t(3,c=r.alt)},l.$$.update=()=>{l.$$.dirty&4&&t(1,s=ne(a))},[n,s,a,c]}class we extends K{constructor(e){super(),Q(this,e,xe,ve,J,{fill:0,length:2,alt:3})}}function ke(l){let e,t,s;return t=new de({props:{posts:l[0].posts,index:l[0].index}}),{c(){e=q("div"),j(t.$$.fragment),this.h()},l(n){e=C(n,"DIV",{class:!0});var a=$(e);N(t.$$.fragment,a),a.forEach(b),this.h()},h(){d(e,"class","fixed top-0 left-0 w-full h-full")},m(n,a){P(n,e,a),A(t,e,null),s=!0},p(n,a){const c={};a&1&&(c.posts=n[0].posts),a&1&&(c.index=n[0].index),t.$set(c)},i(n){s||(V(t.$$.fragment,n),s=!0)},o(n){S(t.$$.fragment,n),s=!1},d(n){n&&b(e),M(t)}}}function Ie(l){let e;return{c(){e=q("div"),this.h()},l(t){e=C(t,"DIV",{class:!0}),$(e).forEach(b),this.h()},h(){d(e,"class","bg-black w-screen h-screen")},m(t,s){P(t,e,s)},p:B,i:B,o:B,d(t){t&&b(e)}}}function Te(l){let e,t,s,n,a,c="수정",r,o,u,v,g,w="삭제",m,x,f;return s=new be({props:{fill:"white",length:1.4}}),u=new we({props:{fill:"red",length:1.4}}),{c(){e=q("div"),t=q("button"),j(s.$$.fragment),n=y(),a=q("span"),a.textContent=c,r=y(),o=q("button"),j(u.$$.fragment),v=y(),g=q("span"),g.textContent=w,this.h()},l(p){e=C(p,"DIV",{class:!0});var h=$(e);t=C(h,"BUTTON",{class:!0});var k=$(t);N(s.$$.fragment,k),n=E(k),a=C(k,"SPAN",{"data-svelte-h":!0}),Z(a)!=="svelte-17aljrl"&&(a.textContent=c),k.forEach(b),r=E(h),o=C(h,"BUTTON",{class:!0});var O=$(o);N(u.$$.fragment,O),v=E(O),g=C(O,"SPAN",{"data-svelte-h":!0}),Z(g)!=="svelte-1k1dgz"&&(g.textContent=w),O.forEach(b),h.forEach(b),this.h()},h(){d(t,"class","w-full py-3 flex items-center gap-2 justify-center text-base font-medium tracking-wider text-white rounded-t-xl bg-[#3335] border-b border-[#333] border-collapse"),d(o,"class","w-full py-3 flex items-center gap-2 justify-center text-base font-medium tracking-wider text-[red] rounded-b-xl bg-[#3336] border-t border-[#333] border-collapse"),d(e,"class","flex flex-col items-center px-6 py-4")},m(p,h){P(p,e,h),T(e,t),A(s,t,null),T(t,n),T(t,a),T(e,r),T(e,o),A(u,o,null),T(o,v),T(o,g),m=!0,x||(f=[L(t,"click",l[12]),L(o,"click",l[13])],x=!0)},p:B,i(p){m||(V(s.$$.fragment,p),V(u.$$.fragment,p),m=!0)},o(p){S(s.$$.fragment,p),S(u.$$.fragment,p),m=!1},d(p){p&&b(e),M(s),M(u),x=!1,ie(f)}}}function qe(l){let e,t,s="정말로 삭제하시겠습니까?",n,a,c="이 작업은 취소할 수 없습니다. 계속 진행하시겠습니까?",r,o,u,v="삭제",g,w,m="취소",x,f;return{c(){e=q("div"),t=q("h2"),t.textContent=s,n=y(),a=q("p"),a.textContent=c,r=y(),o=q("div"),u=q("button"),u.textContent=v,g=y(),w=q("button"),w.textContent=m,this.h()},l(p){e=C(p,"DIV",{class:!0});var h=$(e);t=C(h,"H2",{class:!0,"data-svelte-h":!0}),Z(t)!=="svelte-1yzhdkj"&&(t.textContent=s),n=E(h),a=C(h,"P",{class:!0,"data-svelte-h":!0}),Z(a)!=="svelte-26p028"&&(a.textContent=c),r=E(h),o=C(h,"DIV",{class:!0});var k=$(o);u=C(k,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(u)!=="svelte-1q4epan"&&(u.textContent=v),g=E(k),w=C(k,"BUTTON",{class:!0,"data-svelte-h":!0}),Z(w)!=="svelte-1rzg9yy"&&(w.textContent=m),k.forEach(b),h.forEach(b),this.h()},h(){d(t,"class","text-lg font-semibold mb-2"),d(a,"class","text-gray-600 mb-4"),d(u,"class","bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition"),d(w,"class","bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition"),d(o,"class","flex justify-center space-x-4"),d(e,"class","text-center")},m(p,h){P(p,e,h),T(e,t),T(e,n),T(e,a),T(e,r),T(e,o),T(o,u),T(o,g),T(o,w),x||(f=[L(u,"click",l[15]),L(w,"click",l[16])],x=!0)},p:B,d(p){p&&b(e),x=!1,ie(f)}}}function Ce(l){let e,t,s,n,a,c,r,o,u,v,g,w,m;e=new ce({props:{position:"fixed",leftBack:l[5]?"":"white",rightSearch:"white",rightPostSetting:{visible:l[4],fill:"white",onClick:l[11]}}});const x=[Ie,ke],f=[];function p(i,_){return i[0].posts.length===0?0:1}s=p(l),n=f[s]=x[s](l),c=new he({});function h(i){l[14](i)}let k={defaultHeight:16*16,maxHeight:16*16,$$slots:{default:[Te]},$$scope:{ctx:l}};l[1]!==void 0&&(k.isOpen=l[1]),o=new me({props:k}),X.push(()=>te(o,"isOpen",h));function O(i){l[17](i)}let D={$$slots:{default:[qe]},$$scope:{ctx:l}};return l[2]!==void 0&&(D.modalVisible=l[2]),g=new ge({props:D}),X.push(()=>te(g,"modalVisible",O)),{c(){j(e.$$.fragment),t=y(),n.c(),a=y(),j(c.$$.fragment),r=y(),j(o.$$.fragment),v=y(),j(g.$$.fragment)},l(i){N(e.$$.fragment,i),t=E(i),n.l(i),a=E(i),N(c.$$.fragment,i),r=E(i),N(o.$$.fragment,i),v=E(i),N(g.$$.fragment,i)},m(i,_){A(e,i,_),P(i,t,_),f[s].m(i,_),P(i,a,_),A(c,i,_),P(i,r,_),A(o,i,_),P(i,v,_),A(g,i,_),m=!0},p(i,[_]){const I={};_&32&&(I.leftBack=i[5]?"":"white"),_&18&&(I.rightPostSetting={visible:i[4],fill:"white",onClick:i[11]}),e.$set(I);let U=s;s=p(i),s===U?f[s].p(i,_):(fe(),S(f[U],1,1,()=>{f[U]=null}),oe(),n=f[s],n?n.p(i,_):(n=f[s]=x[s](i),n.c()),V(n,1),n.m(a.parentNode,a));const R={};_&1048590&&(R.$$scope={dirty:_,ctx:i}),!u&&_&2&&(u=!0,R.isOpen=i[1],Y(()=>u=!1)),o.$set(R);const G={};_&1048580&&(G.$$scope={dirty:_,ctx:i}),!w&&_&4&&(w=!0,G.modalVisible=i[2],Y(()=>w=!1)),g.$set(G)},i(i){m||(V(e.$$.fragment,i),V(n),V(c.$$.fragment,i),V(o.$$.fragment,i),V(g.$$.fragment,i),m=!0)},o(i){S(e.$$.fragment,i),S(n),S(c.$$.fragment,i),S(o.$$.fragment,i),S(g.$$.fragment,i),m=!1},d(i){i&&(b(t),b(a),b(r),b(v)),M(e,i),f[s].d(i),M(c,i),M(o,i),M(g,i)}}}function $e(l,e,t){let s,n,a,c,r,o,u;ae(l,ue,I=>t(10,u=I));let{data:v}=e,g=v.tokenIdx,w=v.token,m=!1,x=!1;function f(){fetch(`${F}/posts/${a}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`}}).then(I=>I.json()).then(()=>se(`/users/${g}`,{replaceState:!0,invalidateAll:!0}))}const p=()=>{t(1,m=!0)},h=()=>{t(1,m=!1),se(`/viewer/edit?type=patch&postIdx=${a}`,{replaceState:!1,invalidateAll:!1})},k=()=>{t(1,m=!1),t(2,x=!0)};function O(I){m=I,t(1,m)}const D=()=>{f(),t(2,x=!1)},i=()=>{t(2,x=!1)};function _(I){x=I,t(2,x)}return l.$$set=I=>{"data"in I&&t(0,v=I.data)},l.$$.update=()=>{var I;l.$$.dirty&1024&&t(9,s=u.url.searchParams.get("placeIdx")),l.$$.dirty&1024&&t(8,n=u.url.searchParams.get("userIdx")),l.$$.dirty&1024&&t(3,a=u.url.searchParams.get("postIdx")),l.$$.dirty&1&&t(7,c=(I=v.posts[v.index])==null?void 0:I.user_idx),l.$$.dirty&768&&t(5,r=!s&&!n),l.$$.dirty&128&&t(4,o=String(g)===String(c))},[v,m,x,a,o,r,f,c,n,s,u,p,h,k,O,D,i,_]}class Re extends K{constructor(e){super(),Q(this,e,$e,Ce,J,{data:0})}}const Pe=async({fetch:l,url:e,data:t})=>{console.warn("viewer/+page.ts load");const s=sessionStorage.getItem("jwt"),n=le(),a=e.searchParams.get("placeIdx"),c=e.searchParams.get("userIdx"),r=Number(e.searchParams.get("postIdx")||0),o=Number(e.searchParams.get("mediaIdx")||0),u=0,v=30,g=`&offset=${u}`,w=`&limit=${v}`;let m=[],x=0;if((c||a)&&ee(W).length>0)m=ee(W).map(f=>f.idx===r?{...f,mediaIdx:o}:{...f,mediaIdx:0}),x=m.findIndex(f=>f.idx===String(r));else{r&&(m=[await l(`${F}/posts/${r}`,{method:"GET",headers:{Authorization:"Bearer "+s}}).then(h=>h.json()).then(h=>h.data)]);const f=await re.getCurrentOrLastLocation(),p=f?`&location=${[f==null?void 0:f.longitude,f==null?void 0:f.latitude].join(",")}`:"";m=[...m,...await l(`${F}/posts?${g}${w}${p}`,{method:"GET",headers:{Authorization:"Bearer "+s}}).then(h=>h.json()).then(h=>h.data.map(k=>k.idx===r?{...k,mediaIdx:o}:{...k,mediaIdx:0}))||[]]}return{index:x,posts:m,tokenIdx:n,token:s}},Ge=Object.freeze(Object.defineProperty({__proto__:null,load:Pe},Symbol.toStringTag,{value:"Module"}));export{Re as component,Ge as universal};
