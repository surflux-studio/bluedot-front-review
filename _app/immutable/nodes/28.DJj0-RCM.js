import{s as Q,e as B,c as T,b as L,f as $,Q as M,i as I,A,J as R,I as ee,F as te,K as G,a as V,D as J,g as y,k as C,w as se,x as ne,v as D,h as ae,n as P}from"../chunks/scheduler.BTWb34i-.js";import{S as U,i as W,c as w,b as S,m as E,t as g,a as b,d as j,f as O,g as F}from"../chunks/index.D8fgSKXR.js";import{H as oe}from"../chunks/Header.BJ_WNx7K.js";import{V as re}from"../chunks/Viewer.CHDy-O-T.js";import{p as ie}from"../chunks/stores.CAFNgcVH.js";import{N as le}from"../chunks/NavigationBar.CcQzzCkF.js";import"../chunks/ActionSheet.svelte_svelte_type_style_lang.DKdopKpc.js";/* empty css                                                   */import{h as ce,j as H,g as fe,A as K}from"../chunks/sign.FXUqjdDN.js";import{g as me}from"../chunks/entry.BCQ5qs3h.js";import{M as ue,P as pe,S as de}from"../chunks/index.CBy3MeZ6.js";import{I as he}from"../chunks/IconSearch.CTOpFr3y.js";function _e(o){let e,s,t;return{c(){e=B("emoji-picker"),this.h()},l(n){e=T(n,"EMOJI-PICKER",{"aria-hidden":!0,class:!0}),L(e).forEach($),this.h()},h(){M(e,"aria-hidden",""),M(e,"class",o[0])},m(n,r){I(n,e,r),s||(t=[A(e,"emoji-click",R(ee(o[2]))),A(e,"touchstart",R(o[4])),A(e,"touchend",R(o[5]))],s=!0)},p(n,r){r&1&&M(e,"class",n[0])},d(n){n&&$(e),s=!1,te(t)}}}function ge(o){let e,s;return e=new ue({props:{onMask:!0,position:"absolute",onTouch:o[6],$$slots:{default:[_e]},$$scope:{ctx:o}}}),{c(){w(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,n){E(e,t,n),s=!0},p(t,[n]){const r={};n&2&&(r.onTouch=t[6]),n&257&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){s||(g(e.$$.fragment,t),s=!0)},o(t){b(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function $e(o,e,s){let{classList:t}=e,{onSelect:n}=e,{close:r}=e;function c(m){n(m.detail.unicode)}new pe({emojiVersion:15});function f(m){G.call(this,o,m)}function u(m){G.call(this,o,m)}const d=()=>{r()};return o.$$set=m=>{"classList"in m&&s(0,t=m.classList),"onSelect"in m&&s(3,n=m.onSelect),"close"in m&&s(1,r=m.close)},[t,r,c,n,f,u,d]}class be extends U{constructor(e){super(),W(this,e,$e,ge,Q,{classList:0,onSelect:3,close:1})}}function Ie(o){let e,s,t,n,r,c;return t=new he({props:{width:"24",height:"24"}}),{c(){e=B("div"),s=B("button"),w(t.$$.fragment),this.h()},l(f){e=T(f,"DIV",{slot:!0,class:!0});var u=L(e);s=T(u,"BUTTON",{});var d=L(s);S(t.$$.fragment,d),d.forEach($),u.forEach($),this.h()},h(){D(e,"slot","right"),D(e,"class","flex items-center gap-2")},m(f,u){I(f,e,u),ae(e,s),E(t,s,null),n=!0,r||(c=A(s,"click",o[8]),r=!0)},p:P,i(f){n||(g(t.$$.fragment,f),n=!0)},o(f){b(t.$$.fragment,f),n=!1},d(f){f&&$(e),j(t),r=!1,c()}}}function ke(o){let e,s;return e=new re({props:{posts:o[0].posts,index:o[0].index,selectedReaction:o[1]}}),{c(){w(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,n){E(e,t,n),s=!0},p(t,n){const r={};n&1&&(r.posts=t[0].posts),n&1&&(r.index=t[0].index),n&2&&(r.selectedReaction=t[1]),e.$set(r)},i(t){s||(g(e.$$.fragment,t),s=!0)},o(t){b(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function we(o){let e;return{c(){e=B("div"),this.h()},l(s){e=T(s,"DIV",{class:!0}),L(e).forEach($),this.h()},h(){D(e,"class","w-full h-full")},m(s,t){I(s,e,t)},p:P,i:P,o:P,d(s){s&&$(e)}}}function q(o){let e,s;return e=new be({props:{classList:"absolute bottom-24 right-0 px-4 z-50",onSelect:o[4],close:o[9]}}),{c(){w(e.$$.fragment)},l(t){S(e.$$.fragment,t)},m(t,n){E(e,t,n),s=!0},p:P,i(t){s||(g(e.$$.fragment,t),s=!0)},o(t){b(e.$$.fragment,t),s=!1},d(t){j(e,t)}}}function Se(o){let e,s,t,n,r,c,f,u,d;e=new oe({props:{position:"fixed",leftBack:o[2]?"":"white",$$slots:{right:[Ie]},$$scope:{ctx:o}}});const m=[we,ke],h=[];function N(a,i){return a[0].posts.length===0?0:1}t=N(o),n=h[t]=m[t](o),c=new le({});let l=o[3]&&q(o);return{c(){w(e.$$.fragment),s=V(),n.c(),r=V(),w(c.$$.fragment),f=V(),l&&l.c(),u=J()},l(a){S(e.$$.fragment,a),s=y(a),n.l(a),r=y(a),S(c.$$.fragment,a),f=y(a),l&&l.l(a),u=J()},m(a,i){E(e,a,i),I(a,s,i),h[t].m(a,i),I(a,r,i),E(c,a,i),I(a,f,i),l&&l.m(a,i),I(a,u,i),d=!0},p(a,[i]){const _={};i&4&&(_.leftBack=a[2]?"":"white"),i&4096&&(_.$$scope={dirty:i,ctx:a}),e.$set(_);let x=t;t=N(a),t===x?h[t].p(a,i):(F(),b(h[x],1,1,()=>{h[x]=null}),O(),n=h[t],n?n.p(a,i):(n=h[t]=m[t](a),n.c()),g(n,1),n.m(r.parentNode,r)),a[3]?l?(l.p(a,i),i&8&&g(l,1)):(l=q(a),l.c(),g(l,1),l.m(u.parentNode,u)):l&&(F(),b(l,1,1,()=>{l=null}),O())},i(a){d||(g(e.$$.fragment,a),g(n),g(c.$$.fragment,a),g(l),d=!0)},o(a){b(e.$$.fragment,a),b(n),b(c.$$.fragment,a),b(l),d=!1},d(a){a&&($(s),$(r),$(f),$(u)),j(e,a),h[t].d(a),j(c,a),l&&l.d(a)}}}function Ee(o,e,s){let t,n,r,c,f,u;C(o,ie,i=>s(7,c=i)),C(o,ce,i=>s(11,f=i)),C(o,H,i=>s(3,u=i));let d={posts:[],index:0},m,h;se(async()=>{await de.hide();let i="";try{i=fe()}catch{}const _=Number(c.url.searchParams.get("postIdx")||0);Number(c.url.searchParams.get("mediaIdx")||0);const x=0,X=30,Y=`&offset=${x}`,Z=`&limit=${X}`;let k=[];(n||t)&&f.length>0?(k=f.map(p=>p.idx===_?{...p,mediaIdx:p.mediaIdx||0}:{...p,mediaIdx:0}),s(0,d.index=k.findIndex(p=>p.idx===String(_)),d)):(h=new AbortController,_&&(k=[await fetch(`${K}/posts/${_}`,{method:"GET",headers:{Authorization:"Bearer "+i},signal:h.signal}).then(p=>p.json()).then(p=>({...p.data,mediaIdx:p.data.mediaIdx||0}))]),k=[...k,...await fetch(`${K}/posts?${Y}${Z}`,{method:"GET",headers:{Authorization:"Bearer "+i},signal:h.signal}).then(p=>p.json()).then(p=>{var z;return(z=p.data)==null?void 0:z.posts.filter(v=>v.idx!==String(_)).map(v=>({...v,mediaIdx:v.mediaIdx||0}))})||[]]),s(0,d.posts=k,d)}),ne(()=>{h&&h.abort()});async function N(i){const _=c.url.searchParams.get("postIdx");_&&s(1,m={postIdx:_,reaction:i})}const l=async()=>{await me("/search")},a=()=>{H.set(!1)};return o.$$.update=()=>{o.$$.dirty&128&&s(5,t=c.url.searchParams.get("placeIdx")),o.$$.dirty&128&&s(6,n=c.url.searchParams.get("userIdx")),o.$$.dirty&96&&s(2,r=!t&&!n)},[d,m,r,u,N,t,n,c,l,a]}class ye extends U{constructor(e){super(),W(this,e,Ee,Se,Q,{})}}export{ye as component};
