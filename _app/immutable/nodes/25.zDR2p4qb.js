import{j as Ie,e as ge,g as se,d as be,r as De,C as Ve}from"../chunks/sign.B9B4Tbt1.js";import{e as Z}from"../chunks/index.B85aOx-S.js";import{A as ne,k as ue}from"../chunks/constants.B40lR-wj.js";import{l as Be,s as ve,e as D,c as V,b as S,f as k,q as y,i as J,t as re,a as Y,d as oe,g as j,h as C,v as R,T as Ae,j as ce,n as te,C as W,D as U,k as fe,A as Ee,B as Pe,Y as Se,y as Te,E as ke}from"../chunks/scheduler.Ds8JjPaX.js";import{g as ee}from"../chunks/entry.CayY3Lwj.js";import{S as ye,i as we,g as ae,f as le,t as A,a as E,c as x,b as L,m as H,d as q,e as Q}from"../chunks/index.ucgEq-dW.js";import{H as Ce}from"../chunks/Header.BTUMY7Je.js";import{V as $e}from"../chunks/Viewer.VPAuYEcA.js";/* empty css                                                   */import"../chunks/heic2any.BUVkEL7j.js";/* empty css                                                     *//* empty css                                                   */import{p as Ne}from"../chunks/stores.2r8ZKa-r.js";import{e as de,u as Oe,o as Ye}from"../chunks/each.BmbOg1ua.js";import{I as je}from"../chunks/IconChevronRight.DJW4CkZG.js";import{B as Fe}from"../chunks/BottomNavigationPadder.lFXP-Uph.js";import{V as Me}from"../chunks/VisibilitySheet.DbLsCz33.js";/* empty css                                                            */const xe=async({fetch:s,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return Z(400,"Bad Request");if(t==="post"){const i=Ie();return{posts:[{user_idx:i==null?void 0:i.sub,unique_name:i==null?void 0:i.uni,profile_image_url:i==null?void 0:i.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Be(be),mediaIdx:0,text:""}]}}if(t==="patch"){const i=e.searchParams.get("postIdx");if(i==="null")return ge.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),ee("/viewer",{replaceState:!0});i||Z(404,"Not Found");const n=await s(`${ne}/posts/${i}`,{method:"GET",headers:{Authorization:"Bearer "+se()}}).then(r=>r.json()).then(r=>r.data);return n.error&&Z(404,"Not Found"),{posts:[{...n,mediaIdx:0}]}}return Z(404,"Not Found")},bt=Object.freeze(Object.defineProperty({__proto__:null,load:xe},Symbol.toStringTag,{value:"Module"}));var pe;(function(s){s.Dark="DARK",s.Light="LIGHT",s.Default="DEFAULT"})(pe||(pe={}));var _e;(function(s){s.Body="body",s.Ionic="ionic",s.Native="native",s.None="none"})(_e||(_e={}));const ie=De("Keyboard");function he(s,e,t){const i=s.slice();return i[1]=e[t],i[3]=t,i}function Le(s){let e;return{c(){e=D("div"),this.h()},l(t){e=V(t,"DIV",{class:!0}),S(e).forEach(k),this.h()},h(){y(e,"class","w-0.5")},m(t,i){J(t,e,i)},i:te,o:te,d(t){t&&k(e)}}}function He(s){let e,t;return e=new je({props:{fill:"#6B7280",length:"1.25"}}),{c(){x(e.$$.fragment)},l(i){L(e.$$.fragment,i)},m(i,n){H(e,i,n),t=!0},i(i){t||(A(e.$$.fragment,i),t=!0)},o(i){E(e.$$.fragment,i),t=!1},d(i){q(e,i)}}}function me(s,e){let t,i,n=e[1].title+"",r,m,a,l,u=e[1].value+"",o,_,g,p,c,b,h,B,T;const P=[He,Le],w=[];function F($,I){return $[1].onClick?0:1}return g=F(e),p=w[g]=P[g](e),{key:s,first:null,c(){t=D("div"),i=D("span"),r=re(n),m=Y(),a=D("div"),l=D("span"),o=re(u),_=Y(),p.c(),c=Y(),this.h()},l($){t=V($,"DIV",{class:!0});var I=S(t);i=V(I,"SPAN",{class:!0});var N=S(i);r=oe(N,n),N.forEach(k),m=j(I),a=V(I,"DIV",{class:!0});var O=S(a);l=V(O,"SPAN",{class:!0});var G=S(l);o=oe(G,u),G.forEach(k),_=j(O),p.l(O),O.forEach(k),c=j(I),I.forEach(k),this.h()},h(){y(i,"class","text-white text-base"),y(l,"class","text-gray-500 text-sm font-medium"),y(a,"class","flex items-center gap-2"),y(t,"class",b=`flex items-center justify-between w-full p-4 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m($,I){J($,t,I),C(t,i),C(i,r),C(t,m),C(t,a),C(a,l),C(l,o),C(a,_),w[g].m(a,null),C(t,c),h=!0,B||(T=R(t,"click",function(){Ae(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),B=!0)},p($,I){e=$,(!h||I&1)&&n!==(n=e[1].title+"")&&ce(r,n),(!h||I&1)&&u!==(u=e[1].value+"")&&ce(o,u);let N=g;g=F(e),g!==N&&(ae(),E(w[N],1,1,()=>{w[N]=null}),le(),p=w[g],p||(p=w[g]=P[g](e),p.c()),A(p,1),p.m(a,null)),(!h||I&1&&b!==(b=`flex items-center justify-between w-full p-4 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&y(t,"class",b)},i($){h||(A(p),h=!0)},o($){E(p),h=!1},d($){$&&k(t),w[g].d(),B=!1,T()}}}function qe(s){let e,t=[],i=new Map,n,r=de(s[0]);const m=a=>a[1].id;for(let a=0;a<r.length;a+=1){let l=he(s,r,a),u=m(l);i.set(u,t[a]=me(u,l))}return{c(){e=D("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=V(a,"DIV",{class:!0});var l=S(e);for(let u=0;u<t.length;u+=1)t[u].l(l);l.forEach(k),this.h()},h(){y(e,"class","flex flex-col w-full")},m(a,l){J(a,e,l);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(e,null);n=!0},p(a,[l]){l&1&&(r=de(a[0]),ae(),t=Oe(t,l,m,1,a,r,i,e,Ye,me,null,he),le())},i(a){if(!n){for(let l=0;l<r.length;l+=1)A(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)E(t[l]);n=!1},d(a){a&&k(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function Je(s,e,t){let{items:i=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return s.$$set=n=>{"items"in n&&t(0,i=n.items)},[i]}class Ge extends ye{constructor(e){super(),we(this,e,Je,qe,ve,{items:0})}}function ze(s){let e,t,i,n,r,m;e=new Ce({props:{position:"fixed",leftBack:"white",$$slots:{right:[Re]},$$scope:{ctx:s}}});function a(o){s[20](o)}function l(o){s[21](o)}let u={dontMoveVertically:!0};return s[6]!==void 0&&(u.posts=s[6]),s[4]!==void 0&&(u.keyboardY=s[4]),i=new $e({props:u}),W.push(()=>Q(i,"posts",a)),W.push(()=>Q(i,"keyboardY",l)),{c(){x(e.$$.fragment),t=Y(),x(i.$$.fragment)},l(o){L(e.$$.fragment,o),t=j(o),L(i.$$.fragment,o)},m(o,_){H(e,o,_),J(o,t,_),H(i,o,_),m=!0},p(o,_){const g={};_&536870912&&(g.$$scope={dirty:_,ctx:o}),e.$set(g);const p={};!n&&_&64&&(n=!0,p.posts=o[6],U(()=>n=!1)),!r&&_&16&&(r=!0,p.keyboardY=o[4],U(()=>r=!1)),i.$set(p)},i(o){m||(A(e.$$.fragment,o),A(i.$$.fragment,o),m=!0)},o(o){E(e.$$.fragment,o),E(i.$$.fragment,o),m=!1},d(o){o&&k(t),q(e,o),q(i,o)}}}function Ke(s){var G;let e,t,i,n,r,m,a,l,u,o,_=(s[1]||"텍스트 입력하기...")+"",g,p,c,b,h,B,T,P,w,F,$;t=new Ce({props:{position:"static",leftBack:"white",$$slots:{right:[We]},$$scope:{ctx:s}}});function I(d){s[14](d)}function N(d){s[15](d)}let O={dontMoveVertically:!0,isEdit:!0};return s[6]!==void 0&&(O.posts=s[6]),s[4]!==void 0&&(O.keyboardY=s[4]),r=new $e({props:O}),W.push(()=>Q(r,"posts",I)),W.push(()=>Q(r,"keyboardY",N)),h=new Ge({props:{items:[{id:1,title:"장소",value:((G=s[6].at(0))==null?void 0:G.place_name)||""},{id:2,title:"공개 여부",value:ue[s[3]],onClick:s[18]}]}}),P=new Fe({}),{c(){e=D("section"),x(t.$$.fragment),i=Y(),n=D("div"),x(r.$$.fragment),l=Y(),u=D("div"),o=D("div"),g=re(_),c=Y(),b=D("div"),x(h.$$.fragment),B=Y(),T=D("div"),x(P.$$.fragment),this.h()},l(d){e=V(d,"SECTION",{class:!0});var v=S(e);L(t.$$.fragment,v),i=j(v),n=V(v,"DIV",{class:!0});var z=S(n);L(r.$$.fragment,z),z.forEach(k),l=j(v),u=V(v,"DIV",{class:!0});var M=S(u);o=V(M,"DIV",{contenteditable:!0,class:!0});var K=S(o);g=oe(K,_),K.forEach(k),M.forEach(k),c=j(v),b=V(v,"DIV",{class:!0});var f=S(b);L(h.$$.fragment,f),f.forEach(k),B=j(v),T=V(v,"DIV",{class:!0});var X=S(T);L(P.$$.fragment,X),X.forEach(k),v.forEach(k),this.h()},h(){y(n,"class","flex flex-grow"),y(o,"contenteditable","true"),y(o,"class",p="w-full h-full bg-black border-0 overflow-y-auto focus:outline-none text-base "+(s[5]?"text-gray-400":"text-white")),y(u,"class","h-44 px-5 py-3"),y(b,"class",""),y(T,"class","h-40"),y(e,"class","flex flex-col w-full h-screen bg-black")},m(d,v){J(d,e,v),H(t,e,null),C(e,i),C(e,n),H(r,n,null),C(e,l),C(e,u),C(u,o),C(o,g),C(e,c),C(e,b),H(h,b,null),C(e,B),C(e,T),H(P,T,null),w=!0,F||($=[R(o,"input",s[10]),R(o,"focus",s[16]),R(o,"blur",s[17])],F=!0)},p(d,v){var f;const z={};v&536870913&&(z.$$scope={dirty:v,ctx:d}),t.$set(z);const M={};!m&&v&64&&(m=!0,M.posts=d[6],U(()=>m=!1)),!a&&v&16&&(a=!0,M.keyboardY=d[4],U(()=>a=!1)),r.$set(M),(!w||v&2)&&_!==(_=(d[1]||"텍스트 입력하기...")+"")&&Se(g,_),(!w||v&32&&p!==(p="w-full h-full bg-black border-0 overflow-y-auto focus:outline-none text-base "+(d[5]?"text-gray-400":"text-white")))&&y(o,"class",p);const K={};v&76&&(K.items=[{id:1,title:"장소",value:((f=d[6].at(0))==null?void 0:f.place_name)||""},{id:2,title:"공개 여부",value:ue[d[3]],onClick:d[18]}]),h.$set(K)},i(d){w||(A(t.$$.fragment,d),A(r.$$.fragment,d),A(h.$$.fragment,d),A(P.$$.fragment,d),w=!0)},o(d){E(t.$$.fragment,d),E(r.$$.fragment,d),E(h.$$.fragment,d),E(P.$$.fragment,d),w=!1},d(d){d&&k(e),q(t),q(r),q(h),q(P),F=!1,Te($)}}}function Re(s){let e,t="완료",i,n;return{c(){e=D("div"),e.textContent=t,this.h()},l(r){e=V(r,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ke(e)!=="svelte-11t55ng"&&(e.textContent=t),this.h()},h(){y(e,"slot","right"),y(e,"class","text-white")},m(r,m){J(r,e,m),i||(n=R(e,"click",s[19]),i=!0)},p:te,d(r){r&&k(e),i=!1,n()}}}function We(s){let e,t="다음",i,n;return{c(){e=D("div"),e.textContent=t,this.h()},l(r){e=V(r,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ke(e)!=="svelte-1nvebws"&&(e.textContent=t),this.h()},h(){y(e,"slot","right"),y(e,"class","text-white")},m(r,m){J(r,e,m),i||(n=R(e,"click",s[13]),i=!0)},p:te,d(r){r&&k(e),i=!1,n()}}}function Ue(s){let e,t,i,n,r,m,a;const l=[Ke,ze],u=[];function o(c,b){return c[0]===0?0:c[0]===1?1:-1}~(e=o(s))&&(t=u[e]=l[e](s));function _(c){s[22](c)}function g(c){s[23](c)}let p={};return s[2]!==void 0&&(p.isOpen=s[2]),s[3]!==void 0&&(p.selectedVisibility=s[3]),n=new Me({props:p}),W.push(()=>Q(n,"isOpen",_)),W.push(()=>Q(n,"selectedVisibility",g)),{c(){t&&t.c(),i=Y(),x(n.$$.fragment)},l(c){t&&t.l(c),i=j(c),L(n.$$.fragment,c)},m(c,b){~e&&u[e].m(c,b),J(c,i,b),H(n,c,b),a=!0},p(c,[b]){let h=e;e=o(c),e===h?~e&&u[e].p(c,b):(t&&(ae(),E(u[h],1,1,()=>{u[h]=null}),le()),~e?(t=u[e],t?t.p(c,b):(t=u[e]=l[e](c),t.c()),A(t,1),t.m(i.parentNode,i)):t=null);const B={};!r&&b&4&&(r=!0,B.isOpen=c[2],U(()=>r=!1)),!m&&b&8&&(m=!0,B.selectedVisibility=c[3],U(()=>m=!1)),n.$set(B)},i(c){a||(A(t),A(n.$$.fragment,c),a=!0)},o(c){E(t),E(n.$$.fragment,c),a=!1},d(c){c&&k(i),~e&&u[e].d(c),q(n,c)}}}function Qe(s){const e=s.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function Xe(s){const e=s.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function Ze(s,e,t){let i,n,r,m;fe(s,Ne,f=>t(25,r=f)),fe(s,be,f=>t(12,m=f));const a=Ve.getPlatform()!=="web",l=r.url.searchParams.get("type");let u=0,{data:o}=e,_="",g=!1,p="public";async function c(){(await fetch(`${ne}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se()}`},body:JSON.stringify({placeIdx:r.url.searchParams.get("placeIdx"),text:_,media:i,permission:p})})).ok&&await ee("/users/0",{replaceState:!0,invalidateAll:!0})}async function b(){try{const f=await fetch(`${ne}/posts/${r.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se()}`},body:JSON.stringify({text:_})});if(!f.ok){(await f.json()).status===401&&(ge.emit("pushSnackbar",{message:"접근할 수 없습니다"}),ee(`/viewer?postIdx=${r.url.searchParams.get("postIdx")}`));return}await ee("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let h=0;function B(){ie.addListener("keyboardWillShow",f=>{t(4,h=f.keyboardHeight*-1)}),ie.addListener("keyboardWillHide",()=>{t(4,h=0)})}function T(){ie.removeAllListeners()}Ee(()=>{a&&B()}),Pe(()=>{a&&T()});function P(f){const X=f.target;t(1,_=X.innerText),t(6,n[0]={...n[0],text:_},n)}let w=_.trim()==="";const F=()=>t(0,u=1);function $(f){n=f,t(6,n),t(11,o)}function I(f){h=f,t(4,h)}const N=f=>{Qe(f),t(5,w=!1)},O=f=>{Xe(f),t(5,w=!_.trim())},G=()=>{t(2,g=!0)},d=()=>{l==="post"?c():l==="patch"&&b()};function v(f){n=f,t(6,n),t(11,o)}function z(f){h=f,t(4,h)}function M(f){g=f,t(2,g)}function K(f){p=f,t(3,p)}return s.$$set=f=>{"data"in f&&t(11,o=f.data)},s.$$.update=()=>{s.$$.dirty&4096&&(i=m),s.$$.dirty&2048&&t(6,n=o.posts)},[u,_,g,p,h,w,n,l,c,b,P,o,m,F,$,I,N,O,G,d,v,z,M,K]}class vt extends ye{constructor(e){super(),we(this,e,Ze,Ue,ve,{data:11})}}export{vt as component,bt as universal};
