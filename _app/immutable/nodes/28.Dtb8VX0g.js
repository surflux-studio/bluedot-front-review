import{k as Ie,e as be,A as ie,g as se,p as ve,r as De,C as Be,l as ce}from"../chunks/sign.CF4sWAC7.js";import{e as Z}from"../chunks/index.g5YcAAdQ.js";import{l as Ve,s as ke,e as D,c as B,b as x,f as k,v as w,i as F,t as ne,a as T,d as re,g as Y,h as y,A as K,S as Ae,j as fe,n as X,y as R,z as W,k as de,w as Ee,x as Pe,X as xe,F as Se,B as ae}from"../chunks/scheduler.D0BZyuSu.js";import{g as ee}from"../chunks/entry.CF33Li5p.js";import{S as we,i as $e,g as oe,f as le,t as V,a as A,c as j,b as M,m as L,d as H,e as U}from"../chunks/index.ChpzTwUX.js";import{H as ye}from"../chunks/Header.3Kxn0Mdx.js";import{V as Ce}from"../chunks/Viewer.Z_EMMSFv.js";/* empty css                                                   */import{p as Ne}from"../chunks/stores.Ddneh9-F.js";import{e as pe,u as Oe,o as Te}from"../chunks/each.D_QC0jyL.js";import{I as Ye}from"../chunks/IconChevronRight.BoqqTVi8.js";import{B as Fe}from"../chunks/BottomNavigationPadder.DI7yCBeX.js";import{V as je}from"../chunks/VisibilitySheet.QhhqniCL.js";import{N as Me}from"../chunks/NavigationBar.Bw-AeNlX.js";const Le=async({fetch:s,url:e})=>{console.warn("viewer/edit/+page.ts load");const t=e.searchParams.get("type");if(t===null||!["post","patch"].includes(t))return Z(400,"Bad Request");if(t==="post"){console.log("viewer/edit/+page.ts load type post");const i=Ie();return{posts:[{user_idx:i==null?void 0:i.sub,unique_name:i==null?void 0:i.uni,profile_image_url:i==null?void 0:i.pic,place_idx:e.searchParams.get("placeIdx"),place_name:e.searchParams.get("placeName"),media:Ve(ve),mediaIdx:0,text:""}]}}if(t==="patch"){console.log("viewer/edit/+page.ts load type patch");const i=e.searchParams.get("postIdx");if(i==="null")return be.emit("pushSnackbar",{message:"페이지 접근에 문제가 발생했습니다"}),ee("/viewer",{replaceState:!0});i||Z(404,"Not Found");const r=await s(`${ie}/posts/${i}`,{method:"GET",headers:{Authorization:"Bearer "+se()}}).then(o=>o.json()).then(o=>o.data);return r.error&&Z(404,"Not Found"),{posts:[{...r,mediaIdx:0}]}}return Z(404,"Not Found")},mt=Object.freeze(Object.defineProperty({__proto__:null,load:Le},Symbol.toStringTag,{value:"Module"}));var _e;(function(s){s.Dark="DARK",s.Light="LIGHT",s.Default="DEFAULT"})(_e||(_e={}));var he;(function(s){s.Body="body",s.Ionic="ionic",s.Native="native",s.None="none"})(he||(he={}));const te=De("Keyboard");function me(s,e,t){const i=s.slice();return i[1]=e[t],i[3]=t,i}function He(s){let e;return{c(){e=D("div"),this.h()},l(t){e=B(t,"DIV",{class:!0}),x(e).forEach(k),this.h()},h(){w(e,"class","w-0.5")},m(t,i){F(t,e,i)},i:X,o:X,d(t){t&&k(e)}}}function Je(s){let e,t;return e=new Ye({props:{fill:"#6B7280",length:"1.25"}}),{c(){j(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,r){L(e,i,r),t=!0},i(i){t||(V(e.$$.fragment,i),t=!0)},o(i){A(e.$$.fragment,i),t=!1},d(i){H(e,i)}}}function ge(s,e){let t,i,r=e[1].title+"",o,g,a,l,c=e[1].value+"",_,b,n,f,u,h,m,E,S;const P=[Je,He],$=[];function J(C,I){return C[1].onClick?0:1}return n=J(e),f=$[n]=P[n](e),{key:s,first:null,c(){t=D("div"),i=D("span"),o=ne(r),g=T(),a=D("div"),l=D("span"),_=ne(c),b=T(),f.c(),u=T(),this.h()},l(C){t=B(C,"DIV",{class:!0});var I=x(t);i=B(I,"SPAN",{class:!0});var N=x(i);o=re(N,r),N.forEach(k),g=Y(I),a=B(I,"DIV",{class:!0});var O=x(a);l=B(O,"SPAN",{class:!0});var p=x(l);_=re(p,c),p.forEach(k),b=Y(O),f.l(O),O.forEach(k),u=Y(I),I.forEach(k),this.h()},h(){w(i,"class","text-white text-sm font-medium"),w(l,"class","text-gray-500 text-xs"),w(a,"class","flex items-center gap-2"),w(t,"class",h=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`),this.first=t},m(C,I){F(C,t,I),y(t,i),y(i,o),y(t,g),y(t,a),y(a,l),y(l,_),y(a,b),$[n].m(a,null),y(t,u),m=!0,E||(S=K(t,"click",function(){Ae(e[1].onClick)&&e[1].onClick.apply(this,arguments)}),E=!0)},p(C,I){e=C,(!m||I&1)&&r!==(r=e[1].title+"")&&fe(o,r),(!m||I&1)&&c!==(c=e[1].value+"")&&fe(_,c);let N=n;n=J(e),n!==N&&(oe(),A($[N],1,1,()=>{$[N]=null}),le(),f=$[n],f||(f=$[n]=P[n](e),f.c()),V(f,1),f.m(a,null)),(!m||I&1&&h!==(h=`flex items-center justify-between w-full px-5 py-2.5 border-b bg-black border-white/10
      ${e[1].onClick?"cursor-pointer hover:bg-white/10 active:bg-white/20":"cursor-default"} 
      ${e[3]===0?"border-t":""}
      transition-colors`))&&w(t,"class",h)},i(C){m||(V(f),m=!0)},o(C){A(f),m=!1},d(C){C&&k(t),$[n].d(),E=!1,S()}}}function qe(s){let e,t=[],i=new Map,r,o=pe(s[0]);const g=a=>a[1].id;for(let a=0;a<o.length;a+=1){let l=me(s,o,a),c=g(l);i.set(c,t[a]=ge(c,l))}return{c(){e=D("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=B(a,"DIV",{class:!0});var l=x(e);for(let c=0;c<t.length;c+=1)t[c].l(l);l.forEach(k),this.h()},h(){w(e,"class","flex flex-col w-full")},m(a,l){F(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);r=!0},p(a,[l]){l&1&&(o=pe(a[0]),oe(),t=Oe(t,l,g,1,a,o,i,e,Te,ge,null,me),le())},i(a){if(!r){for(let l=0;l<o.length;l+=1)V(t[l]);r=!0}},o(a){for(let l=0;l<t.length;l+=1)A(t[l]);r=!1},d(a){a&&k(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function ze(s,e,t){let{items:i=[{id:1,title:"장소",value:"팔발라 삼정본점"},{id:2,title:"공개 여부",value:"팔로워 공개"}]}=e;return s.$$set=r=>{"items"in r&&t(0,i=r.items)},[i]}class Ge extends we{constructor(e){super(),$e(this,e,ze,qe,ke,{items:0})}}function Ke(s){let e,t,i,r,o,g,a,l;e=new ye({props:{position:"fixed",leftBack:"white",$$slots:{right:[Ue],default:[We]},$$scope:{ctx:s}}});function c(n){s[20](n)}function _(n){s[21](n)}let b={dontMoveVertically:!0,hideActionButtons:!0};return s[1]!==void 0&&(b.posts=s[1]),s[5]!==void 0&&(b.keyboardY=s[5]),i=new Ce({props:b}),R.push(()=>U(i,"posts",c)),R.push(()=>U(i,"keyboardY",_)),a=new Me({}),{c(){j(e.$$.fragment),t=T(),j(i.$$.fragment),g=T(),j(a.$$.fragment)},l(n){M(e.$$.fragment,n),t=Y(n),M(i.$$.fragment,n),g=Y(n),M(a.$$.fragment,n)},m(n,f){L(e,n,f),F(n,t,f),L(i,n,f),F(n,g,f),L(a,n,f),l=!0},p(n,f){const u={};f&536870912&&(u.$$scope={dirty:f,ctx:n}),e.$set(u);const h={};!r&&f&2&&(r=!0,h.posts=n[1],W(()=>r=!1)),!o&&f&32&&(o=!0,h.keyboardY=n[5],W(()=>o=!1)),i.$set(h)},i(n){l||(V(e.$$.fragment,n),V(i.$$.fragment,n),V(a.$$.fragment,n),l=!0)},o(n){A(e.$$.fragment,n),A(i.$$.fragment,n),A(a.$$.fragment,n),l=!1},d(n){n&&(k(t),k(g)),H(e,n),H(i,n),H(a,n)}}}function Re(s){let e,t,i,r,o,g,a,l,c,_,b=(s[2]||"텍스트 입력하기...")+"",n,f,u,h,m,E,S,P,$,J,C;t=new ye({props:{position:"static",leftBack:"white",$$slots:{right:[Xe]},$$scope:{ctx:s}}});function I(p){s[14](p)}function N(p){s[15](p)}let O={dontMoveVertically:!0,isEdit:!0};return s[1]!==void 0&&(O.posts=s[1]),s[5]!==void 0&&(O.keyboardY=s[5]),o=new Ce({props:O}),R.push(()=>U(o,"posts",I)),R.push(()=>U(o,"keyboardY",N)),m=new Ge({props:{items:[{id:1,title:"장소",value:s[1][0].place_name||""},{id:2,title:"공개 여부",value:ce[s[4]],onClick:s[18]}]}}),P=new Fe({}),{c(){e=D("section"),j(t.$$.fragment),i=T(),r=D("div"),j(o.$$.fragment),l=T(),c=D("div"),_=D("div"),n=ne(b),u=T(),h=D("div"),j(m.$$.fragment),E=T(),S=D("div"),j(P.$$.fragment),this.h()},l(p){e=B(p,"SECTION",{class:!0});var v=x(e);M(t.$$.fragment,v),i=Y(v),r=B(v,"DIV",{class:!0});var z=x(r);M(o.$$.fragment,z),z.forEach(k),l=Y(v),c=B(v,"DIV",{class:!0});var q=x(c);_=B(q,"DIV",{contenteditable:!0,class:!0});var G=x(_);n=re(G,b),G.forEach(k),q.forEach(k),u=Y(v),h=B(v,"DIV",{class:!0});var Q=x(h);M(m.$$.fragment,Q),Q.forEach(k),E=Y(v),S=B(v,"DIV",{class:!0});var d=x(S);M(P.$$.fragment,d),d.forEach(k),v.forEach(k),this.h()},h(){w(r,"class","flex flex-grow"),w(_,"contenteditable","true"),w(_,"class",f=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${s[6]?"text-gray-400":"text-white"}
        `),w(c,"class","h-32 px-5 py-2.5"),w(h,"class",""),w(S,"class","h-40"),w(e,"class","flex flex-col w-full h-screen bg-black")},m(p,v){F(p,e,v),L(t,e,null),y(e,i),y(e,r),L(o,r,null),y(e,l),y(e,c),y(c,_),y(_,n),y(e,u),y(e,h),L(m,h,null),y(e,E),y(e,S),L(P,S,null),$=!0,J||(C=[K(_,"input",s[10]),K(_,"focus",s[16]),K(_,"blur",s[17])],J=!0)},p(p,v){const z={};v&536870913&&(z.$$scope={dirty:v,ctx:p}),t.$set(z);const q={};!g&&v&2&&(g=!0,q.posts=p[1],W(()=>g=!1)),!a&&v&32&&(a=!0,q.keyboardY=p[5],W(()=>a=!1)),o.$set(q),(!$||v&4)&&b!==(b=(p[2]||"텍스트 입력하기...")+"")&&xe(n,b),(!$||v&64&&f!==(f=`w-full h-full text-xs leading-[1.125rem] tracking-[-0.0375rem]
          bg-black border-0 overflow-y-auto 
          focus:outline-none 
          whitespace-pre-wrap
          ${p[6]?"text-gray-400":"text-white"}
        `))&&w(_,"class",f);const G={};v&26&&(G.items=[{id:1,title:"장소",value:p[1][0].place_name||""},{id:2,title:"공개 여부",value:ce[p[4]],onClick:p[18]}]),m.$set(G)},i(p){$||(V(t.$$.fragment,p),V(o.$$.fragment,p),V(m.$$.fragment,p),V(P.$$.fragment,p),$=!0)},o(p){A(t.$$.fragment,p),A(o.$$.fragment,p),A(m.$$.fragment,p),A(P.$$.fragment,p),$=!1},d(p){p&&k(e),H(t),H(o),H(m),H(P),J=!1,Se(C)}}}function We(s){let e,t="미리보기";return{c(){e=D("p"),e.textContent=t,this.h()},l(i){e=B(i,"P",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-1hktwn7"&&(e.textContent=t),this.h()},h(){w(e,"class","text-white text-[0.9375rem] font-semibold")},m(i,r){F(i,e,r)},p:X,d(i){i&&k(e)}}}function Ue(s){let e,t="완료",i,r;return{c(){e=D("div"),e.textContent=t,this.h()},l(o){e=B(o,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-11t55ng"&&(e.textContent=t),this.h()},h(){w(e,"slot","right"),w(e,"class","text-white")},m(o,g){F(o,e,g),i||(r=K(e,"click",s[19]),i=!0)},p:X,d(o){o&&k(e),i=!1,r()}}}function Xe(s){let e,t="다음",i,r;return{c(){e=D("div"),e.textContent=t,this.h()},l(o){e=B(o,"DIV",{slot:!0,class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-7lem8v"&&(e.textContent=t),this.h()},h(){w(e,"slot","right"),w(e,"class","text-white")},m(o,g){F(o,e,g),i||(r=K(e,"click",s[13]),i=!0)},p:X,d(o){o&&k(e),i=!1,r()}}}function Qe(s){let e,t,i,r,o,g,a;const l=[Re,Ke],c=[];function _(u,h){return u[0]===0?0:u[0]===1?1:-1}~(e=_(s))&&(t=c[e]=l[e](s));function b(u){s[22](u)}function n(u){s[23](u)}let f={};return s[3]!==void 0&&(f.isOpen=s[3]),s[4]!==void 0&&(f.selectedVisibility=s[4]),r=new je({props:f}),R.push(()=>U(r,"isOpen",b)),R.push(()=>U(r,"selectedVisibility",n)),{c(){t&&t.c(),i=T(),j(r.$$.fragment)},l(u){t&&t.l(u),i=Y(u),M(r.$$.fragment,u)},m(u,h){~e&&c[e].m(u,h),F(u,i,h),L(r,u,h),a=!0},p(u,[h]){let m=e;e=_(u),e===m?~e&&c[e].p(u,h):(t&&(oe(),A(c[m],1,1,()=>{c[m]=null}),le()),~e?(t=c[e],t?t.p(u,h):(t=c[e]=l[e](u),t.c()),V(t,1),t.m(i.parentNode,i)):t=null);const E={};!o&&h&8&&(o=!0,E.isOpen=u[3],W(()=>o=!1)),!g&&h&16&&(g=!0,E.selectedVisibility=u[4],W(()=>g=!1)),r.$set(E)},i(u){a||(V(t),V(r.$$.fragment,u),a=!0)},o(u){A(t),A(r.$$.fragment,u),a=!1},d(u){u&&k(i),~e&&c[e].d(u),H(r,u)}}}function Ze(s){const e=s.target;e.innerText==="텍스트 입력하기..."&&(e.innerText="")}function et(s){const e=s.target;e.innerText.trim()||(e.innerText="텍스트 입력하기...")}function tt(s,e,t){let i,r,o;de(s,Ne,d=>t(25,r=d)),de(s,ve,d=>t(12,o=d));const g=Be.getPlatform()!=="web",a=r.url.searchParams.get("type");let l=0,{data:c}=e,_=c.posts,b=_[0].text||"",n=!1,f="public";async function u(){(await fetch(`${ie}/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se()}`},body:JSON.stringify({placeIdx:r.url.searchParams.get("placeIdx"),text:b,media:i,permission:f})})).ok&&await ee("/users/0",{replaceState:!0,invalidateAll:!0})}async function h(){try{const d=await fetch(`${ie}/posts/${r.url.searchParams.get("postIdx")}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${se()}`},body:JSON.stringify({text:b})});if(!d.ok){(await d.json()).status===401&&(be.emit("pushSnackbar",{message:"접근할 수 없습니다"}),ee(`/viewer?postIdx=${r.url.searchParams.get("postIdx")}`));return}await ee("/users/0",{replaceState:!0,invalidateAll:!0})}catch{}}let m=0;function E(){te.addListener("keyboardWillShow",d=>{t(5,m=d.keyboardHeight*-1)}),te.addListener("keyboardWillHide",()=>{t(5,m=0)})}function S(){te.removeAllListeners()}Ee(()=>{g&&E()}),Pe(()=>{g&&S()});function P(d){const ue=d.target;t(2,b=ue.innerText),t(1,_[0]={..._[0],text:b},_)}let $=b.trim()==="";const J=()=>{t(0,l=1)};function C(d){_=d,t(1,_)}function I(d){m=d,t(5,m)}const N=d=>{Ze(d),t(6,$=!1)},O=d=>{et(d),t(6,$=!b.trim())},p=()=>{t(3,n=!0)},v=()=>{a==="post"?u():a==="patch"&&h()};function z(d){_=d,t(1,_)}function q(d){m=d,t(5,m)}function G(d){n=d,t(3,n)}function Q(d){f=d,t(4,f)}return s.$$set=d=>{"data"in d&&t(11,c=d.data)},s.$$.update=()=>{s.$$.dirty&4096&&(i=o)},[l,_,b,n,f,m,$,a,u,h,P,c,o,J,C,I,N,O,p,v,z,q,G,Q]}class gt extends we{constructor(e){super(),$e(this,e,tt,Qe,ke,{data:11})}}export{gt as component,mt as universal};
