import{s as W,e as T,a as j,q as D,M as te,c as z,z as J,g as L,r as V,b as S,f as C,N as ae,v as s,C as O,i as k,h as y,n as Y,y as K,w as Q,m as oe,t as ne,d as ie,A as se,u as re,o as le,p as ce,j as ue,k as fe,B as me}from"./scheduler.CXaZJLX8.js";import{S as X,i as $,c as de,d as he,m as pe,t as F,a as Z,f as ge}from"./index.BKOkOgp0.js";import{m as E,s as H,f as Ce}from"./map.Bukue693.js";import{e as A,A as _e,b as be}from"./store.mQmyAdCo.js";import{g as ve}from"./search.CsWh50R-.js";import{p as we}from"./stores.BM436znX.js";import"./entry.DkKUt85L.js";import{s as Ee}from"./searchParams.BnAD7qVt.js";import{a as N,f as q}from"./proj.C890k1jX.js";import{s as R}from"./s32cloudfront.DPtLQakp.js";import{i as xe}from"./isVideoFile.DGBlGWVm.js";/* empty css                                          */import{C as Pe}from"./index.DC48Ayze.js";function Se(u){let a,f="",l,m,r,h,g,c,_,d,t,b,v;return{c(){a=T("div"),a.innerHTML=f,l=j(),m=D("svg"),r=D("defs"),h=D("filter"),g=D("feGaussianBlur"),c=D("feColorMatrix"),_=D("feComposite"),d=D("mask"),t=D("rect"),b=D("g"),v=new te(!0),this.h()},l(o){a=z(o,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),J(a)!=="svelte-1yoogyr"&&(a.innerHTML=f),l=L(o),m=V(o,"svg",{width:!0,height:!0,style:!0});var e=S(m);r=V(e,"defs",{});var i=S(r);h=V(i,"filter",{id:!0});var x=S(h);g=V(x,"feGaussianBlur",{in:!0,stdDeviation:!0,result:!0}),S(g).forEach(C),c=V(x,"feColorMatrix",{in:!0,mode:!0,values:!0,result:!0}),S(c).forEach(C),_=V(x,"feComposite",{in:!0,in2:!0,operator:!0}),S(_).forEach(C),x.forEach(C),d=V(i,"mask",{id:!0});var B=S(d);t=V(B,"rect",{width:!0,height:!0,fill:!0}),S(t).forEach(C),b=V(B,"g",{filter:!0,fill:!0});var M=S(b);v=ae(M,!0),M.forEach(C),B.forEach(C),i.forEach(C),e.forEach(C),this.h()},h(){s(a,"id","scratch-layer"),s(a,"class","svelte-1zft9l"),s(g,"in","SourceGraphic"),s(g,"stdDeviation",Ie),s(g,"result","blur"),s(c,"in","blur"),s(c,"mode","matrix"),s(c,"values",De),s(c,"result","goo"),s(_,"in","SourceGraphic"),s(_,"in2","goo"),s(_,"operator","atop"),s(h,"id","gooey-filter"),s(t,"width","100%"),s(t,"height","100%"),s(t,"fill","white"),v.a=null,s(b,"filter","url(#gooey-filter)"),s(b,"fill","black"),s(d,"id","scratch-mask"),s(m,"width","100%"),s(m,"height","100%"),O(m,"position","absolute")},m(o,e){k(o,a,e),u[2](a),k(o,l,e),k(o,m,e),y(m,r),y(r,h),y(h,g),y(h,c),y(h,_),y(r,d),y(d,t),y(d,b),v.m(u[1],b)},p(o,[e]){e&2&&v.p(o[1])},i:Y,o:Y,d(o){o&&(C(a),C(l),C(m)),u[2](null)}}}let ye=30;const Ie=5,De="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7";function Ve(u,a,f){let l=[],m,r=0,h="";const g=t=>t<=3.5?16*13836.580104754194:t<=5?16*4891.96981025128:t<=6.5?16*1729.5725130942742:t<=8?16*611.49622628141:t<=9.5?16*216.19656413678427:t<=11?16*76.43702828517625:t<=12.5?16*27.024570517098034:t<=13.94?16*9.960373105967577:100*.5971642834779395;K(()=>{E.on("click",function(t){l.push(t.coordinate),_()}),E.on("postrender",c)});function c(){const t=performance.now();t-r<ye||(r=t,_(),console.log(`스크래치 시간: ${performance.now()-t} milliseconds.`))}function _(){const t=E.getView().getResolution(),b=E.getView().getZoom()??20,o=g(b)/(t??1);f(1,h=l.map(e=>{const[i,x]=E.getPixelFromCoordinate(e);return`<circle cx="${i}" cy="${x}" r="${o}" fill="black"/>`}).join(`
`))}function d(t){Q[t?"unshift":"push"](()=>{m=t,f(0,m)})}return[m,h,d]}class ke extends X{constructor(a){super(),$(this,a,Ve,Se,W,{})}}function Be(u){let a,f,l,m,r,h,g,c,_="복사",d,t,b;const v=u[9].default,o=oe(v,u,u[8],null);return l=new ke({}),{c(){a=T("div"),o&&o.c(),f=j(),de(l.$$.fragment),m=j(),r=T("div"),h=ne(u[1]),g=j(),c=T("button"),c.textContent=_,this.h()},l(e){a=z(e,"DIV",{id:!0,class:!0});var i=S(a);o&&o.l(i),i.forEach(C),f=L(e),he(l.$$.fragment,e),m=L(e),r=z(e,"DIV",{id:!0,class:!0});var x=S(r);h=ie(x,u[1]),g=L(x),c=z(x,"BUTTON",{class:!0,"data-svelte-h":!0}),J(c)!=="svelte-14xatxb"&&(c.textContent=_),x.forEach(C),this.h()},h(){s(a,"id","map"),s(a,"class","absolute w-full h-full z-[1] bg-[#BDDBF3] transition-transform duration-500"),O(a,"transform",`translateY(${u[0]}px)`),s(c,"class","bg-blue-300"),s(r,"id","push-test-data"),s(r,"class","absolute bottom-24 left-4 z-20 flex justify-around w-32 svelte-t4oldr")},m(e,i){k(e,a,i),o&&o.m(a,null),u[10](a),k(e,f,i),pe(l,e,i),k(e,m,i),k(e,r,i),y(r,h),y(r,g),y(r,c),d=!0,t||(b=se(c,"click",u[3]),t=!0)},p(e,[i]){o&&o.p&&(!d||i&256)&&re(o,v,e,e[8],d?ce(v,e[8],i,null):le(e[8]),null),i&1&&O(a,"transform",`translateY(${e[0]}px)`),(!d||i&2)&&ue(h,e[1])},i(e){d||(F(o,e),F(l.$$.fragment,e),d=!0)},o(e){Z(o,e),Z(l.$$.fragment,e),d=!1},d(e){e&&(C(a),C(f),C(m),C(r)),o&&o.d(e),u[10](null),ge(l,e),t=!1,b()}}}function U(u){u.preventDefault()}function Me(u,a,f){let l;fe(u,we,n=>f(13,l=n));let{$$slots:m={},$$scope:r}=a,{onSelect:h=()=>{}}=a,{onMoveend:g=()=>{}}=a,{mapY:c=0}=a,{allowEdit:_=!0}=a,{whenCancelEdit:d=()=>{}}=a,t="0";H.refresh(),A.on("explorePlaces",o);let b="",v;async function o(){var w;const n=E.getView().getZoom();if(!(!n||n<16))try{v&&v.abort("new request");const p=(w=window.location.search.split("tags=")[1])==null?void 0:w.split("&")[0];if(!p)return;const I=decodeURIComponent(p);if(!I)return;b!==I&&(H.refresh(),b=I),v=new AbortController;const G=await ve({tags:b,bbox:N(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:v});A.emit("addIcons",G.map(P=>({idx:P.idx,coordinate:q(P.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:R(P.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${P.idx}`,rank:3,name:P.name,width:38,height:46,onlyMain:!0})))}catch(p){(p==null?void 0:p.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",p)}}E.on("moveend",e);function e(){var n,w,p;o(),f(1,t=(n=E.getView().getZoom())==null?void 0:n.toFixed(2)),Ee({location:((w=E.getView().getCenter())==null?void 0:w.join(","))??"",zoom:((p=E.getView().getZoom())==null?void 0:p.toFixed(2))??""}),g(N(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}o();let i;K(()=>{E.setTarget(i),i.addEventListener("contextmenu",U),l.url.searchParams.has("location")&&x(),l.url.searchParams.has("placeIdx")&&B(l.url.searchParams.get("placeIdx")),g(N(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),me(()=>{E.un("moveend",e),i.removeEventListener("contextmenu",U)});function x(){const n=l.url.searchParams.get("location"),w=l.url.searchParams.get("zoom"),p=n==null?void 0:n.split(",").map(Number),I={};p&&(I.center=p),w&&(I.zoom=Number(w)),Object.values(I).length>0&&Ce(I)}A.on("addIconByPlaceIdx",B);async function B(n){var G;const w=await fetch(`${_e}/places/${n}`,{headers:{"x-api-version":be.PLACE}}).then(P=>P.json()).then(P=>P.data.place).catch(P=>{console.error(P)});let p=((G=w.thumbnail)==null?void 0:G.at(0))||"";if(!String(p).includes("youtu")){const P=R(p);await xe(P)&&(p=p+"-thumbnail")}const I={idx:w.placeIdx,coordinate:q([w.longitude,w.latitude]),image:R(p,500)||"",shape:"point",type:"place",link:`/places/${w.placeIdx}`,rank:5,name:w.name,width:38,height:46};A.emit("addIcon",I)}async function M(){await Pe.write({string:t})}function ee(n){Q[n?"unshift":"push"](()=>{i=n,f(2,i)})}return u.$$set=n=>{"onSelect"in n&&f(4,h=n.onSelect),"onMoveend"in n&&f(5,g=n.onMoveend),"mapY"in n&&f(0,c=n.mapY),"allowEdit"in n&&f(6,_=n.allowEdit),"whenCancelEdit"in n&&f(7,d=n.whenCancelEdit),"$$scope"in n&&f(8,r=n.$$scope)},[c,t,i,M,h,g,_,d,r,m,ee]}class Ue extends X{constructor(a){super(),$(this,a,Me,Be,W,{onSelect:4,onMoveend:5,mapY:0,allowEdit:6,whenCancelEdit:7})}}export{Ue as M};
