import{s as Fe,e as A,c as P,b as X,f as k,q as m,i as F,r as q,y as Qe,I as pe,k as $e,o as et,M as tt,l as st,v as we,D as nt,a as U,t as Te,g as J,d as We,G as le,h as L,N as be,j as je,C as Ce,J as Ie,O as Ee,x as lt}from"./scheduler.BiUHV-k5.js";import{S as rt,i as at,t as j,g as _e,f as ve,b as K,c as Oe,a as Re,m as Ne,d as qe}from"./index.DaxfEsq8.js";import{e as re}from"./each.BSmogOji.js";import{e as ot,A as it,r as ye}from"./units.CViq7WVk.js";import{g as ct}from"./entry.CNm_GwBA.js";import{b as ge}from"./store.CgiSRkuz.js";import{g as ut,u as ft}from"./searchParams.CAKBE76C.js";import{W as dt}from"./WaterdropImage.CKKxE3j7.js";import{C as ht}from"./CircleImage.W57X7zlF.js";import{p as mt}from"./stores.HPcaSUCG.js";import{L as gt}from"./location.UrMc7eyh.js";import{s as me}from"./s32cloudfront.LEGgYtVe.js";/* empty css                                             */function pt(t){const s=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","wheel"].map(a=>{const o=e=>e.stopPropagation();return t.addEventListener(a,o),{event:a,handler:o}});return{destroy(){s.forEach(({event:a,handler:o})=>{t.removeEventListener(a,o)})}}}function ke(t,n,s){const a=t.slice();return a[45]=n[s],a[46]=n,a[47]=s,a}function xe(t,n,s){const a=t.slice();return a[48]=n[s],a[50]=s,a}function Me(t,n,s){const a=t.slice();return a[51]=n[s],a}function Le(t){var W,oe;let n,s,a,o,e,i,f,l,d,u,h,v,D,H,C=(t[45].place_name||"")+"",ee,x,te,ae,se,ne,M,z,B,Y=re(t[45].media),I=[];for(let _=0;_<Y.length;_+=1)I[_]=De(Me(t,Y,_));let E=t[45].media.length>1&&Ye(t),y=(t[7]==="post"||t[7]==="patch"||((oe=(W=t[45])==null?void 0:W.text)==null?void 0:oe.length)>0)&&Pe(t),g=t[45].user_idx&&Xe(t);v=new dt({props:{src:"graydot.png",width:"2rem",strokeColor:"white",strokeWidth:"13"}});function O(){return t[19](t[45])}return{c(){n=A("div"),s=A("div"),a=A("div");for(let _=0;_<I.length;_+=1)I[_].c();i=U(),f=A("div"),E&&E.c(),l=U(),y&&y.c(),d=U(),g&&g.c(),u=U(),h=A("div"),Oe(v.$$.fragment),D=U(),H=A("div"),ee=Te(C),ae=U(),this.h()},l(_){n=P(_,"DIV",{class:!0,style:!0});var p=X(n);s=P(p,"DIV",{class:!0});var V=X(s);a=P(V,"DIV",{class:!0,style:!0});var R=X(a);for(let ie=0;ie<I.length;ie+=1)I[ie].l(R);R.forEach(k),V.forEach(k),i=J(p),f=P(p,"DIV",{class:!0,style:!0});var w=X(f);E&&E.l(w),l=J(w),y&&y.l(w),d=J(w),g&&g.l(w),u=J(w),h=P(w,"DIV",{class:!0});var G=X(h);Re(v.$$.fragment,G),D=J(G),H=P(G,"DIV",{});var he=X(H);ee=We(he,C),he.forEach(k),G.forEach(k),w.forEach(k),ae=J(p),p.forEach(k),this.h()},h(){m(a,"class",o=le(`carousel-track transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"),m(a,"style",e=`transform: translateX(${-t[45].mediaIdx*t[6].width+t[5]}px);`),m(s,"class","carousel-container svelte-1xgvwrg"),m(h,"class","text-shadow text-center flex gap-2 justify-center items-center svelte-1xgvwrg"),m(f,"class",x=le(`fixed bottom-0 w-full px-4 text-white text-md flex flex-col items-start gap-2 z-40 
            ${t[2]?"":"pb-24"} 
           transition-transform`)+" svelte-1xgvwrg"),m(f,"style",te=`transform: translateY(${t[2]}px);`),m(n,"class",se=le(`w-full h-full gradient-overlay absolute content-center transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"),m(n,"style",ne=`top: 0; transform: translateY(${(t[47]-t[1])*t[6].height+t[4]}px);`)},m(_,p){F(_,n,p),L(n,s),L(s,a);for(let V=0;V<I.length;V+=1)I[V]&&I[V].m(a,null);L(n,i),L(n,f),E&&E.m(f,null),L(f,l),y&&y.m(f,null),L(f,d),g&&g.m(f,null),L(f,u),L(f,h),Ne(v,h,null),L(h,D),L(h,H),L(H,ee),L(n,ae),M=!0,z||(B=[q(a,"transitionend",function(){be(t[45].mediaIdx===t[0][t[1]].mediaIdx?t[9]:void 0)&&(t[45].mediaIdx===t[0][t[1]].mediaIdx?t[9]:void 0).apply(this,arguments)}),q(h,"click",O),q(n,"transitionend",function(){be(t[47]===t[1]?t[9]:void 0)&&(t[47]===t[1]?t[9]:void 0).apply(this,arguments)})],z=!0)},p(_,p){var V,R;if(t=_,p[0]&1){Y=re(t[45].media);let w;for(w=0;w<Y.length;w+=1){const G=Me(t,Y,w);I[w]?I[w].p(G,p):(I[w]=De(G),I[w].c(),I[w].m(a,null))}for(;w<I.length;w+=1)I[w].d(1);I.length=Y.length}(!M||p[0]&8&&o!==(o=le(`carousel-track transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"))&&m(a,"class",o),(!M||p[0]&97&&e!==(e=`transform: translateX(${-t[45].mediaIdx*t[6].width+t[5]}px);`))&&m(a,"style",e),t[45].media.length>1?E?E.p(t,p):(E=Ye(t),E.c(),E.m(f,l)):E&&(E.d(1),E=null),t[7]==="post"||t[7]==="patch"||((R=(V=t[45])==null?void 0:V.text)==null?void 0:R.length)>0?y?y.p(t,p):(y=Pe(t),y.c(),y.m(f,d)):y&&(y.d(1),y=null),t[45].user_idx?g?(g.p(t,p),p[0]&1&&j(g,1)):(g=Xe(t),g.c(),j(g,1),g.m(f,u)):g&&(_e(),K(g,1,1,()=>{g=null}),ve()),(!M||p[0]&1)&&C!==(C=(t[45].place_name||"")+"")&&je(ee,C),(!M||p[0]&4&&x!==(x=le(`fixed bottom-0 w-full px-4 text-white text-md flex flex-col items-start gap-2 z-40 
            ${t[2]?"":"pb-24"} 
           transition-transform`)+" svelte-1xgvwrg"))&&m(f,"class",x),(!M||p[0]&4&&te!==(te=`transform: translateY(${t[2]}px);`))&&m(f,"style",te),(!M||p[0]&8&&se!==(se=le(`w-full h-full gradient-overlay absolute content-center transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"))&&m(n,"class",se),(!M||p[0]&82&&ne!==(ne=`top: 0; transform: translateY(${(t[47]-t[1])*t[6].height+t[4]}px);`))&&m(n,"style",ne)},i(_){M||(j(g),j(v.$$.fragment,_),M=!0)},o(_){K(g),K(v.$$.fragment,_),M=!1},d(_){_&&k(n),pe(I,_),E&&E.d(),y&&y.d(),g&&g.d(),qe(v),z=!1,Ce(B)}}}function De(t){let n,s,a,o,e;return{c(){n=A("div"),s=A("img"),e=U(),this.h()},l(i){n=P(i,"DIV",{class:!0});var f=X(n);s=P(f,"IMG",{src:!0,alt:!0,class:!0,draggable:!0}),e=J(f),f.forEach(k),this.h()},h(){Ie(s.src,a=me(t[51]))||m(s,"src",a),m(s,"alt",o=t[45].place_name),m(s,"class","w-full h-full object-contain svelte-1xgvwrg"),m(s,"draggable","false"),m(n,"class","carousel-slide svelte-1xgvwrg")},m(i,f){F(i,n,f),L(n,s),L(n,e)},p(i,f){f[0]&1&&!Ie(s.src,a=me(i[51]))&&m(s,"src",a),f[0]&1&&o!==(o=i[45].place_name)&&m(s,"alt",o)},d(i){i&&k(n)}}}function Ye(t){let n,s=re(t[45].media),a=[];for(let o=0;o<s.length;o+=1)a[o]=Ae(xe(t,s,o));return{c(){n=A("div");for(let o=0;o<a.length;o+=1)a[o].c();this.h()},l(o){n=P(o,"DIV",{class:!0});var e=X(n);for(let i=0;i<a.length;i+=1)a[i].l(e);e.forEach(k),this.h()},h(){m(n,"class","carousel-nav svelte-1xgvwrg")},m(o,e){F(o,n,e);for(let i=0;i<a.length;i+=1)a[i]&&a[i].m(n,null)},p(o,e){if(e[0]&1){s=re(o[45].media);let i;for(i=0;i<s.length;i+=1){const f=xe(o,s,i);a[i]?a[i].p(f,e):(a[i]=Ae(f),a[i].c(),a[i].m(n,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=s.length}},d(o){o&&k(n),pe(a,o)}}}function Ae(t){let n,s;return{c(){n=A("span"),this.h()},l(a){n=P(a,"SPAN",{class:!0}),X(n).forEach(k),this.h()},h(){m(n,"class",s="carousel-dot "+(t[45].mediaIdx===t[50]?"active":"")+" svelte-1xgvwrg")},m(a,o){F(a,n,o)},p(a,o){o[0]&1&&s!==(s="carousel-dot "+(a[45].mediaIdx===a[50]?"active":"")+" svelte-1xgvwrg")&&m(n,"class",s)},d(a){a&&k(n)}}}function Pe(t){let n,s,a;function o(){t[16].call(n,t[46],t[47])}return{c(){n=A("textarea"),this.h()},l(e){n=P(e,"TEXTAREA",{class:!0,placeholder:!0}),X(n).forEach(k),this.h()},h(){m(n,"class","w-full h-auto overflow-scroll py-0 px-1 mb-3 outline-0 focus:outline-none focus:ring-0 border-none bg-transparent text-sm text-shadow placeholder:text-white/75 placeholder:text-base box-content read-only:cursor-pointer  svelte-1xgvwrg"),n.readOnly=t[7]!=="post"&&t[7]!=="patch",m(n,"placeholder",t[7]==="post"||t[7]==="patch"?"✎ 텍스트 입력하기":"")},m(e,i){F(e,n,i),Ee(n,t[45].text),s||(a=[q(n,"input",o),lt(pt.call(null,n)),q(n,"input",t[17]),q(n,"click",t[10]),q(n,"focus",t[11]),q(n,"blur",t[12])],s=!0)},p(e,i){t=e,i[0]&1&&Ee(n,t[45].text)},d(e){e&&k(n),s=!1,Ce(a)}}}function Xe(t){let n,s,a,o,e=t[45].display_name+"",i,f,l,d;s=new ht({props:{src:me(t[45].profile_image_url),width:"2rem",strokeColor:"white",strokeWidth:"13"}});function u(){return t[18](t[45])}return{c(){n=A("div"),Oe(s.$$.fragment),a=U(),o=A("div"),i=Te(e),this.h()},l(h){n=P(h,"DIV",{class:!0});var v=X(n);Re(s.$$.fragment,v),a=J(v),o=P(v,"DIV",{});var D=X(o);i=We(D,e),D.forEach(k),v.forEach(k),this.h()},h(){m(n,"class","text-shadow text-center flex gap-2 justify-center items-center svelte-1xgvwrg")},m(h,v){F(h,n,v),Ne(s,n,null),L(n,a),L(n,o),L(o,i),f=!0,l||(d=q(n,"click",u),l=!0)},p(h,v){t=h;const D={};v[0]&1&&(D.src=me(t[45].profile_image_url)),s.$set(D),(!f||v[0]&1)&&e!==(e=t[45].display_name+"")&&je(i,e)},i(h){f||(j(s.$$.fragment,h),f=!0)},o(h){K(s.$$.fragment,h),f=!1},d(h){h&&k(n),qe(s),l=!1,d()}}}function He(t){let n=Math.abs(t[1]-t[47])<=1,s,a,o=n&&Le(t);return{c(){o&&o.c(),s=we()},l(e){o&&o.l(e),s=we()},m(e,i){o&&o.m(e,i),F(e,s,i),a=!0},p(e,i){i[0]&2&&(n=Math.abs(e[1]-e[47])<=1),n?o?(o.p(e,i),i[0]&2&&j(o,1)):(o=Le(e),o.c(),j(o,1),o.m(s.parentNode,s)):o&&(_e(),K(o,1,1,()=>{o=null}),ve())},i(e){a||(j(o),a=!0)},o(e){K(o),a=!1},d(e){e&&k(s),o&&o.d(e)}}}function _t(t){let n,s,a,o,e=re(t[0]),i=[];for(let l=0;l<e.length;l+=1)i[l]=He(ke(t,e,l));const f=l=>K(i[l],1,1,()=>{i[l]=null});return{c(){n=A("div");for(let l=0;l<i.length;l+=1)i[l].c();this.h()},l(l){n=P(l,"DIV",{class:!0});var d=X(n);for(let u=0;u<i.length;u+=1)i[u].l(d);d.forEach(k),this.h()},h(){m(n,"class","bg-black w-screen h-screen")},m(l,d){F(l,n,d);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(n,null);s=!0,a||(o=q(n,"contextmenu",Qe(t[15])),a=!0)},p(l,d){if(d[0]&8191){e=re(l[0]);let u;for(u=0;u<e.length;u+=1){const h=ke(l,e,u);i[u]?(i[u].p(h,d),j(i[u],1)):(i[u]=He(h),i[u].c(),j(i[u],1),i[u].m(n,null))}for(_e(),u=e.length;u<i.length;u+=1)f(u);ve()}},i(l){if(!s){for(let d=0;d<e.length;d+=1)j(i[d]);s=!0}},o(l){i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)K(i[d]);s=!1},d(l){l&&k(n),pe(i,l),a=!1,o()}}}const vt=30,wt=10,Ve=10,Se=300;function de(t){return"touches"in t||"changedTouches"in t}function bt(t,n,s){let a;$e(t,mt,r=>s(29,a=r));let o=a.url.searchParams.get("type"),{posts:e=[]}=n,{dontMoveVertically:i=!1}=n,{keyboardY:f=0}=n,{index:l=0}=n,d=!0,u=!1,h=!1,v=0,D=0,H={width:0,height:0},C=!1;async function ee(){s(14,C=!0);const r=a.url.searchParams.get("userIdx"),c=a.url.searchParams.get("placeIdx"),b=await gt.getCurrentOrLastLocation(),S=e.length,T=vt,N=r?`&userIdx=${r}`:"",ce=c?`&placeIdx=${c}`:"",Q=b?`&location=${[b==null?void 0:b.longitude,b==null?void 0:b.latitude].join(",")}`:"",$=`&offset=${S}`,Z=`&limit=${T}`,ue=(await fetch(`${it}/posts?${N}${ce}${$}${Z}${Q}`).then(fe=>fe.json()).then(fe=>fe.data)).map(fe=>({...fe,mediaIdx:0}));s(0,e=[...e,...ue]),s(14,C=!1)}async function x(){ft({mediaIdx:`${e[l].mediaIdx}`,postIdx:`${e[l].idx}`},{replace:!0})}function te(r){const c=H.height;if(l===0&&r>0){s(4,v=r*.3);return}if(l===e.length-1&&r<0){s(4,v=r*.3);return}s(4,v=Math.max(Math.min(r,c),-c))}function ae(r){document.querySelectorAll("textarea").forEach(S=>{R({target:S})}),s(3,d=!1),H.height;let c=0;de(r)?c=r.changedTouches[0].clientY-B:c=r.clientY-B;const b=ye(2);c>b&&l>0?(s(1,l-=1),u=!0,x()):-c>b&&l<e.length-1&&(s(1,l+=1),u=!0,x()),s(4,v=0)}function se(r){const c=H.width;if(r=Math.max(Math.min(r,c),-c),e[l].mediaIdx===0&&r>0||e[l].mediaIdx===e[l].media.length-1&&r<0){s(5,D=r*.3);return}s(5,D=r)}function ne(r){H.width,s(3,d=!1);let c=0;de(r)?c=r.changedTouches[0].clientX-z:c=r.clientX-z;const b=ye(2);if(c>b&&e[l].mediaIdx>0){const S=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:S},e),s(0,e=[...e]),h=!0,x()}else if(-c>b&&e[l].mediaIdx<e[l].media.length-1){const S=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:S},e),s(0,e=[...e]),h=!0,x()}s(5,D=0)}let M=!1,z=-1,B=-1,Y,I=!1;ot.on("blockSwipeInViewer",r=>M=r);function E(r){M||u||h||(I=!0,Y=void 0,ge.set(!0),de(r)?(z=r.touches[0].clientX,B=r.touches[0].clientY):(z=r.clientX,B=r.clientY,window.addEventListener("mousemove",y,{passive:!1}),window.addEventListener("mouseup",g)))}function y(r){if(M||!I||u||h)return;let c=0,b=0;de(r)?(c=r.touches[0].clientX,b=r.touches[0].clientY):(c=r.clientX,b=r.clientY);let S=c-z,T=b-B;Y===void 0&&(Y=Math.abs(T)>=Math.abs(S)?"post":"media"),!i&&Y==="post"?te(T):Y==="media"&&se(S)}function g(r){M||!I||u||h||(I=!1,Y==="post"?ae(r):Y==="media"?ne(r):ge.set(!1),de(r)||(window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",g)))}let O=[],W=[];function oe(r){if(M||u||h)return;r.preventDefault();const c=Date.now(),b=Math.abs(r.deltaX),S=Math.abs(r.deltaY);if(b>S){if(W.push({deltaX:r.deltaX,timestamp:c}),W=W.filter(T=>c-T.timestamp<=Se),W.length>=2){const T=W[0],N=W[W.length-1],ce=Math.abs(T.deltaX),Q=Math.abs(N.deltaX),$=Q-ce;if($<0)return;if($>=0&&Q>=Ve){let Z=!1;if(N.deltaX>0&&e[l].mediaIdx<e[l].media.length-1){const ue=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:ue},e),s(0,e=[...e]),s(3,d=!1),x(),Z=!0}else if(N.deltaX<0&&e[l].mediaIdx>0){const ue=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:ue},e),s(0,e=[...e]),s(3,d=!1),x(),Z=!0}W=[],Z&&(h=!0)}}}else if(O.push({deltaY:r.deltaY,timestamp:c}),O=O.filter(T=>c-T.timestamp<=Se),O.length>=2){const T=O[0],N=O[O.length-1],ce=Math.abs(T.deltaY),Q=Math.abs(N.deltaY),$=Q-ce;if($<0)return;if($>=0&&Q>=Ve){let Z=!1;N.deltaY>0&&l<e.length-1?(s(3,d=!1),s(1,l+=1),x(),Z=!0):N.deltaY<0&&l>0&&(s(3,d=!1),s(1,l-=1),x(),Z=!0),O=[],Z&&(u=!0)}}}function _(r){if(!(M||u||h))switch(r.key){case"ArrowUp":l>0&&(s(3,d=!1),s(1,l-=1),u=!0,x());break;case"ArrowDown":l<e.length-1&&(s(3,d=!1),s(1,l+=1),u=!0,x());break;case"ArrowLeft":if(e[l].mediaIdx>0){const c=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:c},e),s(0,e=[...e]),s(3,d=!1),h=!0,x()}break;case"ArrowRight":if(e[l].mediaIdx<e[l].media.length-1){const c=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:c},e),s(0,e=[...e]),s(3,d=!1),h=!0,x()}break}}function p(){s(6,H={width:document.body.clientWidth,height:document.body.clientHeight})}function V(){const r=Number(a.url.searchParams.get("mediaIdx")||0);r&&e[l].media[r]?(s(0,e[l]={...e[l],mediaIdx:r},e),s(0,e=[...e])):(s(0,e[l]={...e[l],mediaIdx:0},e),s(0,e=[...e])),x()}function R(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.style.height="16px";let b=c.scrollHeight;b>window.innerHeight/3&&(b=window.innerHeight/3),c.style.height=`${b}px`}et(async()=>{p(),window.addEventListener("resize",p),w(),V(),await tt(),document.querySelectorAll("textarea").forEach(r=>{R({target:r})})}),st(()=>{window.removeEventListener("resize",p),G()});function w(){document.addEventListener("touchstart",E,{passive:!1}),document.addEventListener("touchmove",y,{passive:!1}),document.addEventListener("touchend",g),document.addEventListener("mousedown",E,{passive:!1}),document.addEventListener("wheel",oe,{passive:!1}),document.addEventListener("keydown",_)}function G(){document.removeEventListener("touchstart",E),document.removeEventListener("touchmove",y),document.removeEventListener("touchend",g),document.removeEventListener("mousedown",E),document.removeEventListener("wheel",oe),document.removeEventListener("keydown",_)}function he(){s(3,d=!0),u=!1,h=!1,ge.set(!1)}function ie(r){if(o==="post"||o==="patch")return;const c=r.target;c instanceof HTMLTextAreaElement&&(c.scrollHeight<=c.clientHeight||(c.hasAttribute("open")?(c.style.height="",c.removeAttribute("open")):(c.style.height=`${window.innerHeight/3}px`,c.setAttribute("open",""))))}function ze(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.hasAttribute("open")||(c.style.height=`${window.innerHeight/3}px`,c.setAttribute("open",""))}function Ge(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.hasAttribute("open")&&(c.style.height="",c.removeAttribute("open"))}function Ze(r){nt.call(this,t,r)}function Be(r,c){r[c].text=this.value,s(0,e)}const Ue=r=>R(r),Je=r=>{r.user_idx&&ut(`/users/${r.user_idx}`)},Ke=r=>{r.place_idx&&ct(`/places/${r.place_idx}`)};return t.$$set=r=>{"posts"in r&&s(0,e=r.posts),"dontMoveVertically"in r&&s(13,i=r.dontMoveVertically),"keyboardY"in r&&s(2,f=r.keyboardY),"index"in r&&s(1,l=r.index)},t.$$.update=()=>{t.$$.dirty[0]&16387&&l>=e.length-wt&&!C&&ee()},[e,l,f,d,v,D,H,o,R,he,ie,ze,Ge,i,C,Ze,Be,Ue,Je,Ke]}class Vt extends rt{constructor(n){super(),at(this,n,bt,_t,Fe,{posts:0,dontMoveVertically:13,keyboardY:2,index:1},null,[-1,-1])}}export{Vt as V};
