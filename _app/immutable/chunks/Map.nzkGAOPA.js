import{s as X,y as $,B as ie,e as F,a as A,q as V,V as me,c as Z,z as le,g as L,r as B,b as D,f as P,W as de,v as d,C as W,i as z,h as I,n as ee,w as ce,m as he,t as ge,d as pe,A as ve,u as xe,o as Ce,p as Ee,j as _e,k as ye}from"./scheduler.B7IswjaW.js";import{S as J,i as Q,c as te,d as ne,m as oe,t as H,a as q,f as ae}from"./index.Bhf26fYQ.js";import{c as we,m as w,O as be,s as se,f as Pe}from"./map.Cf2thfE9.js";import{A as ue,e as R,b as ke}from"./store.CZDBRdAx.js";import{e as je}from"./search.B9aInzRX.js";import{p as Me}from"./stores.CDL9tUc5.js";import"./entry.BLOyG78Q.js";import{s as Se}from"./searchParams.96hAD6Cv.js";import{f as N,a as K}from"./proj.C890k1jX.js";import{s as U}from"./s32cloudfront.ca27ppBg.js";import{i as De}from"./isVideoFile.DGBlGWVm.js";/* empty css                                          */import{C as Ie}from"./index.DZM7idRd.js";let Oe=50;function G(f,t){return f+Math.floor(Math.random()*(t+1-f))}function Ve(f){const t=["dosisool.jpg","eul.jpg","face1.jpeg","face2.jpeg","face3.jpeg","j.jpg","oilh.jpg","signin.png","thumb1.jpeg","thumb2.jpeg","thumb3.jpeg","thumb4.jpeg","thumb5.jpeg"],C=t.length,g=we(),i={},l=[];function E(){for(let o=0;o<Oe;o++)v(o)}N([126.97685,37.578019]);const c=[[128513,128591],[9986,10160],[128640,128704],[128512,128566],[128641,128709],[127757,128359]];function _(){const o=c[G(0,c.length-1)];return`&#${G(o[0],o[1])};`}function k(){let o="";const p=G(1,8);for(let a=0;a<p;a++)o+=_();return o}const s=["w-[160px] h-[160px]","w-[100px] h-[100px]","w-[60px] h-[60px]"];function j(){const o=document.createElement("div");return o.innerHTML=`<img class="rounded-avatar2" src="${t[G(0,C-1)]}" />
    <svg class="spining-emoji" viewBox="0 0 100 100">
      <path
        id="text-path"
        d="M 50,50 m -30,0 a 30,30 0 1,1 60,0 a 30,30 0 1,1 -60,0"
        fill="none"
      />
      <text font-size="12" dy="-3" letter-spacing="10">
        <textPath href="#text-path" startOffset="0">
          ${k()}
        </textPath>
      </text>
    </svg>
    `,o}function v(o,p){const a=new be({id:o,element:j(),stopEvent:!1,positioning:"center-center",position:p});w.addOverlay(a),l.push(a)}E(),$(()=>{w.on("moveend",()=>{const o=w.getView().getZoom();if(!o)return;const p=w.getView().calculateExtent(w.getSize());l.forEach(e=>e.set("uncheck",!0));const a=Math.ceil(o);g.forEachTileCoord(p,a,e=>{const[r,y,S]=e;if(!i[r])i[r]={[y]:{[S]:[]}};else if(!i[r][y])i[r][y]={[S]:[]};else if(!i[r][y][S])i[r][y][S]=[];else{const n=i[r][y][S].filter(h=>{const b=l.find(m=>m.get("idx")===h.idx);return b?(b.set("uncheck",!1),!1):!0}),x=l.filter(h=>h.get("uncheck")),u=l.filter(h=>!h.get("uncheck"));n.forEach((h,b)=>{const m=x[b];if(!m)return;const O=N([h.longitude,h.latitude]);if(M(O,u))return;u.push(m),m.setPosition(O),m.set("idx",h.idx),m.set("uncheck",!1);const T=m.getElement();if(T){const Y=s[G(0,s.length-1)];T.className=`effective-element2 ${Y}`}});return}fetch(`${ue}/places/${r}/${y}/${S}`).then(n=>n.json()).then(n=>{const x=n.data;i[r][y][S]=x;const u=l.filter(b=>b.get("uncheck")),h=l.filter(b=>!b.get("uncheck"));x.forEach((b,m)=>{const O=u[m];if(!O)return;const T=N([b.longitude,b.latitude]);if(M(T,h))return;h.push(O),O.setPosition(T),O.set("idx",b.idx),O.set("uncheck",!1);const Y=O.getElement();if(Y){const fe=s[G(0,s.length-1)];Y.className=`effective-element2 ${fe}`}})}).catch(n=>console.error(n))})})});function M(o,p,a=250){const e=w.getPixelFromCoordinate(o),r=Math.floor(e[0]/a),y=Math.floor(e[1]/a),S=`${r}_${y}`;return p.some(n=>{const x=n.getPosition();if(!x)return!1;const u=w.getPixelFromCoordinate(x),h=Math.floor(u[0]/a),b=Math.floor(u[1]/a),m=`${h}_${b}`;return S===m})}return ie(()=>{}),[]}class Be extends J{constructor(t){super(),Q(this,t,Ve,null,X,{})}}function ze(f){let t,C="",g,i,l,E,c,_,k,s,j,v,M;return{c(){t=F("div"),t.innerHTML=C,g=A(),i=V("svg"),l=V("defs"),E=V("filter"),c=V("feGaussianBlur"),_=V("feColorMatrix"),k=V("feComposite"),s=V("mask"),j=V("rect"),v=V("g"),M=new me(!0),this.h()},l(o){t=Z(o,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),le(t)!=="svelte-1yoogyr"&&(t.innerHTML=C),g=L(o),i=B(o,"svg",{width:!0,height:!0,style:!0});var p=D(i);l=B(p,"defs",{});var a=D(l);E=B(a,"filter",{id:!0});var e=D(E);c=B(e,"feGaussianBlur",{in:!0,stdDeviation:!0,result:!0}),D(c).forEach(P),_=B(e,"feColorMatrix",{in:!0,mode:!0,values:!0,result:!0}),D(_).forEach(P),k=B(e,"feComposite",{in:!0,in2:!0,operator:!0}),D(k).forEach(P),e.forEach(P),s=B(a,"mask",{id:!0});var r=D(s);j=B(r,"rect",{width:!0,height:!0,fill:!0}),D(j).forEach(P),v=B(r,"g",{filter:!0,fill:!0});var y=D(v);M=de(y,!0),y.forEach(P),r.forEach(P),a.forEach(P),p.forEach(P),this.h()},h(){d(t,"id","scratch-layer"),d(t,"class","svelte-1zft9l"),d(c,"in","SourceGraphic"),d(c,"stdDeviation",Te),d(c,"result","blur"),d(_,"in","blur"),d(_,"mode","matrix"),d(_,"values",Ae),d(_,"result","goo"),d(k,"in","SourceGraphic"),d(k,"in2","goo"),d(k,"operator","atop"),d(E,"id","gooey-filter"),d(j,"width","100%"),d(j,"height","100%"),d(j,"fill","white"),M.a=null,d(v,"filter","url(#gooey-filter)"),d(v,"fill","black"),d(s,"id","scratch-mask"),d(i,"width","100%"),d(i,"height","100%"),W(i,"position","absolute")},m(o,p){z(o,t,p),f[2](t),z(o,g,p),z(o,i,p),I(i,l),I(l,E),I(E,c),I(E,_),I(E,k),I(l,s),I(s,j),I(s,v),M.m(f[1],v)},p(o,[p]){p&2&&M.p(o[1])},i:ee,o:ee,d(o){o&&(P(t),P(g),P(i)),f[2](null)}}}let Ge=30;const Te=5,Ae="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7";function Le(f,t,C){let g=[],i,l=0,E="";$(()=>{w.on("click",function(s){g.push(s.coordinate),_()}),w.on("postrender",c)});function c(){const s=performance.now();s-l<Ge||(l=s,_(),console.log(`스크래치 시간: ${performance.now()-s} milliseconds.`))}function _(){C(1,E=g.map(s=>{const[j,v]=w.getPixelFromCoordinate(s);return`<circle cx="${j}" cy="${v}" r="20" fill="black"/>`}).join(`
`))}function k(s){ce[s?"unshift":"push"](()=>{i=s,C(0,i)})}return[i,E,k]}class Ne extends J{constructor(t){super(),Q(this,t,Le,ze,X,{})}}function Ye(f){let t,C,g,i,l,E,c,_,k,s,j="복사",v,M,o;const p=f[9].default,a=he(p,f,f[8],null);return g=new Ne({}),l=new Be({}),{c(){t=F("div"),a&&a.c(),C=A(),te(g.$$.fragment),i=A(),te(l.$$.fragment),E=A(),c=F("div"),_=ge(f[1]),k=A(),s=F("button"),s.textContent=j,this.h()},l(e){t=Z(e,"DIV",{id:!0,class:!0});var r=D(t);a&&a.l(r),r.forEach(P),C=L(e),ne(g.$$.fragment,e),i=L(e),ne(l.$$.fragment,e),E=L(e),c=Z(e,"DIV",{id:!0,class:!0});var y=D(c);_=pe(y,f[1]),k=L(y),s=Z(y,"BUTTON",{class:!0,"data-svelte-h":!0}),le(s)!=="svelte-14xatxb"&&(s.textContent=j),y.forEach(P),this.h()},h(){d(t,"id","map"),d(t,"class","absolute w-full h-full z-[1] bg-[#BDDBF3] transition-transform duration-500"),W(t,"transform",`translateY(${f[0]}px)`),d(s,"class","bg-blue-300"),d(c,"id","push-test-data"),d(c,"class","absolute bottom-24 left-4 z-20 flex justify-around w-32 svelte-t4oldr")},m(e,r){z(e,t,r),a&&a.m(t,null),f[10](t),z(e,C,r),oe(g,e,r),z(e,i,r),oe(l,e,r),z(e,E,r),z(e,c,r),I(c,_),I(c,k),I(c,s),v=!0,M||(o=ve(s,"click",f[3]),M=!0)},p(e,[r]){a&&a.p&&(!v||r&256)&&xe(a,p,e,e[8],v?Ee(p,e[8],r,null):Ce(e[8]),null),r&1&&W(t,"transform",`translateY(${e[0]}px)`),(!v||r&2)&&_e(_,e[1])},i(e){v||(H(a,e),H(g.$$.fragment,e),H(l.$$.fragment,e),v=!0)},o(e){q(a,e),q(g.$$.fragment,e),q(l.$$.fragment,e),v=!1},d(e){e&&(P(t),P(C),P(i),P(E),P(c)),a&&a.d(e),f[10](null),ae(g,e),ae(l,e),M=!1,o()}}}function re(f){f.preventDefault()}function Re(f,t,C){let g;ye(f,Me,n=>C(13,g=n));let{$$slots:i={},$$scope:l}=t,{onSelect:E=()=>{}}=t,{onMoveend:c=()=>{}}=t,{mapY:_=0}=t,{allowEdit:k=!0}=t,{whenCancelEdit:s=()=>{}}=t,j="0";se.refresh(),R.on("explorePlaces",o);let v="",M;async function o(){var x;const n=w.getView().getZoom();if(!(!n||n<16))try{M&&M.abort("new request");const u=(x=window.location.search.split("tags=")[1])==null?void 0:x.split("&")[0];if(!u)return;const h=decodeURIComponent(u);if(!h)return;v!==h&&(se.refresh(),v=h),M=new AbortController;const b=await je({tags:v,bbox:K(w.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:M});R.emit("addIcons",b.map(m=>({idx:m.idx,coordinate:N(m.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:U(m.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${m.idx}`,rank:3,name:m.name,width:38,height:46,onlyMain:!0})))}catch(u){(u==null?void 0:u.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",u)}}w.on("moveend",p);function p(){var n,x,u;o(),C(1,j=(n=w.getView().getZoom())==null?void 0:n.toFixed(2)),Se({location:((x=w.getView().getCenter())==null?void 0:x.join(","))??"",zoom:((u=w.getView().getZoom())==null?void 0:u.toFixed(2))??""}),c(K(w.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}o();let a;$(()=>{w.setTarget(a),a.addEventListener("contextmenu",re),g.url.searchParams.has("location")&&e(),g.url.searchParams.has("placeIdx")&&r(g.url.searchParams.get("placeIdx")),c(K(w.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),ie(()=>{w.un("moveend",p),a.removeEventListener("contextmenu",re)});function e(){const n=g.url.searchParams.get("location"),x=g.url.searchParams.get("zoom"),u=n==null?void 0:n.split(",").map(Number),h={};u&&(h.center=u),x&&(h.zoom=Number(x)),Object.values(h).length>0&&Pe(h)}R.on("addIconByPlaceIdx",r);async function r(n){var b;const x=await fetch(`${ue}/places/${n}`,{headers:{"x-api-version":ke.PLACE}}).then(m=>m.json()).then(m=>m.data.place).catch(m=>{console.error(m)});let u=((b=x.thumbnail)==null?void 0:b.at(0))||"";if(!String(u).includes("youtu")){const m=U(u);await De(m)&&(u=u+"-thumbnail")}const h={idx:x.placeIdx,coordinate:N([x.longitude,x.latitude]),image:U(u,500)||"",shape:"point",type:"place",link:`/places/${x.placeIdx}`,rank:5,name:x.name,width:38,height:46};R.emit("addIcon",h)}async function y(){await Ie.write({string:j})}function S(n){ce[n?"unshift":"push"](()=>{a=n,C(2,a)})}return f.$$set=n=>{"onSelect"in n&&C(4,E=n.onSelect),"onMoveend"in n&&C(5,c=n.onMoveend),"mapY"in n&&C(0,_=n.mapY),"allowEdit"in n&&C(6,k=n.allowEdit),"whenCancelEdit"in n&&C(7,s=n.whenCancelEdit),"$$scope"in n&&C(8,l=n.$$scope)},[_,j,a,y,E,c,k,s,l,i,S]}class nt extends J{constructor(t){super(),Q(this,t,Re,Ye,X,{onSelect:4,onMoveend:5,mapY:0,allowEdit:6,whenCancelEdit:7})}}export{nt as M};
