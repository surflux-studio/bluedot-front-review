import{s as M,y,e as D,c as A,b as B,f as C,l as _,i as k,z as S,w as b,A as T,B as N,C as X,r as Y,k as q,p as V,q as j,u as z}from"./scheduler.CuQsZbPO.js";import{S as W,i as O,t as U,b as F}from"./index.Cqam3s4x.js";import{a as G,m as h}from"./map.BqRGFfxY.js";import{e as L}from"./units.BmAtfPLl.js";import{g as H}from"./search.-xBrX0xR.js";import{p as J}from"./stores.BkwWLvmj.js";import{g as K}from"./entry.IqVVwzvC.js";/* empty css                                          */function Q(e,o=500,i=10){let r,f,p;const n=m=>{const{clientX:v,clientY:d}=m instanceof MouseEvent?m:m.touches[0];f=v,p=d,r=setTimeout(()=>{e.dispatchEvent(new CustomEvent("longpress",{detail:m}))},o)},s=m=>{const{clientX:v,clientY:d}=m instanceof MouseEvent?m:m.touches[0],g=Math.abs(v-f),E=Math.abs(d-p);(g>i||E>i)&&clearTimeout(r)},a=()=>{clearTimeout(r)};return e.addEventListener("mousedown",n),e.addEventListener("mousemove",s),e.addEventListener("mouseup",a),e.addEventListener("mouseleave",a),e.addEventListener("touchstart",n),e.addEventListener("touchmove",s),e.addEventListener("touchend",a),e.addEventListener("touchcancel",a),{destroy(){e.removeEventListener("mousedown",n),e.removeEventListener("mousemove",s),e.removeEventListener("mouseup",a),e.removeEventListener("mouseleave",a),e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",s),e.removeEventListener("touchend",a),e.removeEventListener("touchcancel",a)}}}function R(e){let o,i,r,f;const p=e[5].default,n=y(p,e,e[4],null);return{c(){o=D("div"),n&&n.c(),this.h()},l(s){o=A(s,"DIV",{id:!0,class:!0});var a=B(o);n&&n.l(a),a.forEach(C),this.h()},h(){_(o,"id","map"),_(o,"class","svelte-dxcqed")},m(s,a){k(s,o,a),n&&n.m(o,null),e[6](o),i=!0,r||(f=[S(Q.call(null,o,500)),b(o,"longpress",e[7]),b(o,"touchend",e[8],{passive:!0})],r=!0)},p(s,[a]){n&&n.p&&(!i||a&16)&&T(n,p,s,s[4],i?X(p,s[4],a,null):N(s[4]),null)},i(s){i||(U(n,s),i=!0)},o(s){F(n,s),i=!1},d(s){s&&C(o),n&&n.d(s),e[6](null),r=!1,Y(f)}}}function x(e){e.preventDefault()}function Z(e,o,i){let r;q(e,J,t=>i(3,r=t));let{$$slots:f={},$$scope:p}=o,{onSelect:n=void 0}=o,s=!0;G.refresh();let a;async function m(){try{a&&a.abort();const t=r.url.searchParams.get("tags");if(!t)return;a=new AbortController,(await H({tags:t,bbox:h.getView().calculateExtent().join(),abortController:a})).forEach(c=>{const u={idx:c.idx,coordinate:c.location.replace("POINT(","").replace(")","").split(" ").map(Number),image:`https://picsum.photos/112/116?random=${c.idx}`,shape:"waterdrop",type:"place",link:`/places/${c.idx}`,rank:3,name:c.name,width:56,height:61};L.emit("addIcon",u)})}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}function v(){m()}h.on("moveend",v),m();let d;V(()=>{h.setTarget(d),d.addEventListener("contextmenu",x),r.url.searchParams.has("location")&&g(),r.url.searchParams.has("placeIdx")&&E()}),j(()=>{h.un("moveend",v),d.removeEventListener("contextmenu",x)});function g(){const t=r.url.searchParams.get("location"),l=t==null?void 0:t.split(","),c=l[0],u=l[1];c&&u&&h.getView().setCenter([Number(c),Number(u)])}async function E(){const t=r.url.searchParams.get("placeIdx"),l=await fetch(`https://azit.surflux.studio/places/${t}`).then(u=>u.json()).then(u=>u.data).catch(u=>{console.error(u)}),c={idx:l.placeIdx,coordinate:[l.longitude,l.latitude],image:`https://picsum.photos/112/116?random=${l.placeIdx}`,shape:"waterdrop",type:"place",link:`/places/${l.placeIdx}`,rank:5,name:l.name,width:56,height:61};L.emit("addIcon",c)}function w(t){z[t?"unshift":"push"](()=>{d=t,i(2,d)})}const I=t=>{i(1,s=!1),h.getInteractions().forEach(u=>u.setActive(!1));const[l,c]=h.getEventCoordinate(t.detail);r.url.pathname!=="/map/edit"?K(`/map/edit?longitude=${l}&latitude=${c}`):n&&n(l,c)},P=()=>{s||h.getInteractions().forEach(t=>t.setActive(!0))};return e.$$set=t=>{"onSelect"in t&&i(0,n=t.onSelect),"$$scope"in t&&i(4,p=t.$$scope)},[n,s,d,r,p,f,w,I,P]}class ie extends W{constructor(o){super(),O(this,o,Z,R,M,{onSelect:0})}}export{ie as M};
