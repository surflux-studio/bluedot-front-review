import{s as T,e as k,a as V,c as $,b as w,g as C,f as p,q as g,i as y,h as b,k as Z,A as ee,v as J,n as te,t as K,d as Q,j as W,F as A,C as ae}from"./scheduler.Ds8JjPaX.js";import{S as ie,i as re,t as v,g as N,a as x,f as S,c as P,b as U,m as j,d as q}from"./index.ucgEq-dW.js";import{e as H,u as le,o as se}from"./each.BmbOg1ua.js";import{e as oe}from"./sign.B9B4Tbt1.js";import{H as X}from"./HexImage.24YKsBn6.js";import{a as ne}from"./map.G2abntfR.js";import{f as fe}from"./location.BHndQV4O.js";import{s as B}from"./s32cloudfront.yu0ljD8J.js";import{A as ce}from"./constants.B40lR-wj.js";import{s as de}from"./searchParams.Ig__F9As.js";import{p as ue}from"./stores.2r8ZKa-r.js";import{B as Y}from"./Button.pC4S2eyB.js";function L(s,e,t){const i=s.slice();return i[12]=e[t],i[14]=t,i}function M(s){let e,t,i=s[3].image,l,a,n,r,f,h=G(s);return a=new Y({props:{className:"w-20 shadow-md",padding:"p-1",backgroundColor:"bg-white",border:"",typo:"typo-caption2",$$slots:{default:[he]},$$scope:{ctx:s}}}),{c(){e=k("div"),t=k("div"),h.c(),l=V(),P(a.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0,"aria-hidden":!0});var c=w(e);t=$(c,"DIV",{class:!0});var _=w(t);h.l(_),_.forEach(p),l=C(c),U(a.$$.fragment,c),c.forEach(p),this.h()},h(){g(t,"class","w-20 h-20 relative"),g(e,"class","flex-shrink-0 flex flex-col items-center space-y-1"),g(e,"aria-hidden","")},m(o,c){y(o,e,c),b(e,t),h.m(t,null),b(e,l),j(a,e,null),n=!0,r||(f=J(e,"click",s[5]),r=!0)},p(o,c){c&8&&T(i,i=o[3].image)?(N(),x(h,1,1,te),S(),h=G(o),h.c(),v(h,1),h.m(t,null)):h.p(o,c);const _={};c&32776&&(_.$$scope={dirty:c,ctx:o}),a.$set(_)},i(o){n||(v(h),v(a.$$.fragment,o),n=!0)},o(o){x(h),x(a.$$.fragment,o),n=!1},d(o){o&&p(e),h.d(o),q(a),r=!1,f()}}}function G(s){let e,t;return e=new X({props:{src:s[3].image?B(s[3].image,500):void 0,width:150,height:150,onBorder:!0}}),{c(){P(e.$$.fragment)},l(i){U(e.$$.fragment,i)},m(i,l){j(e,i,l),t=!0},p(i,l){const a={};l&8&&(a.src=i[3].image?B(i[3].image,500):void 0),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){x(e.$$.fragment,i),t=!1},d(i){q(e,i)}}}function he(s){let e,t,i=s[3].name+"",l,a;return{c(){e=k("div"),t=k("a"),l=K(i),this.h()},l(n){e=$(n,"DIV",{class:!0});var r=w(e);t=$(r,"A",{class:!0,href:!0});var f=w(t);l=Q(f,i),f.forEach(p),r.forEach(p),this.h()},h(){g(t,"class","text-gray-700"),g(t,"href",a=`/boxes/${s[3].idx}`),g(e,"class","line-clamp-2 break-words w-16")},m(n,r){y(n,e,r),b(e,t),b(t,l)},p(n,r){r&8&&i!==(i=n[3].name+"")&&W(l,i),r&8&&a!==(a=`/boxes/${n[3].idx}`)&&g(t,"href",a)},d(n){n&&p(e)}}}function O(s){let e,t,i,l,a,n,r,f,h;i=new X({props:{src:s[12].image?B(s[12].image,500):void 0,width:150,height:150}}),a=new Y({props:{className:"w-20 shadow-md",padding:"p-1",backgroundColor:"bg-white",border:"",typo:"typo-caption2",$$slots:{default:[me]},$$scope:{ctx:s}}});function o(){return s[6](s[12])}return{c(){e=k("div"),t=k("div"),P(i.$$.fragment),l=V(),P(a.$$.fragment),n=V(),this.h()},l(c){e=$(c,"DIV",{class:!0,"aria-hidden":!0});var _=w(e);t=$(_,"DIV",{class:!0});var d=w(t);U(i.$$.fragment,d),d.forEach(p),l=C(_),U(a.$$.fragment,_),n=C(_),_.forEach(p),this.h()},h(){g(t,"class","w-20 h-20 relative"),g(e,"class","flex-shrink-0 flex flex-col items-center space-y-1"),g(e,"aria-hidden","")},m(c,_){y(c,e,_),b(e,t),j(i,t,null),b(e,l),j(a,e,null),b(e,n),r=!0,f||(h=J(e,"click",o),f=!0)},p(c,_){s=c;const d={};_&2&&(d.src=s[12].image?B(s[12].image,500):void 0),i.$set(d);const m={};_&32770&&(m.$$scope={dirty:_,ctx:s}),a.$set(m)},i(c){r||(v(i.$$.fragment,c),v(a.$$.fragment,c),r=!0)},o(c){x(i.$$.fragment,c),x(a.$$.fragment,c),r=!1},d(c){c&&p(e),q(i),q(a),f=!1,h()}}}function me(s){let e,t,i=s[12].name+"",l,a;return{c(){e=k("div"),t=k("a"),l=K(i),this.h()},l(n){e=$(n,"DIV",{class:!0});var r=w(e);t=$(r,"A",{class:!0,href:!0});var f=w(t);l=Q(f,i),f.forEach(p),r.forEach(p),this.h()},h(){g(t,"class","text-gray-700"),g(t,"href",a=`/boxes/${s[12].idx}`),g(e,"class","line-clamp-2 break-words w-16")},m(n,r){y(n,e,r),b(e,t),b(t,l)},p(n,r){r&2&&i!==(i=n[12].name+"")&&W(l,i),r&2&&a!==(a=`/boxes/${n[12].idx}`)&&g(t,"href",a)},d(n){n&&p(e)}}}function R(s,e){var n;let t,i,l,a=e[12].idx!==((n=e[3])==null?void 0:n.idx)&&O(e);return{key:s,first:null,c(){t=A(),a&&a.c(),i=A(),this.h()},l(r){t=A(),a&&a.l(r),i=A(),this.h()},h(){this.first=t},m(r,f){y(r,t,f),a&&a.m(r,f),y(r,i,f),l=!0},p(r,f){var h;e=r,e[12].idx!==((h=e[3])==null?void 0:h.idx)?a?(a.p(e,f),f&10&&v(a,1)):(a=O(e),a.c(),v(a,1),a.m(i.parentNode,i)):a&&(N(),x(a,1,1,()=>{a=null}),S())},i(r){l||(v(a),l=!0)},o(r){x(a),l=!1},d(r){r&&(p(t),p(i)),a&&a.d(r)}}}function _e(s){let e,t,i,l=[],a=new Map,n,r,f,h,o=s[3]&&M(s),c=H(s[1]);const _=d=>d[12].idx;for(let d=0;d<c.length;d+=1){let m=L(s,c,d),u=_(m);a.set(u,l[d]=R(u,m))}return{c(){e=k("div"),t=k("div"),o&&o.c(),i=V();for(let d=0;d<l.length;d+=1)l[d].c();n=V(),r=k("div"),this.h()},l(d){e=$(d,"DIV",{class:!0});var m=w(e);t=$(m,"DIV",{class:!0});var u=w(t);o&&o.l(u),i=C(u);for(let I=0;I<l.length;I+=1)l[I].l(u);n=C(u),r=$(u,"DIV",{class:!0}),w(r).forEach(p),u.forEach(p),m.forEach(p),this.h()},h(){g(r,"class","flex-shrink-0 w-1"),g(t,"class","flex space-x-3"),g(e,"class",f=`relative ${s[0]} left-0 overflow-x-auto p-4 z-20 scrollbar-hidden scrollbar-hidden::-webkit-scrollbar`)},m(d,m){y(d,e,m),b(e,t),o&&o.m(t,null),b(t,i);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(t,null);b(t,n),b(t,r),s[7](e),h=!0},p(d,[m]){d[3]?o?(o.p(d,m),m&8&&v(o,1)):(o=M(d),o.c(),v(o,1),o.m(t,i)):o&&(N(),x(o,1,1,()=>{o=null}),S()),m&14&&(c=H(d[1]),N(),l=le(l,m,_,1,d,c,a,t,se,R,n,L),S()),(!h||m&1&&f!==(f=`relative ${d[0]} left-0 overflow-x-auto p-4 z-20 scrollbar-hidden scrollbar-hidden::-webkit-scrollbar`))&&g(e,"class",f)},i(d){if(!h){v(o);for(let m=0;m<c.length;m+=1)v(l[m]);h=!0}},o(d){x(o);for(let m=0;m<l.length;m+=1)x(l[m]);h=!1},d(d){d&&p(e),o&&o.d();for(let m=0;m<l.length;m+=1)l[m].d();s[7](null)}}}function pe(s,e,t){let i;Z(s,ue,u=>t(9,i=u));let{top:l="top-4"}=e,{boxes:a}=e,{onBoxClick:n=u=>o(u)}=e,r=i.url.searchParams.get("box"),f,h=null;ee(()=>{r&&(o(r),r=null)});async function o(u){const I=a.find(D=>D.idx===u);if(I){if(ne.clear(),f&&f.idx===I.idx)return t(3,f=null);t(3,f=I),c(),fetch(`${ce}/boxes/${f.idx}/places`).then(D=>D.json()).then(D=>{const z=D.data;z&&oe.emit("addIcons",z.map(E=>{var F;return{idx:Number(E.idx),coordinate:fe([E.longitude,E.latitude]),image:B(((F=E.media)==null?void 0:F.at(0))??"",500),shape:"waterdrop",type:"place",link:`/places/${E.idx}`,rank:1,name:E.name,width:56,height:61}}))})}}function c(){h&&h.scrollTo({top:0,left:0,behavior:"smooth"})}const _=()=>(f==null?void 0:f.idx)&&n(f.idx),d=u=>n(u.idx);function m(u){ae[u?"unshift":"push"](()=>{h=u,t(4,h)})}return s.$$set=u=>{"top"in u&&t(0,l=u.top),"boxes"in u&&t(1,a=u.boxes),"onBoxClick"in u&&t(2,n=u.onBoxClick)},s.$$.update=()=>{s.$$.dirty&8&&f!==void 0&&de({box:(f==null?void 0:f.idx)??""},{replaceState:!0})},[l,a,n,f,h,_,d,m]}class Ce extends ie{constructor(e){super(),re(this,e,pe,_e,T,{top:0,boxes:1,onBoxClick:2})}}export{Ce as U};
