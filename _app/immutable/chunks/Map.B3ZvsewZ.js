import{s as y,w as M,e as D,c as B,b as A,f as C,m as b,i as k,x as S,r as L,z as T,A as N,B as X,u as Y,k as V,E as j,G as q,l as z}from"./scheduler.Bw1HVZ4I.js";import{S as G,i as O,t as U,b as W}from"./index.B-tLs4nj.js";import{a as F,m as h}from"./Chip.svelte_svelte_type_style_lang.DGC0ulxO.js";import{e as _}from"./units.qluQ__4t.js";import{g as H}from"./search.DshRZeRk.js";import{p as J}from"./stores.DvKb9PLv.js";import{g as K}from"./entry.BXNUqQsT.js";/* empty css                                            *//* empty css                                           */import"./heic2any.C5mk9rbx.js";/* empty css                                                    *//* empty css                                                  *//* empty css                                                     *//* empty css                                          */function Q(e,a=500,i=10){let r,f,p;const o=m=>{const{clientX:v,clientY:d}=m instanceof MouseEvent?m:m.touches[0];f=v,p=d,r=setTimeout(()=>{e.dispatchEvent(new CustomEvent("longpress",{detail:m}))},a)},s=m=>{const{clientX:v,clientY:d}=m instanceof MouseEvent?m:m.touches[0],E=Math.abs(v-f),g=Math.abs(d-p);(E>i||g>i)&&clearTimeout(r)},n=()=>{clearTimeout(r)};return e.addEventListener("mousedown",o),e.addEventListener("mousemove",s),e.addEventListener("mouseup",n),e.addEventListener("mouseleave",n),e.addEventListener("touchstart",o),e.addEventListener("touchmove",s),e.addEventListener("touchend",n),e.addEventListener("touchcancel",n),{destroy(){e.removeEventListener("mousedown",o),e.removeEventListener("mousemove",s),e.removeEventListener("mouseup",n),e.removeEventListener("mouseleave",n),e.removeEventListener("touchstart",o),e.removeEventListener("touchmove",s),e.removeEventListener("touchend",n),e.removeEventListener("touchcancel",n)}}}function R(e){let a,i,r,f;const p=e[5].default,o=M(p,e,e[4],null);return{c(){a=D("div"),o&&o.c(),this.h()},l(s){a=B(s,"DIV",{id:!0,class:!0});var n=A(a);o&&o.l(n),n.forEach(C),this.h()},h(){b(a,"id","map"),b(a,"class","svelte-dxcqed")},m(s,n){k(s,a,n),o&&o.m(a,null),e[6](a),i=!0,r||(f=[S(Q.call(null,a,500)),L(a,"longpress",e[7]),L(a,"touchend",e[8],{passive:!0})],r=!0)},p(s,[n]){o&&o.p&&(!i||n&16)&&T(o,p,s,s[4],i?X(p,s[4],n,null):N(s[4]),null)},i(s){i||(U(o,s),i=!0)},o(s){W(o,s),i=!1},d(s){s&&C(a),o&&o.d(s),e[6](null),r=!1,Y(f)}}}function x(e){e.preventDefault()}function Z(e,a,i){let r;V(e,J,t=>i(3,r=t));let{$$slots:f={},$$scope:p}=a,{onSelect:o=void 0}=a,s=!0;F.refresh();let n;async function m(){try{n&&n.abort();const t=r.url.searchParams.get("tags");if(!t)return;n=new AbortController,(await H({tags:t,bbox:h.getView().calculateExtent().join(),abortController:n})).forEach(c=>{const u={idx:c.idx,coordinate:c.location.replace("POINT(","").replace(")","").split(" ").map(Number),image:`https://picsum.photos/112/116?random=${c.idx}`,shape:"waterdrop",type:"place",link:`/places/${c.idx}`,rank:3,name:c.name,width:56,height:61};_.emit("addIcon",u)})}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}function v(){m()}h.on("moveend",v),m();let d;j(()=>{h.setTarget(d),d.addEventListener("contextmenu",x),r.url.searchParams.has("location")&&E(),r.url.searchParams.has("placeIdx")&&g(r.url.searchParams.get("placeIdx"))}),q(()=>{h.un("moveend",v),d.removeEventListener("contextmenu",x)});function E(){const t=r.url.searchParams.get("location"),l=t==null?void 0:t.split(","),c=l[0],u=l[1];c&&u&&h.getView().setCenter([Number(c),Number(u)])}_.on("addIconByPlaceIdx",g);async function g(t){const l=await fetch(`https://azit.surflux.studio/places/${t}`).then(u=>u.json()).then(u=>u.data).catch(u=>{console.error(u)}),c={idx:l.placeIdx,coordinate:[l.longitude,l.latitude],image:`https://picsum.photos/112/116?random=${l.placeIdx}`,shape:"waterdrop",type:"place",link:`/places/${l.placeIdx}`,rank:5,name:l.name,width:56,height:61};_.emit("addIcon",c)}function I(t){z[t?"unshift":"push"](()=>{d=t,i(2,d)})}const w=t=>{i(1,s=!1),h.getInteractions().forEach(u=>u.setActive(!1));const[l,c]=h.getEventCoordinate(t.detail);r.url.pathname!=="/map/edit"?K(`/map/edit?longitude=${l}&latitude=${c}`):o&&o(l,c)},P=()=>{s||h.getInteractions().forEach(t=>t.setActive(!0))};return e.$$set=t=>{"onSelect"in t&&i(0,o=t.onSelect),"$$scope"in t&&i(4,p=t.$$scope)},[o,s,d,r,p,f,I,w,P]}class pe extends G{constructor(a){super(),O(this,a,Z,R,y,{onSelect:0})}}export{pe as M};
