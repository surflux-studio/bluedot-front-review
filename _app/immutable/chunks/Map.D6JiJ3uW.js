import{s as W,e as X,c as U,z as ie,v as m,i as z,n as L,f as _,y as J,B as le,a as $,q as B,V as me,g as q,r as O,b as D,W as de,C as K,h as V,w as ce,m as he,u as ge,o as pe,p as ve,k as xe}from"./scheduler.B7IswjaW.js";import{S as Q,i as ee,c as te,d as ne,m as oe,t as R,a as H,f as ae}from"./index.Bhf26fYQ.js";import{c as Ce,m as x,O as Ee,s as se,f as ye}from"./map.DRcGJRMU.js";import{A as ue,e as N,b as _e}from"./store.DzamesA2.js";import{e as we}from"./search.Bl7qqScm.js";import{p as be}from"./stores.CSI25ST9.js";import"./entry.CtRq8kOV.js";import{s as Pe}from"./searchParams.BevfY9c6.js";import{f as A,a as F}from"./proj.C890k1jX.js";import{s as Z}from"./s32cloudfront.RDEBwLXG.js";import{i as ke}from"./isVideoFile.DGBlGWVm.js";/* empty css                                                     */function je(d){let e,h='<svg class="spining-emoji" viewBox="0 0 100 100"></svg> <div></div>';return{c(){e=X("div"),e.innerHTML=h,this.h()},l(r){e=U(r,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-p2uki9"&&(e.innerHTML=h),this.h()},h(){m(e,"id","push-test-data"),m(e,"class","absolute bottom-24 left-4 z-20 flex flex-col w-32 gap-4")},m(r,s){z(r,e,s)},p:L,i:L,o:L,d(r){r&&_(e)}}}let Me=50;function G(d,e){return d+Math.floor(Math.random()*(e+1-d))}function Se(d){const e=["dosisool.jpg","eul.jpg","face1.jpeg","face2.jpeg","face3.jpeg","j.jpg","oilh.jpg","signin.png","thumb1.jpeg","thumb2.jpeg","thumb3.jpeg","thumb4.jpeg","thumb5.jpeg"],h=e.length,r=Ce(),s={},l=[];function p(){for(let a=0;a<Me;a++)w(a)}A([126.97685,37.578019]);const v=[[128513,128591],[9986,10160],[128640,128704],[128512,128566],[128641,128709],[127757,128359]];function i(){const a=v[G(0,v.length-1)];return`&#${G(a[0],a[1])};`}function t(){let a="";const g=G(1,8);for(let C=0;C<g;C++)a+=i();return a}const o=["w-[160px] h-[160px]","w-[100px] h-[100px]","w-[60px] h-[60px]"];function b(){const a=document.createElement("div");return a.innerHTML=`<img class="rounded-avatar2" src="${e[G(0,h-1)]}" />
    <svg class="spining-emoji" viewBox="0 0 100 100">
      <path
        id="text-path"
        d="M 50,50 m -30,0 a 30,30 0 1,1 60,0 a 30,30 0 1,1 -60,0"
        fill="none"
      />
      <text font-size="12" dy="-3" letter-spacing="10">
        <textPath href="#text-path" startOffset="0">
          ${t()}
        </textPath>
      </text>
    </svg>
    `,a}function w(a,g){const C=new Ee({id:a,element:b(),stopEvent:!1,positioning:"center-center",position:g});x.addOverlay(C),l.push(C)}p(),J(()=>{x.on("moveend",()=>{const a=x.getView().getZoom();if(!a)return;const g=x.getView().calculateExtent(x.getSize());l.forEach(k=>k.set("uncheck",!0));const C=Math.ceil(a);r.forEachTileCoord(g,C,k=>{const[y,n,f]=k;if(!s[y])s[y]={[n]:{[f]:[]}};else if(!s[y][n])s[y][n]={[f]:[]};else if(!s[y][n][f])s[y][n][f]=[];else{const u=s[y][n][f].filter(c=>{const P=l.find(S=>S.get("idx")===c.idx);return P?(P.set("uncheck",!1),!1):!0}),E=l.filter(c=>c.get("uncheck")),M=l.filter(c=>!c.get("uncheck"));u.forEach((c,P)=>{const S=E[P];if(!S)return;const I=A([c.longitude,c.latitude]);if(j(I,M))return;M.push(S),S.setPosition(I),S.set("idx",c.idx),S.set("uncheck",!1);const T=S.getElement();if(T){const Y=o[G(0,o.length-1)];T.className=`effective-element2 ${Y}`}});return}fetch(`${ue}/places/${y}/${n}/${f}`).then(u=>u.json()).then(u=>{const E=u.data;s[y][n][f]=E;const M=l.filter(P=>P.get("uncheck")),c=l.filter(P=>!P.get("uncheck"));E.forEach((P,S)=>{const I=M[S];if(!I)return;const T=A([P.longitude,P.latitude]);if(j(T,c))return;c.push(I),I.setPosition(T),I.set("idx",P.idx),I.set("uncheck",!1);const Y=I.getElement();if(Y){const fe=o[G(0,o.length-1)];Y.className=`effective-element2 ${fe}`}})}).catch(u=>console.error(u))})})});function j(a,g,C=250){const k=x.getPixelFromCoordinate(a),y=Math.floor(k[0]/C),n=Math.floor(k[1]/C),f=`${y}_${n}`;return g.some(u=>{const E=u.getPosition();if(!E)return!1;const M=x.getPixelFromCoordinate(E),c=Math.floor(M[0]/C),P=Math.floor(M[1]/C),S=`${c}_${P}`;return f===S})}return le(()=>{}),[]}class De extends Q{constructor(e){super(),ee(this,e,Se,je,W,{})}}function Ie(d){let e,h="",r,s,l,p,v,i,t,o,b,w,j;return{c(){e=X("div"),e.innerHTML=h,r=$(),s=B("svg"),l=B("defs"),p=B("filter"),v=B("feGaussianBlur"),i=B("feColorMatrix"),t=B("feComposite"),o=B("mask"),b=B("rect"),w=B("g"),j=new me(!0),this.h()},l(a){e=U(a,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-1yoogyr"&&(e.innerHTML=h),r=q(a),s=O(a,"svg",{width:!0,height:!0,style:!0});var g=D(s);l=O(g,"defs",{});var C=D(l);p=O(C,"filter",{id:!0});var k=D(p);v=O(k,"feGaussianBlur",{in:!0,stdDeviation:!0,result:!0}),D(v).forEach(_),i=O(k,"feColorMatrix",{in:!0,mode:!0,values:!0,result:!0}),D(i).forEach(_),t=O(k,"feComposite",{in:!0,in2:!0,operator:!0}),D(t).forEach(_),k.forEach(_),o=O(C,"mask",{id:!0});var y=D(o);b=O(y,"rect",{width:!0,height:!0,fill:!0}),D(b).forEach(_),w=O(y,"g",{filter:!0,fill:!0});var n=D(w);j=de(n,!0),n.forEach(_),y.forEach(_),C.forEach(_),g.forEach(_),this.h()},h(){m(e,"id","scratch-layer"),m(e,"class","svelte-1zft9l"),m(v,"in","SourceGraphic"),m(v,"stdDeviation",Oe),m(v,"result","blur"),m(i,"in","blur"),m(i,"mode","matrix"),m(i,"values",Ve),m(i,"result","goo"),m(t,"in","SourceGraphic"),m(t,"in2","goo"),m(t,"operator","atop"),m(p,"id","gooey-filter"),m(b,"width","100%"),m(b,"height","100%"),m(b,"fill","white"),j.a=null,m(w,"filter","url(#gooey-filter)"),m(w,"fill","black"),m(o,"id","scratch-mask"),m(s,"width","100%"),m(s,"height","100%"),K(s,"position","absolute")},m(a,g){z(a,e,g),d[2](e),z(a,r,g),z(a,s,g),V(s,l),V(l,p),V(p,v),V(p,i),V(p,t),V(l,o),V(o,b),V(o,w),j.m(d[1],w)},p(a,[g]){g&2&&j.p(a[1])},i:L,o:L,d(a){a&&(_(e),_(r),_(s)),d[2](null)}}}let Be=30;const Oe=5,Ve="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7";function ze(d,e,h){let r=[],s,l=0,p="";J(()=>{x.on("click",function(o){r.push(o.coordinate),i()}),x.on("postrender",v)});function v(){const o=performance.now();o-l<Be||(l=o,i(),console.log(`스크래치 시간: ${performance.now()-o} milliseconds.`))}function i(){h(1,p=r.map(o=>{const[b,w]=x.getPixelFromCoordinate(o);return`<circle cx="${b}" cy="${w}" r="20" fill="black"/>`}).join(`
`))}function t(o){ce[o?"unshift":"push"](()=>{s=o,h(0,s)})}return[s,p,t]}class Ge extends Q{constructor(e){super(),ee(this,e,ze,Ie,W,{})}}function Te(d){let e,h,r,s,l,p;const v=d[7].default,i=he(v,d,d[6],null);return r=new Ge({}),l=new De({}),{c(){e=X("div"),i&&i.c(),h=$(),te(r.$$.fragment),s=$(),te(l.$$.fragment),this.h()},l(t){e=U(t,"DIV",{id:!0,class:!0});var o=D(e);i&&i.l(o),o.forEach(_),h=q(t),ne(r.$$.fragment,t),s=q(t),ne(l.$$.fragment,t),this.h()},h(){m(e,"id","map"),m(e,"class","absolute w-full h-full z-[1] bg-[#BDDBF3] transition-transform duration-500"),K(e,"transform",`translateY(${d[0]}px)`)},m(t,o){z(t,e,o),i&&i.m(e,null),d[8](e),z(t,h,o),oe(r,t,o),z(t,s,o),oe(l,t,o),p=!0},p(t,[o]){i&&i.p&&(!p||o&64)&&ge(i,v,t,t[6],p?ve(v,t[6],o,null):pe(t[6]),null),o&1&&K(e,"transform",`translateY(${t[0]}px)`)},i(t){p||(R(i,t),R(r.$$.fragment,t),R(l.$$.fragment,t),p=!0)},o(t){H(i,t),H(r.$$.fragment,t),H(l.$$.fragment,t),p=!1},d(t){t&&(_(e),_(h),_(s)),i&&i.d(t),d[8](null),ae(r,t),ae(l,t)}}}function re(d){d.preventDefault()}function Le(d,e,h){let r;xe(d,be,n=>h(11,r=n));let{$$slots:s={},$$scope:l}=e,{onSelect:p=()=>{}}=e,{onMoveend:v=()=>{}}=e,{mapY:i=0}=e,{allowEdit:t=!0}=e,{whenCancelEdit:o=()=>{}}=e;se.refresh(),N.on("explorePlaces",j);let b="",w;async function j(){var f;const n=x.getView().getZoom();if(!(!n||n<16))try{w&&w.abort("new request");const u=(f=window.location.search.split("tags=")[1])==null?void 0:f.split("&")[0];if(!u)return;const E=decodeURIComponent(u);if(!E)return;b!==E&&(se.refresh(),b=E),w=new AbortController;const M=await we({tags:b,bbox:F(x.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:w});N.emit("addIcons",M.map(c=>({idx:c.idx,coordinate:A(c.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:Z(c.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${c.idx}`,rank:3,name:c.name,width:38,height:46,onlyMain:!0})))}catch(u){(u==null?void 0:u.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",u)}}x.on("moveend",a);function a(){var n,f;j(),Pe({location:((n=x.getView().getCenter())==null?void 0:n.join(","))??"",zoom:((f=x.getView().getZoom())==null?void 0:f.toFixed(2))??""}),v(F(x.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}j();let g;J(()=>{x.setTarget(g),g.addEventListener("contextmenu",re),r.url.searchParams.has("location")&&C(),r.url.searchParams.has("placeIdx")&&k(r.url.searchParams.get("placeIdx")),v(F(x.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),le(()=>{x.un("moveend",a),g.removeEventListener("contextmenu",re)});function C(){const n=r.url.searchParams.get("location"),f=r.url.searchParams.get("zoom"),u=n==null?void 0:n.split(",").map(Number),E={};u&&(E.center=u),f&&(E.zoom=Number(f)),Object.values(E).length>0&&ye(E)}N.on("addIconByPlaceIdx",k);async function k(n){var M;const f=await fetch(`${ue}/places/${n}`,{headers:{"x-api-version":_e.PLACE}}).then(c=>c.json()).then(c=>c.data.place).catch(c=>{console.error(c)});let u=((M=f.thumbnail)==null?void 0:M.at(0))||"";if(!String(u).includes("youtu")){const c=Z(u);await ke(c)&&(u=u+"-thumbnail")}const E={idx:f.placeIdx,coordinate:A([f.longitude,f.latitude]),image:Z(u,500)||"",shape:"point",type:"place",link:`/places/${f.placeIdx}`,rank:5,name:f.name,width:38,height:46};N.emit("addIcon",E)}function y(n){ce[n?"unshift":"push"](()=>{g=n,h(1,g)})}return d.$$set=n=>{"onSelect"in n&&h(2,p=n.onSelect),"onMoveend"in n&&h(3,v=n.onMoveend),"mapY"in n&&h(0,i=n.mapY),"allowEdit"in n&&h(4,t=n.allowEdit),"whenCancelEdit"in n&&h(5,o=n.whenCancelEdit),"$$scope"in n&&h(6,l=n.$$scope)},[i,g,p,v,t,o,l,s,y]}class Ue extends Q{constructor(e){super(),ee(this,e,Le,Te,W,{onSelect:2,onMoveend:3,mapY:0,allowEdit:4,whenCancelEdit:5})}}export{Ue as M};
