import{s as M,m as A,e as G,c as k,b as j,f as w,x,B as z,i as L,C as N,y as q,u as Z,o as O,p as R,D as T,k as U,q as F,r as W,v as H}from"./scheduler.B6RFReyk.js";import{S as J,i as K,t as Q,a as X}from"./index.DLC1-nrr.js";import{a as v,m as i}from"./map.DemcD3lO.js";import{e as _,A as Y}from"./sign.HDKgj7Db.js";import{g as $}from"./search.t3-JZgWc.js";import{p as ee}from"./stores.DJJB8uAr.js";import{l as te}from"./longPress.C9F0mLoM.js";import{g as oe}from"./entry.CNeqVxWr.js";import{s as ae}from"./searchParams.DqjEl6fz.js";import{a as P,f as I}from"./proj.DXH8zrwl.js";import{s as S}from"./s32cloudfront.CTUFng11.js";/* empty css                                          */function ne(s){let a,r,l,h;const d=s[5].default,n=A(d,s,s[4],null);return{c(){a=G("div"),n&&n.c(),this.h()},l(o){a=k(o,"DIV",{id:!0,class:!0});var c=j(a);n&&n.l(c),c.forEach(w),this.h()},h(){x(a,"id","map"),x(a,"class",z("absolute w-full h-full z-[1]")+" svelte-mehtzq")},m(o,c){L(o,a,c),n&&n.m(a,null),s[6](a),r=!0,l||(h=[N(te.call(null,a,500)),q(a,"longpress",s[7])],l=!0)},p(o,[c]){n&&n.p&&(!r||c&16)&&Z(n,d,o,o[4],r?R(d,o[4],c,null):O(o[4]),null)},i(o){r||(Q(n,o),r=!0)},o(o){X(n,o),r=!1},d(o){o&&w(a),n&&n.d(o),s[6](null),l=!1,T(h)}}}function y(s){s.preventDefault()}function se(s,a,r){let l;U(s,ee,e=>r(2,l=e));let{$$slots:h={},$$scope:d}=a,{onSelect:n=()=>{}}=a,{onMoveend:o=()=>{}}=a;v.refresh(),_.on("explorePlaces",C);let c="",g;async function C(){var e;if(!(i.getView().getZoom()<16))try{g&&g.abort("new request");const t=(e=window.location.search.split("tags=")[1])==null?void 0:e.split("&")[0];if(!t)return;const m=decodeURIComponent(t);if(!m)return;c!==m&&(v.refresh(),c=m),g=new AbortController;const u=await $({tags:c,bbox:P(i.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:g});_.emit("addIcons",u.map(p=>({idx:p.idx,coordinate:I(p.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:S(p.thumbnail,500)||"",shape:"waterdrop",type:"place",link:`/places/${p.idx}`,rank:3,name:p.name,width:56,height:61,onlyMain:!0})))}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}i.on("moveend",b);function b(){var e,t;C(),ae({location:((e=i.getView().getCenter())==null?void 0:e.join(","))??"",zoom:((t=i.getView().getZoom())==null?void 0:t.toFixed(2))??""}),o(P(i.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}C();let f;F(()=>{i.setTarget(f),f.addEventListener("contextmenu",y),l.url.searchParams.has("location")&&D(),l.url.searchParams.has("placeIdx")&&E(l.url.searchParams.get("placeIdx")),o(P(i.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),W(()=>{i.un("moveend",b),f.removeEventListener("contextmenu",y)});function D(){const e=l.url.searchParams.get("location"),t=l.url.searchParams.get("zoom"),m=e==null?void 0:e.split(",").map(Number);m&&i.getView().setCenter(m),t&&i.getView().setZoom(Number(t))}_.on("addIconByPlaceIdx",E);async function E(e){const t=await fetch(`${Y}/places/${e}`).then(u=>u.json()).then(u=>u.data).catch(u=>{console.error(u)}),m={idx:t.placeIdx,coordinate:I([t.longitude,t.latitude]),image:S(t.thumbnail,500)||"",shape:"waterdrop",type:"place",link:`/places/${t.placeIdx}`,rank:5,name:t.name,width:56,height:61};_.emit("addIcon",m)}function B(e){H[e?"unshift":"push"](()=>{f=e,r(1,f)})}const V=e=>{const t=i.getEventCoordinate(e.detail);l.url.pathname!=="/map/edit"?oe(`/map/edit?location=${t[0]},${t[1]}`):n(t)};return s.$$set=e=>{"onSelect"in e&&r(0,n=e.onSelect),"onMoveend"in e&&r(3,o=e.onMoveend),"$$scope"in e&&r(4,d=e.$$scope)},[n,f,l,o,d,h,B,V]}class Ce extends J{constructor(a){super(),K(this,a,se,ne,M,{onSelect:0,onMoveend:3})}}export{Ce as M};
