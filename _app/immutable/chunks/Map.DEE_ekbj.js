import{s as y,y as I,e as S,c as D,b as B,f as b,q as P,H as V,i as z,z as k,r as G,B as j,C as A,D as T,w as q,k as N,o as X,l as Y,m as Z}from"./scheduler.De904EWn.js";import{S as U,i as F,t as H,b as O}from"./index.w_cQNxYZ.js";import{a as W,m as u}from"./map.XhCtemUh.js";import{e as g}from"./units.DvlLNOex.js";import{g as J}from"./search.V717-9Sx.js";import{p as K}from"./stores.DMUPpfAr.js";import{g as Q}from"./entry.BSZcKorA.js";import{s as R}from"./searchParams.C8PNeJ8T.js";import{a as _,f as w}from"./proj.DXH8zrwl.js";/* empty css                                          */function $(e,s=500,l=10){let r,p,f;const n=c=>{const{clientX:v,clientY:m}=c instanceof MouseEvent?c:c.touches[0];p=v,f=m,r=setTimeout(()=>{e.dispatchEvent(new CustomEvent("longpress",{detail:c}))},s)},o=c=>{const{clientX:v,clientY:m}=c instanceof MouseEvent?c:c.touches[0],C=Math.abs(v-p),E=Math.abs(m-f);(C>l||E>l)&&clearTimeout(r)},a=()=>{clearTimeout(r)};return e.addEventListener("mousedown",n),e.addEventListener("mousemove",o),e.addEventListener("mouseup",a),e.addEventListener("mouseleave",a),e.addEventListener("touchstart",n),e.addEventListener("touchmove",o),e.addEventListener("touchend",a),e.addEventListener("touchcancel",a),{destroy(){e.removeEventListener("mousedown",n),e.removeEventListener("mousemove",o),e.removeEventListener("mouseup",a),e.removeEventListener("mouseleave",a),e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",o),e.removeEventListener("touchend",a),e.removeEventListener("touchcancel",a)}}}function ee(e){let s,l,r,p;const f=e[5].default,n=I(f,e,e[4],null);return{c(){s=S("div"),n&&n.c(),this.h()},l(o){s=D(o,"DIV",{id:!0,class:!0});var a=B(s);n&&n.l(a),a.forEach(b),this.h()},h(){P(s,"id","map"),P(s,"class",V("absolute w-full h-full z-[1]")+" svelte-mehtzq")},m(o,a){z(o,s,a),n&&n.m(s,null),e[6](s),l=!0,r||(p=[k($.call(null,s,500)),G(s,"longpress",e[7])],r=!0)},p(o,[a]){n&&n.p&&(!l||a&16)&&j(n,f,o,o[4],l?T(f,o[4],a,null):A(o[4]),null)},i(o){l||(H(n,o),l=!0)},o(o){O(n,o),l=!1},d(o){o&&b(s),n&&n.d(o),e[6](null),r=!1,q(p)}}}function x(e){e.preventDefault()}function te(e,s,l){let r;N(e,K,t=>l(2,r=t));let{$$slots:p={},$$scope:f}=s,{onSelect:n=()=>{}}=s,{onMoveend:o=()=>{}}=s;W.refresh();let a;async function c(){try{a&&a.abort("new request");const t=r.url.searchParams.get("tags");if(!t)return;a=new AbortController,(await J({tags:t,bbox:_(u.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:a})).forEach(d=>{const h={idx:d.idx,coordinate:w(d.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:`https://picsum.photos/112/116?random=${d.idx}`,shape:"waterdrop",type:"place",link:`/places/${d.idx}`,rank:3,name:d.name,width:56,height:61};g.emit("addIcon",h)})}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}u.on("moveend",v);function v(){var t,i;c(),R({location:((t=u.getView().getCenter())==null?void 0:t.join(","))??"",zoom:((i=u.getView().getZoom())==null?void 0:i.toFixed(2))??""}),o(_(u.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}g.on("explorePlaces",c),c();let m;X(()=>{u.setTarget(m),m.addEventListener("contextmenu",x),r.url.searchParams.has("location")&&C(),r.url.searchParams.has("placeIdx")&&E(r.url.searchParams.get("placeIdx")),o(_(u.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),Y(()=>{u.un("moveend",v),m.removeEventListener("contextmenu",x)});function C(){const t=r.url.searchParams.get("location"),i=r.url.searchParams.get("zoom"),d=t==null?void 0:t.split(",").map(Number);d&&u.getView().setCenter(d),i&&u.getView().setZoom(Number(i))}g.on("addIconByPlaceIdx",E);async function E(t){const i=await fetch(`https://azit.surflux.studio/places/${t}`).then(h=>h.json()).then(h=>h.data).catch(h=>{console.error(h)}),d={idx:i.placeIdx,coordinate:w([i.longitude,i.latitude]),image:`https://picsum.photos/112/116?random=${i.placeIdx}`,shape:"waterdrop",type:"place",link:`/places/${i.placeIdx}`,rank:5,name:i.name,width:56,height:61};g.emit("addIcon",d)}function L(t){Z[t?"unshift":"push"](()=>{m=t,l(1,m)})}const M=t=>{const i=u.getEventCoordinate(t.detail);r.url.pathname!=="/map/edit"?Q(`/map/edit?location=${i[0]},${i[1]}`):n(i)};return e.$$set=t=>{"onSelect"in t&&l(0,n=t.onSelect),"onMoveend"in t&&l(3,o=t.onMoveend),"$$scope"in t&&l(4,f=t.$$scope)},[n,m,r,o,f,p,L,M]}class de extends U{constructor(s){super(),F(this,s,te,ee,y,{onSelect:0,onMoveend:3})}}export{de as M};
