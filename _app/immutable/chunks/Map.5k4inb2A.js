import{_}from"./preload-helper.D6kgxu3v.js";import{s as N,n as I,c as O,o as S,a as V,b as w}from"./scheduler.CS_98Wiq.js";import{S as R,i as z,e as F,s as U,q as k,c as L,a as Z,d as f,f as q,r as D,g as b}from"./index.DkGyNcZ4.js";import{m as r,g as W}from"./search.DsDufvsw.js";import{s as J,e as m,g as G}from"./icon.iuqdwY6R.js";import{p as H}from"./stores.DoXZPmyn.js";import{a as g}from"./searchParams.CTWHlEBv.js";function K(c){let i,s,d;return{c(){i=F("div"),s=U(),d=k(),this.h()},l(a){i=L(a,"DIV",{id:!0,class:!0}),Z(i).forEach(f),s=q(a),d=k(),this.h()},h(){D(i,"id","map"),D(i,"class","svelte-4dod2t")},m(a,u){b(a,i,u),c[6](i),b(a,s,u),b(a,d,u)},p(a,[u]){},i:I,o:I,d(a){a&&(f(i),f(s),f(d)),c[6](null)}}}function Q(c,i,s){let d;O(c,H,e=>s(9,d=e));let{onMark:a=!1}=i;async function u(){const{default:e}=await _(async()=>{const{default:t}=await import("./feed_read.LNY5rkFx.js");return{default:t}},[],import.meta.url);m.emit("addIcon",{image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"circle",type:"feed",link:"/boxes?feed=true&type=feed",rank:2,name:"읽은 피드의 장소명",width:62,height:67,backgroundImage:e,displacement:[0,3.5]})}async function A(){const{default:e}=await _(async()=>{const{default:t}=await import("./feed_unread.BwN6XzLy.js");return{default:t}},[],import.meta.url);m.emit("addIcon",{coordinate:[126.97785,37.578019],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"circle",type:"feed",link:"/boxes?feed=true&type=feed",rank:1,name:"안읽은 피드의 장소명",width:62,height:67,backgroundImage:e,displacement:[0,3.5]})}async function E(){m.emit("addIcon",{coordinate:[126.97685,37.576519],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"waterdrop",type:"place",link:"/boxes?feed=true&type=feed",rank:3,name:"장소명",width:56,height:61})}let l;function P(){if(l){const e=r.getView().getZoom()||0;s(0,l.innerText=`ZOOM: ${e.toString()}`,l)}}J.refresh();function B(){const e=r.getView().calculateExtent(r.getSize()),t=G(e),o=Number(t[0].toFixed(6)),n=Number(t[1].toFixed(6));m.emit("addIcon",{coordinate:[o,n],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"waterdrop",type:"place",link:"/boxes?feed=true&type=feed",rank:1,name:"추가된 장소",width:56,height:61}),fetch("https://azit.surflux.studio/places",{method:"POST",body:JSON.stringify([{name:"testname",location:{lon:o,lat:n}}])}).then(async C=>{console.log(await C.json())}).catch(C=>{console.log(C)})}let p;async function x(){try{p&&p.abort();const e=d.url.searchParams.get("tags");if(!e)return;p=new AbortController,(await W({tags:e,bbox:r.getView().calculateExtent().join(),abortController:p})).forEach(o=>{const n={idx:o.idx,coordinate:o.location.replace("POINT(","").replace(")","").split(" ").map(Number),image:`https://picsum.photos/112/116?random=${o.idx}`,shape:"waterdrop",type:"place",link:`/places/${o.idx}`,rank:3,name:o.name,width:56,height:61};m.emit("addIcon",n)})}catch(e){(e==null?void 0:e.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",e)}}function y(){P(),x()}r.on("moveend",y),x();let h;S(()=>{r.setTarget(h),g("location")&&v(),g("placeIdx")&&T()}),V(()=>{r.un("moveend",y)});function v(){const e=g("location"),t=e==null?void 0:e.split(","),o=t[0],n=t[1];o&&n&&r.getView().setCenter([Number(o),Number(n)])}async function T(){const e=g("placeIdx"),t=await fetch(`https://azit.surflux.studio/places/${e}`).then(n=>n.json()).then(n=>n.data).catch(n=>{console.error(n)}),o={idx:t.placeIdx,coordinate:[t.longitude,t.latitude],image:`https://picsum.photos/112/116?random=${t.placeIdx}`,shape:"waterdrop",type:"place",link:`/places/${t.placeIdx}`,rank:5,name:t.name,width:56,height:61};m.emit("addIcon",o)}function M(e){w[e?"unshift":"push"](()=>{h=e,s(1,h)})}function j(e){w[e?"unshift":"push"](()=>{l=e,s(0,l)})}return c.$$set=e=>{"onMark"in e&&s(5,a=e.onMark)},c.$$.update=()=>{c.$$.dirty&32&&a&&(s(5,a=!1),B())},[l,h,u,A,E,a,M,j]}class ne extends R{constructor(i){super(),z(this,i,Q,K,N,{onMark:5})}}export{ne as M};
