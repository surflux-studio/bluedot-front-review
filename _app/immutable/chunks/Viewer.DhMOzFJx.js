import{s as Qe,e as Y,c as A,b as X,f as k,q as m,i as J,r as N,z as $e,I as pe,k as et,o as tt,N as st,l as nt,w as we,E as lt,a as U,t as Te,g as Z,d as We,v as ae,h as M,O as be,j as je,D as Oe,K as Ie,P as Ee,y as rt}from"./scheduler.BnheM4g2.js";import{S as at,i as ot,t as O,g as _e,f as ve,b as F,c as Re,a as Ce,m as ze,d as Ne}from"./index.CP53dWnj.js";import{e as oe}from"./each.B4pMeuX4.js";import{e as it,A as ct,r as ye}from"./Header.DTOPxOfb.js";import{g as ft}from"./entry.wtivmaCQ.js";import{c as ge}from"./store.CeFeRIes.js";import{u as ut,g as dt}from"./searchParams.miZU2nyp.js";import{W as ht}from"./WaterdropImage.B2tgz0zb.js";import{C as mt}from"./CircleImage.B02Dd2sW.js";import{p as gt}from"./stores.h1yDrrE5.js";import{L as pt}from"./location.C9RXVY9j.js";import{s as me}from"./s32cloudfront.DbyO5vyf.js";/* empty css                                             */function _t(t){const s=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","wheel"].map(a=>{const o=e=>e.stopPropagation();return t.addEventListener(a,o),{event:a,handler:o}});return{destroy(){s.forEach(({event:a,handler:o})=>{t.removeEventListener(a,o)})}}}function ke(t,n,s){const a=t.slice();return a[46]=n[s],a[47]=n,a[48]=s,a}function xe(t,n,s){const a=t.slice();return a[49]=n[s],a[51]=s,a}function Me(t,n,s){const a=t.slice();return a[52]=n[s],a}function Le(t){var W,j;let n,s,a,o,e,i,u,l,d,f,h,b,L,H,R=(t[46].place_name||"")+"",G,te,x,ie,se,ne,P,C,K,V=oe(t[46].media),p=[];for(let v=0;v<V.length;v+=1)p[v]=De(Me(t,V,v));let E=t[46].media.length>1&&Ye(t),y=(t[7]==="post"||t[7]==="patch"||((j=(W=t[46])==null?void 0:W.text)==null?void 0:j.length)>0)&&Pe(t),_=t[46].user_idx&&Xe(t);b=new ht({props:{src:"/graydot.png",width:"2rem",strokeColor:"white",strokeWidth:"13"}});function le(){return t[21](t[46])}return{c(){n=Y("div"),s=Y("div"),a=Y("div");for(let v=0;v<p.length;v+=1)p[v].c();i=U(),u=Y("div"),E&&E.c(),l=U(),y&&y.c(),d=U(),_&&_.c(),f=U(),h=Y("div"),Re(b.$$.fragment),L=U(),H=Y("div"),G=Te(R),ie=U(),this.h()},l(v){n=A(v,"DIV",{class:!0,style:!0});var w=X(n);s=A(w,"DIV",{class:!0});var D=X(s);a=A(D,"DIV",{class:!0,style:!0});var Q=X(a);for(let ce=0;ce<p.length;ce+=1)p[ce].l(Q);Q.forEach(k),D.forEach(k),i=Z(w),u=A(w,"DIV",{class:!0,style:!0});var g=X(u);E&&E.l(g),l=Z(g),y&&y.l(g),d=Z(g),_&&_.l(g),f=Z(g),h=A(g,"DIV",{class:!0});var q=X(h);Ce(b.$$.fragment,q),L=Z(q),H=A(q,"DIV",{});var he=X(H);G=We(he,R),he.forEach(k),q.forEach(k),g.forEach(k),ie=Z(w),w.forEach(k),this.h()},h(){m(a,"class",o=ae(`carousel-track transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"),m(a,"style",e=`transform: translateX(${-t[46].mediaIdx*t[6].width+t[5]}px);`),m(s,"class","carousel-container svelte-1xgvwrg"),m(h,"class","text-shadow text-center flex gap-2 justify-center items-center svelte-1xgvwrg"),m(u,"class",te=ae(`fixed bottom-0 w-full px-4 text-white text-md flex flex-col items-start gap-2 z-40 
            ${t[2]?"":"pb-24"} 
           transition-transform`)+" svelte-1xgvwrg"),m(u,"style",x=`transform: translateY(${t[2]}px);`),m(n,"class",se=ae(`w-full h-full gradient-overlay absolute content-center transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"),m(n,"style",ne=`top: 0; transform: translateY(${(t[48]-t[1])*t[6].height+t[4]}px);`)},m(v,w){J(v,n,w),M(n,s),M(s,a);for(let D=0;D<p.length;D+=1)p[D]&&p[D].m(a,null);M(n,i),M(n,u),E&&E.m(u,null),M(u,l),y&&y.m(u,null),M(u,d),_&&_.m(u,null),M(u,f),M(u,h),ze(b,h,null),M(h,L),M(h,H),M(H,G),M(n,ie),P=!0,C||(K=[N(a,"transitionend",function(){be(t[46].mediaIdx===t[0][t[1]].mediaIdx?t[9]:void 0)&&(t[46].mediaIdx===t[0][t[1]].mediaIdx?t[9]:void 0).apply(this,arguments)}),N(h,"click",le),N(n,"transitionend",function(){be(t[48]===t[1]?t[9]:void 0)&&(t[48]===t[1]?t[9]:void 0).apply(this,arguments)})],C=!0)},p(v,w){var D,Q;if(t=v,w[0]&1){V=oe(t[46].media);let g;for(g=0;g<V.length;g+=1){const q=Me(t,V,g);p[g]?p[g].p(q,w):(p[g]=De(q),p[g].c(),p[g].m(a,null))}for(;g<p.length;g+=1)p[g].d(1);p.length=V.length}(!P||w[0]&8&&o!==(o=ae(`carousel-track transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"))&&m(a,"class",o),(!P||w[0]&97&&e!==(e=`transform: translateX(${-t[46].mediaIdx*t[6].width+t[5]}px);`))&&m(a,"style",e),t[46].media.length>1?E?E.p(t,w):(E=Ye(t),E.c(),E.m(u,l)):E&&(E.d(1),E=null),t[7]==="post"||t[7]==="patch"||((Q=(D=t[46])==null?void 0:D.text)==null?void 0:Q.length)>0?y?y.p(t,w):(y=Pe(t),y.c(),y.m(u,d)):y&&(y.d(1),y=null),t[46].user_idx?_?(_.p(t,w),w[0]&1&&O(_,1)):(_=Xe(t),_.c(),O(_,1),_.m(u,f)):_&&(_e(),F(_,1,1,()=>{_=null}),ve()),(!P||w[0]&1)&&R!==(R=(t[46].place_name||"")+"")&&je(G,R),(!P||w[0]&4&&te!==(te=ae(`fixed bottom-0 w-full px-4 text-white text-md flex flex-col items-start gap-2 z-40 
            ${t[2]?"":"pb-24"} 
           transition-transform`)+" svelte-1xgvwrg"))&&m(u,"class",te),(!P||w[0]&4&&x!==(x=`transform: translateY(${t[2]}px);`))&&m(u,"style",x),(!P||w[0]&8&&se!==(se=ae(`w-full h-full gradient-overlay absolute content-center transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"))&&m(n,"class",se),(!P||w[0]&82&&ne!==(ne=`top: 0; transform: translateY(${(t[48]-t[1])*t[6].height+t[4]}px);`))&&m(n,"style",ne)},i(v){P||(O(_),O(b.$$.fragment,v),P=!0)},o(v){F(_),F(b.$$.fragment,v),P=!1},d(v){v&&k(n),pe(p,v),E&&E.d(),y&&y.d(),_&&_.d(),Ne(b),C=!1,Oe(K)}}}function De(t){let n,s,a,o,e;return{c(){n=Y("div"),s=Y("img"),e=U(),this.h()},l(i){n=A(i,"DIV",{class:!0});var u=X(n);s=A(u,"IMG",{src:!0,alt:!0,class:!0,draggable:!0}),e=Z(u),u.forEach(k),this.h()},h(){Ie(s.src,a=me(t[52]))||m(s,"src",a),m(s,"alt",o=t[46].place_name),m(s,"class","w-full h-full object-contain svelte-1xgvwrg"),m(s,"draggable","false"),m(n,"class","carousel-slide svelte-1xgvwrg")},m(i,u){J(i,n,u),M(n,s),M(n,e)},p(i,u){u[0]&1&&!Ie(s.src,a=me(i[52]))&&m(s,"src",a),u[0]&1&&o!==(o=i[46].place_name)&&m(s,"alt",o)},d(i){i&&k(n)}}}function Ye(t){let n,s=oe(t[46].media),a=[];for(let o=0;o<s.length;o+=1)a[o]=Ae(xe(t,s,o));return{c(){n=Y("div");for(let o=0;o<a.length;o+=1)a[o].c();this.h()},l(o){n=A(o,"DIV",{class:!0});var e=X(n);for(let i=0;i<a.length;i+=1)a[i].l(e);e.forEach(k),this.h()},h(){m(n,"class","carousel-nav svelte-1xgvwrg")},m(o,e){J(o,n,e);for(let i=0;i<a.length;i+=1)a[i]&&a[i].m(n,null)},p(o,e){if(e[0]&1){s=oe(o[46].media);let i;for(i=0;i<s.length;i+=1){const u=xe(o,s,i);a[i]?a[i].p(u,e):(a[i]=Ae(u),a[i].c(),a[i].m(n,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=s.length}},d(o){o&&k(n),pe(a,o)}}}function Ae(t){let n,s;return{c(){n=Y("span"),this.h()},l(a){n=A(a,"SPAN",{class:!0}),X(n).forEach(k),this.h()},h(){m(n,"class",s="carousel-dot "+(t[46].mediaIdx===t[51]?"active":"")+" svelte-1xgvwrg")},m(a,o){J(a,n,o)},p(a,o){o[0]&1&&s!==(s="carousel-dot "+(a[46].mediaIdx===a[51]?"active":"")+" svelte-1xgvwrg")&&m(n,"class",s)},d(a){a&&k(n)}}}function Pe(t){let n,s,a;function o(){t[18].call(n,t[47],t[48])}return{c(){n=Y("textarea"),this.h()},l(e){n=A(e,"TEXTAREA",{class:!0,placeholder:!0}),X(n).forEach(k),this.h()},h(){m(n,"class","w-full h-auto overflow-scroll py-0 px-1 mb-3 outline-0 focus:outline-none focus:ring-0 border-none bg-transparent text-sm text-shadow placeholder:text-white/75 placeholder:text-base box-content read-only:cursor-pointer  svelte-1xgvwrg"),n.readOnly=t[7]!=="post"&&t[7]!=="patch",m(n,"placeholder",t[7]==="post"||t[7]==="patch"?"✎ 텍스트 입력하기":"")},m(e,i){J(e,n,i),Ee(n,t[46].text),s||(a=[N(n,"input",o),rt(_t.call(null,n)),N(n,"input",t[19]),N(n,"click",t[10]),N(n,"focus",t[11]),N(n,"blur",t[12])],s=!0)},p(e,i){t=e,i[0]&1&&Ee(n,t[46].text)},d(e){e&&k(n),s=!1,Oe(a)}}}function Xe(t){let n,s,a,o,e=t[46].display_name+"",i,u,l,d;s=new mt({props:{src:me(t[46].profile_image_url),width:"2rem",strokeColor:"white",strokeWidth:"13"}});function f(){return t[20](t[46])}return{c(){n=Y("div"),Re(s.$$.fragment),a=U(),o=Y("div"),i=Te(e),this.h()},l(h){n=A(h,"DIV",{class:!0});var b=X(n);Ce(s.$$.fragment,b),a=Z(b),o=A(b,"DIV",{});var L=X(o);i=We(L,e),L.forEach(k),b.forEach(k),this.h()},h(){m(n,"class","text-shadow text-center flex gap-2 justify-center items-center svelte-1xgvwrg")},m(h,b){J(h,n,b),ze(s,n,null),M(n,a),M(n,o),M(o,i),u=!0,l||(d=N(n,"click",f),l=!0)},p(h,b){t=h;const L={};b[0]&1&&(L.src=me(t[46].profile_image_url)),s.$set(L),(!u||b[0]&1)&&e!==(e=t[46].display_name+"")&&je(i,e)},i(h){u||(O(s.$$.fragment,h),u=!0)},o(h){F(s.$$.fragment,h),u=!1},d(h){h&&k(n),Ne(s),l=!1,d()}}}function He(t){let n=Math.abs(t[1]-t[48])<=1,s,a,o=n&&Le(t);return{c(){o&&o.c(),s=we()},l(e){o&&o.l(e),s=we()},m(e,i){o&&o.m(e,i),J(e,s,i),a=!0},p(e,i){i[0]&2&&(n=Math.abs(e[1]-e[48])<=1),n?o?(o.p(e,i),i[0]&2&&O(o,1)):(o=Le(e),o.c(),O(o,1),o.m(s.parentNode,s)):o&&(_e(),F(o,1,1,()=>{o=null}),ve())},i(e){a||(O(o),a=!0)},o(e){F(o),a=!1},d(e){e&&k(s),o&&o.d(e)}}}function vt(t){let n,s,a,o,e=oe(t[0]),i=[];for(let l=0;l<e.length;l+=1)i[l]=He(ke(t,e,l));const u=l=>F(i[l],1,1,()=>{i[l]=null});return{c(){n=Y("div");for(let l=0;l<i.length;l+=1)i[l].c();this.h()},l(l){n=A(l,"DIV",{class:!0});var d=X(n);for(let f=0;f<i.length;f+=1)i[f].l(d);d.forEach(k),this.h()},h(){m(n,"class","bg-black w-screen h-screen")},m(l,d){J(l,n,d);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(n,null);s=!0,a||(o=N(n,"contextmenu",$e(t[17])),a=!0)},p(l,d){if(d[0]&8191){e=oe(l[0]);let f;for(f=0;f<e.length;f+=1){const h=ke(l,e,f);i[f]?(i[f].p(h,d),O(i[f],1)):(i[f]=He(h),i[f].c(),O(i[f],1),i[f].m(n,null))}for(_e(),f=e.length;f<i.length;f+=1)u(f);ve()}},i(l){if(!s){for(let d=0;d<e.length;d+=1)O(i[d]);s=!0}},o(l){i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)F(i[d]);s=!1},d(l){l&&k(n),pe(i,l),a=!1,o()}}}const wt=30,bt=10,Ve=10,Se=300;function de(t){return"touches"in t||"changedTouches"in t}function It(t,n,s){let a;et(t,gt,r=>s(16,a=r));let o=a.url.searchParams.get("type"),{posts:e=[]}=n,{dontMoveVertically:i=!1}=n,{keyboardY:u=0}=n,{index:l=0}=n,d=!0,f=!1,h=!1,b=0,L=0,H={width:0,height:0},R=!1,G=!1;async function te(){s(14,R=!0);const r=a.url.searchParams.get("userIdx"),c=a.url.searchParams.get("placeIdx"),I=await pt.getCurrentOrLastLocation(),S=e.length,T=wt,z=r?`&userIdx=${r}`:"",fe=c?`&placeIdx=${c}`:"",$=I?`&location=${[I==null?void 0:I.longitude,I==null?void 0:I.latitude].join(",")}`:"",ee=`&offset=${S}`,B=`&limit=${T}`,re=(await fetch(`${ct}/posts?${z}${fe}${ee}${B}${$}`).then(ue=>ue.json()).then(ue=>ue.data)).map(ue=>({...ue,mediaIdx:0}));re.length===0&&s(15,G=!0),s(0,e=[...e,...re]),s(14,R=!1)}async function x(){ut({mediaIdx:`${e[l].mediaIdx}`,postIdx:`${e[l].idx}`},{replace:!0})}function ie(r){const c=H.height;if(l===0&&r>0){s(4,b=r*.3);return}if(l===e.length-1&&r<0){s(4,b=r*.3);return}s(4,b=Math.max(Math.min(r,c),-c))}function se(r){document.querySelectorAll("textarea").forEach(S=>{g({target:S})}),s(3,d=!1),H.height;let c=0;de(r)?c=r.changedTouches[0].clientY-V:c=r.clientY-V;const I=ye(2);c>I&&l>0?(s(1,l-=1),f=!0,x()):-c>I&&l<e.length-1&&(s(1,l+=1),f=!0,x()),s(4,b=0)}function ne(r){const c=H.width;if(r=Math.max(Math.min(r,c),-c),e[l].mediaIdx===0&&r>0||e[l].mediaIdx===e[l].media.length-1&&r<0){s(5,L=r*.3);return}s(5,L=r)}function P(r){H.width,s(3,d=!1);let c=0;de(r)?c=r.changedTouches[0].clientX-K:c=r.clientX-K;const I=ye(2);if(c>I&&e[l].mediaIdx>0){const S=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:S},e),s(0,e=[...e]),h=!0,x()}else if(-c>I&&e[l].mediaIdx<e[l].media.length-1){const S=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:S},e),s(0,e=[...e]),h=!0,x()}s(5,L=0)}let C=!1,K=-1,V=-1,p,E=!1;it.on("blockSwipeInViewer",r=>C=r);function y(r){C||f||h||(E=!0,p=void 0,ge.set(!0),de(r)?(K=r.touches[0].clientX,V=r.touches[0].clientY):(K=r.clientX,V=r.clientY,window.addEventListener("mousemove",_,{passive:!1}),window.addEventListener("mouseup",le)))}function _(r){if(C||!E||f||h)return;let c=0,I=0;de(r)?(c=r.touches[0].clientX,I=r.touches[0].clientY):(c=r.clientX,I=r.clientY);let S=c-K,T=I-V;p===void 0&&(p=Math.abs(T)>=Math.abs(S)?"post":"media"),!i&&p==="post"?ie(T):p==="media"&&ne(S)}function le(r){C||!E||f||h||(E=!1,p==="post"?se(r):p==="media"?P(r):ge.set(!1),de(r)||(window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",le)))}let W=[],j=[];function v(r){if(C||f||h)return;r.preventDefault();const c=Date.now(),I=Math.abs(r.deltaX),S=Math.abs(r.deltaY);if(I>S){if(j.push({deltaX:r.deltaX,timestamp:c}),j=j.filter(T=>c-T.timestamp<=Se),j.length>=2){const T=j[0],z=j[j.length-1],fe=Math.abs(T.deltaX),$=Math.abs(z.deltaX),ee=$-fe;if(ee<0)return;if(ee>=0&&$>=Ve){let B=!1;if(z.deltaX>0&&e[l].mediaIdx<e[l].media.length-1){const re=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:re},e),s(0,e=[...e]),s(3,d=!1),x(),B=!0}else if(z.deltaX<0&&e[l].mediaIdx>0){const re=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:re},e),s(0,e=[...e]),s(3,d=!1),x(),B=!0}j=[],B&&(h=!0)}}}else if(W.push({deltaY:r.deltaY,timestamp:c}),W=W.filter(T=>c-T.timestamp<=Se),W.length>=2){const T=W[0],z=W[W.length-1],fe=Math.abs(T.deltaY),$=Math.abs(z.deltaY),ee=$-fe;if(ee<0)return;if(ee>=0&&$>=Ve){let B=!1;z.deltaY>0&&l<e.length-1?(s(3,d=!1),s(1,l+=1),x(),B=!0):z.deltaY<0&&l>0&&(s(3,d=!1),s(1,l-=1),x(),B=!0),W=[],B&&(f=!0)}}}function w(r){if(!(C||f||h))switch(r.key){case"ArrowUp":l>0&&(s(3,d=!1),s(1,l-=1),f=!0,x());break;case"ArrowDown":l<e.length-1&&(s(3,d=!1),s(1,l+=1),f=!0,x());break;case"ArrowLeft":if(e[l].mediaIdx>0){const c=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:c},e),s(0,e=[...e]),s(3,d=!1),h=!0,x()}break;case"ArrowRight":if(e[l].mediaIdx<e[l].media.length-1){const c=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:c},e),s(0,e=[...e]),s(3,d=!1),h=!0,x()}break}}function D(){s(6,H={width:document.body.clientWidth,height:document.body.clientHeight})}function Q(){const r=Number(a.url.searchParams.get("mediaIdx")||0);r&&e[l].media[r]?(s(0,e[l]={...e[l],mediaIdx:r},e),s(0,e=[...e])):(s(0,e[l]={...e[l],mediaIdx:0},e),s(0,e=[...e])),x()}function g(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.style.height="16px";let I=c.scrollHeight;I>window.innerHeight/3&&(I=window.innerHeight/3),c.style.height=`${I}px`}tt(async()=>{D(),window.addEventListener("resize",D),q(),Q(),await st(),document.querySelectorAll("textarea").forEach(r=>{g({target:r})})}),nt(()=>{window.removeEventListener("resize",D),he()});function q(){document.addEventListener("touchstart",y,{passive:!1}),document.addEventListener("touchmove",_,{passive:!1}),document.addEventListener("touchend",le),document.addEventListener("mousedown",y,{passive:!1}),document.addEventListener("wheel",v,{passive:!1}),document.addEventListener("keydown",w)}function he(){document.removeEventListener("touchstart",y),document.removeEventListener("touchmove",_),document.removeEventListener("touchend",le),document.removeEventListener("mousedown",y),document.removeEventListener("wheel",v),document.removeEventListener("keydown",w)}function ce(){s(3,d=!0),f=!1,h=!1,ge.set(!1)}function qe(r){if(o==="post"||o==="patch")return;const c=r.target;c instanceof HTMLTextAreaElement&&(c.scrollHeight<=c.clientHeight||(c.hasAttribute("open")?(c.style.height="",c.removeAttribute("open")):(c.style.height=`${window.innerHeight/3}px`,c.setAttribute("open",""))))}function Be(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.hasAttribute("open")||(c.style.height=`${window.innerHeight/3}px`,c.setAttribute("open",""))}function Ge(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.hasAttribute("open")&&(c.style.height="",c.removeAttribute("open"))}function Ke(r){lt.call(this,t,r)}function Ue(r,c){r[c].text=this.value,s(0,e)}const Ze=r=>g(r),Fe=r=>{r.user_idx&&dt(`/users/${r.user_idx}`)},Je=r=>{r.place_idx&&ft(`/places/${r.place_idx}`)};return t.$$set=r=>{"posts"in r&&s(0,e=r.posts),"dontMoveVertically"in r&&s(13,i=r.dontMoveVertically),"keyboardY"in r&&s(2,u=r.keyboardY),"index"in r&&s(1,l=r.index)},t.$$.update=()=>{t.$$.dirty[0]&65536&&a&&x(),t.$$.dirty[0]&49155&&l>=e.length-bt&&!R&&!G&&te()},[e,l,u,d,b,L,H,o,g,ce,qe,Be,Ge,i,R,G,a,Ke,Ue,Ze,Fe,Je]}class St extends at{constructor(n){super(),ot(this,n,It,vt,Qe,{posts:0,dontMoveVertically:13,keyboardY:2,index:1},null,[-1,-1])}}export{St as V};
