const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./web.CamTdhZ_.js","./store.Z2N5eHHB.js","./entry.p5szuD2A.js","./scheduler.BRSuf-vg.js","./preload-helper.D6kgxu3v.js","./web.Cb2G5L2t.js"])))=>i.map(i=>d[i]);
import{g as l}from"./entry.p5szuD2A.js";import{_ as v}from"./preload-helper.D6kgxu3v.js";import{r as d,C as b,d as m,A as u,e as j}from"./store.Z2N5eHHB.js";import{e as y}from"./emitter.E5P-NQ8u.js";import{R as k}from"./scheduler.BRSuf-vg.js";const h=d("SocialLogin",{web:()=>v(()=>import("./web.CamTdhZ_.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>new e.SocialLoginWeb)}),w=d("SecureStoragePlugin",{web:()=>v(()=>import("./web.Cb2G5L2t.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url).then(e=>new e.SecureStoragePluginWeb)}),p=b.getPlatform(),g=p==="ios"||p==="android";async function N(){h.initialize({google:{iOSClientId:"298551622119-6r1e3ji2e6vdioqarf2pg3g6brvd47od.apps.googleusercontent.com",webClientId:"298551622119-gg1fqk381om4384l71ju7ip4857cqbh1.apps.googleusercontent.com"},apple:{}})}async function J(e){var t;if(g){const r=(await h.login({provider:"google",options:{scopes:["email","profile"],forcePrompt:!0}})).result,s=await(await fetch(`${u}/auth/social/user`,{method:"POST",body:JSON.stringify({name:r.profile.name,email:r.profile.email,picture:r.profile.imageUrl,provider:"google",keepSignin:e})})).json();if(!((t=s==null?void 0:s.data)!=null&&t.access))throw y.emit("pushSnackbar",{message:"로그인에 실패했습니다."}),Error("Failed to sign in");f(s.data.access,s.data.refresh)}else if(p==="web"){const o="298551622119-gg1fqk381om4384l71ju7ip4857cqbh1.apps.googleusercontent.com",r=`${u}/auth/oauth/google`,i="email profile",s="code",a=new URL(window.location.href);a.searchParams.set("keepSignin",e.toString());const c=a.toString(),n=new URL("https://accounts.google.com/o/oauth2/v2/auth");n.searchParams.set("response_type",s),n.searchParams.set("client_id",o),n.searchParams.set("redirect_uri",r),n.searchParams.set("scope",i),n.searchParams.set("state",c),n.searchParams.set("prompt","select_account"),location.replace(n)}else throw Error("Not supported platform")}async function D(e){var c;if(p!=="ios")return;const o=(await h.login({provider:"apple",options:{}})).result;let r=o.profile.givenName??"";o.profile.familyName&&(r+=(r?" ":"")+o.profile.familyName);let i=o.profile.email;const a=await(await fetch(`${u}/auth/social/apple`,{method:"POST",body:JSON.stringify({name:r,email:i,providerId:o.profile.user,keepSignin:e})})).json();if(!((c=a==null?void 0:a.data)!=null&&c.access))throw y.emit("pushSnackbar",{message:"로그인에 실패했습니다."}),Error("Failed to sign in");f(a.data.access,a.data.refresh)}function R(){sessionStorage.removeItem("jwt"),g&&w.clear()}function I(){try{const e=sessionStorage.getItem("jwt")||null;if(!e)throw new Error("jwt not found");if(k(m)===!0&&!window.location.pathname.startsWith("/users/sign-up/")&&!window.location.pathname.startsWith("/tp/"))return console.log("A"),l("/users/sign-up/agreement"),null;const t=S(e);if(t.exp&&Math.floor(Date.now()/1e3)>t.exp)throw j.set(!0),new Error("jwt expired");return t.sig===!1&&!window.location.pathname.startsWith("/users/sign-up")&&!window.location.pathname.startsWith("/tp")?(m.set(!0),l("/users/sign-up/agreement"),null):e}catch(e){return console.warn(e),sessionStorage.removeItem("jwt"),null}}function U(){const e=I();return e?S(e):null}function C(){const e=U();return e?BigInt(e.sub):null}function f(e,t){sessionStorage.setItem("jwt",e),g&&t&&w.set({key:"refresh",value:t})}async function W(){const e={credentials:"include"};if(g)try{const t=await w.get({key:"refresh"});if(!t.value)return!1;e.headers={Authorization:`Bearer ${t.value}`}}catch{return!1}try{const t=await fetch(`${u}/auth/token/refresh`,e);if(!t.ok)throw new Error("Failed to refresh token");const o=await t.json();return f(o.data.access,o.data.refresh),!0}catch{return!1}}async function q(e){const t=e.searchParams.get("access");if(t){f(t);const o=S(t).sig;if(e.searchParams.delete("access"),o===!1){m.set(!0),await l("/users/sign-up/agreement");return}await l(e.toString(),{replaceState:!0,invalidateAll:!1})}}function S(e){const o=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(o).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)}function x(){return I()!==null}var P;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(P||(P={}));var _;(function(e){e.Body="body",e.Ionic="ionic",e.Native="native",e.None="none"})(_||(_={}));const $=d("Keyboard");export{$ as K,C as a,J as b,D as c,N as d,I as g,q as h,x as i,W as r,R as s};
