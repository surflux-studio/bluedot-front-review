import{s as S,w as D,e as B,c as A,b as G,f as P,q as b,G as V,i as k,x as z,r as j,z as N,A as T,B as q,C as X,k as Y,o as U,l as Z,m as O}from"./scheduler.BiUHV-k5.js";import{S as R,i as F,t as W,b as H}from"./index.DaxfEsq8.js";import{a as J,m as u}from"./map.cADd4nz2.js";import{e as C,A as K}from"./units.DtuR4fdj.js";import{g as Q}from"./search.BtHXGU8E.js";import{p as $}from"./stores.BYa5jm3-.js";import{g as ee}from"./entry.aeROdYTI.js";import{s as te}from"./searchParams.Dn91dS03.js";import{a as w,f as L}from"./proj.DXH8zrwl.js";/* empty css                                          */function oe(e,r=500,l=10){let i,f,d;const a=c=>{const{clientX:h,clientY:m}=c instanceof MouseEvent?c:c.touches[0];f=h,d=m,i=setTimeout(()=>{e.dispatchEvent(new CustomEvent("longpress",{detail:c}))},r)},t=c=>{const{clientX:h,clientY:m}=c instanceof MouseEvent?c:c.touches[0],_=Math.abs(h-f),g=Math.abs(m-d);(_>l||g>l)&&clearTimeout(i)},s=()=>{clearTimeout(i)};return e.addEventListener("mousedown",a),e.addEventListener("mousemove",t),e.addEventListener("mouseup",s),e.addEventListener("mouseleave",s),e.addEventListener("touchstart",a),e.addEventListener("touchmove",t),e.addEventListener("touchend",s),e.addEventListener("touchcancel",s),{destroy(){e.removeEventListener("mousedown",a),e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",s),e.removeEventListener("mouseleave",s),e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",t),e.removeEventListener("touchend",s),e.removeEventListener("touchcancel",s)}}}function ne(e){let r,l,i,f;const d=e[5].default,a=D(d,e,e[4],null);return{c(){r=B("div"),a&&a.c(),this.h()},l(t){r=A(t,"DIV",{id:!0,class:!0});var s=G(r);a&&a.l(s),s.forEach(P),this.h()},h(){b(r,"id","map"),b(r,"class",V("absolute w-full h-full z-[1]")+" svelte-mehtzq")},m(t,s){k(t,r,s),a&&a.m(r,null),e[6](r),l=!0,i||(f=[z(oe.call(null,r,500)),j(r,"longpress",e[7])],i=!0)},p(t,[s]){a&&a.p&&(!l||s&16)&&N(a,d,t,t[4],l?q(d,t[4],s,null):T(t[4]),null)},i(t){l||(W(a,t),l=!0)},o(t){H(a,t),l=!1},d(t){t&&P(r),a&&a.d(t),e[6](null),i=!1,X(f)}}}function x(e){e.preventDefault()}function ae(e,r,l){let i;Y(e,$,o=>l(2,i=o));let{$$slots:f={},$$scope:d}=r,{onSelect:a=()=>{}}=r,{onMoveend:t=()=>{}}=r;J.refresh(),C.on("explorePlaces",c);let s;async function c(){var o;try{s&&s.abort("new request");const n=(o=window.location.search.split("tags=")[1])==null?void 0:o.split("&")[0];if(!n)return;const p=decodeURIComponent(n);if(!p)return;s=new AbortController,(await Q({tags:p,bbox:w(u.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:s})).forEach(E=>{const y={idx:E.idx,coordinate:L(E.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:"graydot.png",shape:"waterdrop",type:"place",link:`/places/${E.idx}`,rank:3,name:E.name,width:56,height:61};C.emit("addIcon",y)})}catch(n){(n==null?void 0:n.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",n)}}u.on("moveend",h);function h(){var o,n;c(),te({location:((o=u.getView().getCenter())==null?void 0:o.join(","))??"",zoom:((n=u.getView().getZoom())==null?void 0:n.toFixed(2))??""}),t(w(u.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}c();let m;U(()=>{u.setTarget(m),m.addEventListener("contextmenu",x),i.url.searchParams.has("location")&&_(),i.url.searchParams.has("placeIdx")&&g(i.url.searchParams.get("placeIdx")),t(w(u.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),Z(()=>{u.un("moveend",h),m.removeEventListener("contextmenu",x)});function _(){const o=i.url.searchParams.get("location"),n=i.url.searchParams.get("zoom"),p=o==null?void 0:o.split(",").map(Number);p&&u.getView().setCenter(p),n&&u.getView().setZoom(Number(n))}C.on("addIconByPlaceIdx",g);async function g(o){const n=await fetch(`${K}/places/${o}`).then(v=>v.json()).then(v=>v.data).catch(v=>{console.error(v)}),p={idx:n.placeIdx,coordinate:L([n.longitude,n.latitude]),image:"graydot.png",shape:"waterdrop",type:"place",link:`/places/${n.placeIdx}`,rank:5,name:n.name,width:56,height:61};C.emit("addIcon",p)}function I(o){O[o?"unshift":"push"](()=>{m=o,l(1,m)})}const M=o=>{const n=u.getEventCoordinate(o.detail);i.url.pathname!=="/map/edit"?ee(`/map/edit?location=${n[0]},${n[1]}`):a(n)};return e.$$set=o=>{"onSelect"in o&&l(0,a=o.onSelect),"onMoveend"in o&&l(3,t=o.onMoveend),"$$scope"in o&&l(4,d=o.$$scope)},[a,m,i,t,d,f,I,M]}class he extends R{constructor(r){super(),F(this,r,ae,ne,S,{onSelect:0,onMoveend:3})}}export{he as M};
