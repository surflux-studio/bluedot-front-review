import{s as G,m as k,e as z,c as Y,b as L,f as I,v as S,C as y,i as N,E as F,y as O,u as T,o as W,p as Z,F as q,k as R,w as U,B as H,z as J}from"./scheduler.DH3jNSXp.js";import{S as K,i as Q,t as X,a as $}from"./index.DhGy8j-A.js";import{s as B,m,f as ee}from"./map.B-q2c8ZE.js";import{e as C}from"./emitter.CkY1Q2mT.js";import{g as te}from"./search.DYL1vFb3.js";import{p as oe}from"./stores.Dz8aN1FY.js";import{l as ae}from"./longPress.C9F0mLoM.js";import{g as ne}from"./entry.BhCHTBrT.js";import{s as se}from"./searchParams.w9NG9FXL.js";import{a as E,f as D}from"./proj.DXH8zrwl.js";import{A as ie}from"./store.BJaWoeSk.js";import{s as x}from"./s32cloudfront.CATw5Mi_.js";import{i as re}from"./isVideoFile.DGBlGWVm.js";function le(s){let a,i,r,g;const p=s[6].default,n=k(p,s,s[5],null);return{c(){a=z("div"),n&&n.c(),this.h()},l(o){a=Y(o,"DIV",{id:!0,class:!0});var c=L(a);n&&n.l(c),c.forEach(I),this.h()},h(){S(a,"id","map"),S(a,"class","absolute w-full h-full z-[1] bg-[#BDDBF3] transition-transform duration-500"),y(a,"transform",`translateY(${s[1]}px)`)},m(o,c){N(o,a,c),n&&n.m(a,null),s[7](a),i=!0,r||(g=[F(ae.call(null,a,500)),O(a,"longpress",s[8])],r=!0)},p(o,[c]){n&&n.p&&(!i||c&32)&&T(n,p,o,o[5],i?Z(p,o[5],c,null):W(o[5]),null),c&2&&y(a,"transform",`translateY(${o[1]}px)`)},i(o){i||(X(n,o),i=!0)},o(o){$(n,o),i=!1},d(o){o&&I(a),n&&n.d(o),s[7](null),r=!1,q(g)}}}function V(s){s.preventDefault()}function ce(s,a,i){let r;R(s,oe,e=>i(3,r=e));let{$$slots:g={},$$scope:p}=a,{onSelect:n=()=>{}}=a,{onMoveend:o=()=>{}}=a,{mapY:c=0}=a;B.refresh(),C.on("explorePlaces",P);let b="",_;async function P(){var e;if(!(m.getView().getZoom()<16))try{_&&_.abort("new request");const t=(e=window.location.search.split("tags=")[1])==null?void 0:e.split("&")[0];if(!t)return;const l=decodeURIComponent(t);if(!l)return;b!==l&&(B.refresh(),b=l),_=new AbortController;const u=await te({tags:b,bbox:E(m.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:_});C.emit("addIcons",u.map(f=>({idx:f.idx,coordinate:D(f.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:x(f.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${f.idx}`,rank:3,name:f.name,width:38,height:46,onlyMain:!0})))}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}m.on("moveend",w);function w(){var e,t;P(),se({location:((e=m.getView().getCenter())==null?void 0:e.join(","))??"",zoom:((t=m.getView().getZoom())==null?void 0:t.toFixed(2))??""}),o(E(m.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}P();let h;U(()=>{m.setTarget(h),h.addEventListener("contextmenu",V),r.url.searchParams.has("location")&&M(),r.url.searchParams.has("placeIdx")&&v(r.url.searchParams.get("placeIdx")),o(E(m.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),H(()=>{m.un("moveend",w),h.removeEventListener("contextmenu",V)});function M(){const e=r.url.searchParams.get("location"),t=r.url.searchParams.get("zoom"),l=e==null?void 0:e.split(",").map(Number),u={};l&&(u.center=l),t&&(u.zoom=Number(t)),Object.values(u).length>0&&ee(u)}C.on("addIconByPlaceIdx",v);async function v(e){var f;const t=await fetch(`${ie}/places/${e}`).then(d=>d.json()).then(d=>d.data.place).catch(d=>{console.error(d)});let l=((f=t.thumbnail)==null?void 0:f.at(0))||"";if(!String(l).includes("youtu")){const d=x(l);await re(d)&&(l=l+"-thumbnail")}const u={idx:t.placeIdx,coordinate:D([t.longitude,t.latitude]),image:x(l,500)||"",shape:"point",type:"place",link:`/places/${t.placeIdx}`,rank:5,name:t.name,width:38,height:46};C.emit("addIcon",u)}function j(e){J[e?"unshift":"push"](()=>{h=e,i(2,h)})}const A=e=>{if(!r.url.pathname.startsWith("/map"))return;const t=m.getEventCoordinate(e.detail);r.url.pathname!=="/map/edit"?ne(`/map/edit?location=${t.join()}`):n(t)};return s.$$set=e=>{"onSelect"in e&&i(0,n=e.onSelect),"onMoveend"in e&&i(4,o=e.onMoveend),"mapY"in e&&i(1,c=e.mapY),"$$scope"in e&&i(5,p=e.$$scope)},[n,c,h,r,o,p,g,j,A]}class ve extends K{constructor(a){super(),Q(this,a,ce,le,G,{onSelect:0,onMoveend:4,mapY:1})}}export{ve as M};
