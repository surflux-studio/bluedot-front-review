import{s as M,w as D,e as A,c as B,b as S,f as b,m as x,i as k,x as T,r as L,z as V,A as z,B as N,u as X,k as Y,E as j,G as q,l as Z}from"./scheduler.Bw1HVZ4I.js";import{S as F,i as U,t as G,b as O}from"./index.B-tLs4nj.js";import{a as W,m as d}from"./Chip.svelte_svelte_type_style_lang.Cce-Cwhg.js";import{e as C}from"./units.DupG7vLm.js";import{g as H}from"./search.Bn55CYkR.js";import{p as J}from"./stores.DL5PQeGw.js";import{g as K}from"./entry.CvT5G2XL.js";import{s as Q}from"./searchParams.By_jWg9S.js";/* empty css                                            *//* empty css                                           */import"./heic2any.BJy9RlnX.js";/* empty css                                                    *//* empty css                                                  *//* empty css                                                     *//* empty css                                          */function R(e,a=500,i=10){let r,f,h;const s=m=>{const{clientX:v,clientY:p}=m instanceof MouseEvent?m:m.touches[0];f=v,h=p,r=setTimeout(()=>{e.dispatchEvent(new CustomEvent("longpress",{detail:m}))},a)},o=m=>{const{clientX:v,clientY:p}=m instanceof MouseEvent?m:m.touches[0],E=Math.abs(v-f),g=Math.abs(p-h);(E>i||g>i)&&clearTimeout(r)},n=()=>{clearTimeout(r)};return e.addEventListener("mousedown",s),e.addEventListener("mousemove",o),e.addEventListener("mouseup",n),e.addEventListener("mouseleave",n),e.addEventListener("touchstart",s),e.addEventListener("touchmove",o),e.addEventListener("touchend",n),e.addEventListener("touchcancel",n),{destroy(){e.removeEventListener("mousedown",s),e.removeEventListener("mousemove",o),e.removeEventListener("mouseup",n),e.removeEventListener("mouseleave",n),e.removeEventListener("touchstart",s),e.removeEventListener("touchmove",o),e.removeEventListener("touchend",n),e.removeEventListener("touchcancel",n)}}}function $(e){let a,i,r,f;const h=e[5].default,s=D(h,e,e[4],null);return{c(){a=A("div"),s&&s.c(),this.h()},l(o){a=B(o,"DIV",{id:!0,class:!0});var n=S(a);s&&s.l(n),n.forEach(b),this.h()},h(){x(a,"id","map"),x(a,"class","svelte-dxcqed")},m(o,n){k(o,a,n),s&&s.m(a,null),e[6](a),i=!0,r||(f=[T(R.call(null,a,500)),L(a,"longpress",e[7]),L(a,"touchend",e[8],{passive:!0})],r=!0)},p(o,[n]){s&&s.p&&(!i||n&16)&&V(s,h,o,o[4],i?N(h,o[4],n,null):z(o[4]),null)},i(o){i||(G(s,o),i=!0)},o(o){O(s,o),i=!1},d(o){o&&b(a),s&&s.d(o),e[6](null),r=!1,X(f)}}}function w(e){e.preventDefault()}function ee(e,a,i){let r;Y(e,J,t=>i(3,r=t));let{$$slots:f={},$$scope:h}=a,{onSelect:s=void 0}=a,o=!0;W.refresh();let n;async function m(){try{n&&n.abort("new request");const t=r.url.searchParams.get("tags");if(!t)return;n=new AbortController,(await H({tags:t,bbox:d.getView().calculateExtent().join(),abortController:n})).forEach(c=>{const u={idx:c.idx,coordinate:c.location.replace("POINT(","").replace(")","").split(" ").map(Number),image:`https://picsum.photos/112/116?random=${c.idx}`,shape:"waterdrop",type:"place",link:`/places/${c.idx}`,rank:3,name:c.name,width:56,height:61};C.emit("addIcon",u)})}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}d.on("moveend",v);function v(){m(),Q({location:d.getView().getCenter().map(t=>t.toFixed(5)).join(","),zoom:d.getView().getZoom().toFixed(2)})}m();let p;j(()=>{d.setTarget(p),p.addEventListener("contextmenu",w),r.url.searchParams.has("location")&&E(),r.url.searchParams.has("placeIdx")&&g(r.url.searchParams.get("placeIdx"))}),q(()=>{d.un("moveend",v),p.removeEventListener("contextmenu",w)});function E(){const t=r.url.searchParams.get("location"),l=r.url.searchParams.get("zoom"),c=t==null?void 0:t.split(","),u=c[0],_=c[1];u&&_&&d.getView().setCenter([Number(u),Number(_)]),l&&d.getView().setZoom(Number(l))}C.on("addIconByPlaceIdx",g);async function g(t){const l=await fetch(`https://azit.surflux.studio/places/${t}`).then(u=>u.json()).then(u=>u.data).catch(u=>{console.error(u)}),c={idx:l.placeIdx,coordinate:[l.longitude,l.latitude],image:`https://picsum.photos/112/116?random=${l.placeIdx}`,shape:"waterdrop",type:"place",link:`/places/${l.placeIdx}`,rank:5,name:l.name,width:56,height:61};C.emit("addIcon",c)}function I(t){Z[t?"unshift":"push"](()=>{p=t,i(2,p)})}const P=t=>{i(1,o=!1),d.getInteractions().forEach(u=>u.setActive(!1));const[l,c]=d.getEventCoordinate(t.detail);r.url.pathname!=="/map/edit"?K(`/map/edit?longitude=${l}&latitude=${c}`):s&&s(l,c)},y=()=>{o||d.getInteractions().forEach(t=>t.setActive(!0))};return e.$$set=t=>{"onSelect"in t&&i(0,s=t.onSelect),"$$scope"in t&&i(4,h=t.$$scope)},[s,o,p,r,h,f,I,P,y]}class ve extends F{constructor(a){super(),U(this,a,ee,$,M,{onSelect:0})}}export{ve as M};
