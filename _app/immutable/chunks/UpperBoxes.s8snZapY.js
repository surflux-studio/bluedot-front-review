import{s as J,e as k,a as V,c as $,b as x,g as B,f as p,x as g,i as y,h as b,k as ee,q as te,y as K,n as ae,t as Q,d as W,j as X,A,v as ie}from"./scheduler.B69fKoFa.js";import{S as le,i as se,t as v,g as N,a as w,f as P,c as S,b as U,m as j,d as q}from"./index.dtT_z20O.js";import{e as M,u as re,o as oe}from"./each.CwS2ZKx_.js";import{A as ne,e as fe}from"./sign.BxCoe6p8.js";import{H as Y}from"./HexImage.S2t3i2Ck.js";import{a as ce}from"./map.wfdUmv8d.js";import{f as de}from"./location.DNK-si5X.js";import{s as C}from"./s32cloudfront.BwHITURH.js";import{s as ue}from"./searchParams.CxTvUzzR.js";import{p as he}from"./stores.B0I4f_9d.js";import{B as Z}from"./Button.fc5_LK6J.js";function T(r,e,t){const i=r.slice();return i[12]=e[t],i[14]=t,i}function F(r){let e,t,i=r[3].image,s,a,n,l,f,h=G(r);return a=new Z({props:{className:"w-20 shadow-md",padding:"p-1",backgroundColor:"bg-white",border:"",typo:"typo-caption2",$$slots:{default:[me]},$$scope:{ctx:r}}}),{c(){e=k("div"),t=k("div"),h.c(),s=V(),S(a.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0,"aria-hidden":!0});var c=x(e);t=$(c,"DIV",{class:!0});var _=x(t);h.l(_),_.forEach(p),s=B(c),U(a.$$.fragment,c),c.forEach(p),this.h()},h(){g(t,"class","w-20 h-20 relative"),g(e,"class","flex-shrink-0 flex flex-col items-center space-y-1"),g(e,"aria-hidden","")},m(o,c){y(o,e,c),b(e,t),h.m(t,null),b(e,s),j(a,e,null),n=!0,l||(f=K(e,"click",r[5]),l=!0)},p(o,c){c&8&&J(i,i=o[3].image)?(N(),w(h,1,1,ae),P(),h=G(o),h.c(),v(h,1),h.m(t,null)):h.p(o,c);const _={};c&32776&&(_.$$scope={dirty:c,ctx:o}),a.$set(_)},i(o){n||(v(h),v(a.$$.fragment,o),n=!0)},o(o){w(h),w(a.$$.fragment,o),n=!1},d(o){o&&p(e),h.d(o),q(a),l=!1,f()}}}function G(r){let e,t;return e=new Y({props:{src:r[3].image?C(r[3].image,500):void 0,width:150,height:150,onBorder:!0}}),{c(){S(e.$$.fragment)},l(i){U(e.$$.fragment,i)},m(i,s){j(e,i,s),t=!0},p(i,s){const a={};s&8&&(a.src=i[3].image?C(i[3].image,500):void 0),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){q(e,i)}}}function me(r){let e,t,i=r[3].name+"",s,a;return{c(){e=k("div"),t=k("a"),s=Q(i),this.h()},l(n){e=$(n,"DIV",{class:!0});var l=x(e);t=$(l,"A",{class:!0,href:!0});var f=x(t);s=W(f,i),f.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","text-gray-700"),g(t,"href",a=`/boxes/${r[3].idx}`),g(e,"class","line-clamp-2 break-words w-16")},m(n,l){y(n,e,l),b(e,t),b(t,s)},p(n,l){l&8&&i!==(i=n[3].name+"")&&X(s,i),l&8&&a!==(a=`/boxes/${n[3].idx}`)&&g(t,"href",a)},d(n){n&&p(e)}}}function O(r){let e,t,i,s,a,n,l,f,h;i=new Y({props:{src:r[12].image?C(r[12].image,500):void 0,width:150,height:150}}),a=new Z({props:{className:"w-20 shadow-md",padding:"p-1",backgroundColor:"bg-white",border:"",typo:"typo-caption2",$$slots:{default:[_e]},$$scope:{ctx:r}}});function o(){return r[6](r[12])}return{c(){e=k("div"),t=k("div"),S(i.$$.fragment),s=V(),S(a.$$.fragment),n=V(),this.h()},l(c){e=$(c,"DIV",{class:!0,"aria-hidden":!0});var _=x(e);t=$(_,"DIV",{class:!0});var d=x(t);U(i.$$.fragment,d),d.forEach(p),s=B(_),U(a.$$.fragment,_),n=B(_),_.forEach(p),this.h()},h(){g(t,"class","w-20 h-20 relative"),g(e,"class","flex-shrink-0 flex flex-col items-center space-y-1"),g(e,"aria-hidden","")},m(c,_){y(c,e,_),b(e,t),j(i,t,null),b(e,s),j(a,e,null),b(e,n),l=!0,f||(h=K(e,"click",o),f=!0)},p(c,_){r=c;const d={};_&2&&(d.src=r[12].image?C(r[12].image,500):void 0),i.$set(d);const m={};_&32770&&(m.$$scope={dirty:_,ctx:r}),a.$set(m)},i(c){l||(v(i.$$.fragment,c),v(a.$$.fragment,c),l=!0)},o(c){w(i.$$.fragment,c),w(a.$$.fragment,c),l=!1},d(c){c&&p(e),q(i),q(a),f=!1,h()}}}function _e(r){let e,t,i=r[12].name+"",s,a;return{c(){e=k("div"),t=k("a"),s=Q(i),this.h()},l(n){e=$(n,"DIV",{class:!0});var l=x(e);t=$(l,"A",{class:!0,href:!0});var f=x(t);s=W(f,i),f.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","text-gray-700"),g(t,"href",a=`/boxes/${r[12].idx}`),g(e,"class","line-clamp-2 break-words w-16")},m(n,l){y(n,e,l),b(e,t),b(t,s)},p(n,l){l&2&&i!==(i=n[12].name+"")&&X(s,i),l&2&&a!==(a=`/boxes/${n[12].idx}`)&&g(t,"href",a)},d(n){n&&p(e)}}}function R(r,e){var n;let t,i,s,a=e[12].idx!==((n=e[3])==null?void 0:n.idx)&&O(e);return{key:r,first:null,c(){t=A(),a&&a.c(),i=A(),this.h()},l(l){t=A(),a&&a.l(l),i=A(),this.h()},h(){this.first=t},m(l,f){y(l,t,f),a&&a.m(l,f),y(l,i,f),s=!0},p(l,f){var h;e=l,e[12].idx!==((h=e[3])==null?void 0:h.idx)?a?(a.p(e,f),f&10&&v(a,1)):(a=O(e),a.c(),v(a,1),a.m(i.parentNode,i)):a&&(N(),w(a,1,1,()=>{a=null}),P())},i(l){s||(v(a),s=!0)},o(l){w(a),s=!1},d(l){l&&(p(t),p(i)),a&&a.d(l)}}}function pe(r){let e,t,i,s=[],a=new Map,n,l,f,h,o=r[3]&&F(r),c=M(r[1]);const _=d=>d[12].idx;for(let d=0;d<c.length;d+=1){let m=T(r,c,d),u=_(m);a.set(u,s[d]=R(u,m))}return{c(){e=k("div"),t=k("div"),o&&o.c(),i=V();for(let d=0;d<s.length;d+=1)s[d].c();n=V(),l=k("div"),this.h()},l(d){e=$(d,"DIV",{class:!0});var m=x(e);t=$(m,"DIV",{class:!0});var u=x(t);o&&o.l(u),i=B(u);for(let I=0;I<s.length;I+=1)s[I].l(u);n=B(u),l=$(u,"DIV",{class:!0}),x(l).forEach(p),u.forEach(p),m.forEach(p),this.h()},h(){g(l,"class","flex-shrink-0 w-1"),g(t,"class","flex space-x-3"),g(e,"class",f=`relative ${r[0]} left-0 overflow-x-auto p-4 z-20 scrollbar-hidden scrollbar-hidden::-webkit-scrollbar`)},m(d,m){y(d,e,m),b(e,t),o&&o.m(t,null),b(t,i);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null);b(t,n),b(t,l),r[7](e),h=!0},p(d,[m]){d[3]?o?(o.p(d,m),m&8&&v(o,1)):(o=F(d),o.c(),v(o,1),o.m(t,i)):o&&(N(),w(o,1,1,()=>{o=null}),P()),m&14&&(c=M(d[1]),N(),s=re(s,m,_,1,d,c,a,t,oe,R,n,T),P()),(!h||m&1&&f!==(f=`relative ${d[0]} left-0 overflow-x-auto p-4 z-20 scrollbar-hidden scrollbar-hidden::-webkit-scrollbar`))&&g(e,"class",f)},i(d){if(!h){v(o);for(let m=0;m<c.length;m+=1)v(s[m]);h=!0}},o(d){w(o);for(let m=0;m<s.length;m+=1)w(s[m]);h=!1},d(d){d&&p(e),o&&o.d();for(let m=0;m<s.length;m+=1)s[m].d();r[7](null)}}}function ge(r,e,t){let i;ee(r,he,u=>t(9,i=u));let{top:s="top-4"}=e,{boxes:a}=e,{onBoxClick:n=u=>o(u)}=e,l=i.url.searchParams.get("box"),f,h=null;te(()=>{l&&(o(l),l=null)});async function o(u){const I=a.find(D=>D.idx===u);if(!I)return;if(ce.clear(),f&&f.idx===I.idx)return t(3,f=null);t(3,f=I),c();const z=f.idx;fetch(`${ne}/boxes/${z}/places`).then(D=>D.json()).then(D=>{const H=D.data;H&&fe.emit("addIcons",H.map(E=>{var L;return{idx:Number(E.idx),coordinate:de([E.longitude,E.latitude]),image:C(((L=E.media)==null?void 0:L.at(0))??"",500),shape:"waterdrop",type:"place",link:`/places/${E.idx}?boxIdx=${z}`,rank:1,name:E.name,width:56,height:61}}))})}function c(){h&&h.scrollTo({top:0,left:0,behavior:"smooth"})}const _=()=>(f==null?void 0:f.idx)&&n(f.idx),d=u=>n(u.idx);function m(u){ie[u?"unshift":"push"](()=>{h=u,t(4,h)})}return r.$$set=u=>{"top"in u&&t(0,s=u.top),"boxes"in u&&t(1,a=u.boxes),"onBoxClick"in u&&t(2,n=u.onBoxClick)},r.$$.update=()=>{r.$$.dirty&8&&f!==void 0&&ue({box:(f==null?void 0:f.idx)??""},{replaceState:!0})},[s,a,n,f,h,_,d,m]}class Be extends le{constructor(e){super(),se(this,e,ge,pe,J,{top:0,boxes:1,onBoxClick:2})}}export{Be as U};
