import{s as T,e as k,a as V,c as $,b as w,g as C,f as p,q as g,i as y,h as b,k as Z,A as ee,v as J,n as te,t as K,d as Q,j as W,F as A,C as ae}from"./scheduler.CAgUjVVh.js";import{S as ie,i as le,t as v,g as N,a as x,f as S,c as P,b as U,m as j,d as q}from"./index.BArRcuOw.js";import{e as H,u as re,o as se}from"./each.BJdzMYS8.js";import{A as oe,e as ne}from"./sign.JfFJkM-s.js";import{H as X}from"./HexImage.CS0q2e_i.js";import{a as fe}from"./map.K4JlK3Cy.js";import{f as ce}from"./location.JsrCbEaa.js";import{s as B}from"./s32cloudfront.C6wsuqzs.js";import{s as de}from"./searchParams.CKdA0nNl.js";import{p as ue}from"./stores.-zZ4hlSI.js";import{B as Y}from"./Button.zBe_-iWB.js";function L(s,e,t){const i=s.slice();return i[12]=e[t],i[14]=t,i}function M(s){let e,t,i=s[3].image,r,a,n,l,f,h=G(s);return a=new Y({props:{className:"w-20 shadow-md",padding:"p-1",backgroundColor:"bg-white",border:"",typo:"typo-caption2",$$slots:{default:[he]},$$scope:{ctx:s}}}),{c(){e=k("div"),t=k("div"),h.c(),r=V(),P(a.$$.fragment),this.h()},l(o){e=$(o,"DIV",{class:!0,"aria-hidden":!0});var c=w(e);t=$(c,"DIV",{class:!0});var _=w(t);h.l(_),_.forEach(p),r=C(c),U(a.$$.fragment,c),c.forEach(p),this.h()},h(){g(t,"class","w-20 h-20 relative"),g(e,"class","flex-shrink-0 flex flex-col items-center space-y-1"),g(e,"aria-hidden","")},m(o,c){y(o,e,c),b(e,t),h.m(t,null),b(e,r),j(a,e,null),n=!0,l||(f=J(e,"click",s[5]),l=!0)},p(o,c){c&8&&T(i,i=o[3].image)?(N(),x(h,1,1,te),S(),h=G(o),h.c(),v(h,1),h.m(t,null)):h.p(o,c);const _={};c&32776&&(_.$$scope={dirty:c,ctx:o}),a.$set(_)},i(o){n||(v(h),v(a.$$.fragment,o),n=!0)},o(o){x(h),x(a.$$.fragment,o),n=!1},d(o){o&&p(e),h.d(o),q(a),l=!1,f()}}}function G(s){let e,t;return e=new X({props:{src:s[3].image?B(s[3].image,500):void 0,width:150,height:150,onBorder:!0}}),{c(){P(e.$$.fragment)},l(i){U(e.$$.fragment,i)},m(i,r){j(e,i,r),t=!0},p(i,r){const a={};r&8&&(a.src=i[3].image?B(i[3].image,500):void 0),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){x(e.$$.fragment,i),t=!1},d(i){q(e,i)}}}function he(s){let e,t,i=s[3].name+"",r,a;return{c(){e=k("div"),t=k("a"),r=K(i),this.h()},l(n){e=$(n,"DIV",{class:!0});var l=w(e);t=$(l,"A",{class:!0,href:!0});var f=w(t);r=Q(f,i),f.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","text-gray-700"),g(t,"href",a=`/boxes/${s[3].idx}`),g(e,"class","line-clamp-2 break-words w-16")},m(n,l){y(n,e,l),b(e,t),b(t,r)},p(n,l){l&8&&i!==(i=n[3].name+"")&&W(r,i),l&8&&a!==(a=`/boxes/${n[3].idx}`)&&g(t,"href",a)},d(n){n&&p(e)}}}function O(s){let e,t,i,r,a,n,l,f,h;i=new X({props:{src:s[12].image?B(s[12].image,500):void 0,width:150,height:150}}),a=new Y({props:{className:"w-20 shadow-md",padding:"p-1",backgroundColor:"bg-white",border:"",typo:"typo-caption2",$$slots:{default:[me]},$$scope:{ctx:s}}});function o(){return s[6](s[12])}return{c(){e=k("div"),t=k("div"),P(i.$$.fragment),r=V(),P(a.$$.fragment),n=V(),this.h()},l(c){e=$(c,"DIV",{class:!0,"aria-hidden":!0});var _=w(e);t=$(_,"DIV",{class:!0});var d=w(t);U(i.$$.fragment,d),d.forEach(p),r=C(_),U(a.$$.fragment,_),n=C(_),_.forEach(p),this.h()},h(){g(t,"class","w-20 h-20 relative"),g(e,"class","flex-shrink-0 flex flex-col items-center space-y-1"),g(e,"aria-hidden","")},m(c,_){y(c,e,_),b(e,t),j(i,t,null),b(e,r),j(a,e,null),b(e,n),l=!0,f||(h=J(e,"click",o),f=!0)},p(c,_){s=c;const d={};_&2&&(d.src=s[12].image?B(s[12].image,500):void 0),i.$set(d);const m={};_&32770&&(m.$$scope={dirty:_,ctx:s}),a.$set(m)},i(c){l||(v(i.$$.fragment,c),v(a.$$.fragment,c),l=!0)},o(c){x(i.$$.fragment,c),x(a.$$.fragment,c),l=!1},d(c){c&&p(e),q(i),q(a),f=!1,h()}}}function me(s){let e,t,i=s[12].name+"",r,a;return{c(){e=k("div"),t=k("a"),r=K(i),this.h()},l(n){e=$(n,"DIV",{class:!0});var l=w(e);t=$(l,"A",{class:!0,href:!0});var f=w(t);r=Q(f,i),f.forEach(p),l.forEach(p),this.h()},h(){g(t,"class","text-gray-700"),g(t,"href",a=`/boxes/${s[12].idx}`),g(e,"class","line-clamp-2 break-words w-16")},m(n,l){y(n,e,l),b(e,t),b(t,r)},p(n,l){l&2&&i!==(i=n[12].name+"")&&W(r,i),l&2&&a!==(a=`/boxes/${n[12].idx}`)&&g(t,"href",a)},d(n){n&&p(e)}}}function R(s,e){var n;let t,i,r,a=e[12].idx!==((n=e[3])==null?void 0:n.idx)&&O(e);return{key:s,first:null,c(){t=A(),a&&a.c(),i=A(),this.h()},l(l){t=A(),a&&a.l(l),i=A(),this.h()},h(){this.first=t},m(l,f){y(l,t,f),a&&a.m(l,f),y(l,i,f),r=!0},p(l,f){var h;e=l,e[12].idx!==((h=e[3])==null?void 0:h.idx)?a?(a.p(e,f),f&10&&v(a,1)):(a=O(e),a.c(),v(a,1),a.m(i.parentNode,i)):a&&(N(),x(a,1,1,()=>{a=null}),S())},i(l){r||(v(a),r=!0)},o(l){x(a),r=!1},d(l){l&&(p(t),p(i)),a&&a.d(l)}}}function _e(s){let e,t,i,r=[],a=new Map,n,l,f,h,o=s[3]&&M(s),c=H(s[1]);const _=d=>d[12].idx;for(let d=0;d<c.length;d+=1){let m=L(s,c,d),u=_(m);a.set(u,r[d]=R(u,m))}return{c(){e=k("div"),t=k("div"),o&&o.c(),i=V();for(let d=0;d<r.length;d+=1)r[d].c();n=V(),l=k("div"),this.h()},l(d){e=$(d,"DIV",{class:!0});var m=w(e);t=$(m,"DIV",{class:!0});var u=w(t);o&&o.l(u),i=C(u);for(let I=0;I<r.length;I+=1)r[I].l(u);n=C(u),l=$(u,"DIV",{class:!0}),w(l).forEach(p),u.forEach(p),m.forEach(p),this.h()},h(){g(l,"class","flex-shrink-0 w-1"),g(t,"class","flex space-x-3"),g(e,"class",f=`relative ${s[0]} left-0 overflow-x-auto p-4 z-20 scrollbar-hidden scrollbar-hidden::-webkit-scrollbar`)},m(d,m){y(d,e,m),b(e,t),o&&o.m(t,null),b(t,i);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(t,null);b(t,n),b(t,l),s[7](e),h=!0},p(d,[m]){d[3]?o?(o.p(d,m),m&8&&v(o,1)):(o=M(d),o.c(),v(o,1),o.m(t,i)):o&&(N(),x(o,1,1,()=>{o=null}),S()),m&14&&(c=H(d[1]),N(),r=re(r,m,_,1,d,c,a,t,se,R,n,L),S()),(!h||m&1&&f!==(f=`relative ${d[0]} left-0 overflow-x-auto p-4 z-20 scrollbar-hidden scrollbar-hidden::-webkit-scrollbar`))&&g(e,"class",f)},i(d){if(!h){v(o);for(let m=0;m<c.length;m+=1)v(r[m]);h=!0}},o(d){x(o);for(let m=0;m<r.length;m+=1)x(r[m]);h=!1},d(d){d&&p(e),o&&o.d();for(let m=0;m<r.length;m+=1)r[m].d();s[7](null)}}}function pe(s,e,t){let i;Z(s,ue,u=>t(9,i=u));let{top:r="top-4"}=e,{boxes:a}=e,{onBoxClick:n=u=>o(u)}=e,l=i.url.searchParams.get("box"),f,h=null;ee(()=>{l&&(o(l),l=null)});async function o(u){const I=a.find(D=>D.idx===u);if(I){if(fe.clear(),f&&f.idx===I.idx)return t(3,f=null);t(3,f=I),c(),fetch(`${oe}/boxes/${f.idx}/places`).then(D=>D.json()).then(D=>{const z=D.data;z&&ne.emit("addIcons",z.map(E=>{var F;return{idx:Number(E.idx),coordinate:ce([E.longitude,E.latitude]),image:B(((F=E.media)==null?void 0:F.at(0))??"",500),shape:"waterdrop",type:"place",link:`/places/${E.idx}`,rank:1,name:E.name,width:56,height:61}}))})}}function c(){h&&h.scrollTo({top:0,left:0,behavior:"smooth"})}const _=()=>(f==null?void 0:f.idx)&&n(f.idx),d=u=>n(u.idx);function m(u){ae[u?"unshift":"push"](()=>{h=u,t(4,h)})}return s.$$set=u=>{"top"in u&&t(0,r=u.top),"boxes"in u&&t(1,a=u.boxes),"onBoxClick"in u&&t(2,n=u.onBoxClick)},s.$$.update=()=>{s.$$.dirty&8&&f!==void 0&&de({box:(f==null?void 0:f.idx)??""},{replaceState:!0})},[r,a,n,f,h,_,d,m]}class Ve extends ie{constructor(e){super(),le(this,e,pe,_e,T,{top:0,boxes:1,onBoxClick:2})}}export{Ve as U};
