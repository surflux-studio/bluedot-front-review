import{s as Q,e as ee,c as te,z as he,v as p,i as z,n as L,f as k,y as ne,B as ge,a as $,q as I,V as xe,g as J,r as O,b as V,W as Ee,C as K,h as B,w as pe,m as Ce,u as we,o as ye,p as _e,k as Pe}from"./scheduler.B7IswjaW.js";import{S as oe,i as ie,c as ae,d as le,m as ce,t as Z,a as q,f as ue}from"./index.Bhf26fYQ.js";import{c as be,m as E,O as ke,s as fe,f as Se}from"./map.DQzBw1dU.js";import{A as ve,e as H,b as je}from"./store.DeGgwmPs.js";import{e as Me}from"./search.Bytrf1Jl.js";import{p as De}from"./stores.BcGzWerh.js";import"./entry.DgabBo5R.js";import{s as Ve}from"./searchParams.D52gxAUe.js";import{f as A,c as W,a as U}from"./proj.De7y6nwv.js";import{s as X}from"./s32cloudfront.DAw3mjFI.js";import{i as Ie}from"./isVideoFile.DGBlGWVm.js";/* empty css                                                     */import"./index.D3R6QwRr.js";function Oe(c){let e,u="<div></div>";return{c(){e=ee("div"),e.innerHTML=u,this.h()},l(i){e=te(i,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),he(e)!=="svelte-1ubcv6w"&&(e.innerHTML=u),this.h()},h(){p(e,"id","push-test-data"),p(e,"class","absolute bottom-24 left-4 z-20 flex flex-col w-32 gap-4")},m(i,r){z(i,e,r)},p:L,i:L,o:L,d(i){i&&k(e)}}}let Be=50;function G(c,e){return c+Math.floor(Math.random()*(e+1-c))}function Te(c=0){const e=document.createElement("div");return e.innerHTML=`<img class="rounded-avatar2" />
    <svg class="spining-emoji" viewBox="0 0 100 100">
      <defs>
        <filter id="shadow-${c}">
          <feDropShadow
            dx="2"
            dy="2"
            stdDeviation="3"
            flood-color="#000000"
            flood-opacity="0.14"
          />
        </filter>
      </defs>
      <path
        id="text-path"
        d="M 50,50 m -30,0 a 30,30 0 1,1 60,0 a 30,30 0 1,1 -60,0"
        fill="none"
      />
      <text font-size="12" dy="-3" letter-spacing="10" filter="url(#shadow-${c})">
        <textPath href="#text-path" startOffset="0">
        </textPath>
      </text>
    </svg>
    `,e}function de(c,e){const u=c.getElement();if(!u)return;const i=u.querySelector("img");i&&i.setAttribute("src",e.image);const r=u.querySelector("textPath");r&&(r.innerHTML=e.emojis),u.className=`effective-element2 ${e.size}`}function ze(c){const e=["dosisool.jpg","eul.jpg","face1.jpeg","face2.jpeg","face3.jpeg","j.jpg","oilh.jpg","signin.png","thumb1.jpeg","thumb2.jpeg","thumb3.jpeg","thumb4.jpeg","thumb5.jpeg"],u=e.length,i=be(),r={},l=[];function x(){for(let m=0;m<Be;m++)a(m)}A([126.97685,37.578019]);const C=[[128513,128591],[9986,10160],[128640,128704],[128512,128566],[128641,128709],[127757,128359]];function f(){const m=C[G(0,C.length-1)];return`&#${G(m[0],m[1])};`}function n(){let m="";const g=G(1,8);for(let h=0;h<g;h++)m+=f();return m}const d=["w-[160px] h-[160px]","w-[100px] h-[100px]"];function a(m,g){const h=new ke({id:m,element:Te(m),stopEvent:!1,positioning:"center-center",position:g});E.addOverlay(h),l.push(h)}x(),ne(()=>{E.on("moveend",()=>{const m=E.getView().getZoom();if(!m)return;const g=E.getView().calculateExtent(E.getSize());l.forEach(w=>w.set("uncheck",!0));const h=[],j=Math.ceil(m);i.forEachTileCoord(g,j,w=>{let S=!0;const t=i.getTileCoordExtent(w);l.filter(s=>{const o=s.getPosition();return o?W(t,o):!1}).sort((s,o)=>(o.get("point")??0)-(s.get("point")??1)).forEach((s,o)=>{o===0?(s.set("uncheck",!1),S=!1):(s.set("idx",void 0),s.setPosition(void 0))}),S&&h.push(w)}),h.forEach(w=>{const S=i.getTileCoordExtent(w),[t,s,o]=w;if(!r[t])r[t]={[s]:{[o]:[]}};else if(!r[t][s])r[t][s]={[o]:[]};else if(!r[t][s][o])r[t][s][o]=[];else{const v=r[t][s][o].filter(b=>{const D=l.find(_=>_.get("idx")===b.point.idx);return D?(D.set("uncheck",!1),!1):!0}),M=l.filter(b=>b.get("uncheck")),y=l.filter(b=>!b.get("uncheck"));v.forEach((b,D)=>{const _=M[D];if(!_)return;const{idx:F,longitude:N,latitude:Y}=b.point,R=A([N,Y]);P(R,y)||(y.push(_),_.setPosition(R),_.set("idx",F),_.set("uncheck",!1),_.set("point",1/t),de(_,b))}),l.forEach(b=>{if(b.get("uncheck")!==!0)return;const D=b.getPosition();D&&W(S,D)&&(b.set("idx",void 0),b.set("uncheck",!1),b.setPosition(void 0))});return}fetch(`${ve}/places/${t}/${s}/${o}`).then(v=>v.json()).then(v=>{const M=v.data,y=[],b=l.filter(_=>_.get("uncheck")),D=l.filter(_=>!_.get("uncheck"));M.forEach((_,F)=>{const N=e[G(0,u-1)],Y=d[G(0,d.length-1)],R=n(),se={point:_,image:N,size:Y,emojis:R};y.push(se);const T=b[F];if(!T)return;const re=A([_.longitude,_.latitude]);P(re,D)||(D.push(T),T.setPosition(re),T.set("idx",_.idx),T.set("uncheck",!1),T.set("point",1/t),de(T,se))}),r[t][s][o]=y}).catch(v=>console.error(v)).finally(()=>{l.forEach(v=>{if(v.get("uncheck")!==!0)return;const M=v.getPosition();M&&W(S,M)&&(v.set("idx",void 0),v.set("uncheck",!1),v.setPosition(void 0))})})})})});function P(m,g,h=226){const j=E.getPixelFromCoordinate(m);return g.some(w=>{const S=w.getPosition();if(!S)return!1;const t=E.getPixelFromCoordinate(S),s=j[0]-t[0],o=j[1]-t[1];return Math.sqrt(s*s+o*o)<h})}return ge(()=>{}),[]}class Ge extends oe{constructor(e){super(),ie(this,e,ze,Oe,Q,{})}}function Le(c){let e,u="",i,r,l,x,C,f,n,d,a,P,m;return{c(){e=ee("div"),e.innerHTML=u,i=$(),r=I("svg"),l=I("defs"),x=I("filter"),C=I("feGaussianBlur"),f=I("feColorMatrix"),n=I("feComposite"),d=I("mask"),a=I("rect"),P=I("g"),m=new xe(!0),this.h()},l(g){e=te(g,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),he(e)!=="svelte-1yoogyr"&&(e.innerHTML=u),i=J(g),r=O(g,"svg",{width:!0,height:!0,style:!0});var h=V(r);l=O(h,"defs",{});var j=V(l);x=O(j,"filter",{id:!0});var w=V(x);C=O(w,"feGaussianBlur",{in:!0,stdDeviation:!0,result:!0}),V(C).forEach(k),f=O(w,"feColorMatrix",{in:!0,mode:!0,values:!0,result:!0}),V(f).forEach(k),n=O(w,"feComposite",{in:!0,in2:!0,operator:!0}),V(n).forEach(k),w.forEach(k),d=O(j,"mask",{id:!0});var S=V(d);a=O(S,"rect",{width:!0,height:!0,fill:!0}),V(a).forEach(k),P=O(S,"g",{filter:!0,fill:!0});var t=V(P);m=Ee(t,!0),t.forEach(k),S.forEach(k),j.forEach(k),h.forEach(k),this.h()},h(){p(e,"id","scratch-layer"),p(e,"class","svelte-1zft9l"),p(C,"in","SourceGraphic"),p(C,"stdDeviation",Re),p(C,"result","blur"),p(f,"in","blur"),p(f,"mode","matrix"),p(f,"values",He),p(f,"result","goo"),p(n,"in","SourceGraphic"),p(n,"in2","goo"),p(n,"operator","atop"),p(x,"id","gooey-filter"),p(a,"width","100%"),p(a,"height","100%"),p(a,"fill","white"),m.a=null,p(P,"filter","url(#gooey-filter)"),p(P,"fill","black"),p(d,"id","scratch-mask"),p(r,"width","100%"),p(r,"height","100%"),K(r,"position","absolute")},m(g,h){z(g,e,h),c[2](e),z(g,i,h),z(g,r,h),B(r,l),B(l,x),B(x,C),B(x,f),B(x,n),B(l,d),B(d,a),B(d,P),m.m(c[1],P)},p(g,[h]){h&2&&m.p(g[1])},i:L,o:L,d(g){g&&(k(e),k(i),k(r)),c[2](null)}}}let Ae=30;const Re=5,He="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7";function Fe(c,e,u){let i=[],r,l=0,x="";const C=a=>a<=3.5?16*13836.580104754194:a<=5?16*4891.96981025128:a<=6.5?16*1729.5725130942742:a<=8?16*611.49622628141:a<=9.5?16*216.19656413678427:a<=11?16*76.43702828517625:a<=12.5?16*27.024570517098034:a<=13.94?16*9.960373105967577:100*.5971642834779395;ne(()=>{E.on("click",function(a){i.push(a.coordinate),n()}),E.on("postrender",f)});function f(){const a=performance.now();a-l<Ae||(l=a,n(),console.log(`스크래치 시간: ${performance.now()-a} milliseconds.`))}function n(){const a=E.getView().getResolution(),P=E.getView().getZoom()??20,g=C(P)/(a??1);u(1,x=i.map(h=>{const[j,w]=E.getPixelFromCoordinate(h);return`<circle cx="${j}" cy="${w}" r="${g}" fill="black"/>`}).join(`
`))}function d(a){pe[a?"unshift":"push"](()=>{r=a,u(0,r)})}return[r,x,d]}class Ne extends oe{constructor(e){super(),ie(this,e,Fe,Le,Q,{})}}function Ye(c){let e,u,i,r,l,x;const C=c[7].default,f=Ce(C,c,c[6],null);return i=new Ne({}),l=new Ge({}),{c(){e=ee("div"),f&&f.c(),u=$(),ae(i.$$.fragment),r=$(),ae(l.$$.fragment),this.h()},l(n){e=te(n,"DIV",{id:!0,class:!0});var d=V(e);f&&f.l(d),d.forEach(k),u=J(n),le(i.$$.fragment,n),r=J(n),le(l.$$.fragment,n),this.h()},h(){p(e,"id","map"),p(e,"class","absolute w-full h-full z-[1] bg-[#BDDBF3] transition-transform duration-500"),K(e,"transform",`translateY(${c[0]}px)`)},m(n,d){z(n,e,d),f&&f.m(e,null),c[8](e),z(n,u,d),ce(i,n,d),z(n,r,d),ce(l,n,d),x=!0},p(n,[d]){f&&f.p&&(!x||d&64)&&we(f,C,n,n[6],x?_e(C,n[6],d,null):ye(n[6]),null),d&1&&K(e,"transform",`translateY(${n[0]}px)`)},i(n){x||(Z(f,n),Z(i.$$.fragment,n),Z(l.$$.fragment,n),x=!0)},o(n){q(f,n),q(i.$$.fragment,n),q(l.$$.fragment,n),x=!1},d(n){n&&(k(e),k(u),k(r)),f&&f.d(n),c[8](null),ue(i,n),ue(l,n)}}}function me(c){c.preventDefault()}function Ze(c,e,u){let i;Pe(c,De,t=>u(12,i=t));let{$$slots:r={},$$scope:l}=e,{onSelect:x=()=>{}}=e,{onMoveend:C=()=>{}}=e,{mapY:f=0}=e,{allowEdit:n=!0}=e,{whenCancelEdit:d=()=>{}}=e;fe.refresh(),H.on("explorePlaces",m);let a="",P;async function m(){var s;const t=E.getView().getZoom();if(!(!t||t<16))try{P&&P.abort("new request");const o=(s=window.location.search.split("tags=")[1])==null?void 0:s.split("&")[0];if(!o)return;const v=decodeURIComponent(o);if(!v)return;a!==v&&(fe.refresh(),a=v),P=new AbortController;const M=await Me({tags:a,bbox:U(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:P});H.emit("addIcons",M.map(y=>({idx:y.idx,coordinate:A(y.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:X(y.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${y.idx}`,rank:3,name:y.name,width:38,height:46,onlyMain:!0})))}catch(o){(o==null?void 0:o.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",o)}}E.on("moveend",g);function g(){var t,s,o;m(),(t=E.getView().getZoom())==null||t.toFixed(2),Ve({location:((s=E.getView().getCenter())==null?void 0:s.join(","))??"",zoom:((o=E.getView().getZoom())==null?void 0:o.toFixed(2))??""}),C(U(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}m();let h;ne(()=>{E.setTarget(h),h.addEventListener("contextmenu",me),i.url.searchParams.has("location")&&j(),i.url.searchParams.has("placeIdx")&&w(i.url.searchParams.get("placeIdx")),C(U(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),ge(()=>{E.un("moveend",g),h.removeEventListener("contextmenu",me)});function j(){const t=i.url.searchParams.get("location"),s=i.url.searchParams.get("zoom"),o=t==null?void 0:t.split(",").map(Number),v={};o&&(v.center=o),s&&(v.zoom=Number(s)),Object.values(v).length>0&&Se(v)}H.on("addIconByPlaceIdx",w);async function w(t){var M;const s=await fetch(`${ve}/places/${t}`,{headers:{"x-api-version":je.PLACE}}).then(y=>y.json()).then(y=>y.data.place).catch(y=>{console.error(y)});let o=((M=s.thumbnail)==null?void 0:M.at(0))||"";if(!String(o).includes("youtu")){const y=X(o);await Ie(y)&&(o=o+"-thumbnail")}const v={idx:s.placeIdx,coordinate:A([s.longitude,s.latitude]),image:X(o,500)||"",shape:"point",type:"place",link:`/places/${s.placeIdx}`,rank:5,name:s.name,width:38,height:46};H.emit("addIcon",v)}function S(t){pe[t?"unshift":"push"](()=>{h=t,u(1,h)})}return c.$$set=t=>{"onSelect"in t&&u(2,x=t.onSelect),"onMoveend"in t&&u(3,C=t.onMoveend),"mapY"in t&&u(0,f=t.mapY),"allowEdit"in t&&u(4,n=t.allowEdit),"whenCancelEdit"in t&&u(5,d=t.whenCancelEdit),"$$scope"in t&&u(6,l=t.$$scope)},[f,h,x,C,n,d,l,r,S]}class st extends oe{constructor(e){super(),ie(this,e,Ze,Ye,Q,{onSelect:2,onMoveend:3,mapY:0,allowEdit:4,whenCancelEdit:5})}}export{st as M};
