import{s as W,e as A,a as T,q as D,M as te,c as j,z as J,g as L,r as k,b as y,f as C,N as oe,v as i,C as O,i as V,h as S,n as Y,y as K,w as Q,m as ae,t as ne,d as ie,A as se,u as re,o as le,p as ce,j as ue,k as me,B as fe}from"./scheduler.CXaZJLX8.js";import{S as X,i as $,c as de,d as he,m as pe,t as F,a as H,f as ge}from"./index.BKOkOgp0.js";import{m as E,s as Z,f as Ce}from"./map.v3_wi2J3.js";import{e as z,A as _e,b as be}from"./store.CtZL0UI5.js";import{g as ve}from"./search.BSObYn07.js";import{p as we}from"./stores.BJknIGr-.js";import"./entry.BD7G42uW.js";import{s as Ee}from"./searchParams.BrUWBFqd.js";import{a as N,f as q}from"./proj.C890k1jX.js";import{s as R}from"./s32cloudfront.BDr0O5Hj.js";import{i as xe}from"./isVideoFile.DGBlGWVm.js";/* empty css                                          */import{C as Pe}from"./index.CAQr5Co2.js";function ye(u){let t,m="",l,f,r,h,g,c,_,d,n,b,v;return{c(){t=A("div"),t.innerHTML=m,l=T(),f=D("svg"),r=D("defs"),h=D("filter"),g=D("feGaussianBlur"),c=D("feColorMatrix"),_=D("feComposite"),d=D("mask"),n=D("rect"),b=D("g"),v=new te(!0),this.h()},l(o){t=j(o,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),J(t)!=="svelte-1yoogyr"&&(t.innerHTML=m),l=L(o),f=k(o,"svg",{width:!0,height:!0,style:!0});var e=y(f);r=k(e,"defs",{});var s=y(r);h=k(s,"filter",{id:!0});var P=y(h);g=k(P,"feGaussianBlur",{in:!0,stdDeviation:!0,result:!0}),y(g).forEach(C),c=k(P,"feColorMatrix",{in:!0,mode:!0,values:!0,result:!0}),y(c).forEach(C),_=k(P,"feComposite",{in:!0,in2:!0,operator:!0}),y(_).forEach(C),P.forEach(C),d=k(s,"mask",{id:!0});var B=y(d);n=k(B,"rect",{width:!0,height:!0,fill:!0}),y(n).forEach(C),b=k(B,"g",{filter:!0,fill:!0});var M=y(b);v=oe(M,!0),M.forEach(C),B.forEach(C),s.forEach(C),e.forEach(C),this.h()},h(){i(t,"id","scratch-layer"),i(t,"class","svelte-1zft9l"),i(g,"in","SourceGraphic"),i(g,"stdDeviation",Ie),i(g,"result","blur"),i(c,"in","blur"),i(c,"mode","matrix"),i(c,"values",De),i(c,"result","goo"),i(_,"in","SourceGraphic"),i(_,"in2","goo"),i(_,"operator","atop"),i(h,"id","gooey-filter"),i(n,"width","100%"),i(n,"height","100%"),i(n,"fill","white"),v.a=null,i(b,"filter","url(#gooey-filter)"),i(b,"fill","black"),i(d,"id","scratch-mask"),i(f,"width","100%"),i(f,"height","100%"),O(f,"position","absolute")},m(o,e){V(o,t,e),u[2](t),V(o,l,e),V(o,f,e),S(f,r),S(r,h),S(h,g),S(h,c),S(h,_),S(r,d),S(d,n),S(d,b),v.m(u[1],b)},p(o,[e]){e&2&&v.p(o[1])},i:Y,o:Y,d(o){o&&(C(t),C(l),C(f)),u[2](null)}}}let Se=30;const Ie=5,De="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7";function ke(u,t,m){let l=[],f,r=0,h="";const g=160*.14929107086948487;K(()=>{E.on("click",function(n){l.push(n.coordinate),_()}),E.on("postrender",c)});function c(){const n=performance.now();n-r<Se||(r=n,_(),console.log(`스크래치 시간: ${performance.now()-n} milliseconds.`))}function _(){const n=E.getView().getResolution(),b=g/(n??1);m(1,h=l.map(v=>{const[o,e]=E.getPixelFromCoordinate(v);return`<circle cx="${o}" cy="${e}" r="${b}" fill="black"/>`}).join(`
`))}function d(n){Q[n?"unshift":"push"](()=>{f=n,m(0,f)})}return[f,h,d]}class Ve extends X{constructor(t){super(),$(this,t,ke,ye,W,{})}}function Be(u){let t,m,l,f,r,h,g,c,_="복사",d,n,b;const v=u[9].default,o=ae(v,u,u[8],null);return l=new Ve({}),{c(){t=A("div"),o&&o.c(),m=T(),de(l.$$.fragment),f=T(),r=A("div"),h=ne(u[1]),g=T(),c=A("button"),c.textContent=_,this.h()},l(e){t=j(e,"DIV",{id:!0,class:!0});var s=y(t);o&&o.l(s),s.forEach(C),m=L(e),he(l.$$.fragment,e),f=L(e),r=j(e,"DIV",{id:!0,class:!0});var P=y(r);h=ie(P,u[1]),g=L(P),c=j(P,"BUTTON",{class:!0,"data-svelte-h":!0}),J(c)!=="svelte-14xatxb"&&(c.textContent=_),P.forEach(C),this.h()},h(){i(t,"id","map"),i(t,"class","absolute w-full h-full z-[1] bg-[#BDDBF3] transition-transform duration-500"),O(t,"transform",`translateY(${u[0]}px)`),i(c,"class","bg-blue-300"),i(r,"id","push-test-data"),i(r,"class","absolute bottom-24 left-4 z-20 flex justify-around w-32 svelte-t4oldr")},m(e,s){V(e,t,s),o&&o.m(t,null),u[10](t),V(e,m,s),pe(l,e,s),V(e,f,s),V(e,r,s),S(r,h),S(r,g),S(r,c),d=!0,n||(b=se(c,"click",u[3]),n=!0)},p(e,[s]){o&&o.p&&(!d||s&256)&&re(o,v,e,e[8],d?ce(v,e[8],s,null):le(e[8]),null),s&1&&O(t,"transform",`translateY(${e[0]}px)`),(!d||s&2)&&ue(h,e[1])},i(e){d||(F(o,e),F(l.$$.fragment,e),d=!0)},o(e){H(o,e),H(l.$$.fragment,e),d=!1},d(e){e&&(C(t),C(m),C(f),C(r)),o&&o.d(e),u[10](null),ge(l,e),n=!1,b()}}}function U(u){u.preventDefault()}function Me(u,t,m){let l;me(u,we,a=>m(13,l=a));let{$$slots:f={},$$scope:r}=t,{onSelect:h=()=>{}}=t,{onMoveend:g=()=>{}}=t,{mapY:c=0}=t,{allowEdit:_=!0}=t,{whenCancelEdit:d=()=>{}}=t,n="0";Z.refresh(),z.on("explorePlaces",o);let b="",v;async function o(){var w;const a=E.getView().getZoom();if(!(!a||a<16))try{v&&v.abort("new request");const p=(w=window.location.search.split("tags=")[1])==null?void 0:w.split("&")[0];if(!p)return;const I=decodeURIComponent(p);if(!I)return;b!==I&&(Z.refresh(),b=I),v=new AbortController;const G=await ve({tags:b,bbox:N(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:v});z.emit("addIcons",G.map(x=>({idx:x.idx,coordinate:q(x.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:R(x.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${x.idx}`,rank:3,name:x.name,width:38,height:46,onlyMain:!0})))}catch(p){(p==null?void 0:p.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",p)}}E.on("moveend",e);function e(){var a,w,p;o(),m(1,n=(a=E.getView().getZoom())==null?void 0:a.toFixed(2)),Ee({location:((w=E.getView().getCenter())==null?void 0:w.join(","))??"",zoom:((p=E.getView().getZoom())==null?void 0:p.toFixed(2))??""}),g(N(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}o();let s;K(()=>{E.setTarget(s),s.addEventListener("contextmenu",U),l.url.searchParams.has("location")&&P(),l.url.searchParams.has("placeIdx")&&B(l.url.searchParams.get("placeIdx")),g(N(E.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),fe(()=>{E.un("moveend",e),s.removeEventListener("contextmenu",U)});function P(){const a=l.url.searchParams.get("location"),w=l.url.searchParams.get("zoom"),p=a==null?void 0:a.split(",").map(Number),I={};p&&(I.center=p),w&&(I.zoom=Number(w)),Object.values(I).length>0&&Ce(I)}z.on("addIconByPlaceIdx",B);async function B(a){var G;const w=await fetch(`${_e}/places/${a}`,{headers:{"x-api-version":be.PLACE}}).then(x=>x.json()).then(x=>x.data.place).catch(x=>{console.error(x)});let p=((G=w.thumbnail)==null?void 0:G.at(0))||"";if(!String(p).includes("youtu")){const x=R(p);await xe(x)&&(p=p+"-thumbnail")}const I={idx:w.placeIdx,coordinate:q([w.longitude,w.latitude]),image:R(p,500)||"",shape:"point",type:"place",link:`/places/${w.placeIdx}`,rank:5,name:w.name,width:38,height:46};z.emit("addIcon",I)}async function M(){await Pe.write({string:n})}function ee(a){Q[a?"unshift":"push"](()=>{s=a,m(2,s)})}return u.$$set=a=>{"onSelect"in a&&m(4,h=a.onSelect),"onMoveend"in a&&m(5,g=a.onMoveend),"mapY"in a&&m(0,c=a.mapY),"allowEdit"in a&&m(6,_=a.allowEdit),"whenCancelEdit"in a&&m(7,d=a.whenCancelEdit),"$$scope"in a&&m(8,r=a.$$scope)},[c,n,s,M,h,g,_,d,r,f,ee]}class Ue extends X{constructor(t){super(),$(this,t,Me,Be,W,{onSelect:4,onMoveend:5,mapY:0,allowEdit:6,whenCancelEdit:7})}}export{Ue as M};
