import{s as J,e as k,a as V,c as $,b as w,g as C,f as p,x as _,i as I,h as b,k as ee,q as te,y as K,n as ae,t as Q,d as W,j as X,A as B,v as ie}from"./scheduler.B6RFReyk.js";import{S as le,i as se,t as g,g as A,a as v,f as N,c as P,b as S,m as U,d as j}from"./index.DLC1-nrr.js";import{e as M,u as re,o as oe}from"./each.BdHWekAj.js";import{A as ne,e as fe}from"./sign.HDKgj7Db.js";import{H as Y}from"./HexImage.CC_aoSb9.js";import{a as ce}from"./map.DemcD3lO.js";import{f as de}from"./proj.DXH8zrwl.js";import{s as D}from"./s32cloudfront.CTUFng11.js";import{s as ue}from"./searchParams.DqjEl6fz.js";import{p as he}from"./stores.DJJB8uAr.js";import{B as Z}from"./Button.BANH9fTQ.js";function T(f,e,t){const i=f.slice();return i[12]=e[t],i[14]=t,i}function F(f){let e,t,i=f[3].image,o,a,c,r,l,d=G(f);return a=new Z({props:{className:"w-20 shadow-md",padding:"p-1",backgroundColor:"bg-white",border:"",typo:"typo-caption2",$$slots:{default:[me]},$$scope:{ctx:f}}}),{c(){e=k("div"),t=k("div"),d.c(),o=V(),P(a.$$.fragment),this.h()},l(u){e=$(u,"DIV",{class:!0,"aria-hidden":!0});var s=w(e);t=$(s,"DIV",{class:!0});var n=w(t);d.l(n),n.forEach(p),o=C(s),S(a.$$.fragment,s),s.forEach(p),this.h()},h(){_(t,"class","w-20 h-20 relative"),_(e,"class","flex-shrink-0 flex flex-col items-center space-y-1"),_(e,"aria-hidden","")},m(u,s){I(u,e,s),b(e,t),d.m(t,null),b(e,o),U(a,e,null),c=!0,r||(l=K(e,"click",f[5]),r=!0)},p(u,s){s&8&&J(i,i=u[3].image)?(A(),v(d,1,1,ae),N(),d=G(u),d.c(),g(d,1),d.m(t,null)):d.p(u,s);const n={};s&32776&&(n.$$scope={dirty:s,ctx:u}),a.$set(n)},i(u){c||(g(d),g(a.$$.fragment,u),c=!0)},o(u){v(d),v(a.$$.fragment,u),c=!1},d(u){u&&p(e),d.d(u),j(a),r=!1,l()}}}function G(f){let e,t;return e=new Y({props:{src:f[3].image?D(f[3].image,500):void 0,width:150,height:150,onBorder:!0}}),{c(){P(e.$$.fragment)},l(i){S(e.$$.fragment,i)},m(i,o){U(e,i,o),t=!0},p(i,o){const a={};o&8&&(a.src=i[3].image?D(i[3].image,500):void 0),e.$set(a)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){v(e.$$.fragment,i),t=!1},d(i){j(e,i)}}}function me(f){let e,t,i=f[3].name+"",o,a;return{c(){e=k("div"),t=k("a"),o=Q(i),this.h()},l(c){e=$(c,"DIV",{class:!0});var r=w(e);t=$(r,"A",{class:!0,href:!0});var l=w(t);o=W(l,i),l.forEach(p),r.forEach(p),this.h()},h(){_(t,"class","text-gray-700"),_(t,"href",a=`/boxes/${f[3].idx}`),_(e,"class","line-clamp-2 break-words w-16")},m(c,r){I(c,e,r),b(e,t),b(t,o)},p(c,r){r&8&&i!==(i=c[3].name+"")&&X(o,i),r&8&&a!==(a=`/boxes/${c[3].idx}`)&&_(t,"href",a)},d(c){c&&p(e)}}}function O(f){let e,t,i,o,a,c,r,l,d;i=new Y({props:{src:f[12].image?D(f[12].image,500):void 0,width:150,height:150}}),a=new Z({props:{className:"w-20 shadow-md",padding:"p-1",backgroundColor:"bg-white",border:"",typo:"typo-caption2",$$slots:{default:[_e]},$$scope:{ctx:f}}});function u(){return f[6](f[12])}return{c(){e=k("div"),t=k("div"),P(i.$$.fragment),o=V(),P(a.$$.fragment),c=V(),this.h()},l(s){e=$(s,"DIV",{class:!0,"aria-hidden":!0});var n=w(e);t=$(n,"DIV",{class:!0});var h=w(t);S(i.$$.fragment,h),h.forEach(p),o=C(n),S(a.$$.fragment,n),c=C(n),n.forEach(p),this.h()},h(){_(t,"class","w-20 h-20 relative"),_(e,"class","flex-shrink-0 flex flex-col items-center space-y-1"),_(e,"aria-hidden","")},m(s,n){I(s,e,n),b(e,t),U(i,t,null),b(e,o),U(a,e,null),b(e,c),r=!0,l||(d=K(e,"click",u),l=!0)},p(s,n){f=s;const h={};n&2&&(h.src=f[12].image?D(f[12].image,500):void 0),i.$set(h);const x={};n&32770&&(x.$$scope={dirty:n,ctx:f}),a.$set(x)},i(s){r||(g(i.$$.fragment,s),g(a.$$.fragment,s),r=!0)},o(s){v(i.$$.fragment,s),v(a.$$.fragment,s),r=!1},d(s){s&&p(e),j(i),j(a),l=!1,d()}}}function _e(f){let e,t,i=f[12].name+"",o,a;return{c(){e=k("div"),t=k("a"),o=Q(i),this.h()},l(c){e=$(c,"DIV",{class:!0});var r=w(e);t=$(r,"A",{class:!0,href:!0});var l=w(t);o=W(l,i),l.forEach(p),r.forEach(p),this.h()},h(){_(t,"class","text-gray-700"),_(t,"href",a=`/boxes/${f[12].idx}`),_(e,"class","line-clamp-2 break-words w-16")},m(c,r){I(c,e,r),b(e,t),b(t,o)},p(c,r){r&2&&i!==(i=c[12].name+"")&&X(o,i),r&2&&a!==(a=`/boxes/${c[12].idx}`)&&_(t,"href",a)},d(c){c&&p(e)}}}function R(f,e){var c;let t,i,o,a=e[12].idx!==((c=e[3])==null?void 0:c.idx)&&O(e);return{key:f,first:null,c(){t=B(),a&&a.c(),i=B(),this.h()},l(r){t=B(),a&&a.l(r),i=B(),this.h()},h(){this.first=t},m(r,l){I(r,t,l),a&&a.m(r,l),I(r,i,l),o=!0},p(r,l){var d;e=r,e[12].idx!==((d=e[3])==null?void 0:d.idx)?a?(a.p(e,l),l&10&&g(a,1)):(a=O(e),a.c(),g(a,1),a.m(i.parentNode,i)):a&&(A(),v(a,1,1,()=>{a=null}),N())},i(r){o||(g(a),o=!0)},o(r){v(a),o=!1},d(r){r&&(p(t),p(i)),a&&a.d(r)}}}function pe(f){let e,t,i,o=[],a=new Map,c,r,l=f[3]&&F(f),d=M(f[1]);const u=s=>s[12].idx;for(let s=0;s<d.length;s+=1){let n=T(f,d,s),h=u(n);a.set(h,o[s]=R(h,n))}return{c(){e=k("div"),t=k("div"),l&&l.c(),i=V();for(let s=0;s<o.length;s+=1)o[s].c();this.h()},l(s){e=$(s,"DIV",{class:!0});var n=w(e);t=$(n,"DIV",{class:!0});var h=w(t);l&&l.l(h),i=C(h);for(let x=0;x<o.length;x+=1)o[x].l(h);h.forEach(p),n.forEach(p),this.h()},h(){_(t,"class","flex gap-3"),_(e,"class",c=`absolute ${f[0]} left-0 overflow-x-auto p-4 z-20 scrollbar-hidden scrollbar-hidden::-webkit-scrollbar`)},m(s,n){I(s,e,n),b(e,t),l&&l.m(t,null),b(t,i);for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(t,null);f[7](e),r=!0},p(s,[n]){s[3]?l?(l.p(s,n),n&8&&g(l,1)):(l=F(s),l.c(),g(l,1),l.m(t,i)):l&&(A(),v(l,1,1,()=>{l=null}),N()),n&14&&(d=M(s[1]),A(),o=re(o,n,u,1,s,d,a,t,oe,R,null,T),N()),(!r||n&1&&c!==(c=`absolute ${s[0]} left-0 overflow-x-auto p-4 z-20 scrollbar-hidden scrollbar-hidden::-webkit-scrollbar`))&&_(e,"class",c)},i(s){if(!r){g(l);for(let n=0;n<d.length;n+=1)g(o[n]);r=!0}},o(s){v(l);for(let n=0;n<o.length;n+=1)v(o[n]);r=!1},d(s){s&&p(e),l&&l.d();for(let n=0;n<o.length;n+=1)o[n].d();f[7](null)}}}function ge(f,e,t){let i;ee(f,he,m=>t(9,i=m));let{top:o="top-4"}=e,{boxes:a}=e,{onBoxClick:c=m=>u(m)}=e,r=i.url.searchParams.get("box"),l,d=null;te(()=>{r&&(u(r),r=null)});async function u(m){const q=a.find(E=>E.idx===m);if(!q)return;if(ce.clear(),l&&l.idx===q.idx)return t(3,l=null);t(3,l=q),s();const z=l.idx;fetch(`${ne}/boxes/${z}/places`).then(E=>E.json()).then(E=>{const H=E.data;H&&fe.emit("addIcons",H.map(y=>{var L;return{idx:Number(y.idx),coordinate:de([y.longitude,y.latitude]),image:D(((L=y.media)==null?void 0:L.at(0))??"",500),shape:"waterdrop",type:"place",link:`/places/${y.idx}?boxIdx=${z}`,rank:1,name:y.name,width:56,height:61}}))})}function s(){d&&d.scrollTo({top:0,left:0,behavior:"smooth"})}const n=()=>(l==null?void 0:l.idx)&&c(l.idx),h=m=>c(m.idx);function x(m){ie[m?"unshift":"push"](()=>{d=m,t(4,d)})}return f.$$set=m=>{"top"in m&&t(0,o=m.top),"boxes"in m&&t(1,a=m.boxes),"onBoxClick"in m&&t(2,c=m.onBoxClick)},f.$$.update=()=>{f.$$.dirty&8&&l!==void 0&&ue({box:(l==null?void 0:l.idx)??""},{replaceState:!0})},[o,a,c,l,d,n,h,x]}class Ve extends le{constructor(e){super(),se(this,e,ge,pe,J,{top:0,boxes:1,onBoxClick:2})}}export{Ve as U};
