import{s as G,m as V,e as k,c as z,b as Y,f as v,v as w,C as I,i as L,E as N,y as O,u as F,o as T,p as W,F as Z,k as q,w as R,B as U,z as H}from"./scheduler.CbwPF6wx.js";import{S as J,i as K,t as Q,a as X}from"./index.DiLw73rm.js";import{s as S,m,f as $}from"./map.ASJyFyAc.js";import{e as _,A as ee}from"./sign.CGwCWKOZ.js";import{g as te}from"./search.De0Y9YRw.js";import{p as oe}from"./stores.OwqMygU6.js";import{l as ae}from"./longPress.C9F0mLoM.js";import{g as ne}from"./entry.C6FKLZKF.js";import{s as se}from"./searchParams.DmUo3ZD9.js";import{a as P,f as y}from"./proj.DXH8zrwl.js";import{s as B}from"./s32cloudfront.CR69Cdk5.js";function re(s){let a,r,i,h;const f=s[6].default,n=V(f,s,s[5],null);return{c(){a=k("div"),n&&n.c(),this.h()},l(o){a=z(o,"DIV",{id:!0,class:!0});var c=Y(a);n&&n.l(c),c.forEach(v),this.h()},h(){w(a,"id","map"),w(a,"class","absolute w-full h-full z-[1] bg-[#BDDBF3] transition-transform duration-500"),I(a,"transform",`translateY(${s[1]}px)`)},m(o,c){L(o,a,c),n&&n.m(a,null),s[7](a),r=!0,i||(h=[N(ae.call(null,a,500)),O(a,"longpress",s[8])],i=!0)},p(o,[c]){n&&n.p&&(!r||c&32)&&F(n,f,o,o[5],r?W(f,o[5],c,null):T(o[5]),null),c&2&&I(a,"transform",`translateY(${o[1]}px)`)},i(o){r||(Q(n,o),r=!0)},o(o){X(n,o),r=!1},d(o){o&&v(a),n&&n.d(o),s[7](null),i=!1,Z(h)}}}function D(s){s.preventDefault()}function ie(s,a,r){let i;q(s,oe,e=>r(3,i=e));let{$$slots:h={},$$scope:f}=a,{onSelect:n=()=>{}}=a,{onMoveend:o=()=>{}}=a,{mapY:c=0}=a;S.refresh(),_.on("explorePlaces",b);let C="",g;async function b(){var e;if(!(m.getView().getZoom()<16))try{g&&g.abort("new request");const t=(e=window.location.search.split("tags=")[1])==null?void 0:e.split("&")[0];if(!t)return;const u=decodeURIComponent(t);if(!u)return;C!==u&&(S.refresh(),C=u),g=new AbortController;const l=await te({tags:C,bbox:P(m.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:g});_.emit("addIcons",l.map(p=>({idx:p.idx,coordinate:y(p.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:B(p.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${p.idx}`,rank:3,name:p.name,width:38,height:46,onlyMain:!0})))}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}m.on("moveend",E);function E(){var e,t;b(),se({location:((e=m.getView().getCenter())==null?void 0:e.join(","))??"",zoom:((t=m.getView().getZoom())==null?void 0:t.toFixed(2))??""}),o(P(m.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}b();let d;R(()=>{m.setTarget(d),d.addEventListener("contextmenu",D),i.url.searchParams.has("location")&&M(),i.url.searchParams.has("placeIdx")&&x(i.url.searchParams.get("placeIdx")),o(P(m.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),U(()=>{m.un("moveend",E),d.removeEventListener("contextmenu",D)});function M(){const e=i.url.searchParams.get("location"),t=i.url.searchParams.get("zoom"),u=e==null?void 0:e.split(",").map(Number),l={};u&&(l.center=u),t&&(l.zoom=Number(t)),Object.values(l).length>0&&$(l)}_.on("addIconByPlaceIdx",x);async function x(e){const t=await fetch(`${ee}/places/${e}`).then(l=>l.json()).then(l=>l.data.place).catch(l=>{console.error(l)}),u={idx:t.placeIdx,coordinate:y([t.longitude,t.latitude]),image:B(t.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${t.placeIdx}`,rank:5,name:t.name,width:38,height:46};_.emit("addIcon",u)}function j(e){H[e?"unshift":"push"](()=>{d=e,r(2,d)})}const A=e=>{if(!i.url.pathname.startsWith("/map"))return;const t=m.getEventCoordinate(e.detail);i.url.pathname!=="/map/edit"?ne(`/map/edit?location=${t.join()}`):n(t)};return s.$$set=e=>{"onSelect"in e&&r(0,n=e.onSelect),"onMoveend"in e&&r(4,o=e.onMoveend),"mapY"in e&&r(1,c=e.mapY),"$$scope"in e&&r(5,f=e.$$scope)},[n,c,d,i,o,f,h,j,A]}class be extends J{constructor(a){super(),K(this,a,ie,re,G,{onSelect:0,onMoveend:4,mapY:1})}}export{be as M};
