import"./entry.CliHOesx.js";import{F as h,s as m,a as p,t as u,h as w}from"./heic2any.CVnW2htI.js";import{i as y,e as v}from"./units.DgSnVFoF.js";import{g as E}from"./searchParams.DdOiwuTB.js";const M=async()=>{try{return(await h.pickMedia({limit:1})).files[0]}catch(i){throw i}},S=async(i,n)=>{if(!y()){v.emit("showSignInModal",{removable:!0});return}m.set([]),p.set(!1);const t=document.createElement("input");t.type="file",t.multiple=!0,t.style.display="none",t.accept="image/*,.heic,.heif",document.body.appendChild(t),t.addEventListener("change",async s=>{const o=s.target.files,c=new FormData;if(o&&o.length>0){let l="";for await(const e of Array.from(o)){let r=e,d;try{d=await u.gps(e),d&&(l=`&location=${d.longitude.toFixed(5)},${d.latitude.toFixed(5)}`)}catch(a){console.error("GPS 데이터 추출 오류:",a)}if(e.type==="image/heic"||e.type==="image/heif"||e.name.endsWith(".heic")||e.name.endsWith(".heif"))try{const a=await w({blob:e,toType:"image/jpeg",quality:.9});r=new File([a],e.name.replace(/\.[^/.]+$/,".jpg"),{type:"image/jpeg",lastModified:e.lastModified})}catch(a){console.error("HEIC를 JPEG로 변환하는 중 오류 발생:",a);continue}else try{const a=await F(e);r=new File([a],e.name.replace(/\.[^/.]+$/,".jpg"),{type:"image/jpeg",lastModified:e.lastModified})}catch(a){console.error("이미지를 JPEG로 변환하는 중 오류 발생:",a);continue}console.log("converted done"),c.append("media",r),await I(r).then(a=>{m.update(f=>[...f,a])})}E("/viewer/edit",{type:"post",placeIdx:String(i),placeName:n,location:l},{replaceState:!1,invalidateAll:!1}),fetch("https://azit.surflux.studio/posts/media",{method:"POST",body:c,headers:{Authorization:"Bearer "+window.sessionStorage.getItem("jwt")}}).then(async e=>{const r=await e.json();m.set(r.data.media),p.set(!0)})}document.body.removeChild(t)}),t.click()};async function F(i){return new Promise((n,t)=>{const s=new FileReader;s.onload=g=>{var c;const o=new Image;o.onload=()=>{const l=document.createElement("canvas");l.width=o.width,l.height=o.height;const e=l.getContext("2d");if(!e){t(new Error("캔버스 컨텍스트를 가져올 수 없습니다."));return}e.drawImage(o,0,0),l.toBlob(r=>{r?n(r):t(new Error("캔버스가 비어 있습니다."))},"image/jpeg",.9)},o.onerror=()=>{t(new Error("이미지를 로드하는 데 실패했습니다."))},o.src=(c=g.target)==null?void 0:c.result},s.onerror=()=>{t(new Error("파일을 읽는 데 실패했습니다."))},s.readAsDataURL(i)})}function I(i){const n=new FileReader;return new Promise((t,s)=>{n.onload=()=>{t(n.result)},n.onerror=s,n.readAsDataURL(i)})}export{S as a,M as g};
