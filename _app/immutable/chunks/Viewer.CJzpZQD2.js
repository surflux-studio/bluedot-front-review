import{s as Fe,e as A,c as H,b as X,f as k,q as m,i as J,r as q,A as Je,L as pe,k as Qe,o as $e,M as et,l as tt,x as ve,E as st,a as U,t as Se,g as K,d as Te,H as re,h as L,N as we,j as We,w as je,v as be,O as Ie,z as nt}from"./scheduler.De904EWn.js";import{S as lt,i as rt,t as O,g as ge,f as _e,b as F,c as Oe,a as Re,m as Ce,d as ze}from"./index.w_cQNxYZ.js";import{e as ae}from"./each.BGisq09C.js";import{e as at,A as ot,r as Ee}from"./units.DvlLNOex.js";import{g as it}from"./entry.BSZcKorA.js";import{b as me}from"./store.B6V-7GTP.js";import{g as ct,u as ut}from"./searchParams.C8PNeJ8T.js";import{W as ft}from"./WaterdropImage.BstWQrWq.js";import{C as dt}from"./CircleImage.XLp1cBBN.js";import{p as ht}from"./stores.DMUPpfAr.js";import{L as mt}from"./location.D_3NXnmC.js";/* empty css                                             */function pt(t){const s=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","wheel"].map(a=>{const o=e=>e.stopPropagation();return t.addEventListener(a,o),{event:a,handler:o}});return{destroy(){s.forEach(({event:a,handler:o})=>{t.removeEventListener(a,o)})}}}function ke(t,n,s){const a=t.slice();return a[45]=n[s],a[46]=n,a[47]=s,a}function xe(t,n,s){const a=t.slice();return a[48]=n[s],a[50]=s,a}function ye(t,n,s){const a=t.slice();return a[51]=n[s],a}function Me(t){var j,ie;let n,s,a,o,e,i,f,l,d,u,h,_,Y,V,R=(t[45].place_name||"")+"",te,y,se,oe,ne,le,M,Z,G,D=ae(t[45].media),b=[];for(let v=0;v<D.length;v+=1)b[v]=Le(ye(t,D,v));let I=t[45].media.length>1&&Ye(t),E=(t[7]==="post"||t[7]==="patch"||((ie=(j=t[45])==null?void 0:j.text)==null?void 0:ie.length)>0)&&Ae(t),g=t[45].user_idx&&He(t);_=new ft({props:{src:`https://picsum.photos/50/50/?r=${t[45].place_idx}`,width:"2rem",strokeColor:"white",strokeWidth:"13"}});function C(){return t[19](t[45])}return{c(){n=A("div"),s=A("div"),a=A("div");for(let v=0;v<b.length;v+=1)b[v].c();i=U(),f=A("div"),I&&I.c(),l=U(),E&&E.c(),d=U(),g&&g.c(),u=U(),h=A("div"),Oe(_.$$.fragment),Y=U(),V=A("div"),te=Se(R),oe=U(),this.h()},l(v){n=H(v,"DIV",{class:!0,style:!0});var p=X(n);s=H(p,"DIV",{class:!0});var S=X(s);a=H(S,"DIV",{class:!0,style:!0});var z=X(a);for(let ce=0;ce<b.length;ce+=1)b[ce].l(z);z.forEach(k),S.forEach(k),i=K(p),f=H(p,"DIV",{class:!0,style:!0});var P=X(f);I&&I.l(P),l=K(P),E&&E.l(P),d=K(P),g&&g.l(P),u=K(P),h=H(P,"DIV",{class:!0});var x=X(h);Re(_.$$.fragment,x),Y=K(x),V=H(x,"DIV",{});var Q=X(V);te=Te(Q,R),Q.forEach(k),x.forEach(k),P.forEach(k),oe=K(p),p.forEach(k),this.h()},h(){m(a,"class",o=re(`carousel-track transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"),m(a,"style",e=`transform: translateX(${-t[45].mediaIdx*t[6].width+t[5]}px);`),m(s,"class","carousel-container svelte-1xgvwrg"),m(h,"class","text-shadow text-center flex gap-2 justify-center items-center svelte-1xgvwrg"),m(f,"class",y=re(`fixed bottom-0 w-full px-4 text-white text-md flex flex-col items-start gap-2 z-40 
            ${t[2]?"":"pb-24"} 
           transition-transform`)+" svelte-1xgvwrg"),m(f,"style",se=`transform: translateY(${t[2]}px);`),m(n,"class",ne=re(`w-full h-full gradient-overlay absolute content-center transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"),m(n,"style",le=`top: 0; transform: translateY(${(t[47]-t[1])*t[6].height+t[4]}px);`)},m(v,p){J(v,n,p),L(n,s),L(s,a);for(let S=0;S<b.length;S+=1)b[S]&&b[S].m(a,null);L(n,i),L(n,f),I&&I.m(f,null),L(f,l),E&&E.m(f,null),L(f,d),g&&g.m(f,null),L(f,u),L(f,h),Ce(_,h,null),L(h,Y),L(h,V),L(V,te),L(n,oe),M=!0,Z||(G=[q(a,"transitionend",function(){we(t[45].mediaIdx===t[0][t[1]].mediaIdx?t[9]:void 0)&&(t[45].mediaIdx===t[0][t[1]].mediaIdx?t[9]:void 0).apply(this,arguments)}),q(h,"click",C),q(n,"transitionend",function(){we(t[47]===t[1]?t[9]:void 0)&&(t[47]===t[1]?t[9]:void 0).apply(this,arguments)})],Z=!0)},p(v,p){var z,P;if(t=v,p[0]&1){D=ae(t[45].media);let x;for(x=0;x<D.length;x+=1){const Q=ye(t,D,x);b[x]?b[x].p(Q,p):(b[x]=Le(Q),b[x].c(),b[x].m(a,null))}for(;x<b.length;x+=1)b[x].d(1);b.length=D.length}(!M||p[0]&8&&o!==(o=re(`carousel-track transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"))&&m(a,"class",o),(!M||p[0]&97&&e!==(e=`transform: translateX(${-t[45].mediaIdx*t[6].width+t[5]}px);`))&&m(a,"style",e),t[45].media.length>1?I?I.p(t,p):(I=Ye(t),I.c(),I.m(f,l)):I&&(I.d(1),I=null),t[7]==="post"||t[7]==="patch"||((P=(z=t[45])==null?void 0:z.text)==null?void 0:P.length)>0?E?E.p(t,p):(E=Ae(t),E.c(),E.m(f,d)):E&&(E.d(1),E=null),t[45].user_idx?g?(g.p(t,p),p[0]&1&&O(g,1)):(g=He(t),g.c(),O(g,1),g.m(f,u)):g&&(ge(),F(g,1,1,()=>{g=null}),_e());const S={};p[0]&1&&(S.src=`https://picsum.photos/50/50/?r=${t[45].place_idx}`),_.$set(S),(!M||p[0]&1)&&R!==(R=(t[45].place_name||"")+"")&&We(te,R),(!M||p[0]&4&&y!==(y=re(`fixed bottom-0 w-full px-4 text-white text-md flex flex-col items-start gap-2 z-40 
            ${t[2]?"":"pb-24"} 
           transition-transform`)+" svelte-1xgvwrg"))&&m(f,"class",y),(!M||p[0]&4&&se!==(se=`transform: translateY(${t[2]}px);`))&&m(f,"style",se),(!M||p[0]&8&&ne!==(ne=re(`w-full h-full gradient-overlay absolute content-center transition-transform ${t[3]?"duration-0":""}`)+" svelte-1xgvwrg"))&&m(n,"class",ne),(!M||p[0]&82&&le!==(le=`top: 0; transform: translateY(${(t[47]-t[1])*t[6].height+t[4]}px);`))&&m(n,"style",le)},i(v){M||(O(g),O(_.$$.fragment,v),M=!0)},o(v){F(g),F(_.$$.fragment,v),M=!1},d(v){v&&k(n),pe(b,v),I&&I.d(),E&&E.d(),g&&g.d(),ze(_),Z=!1,je(G)}}}function Le(t){let n,s,a,o,e;return{c(){n=A("div"),s=A("img"),e=U(),this.h()},l(i){n=H(i,"DIV",{class:!0});var f=X(n);s=H(f,"IMG",{src:!0,alt:!0,class:!0,draggable:!0}),e=K(f),f.forEach(k),this.h()},h(){be(s.src,a=t[51])||m(s,"src",a),m(s,"alt",o=t[45].place_name),m(s,"class","w-full h-full object-contain svelte-1xgvwrg"),m(s,"draggable","false"),m(n,"class","carousel-slide svelte-1xgvwrg")},m(i,f){J(i,n,f),L(n,s),L(n,e)},p(i,f){f[0]&1&&!be(s.src,a=i[51])&&m(s,"src",a),f[0]&1&&o!==(o=i[45].place_name)&&m(s,"alt",o)},d(i){i&&k(n)}}}function Ye(t){let n,s=ae(t[45].media),a=[];for(let o=0;o<s.length;o+=1)a[o]=De(xe(t,s,o));return{c(){n=A("div");for(let o=0;o<a.length;o+=1)a[o].c();this.h()},l(o){n=H(o,"DIV",{class:!0});var e=X(n);for(let i=0;i<a.length;i+=1)a[i].l(e);e.forEach(k),this.h()},h(){m(n,"class","carousel-nav svelte-1xgvwrg")},m(o,e){J(o,n,e);for(let i=0;i<a.length;i+=1)a[i]&&a[i].m(n,null)},p(o,e){if(e[0]&1){s=ae(o[45].media);let i;for(i=0;i<s.length;i+=1){const f=xe(o,s,i);a[i]?a[i].p(f,e):(a[i]=De(f),a[i].c(),a[i].m(n,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=s.length}},d(o){o&&k(n),pe(a,o)}}}function De(t){let n,s;return{c(){n=A("span"),this.h()},l(a){n=H(a,"SPAN",{class:!0}),X(n).forEach(k),this.h()},h(){m(n,"class",s="carousel-dot "+(t[45].mediaIdx===t[50]?"active":"")+" svelte-1xgvwrg")},m(a,o){J(a,n,o)},p(a,o){o[0]&1&&s!==(s="carousel-dot "+(a[45].mediaIdx===a[50]?"active":"")+" svelte-1xgvwrg")&&m(n,"class",s)},d(a){a&&k(n)}}}function Ae(t){let n,s,a;function o(){t[16].call(n,t[46],t[47])}return{c(){n=A("textarea"),this.h()},l(e){n=H(e,"TEXTAREA",{class:!0,placeholder:!0}),X(n).forEach(k),this.h()},h(){m(n,"class","w-full h-auto overflow-scroll py-0 px-1 mb-3 outline-0 focus:outline-none focus:ring-0 border-none bg-transparent text-sm text-shadow placeholder:text-white/75 placeholder:text-base box-content read-only:cursor-pointer  svelte-1xgvwrg"),n.readOnly=t[7]!=="post"&&t[7]!=="patch",m(n,"placeholder",t[7]==="post"||t[7]==="patch"?"✎ 텍스트 입력하기":"")},m(e,i){J(e,n,i),Ie(n,t[45].text),s||(a=[q(n,"input",o),nt(pt.call(null,n)),q(n,"input",t[17]),q(n,"click",t[10]),q(n,"focus",t[11]),q(n,"blur",t[12])],s=!0)},p(e,i){t=e,i[0]&1&&Ie(n,t[45].text)},d(e){e&&k(n),s=!1,je(a)}}}function He(t){let n,s,a,o,e=t[45].display_name+"",i,f,l,d;s=new dt({props:{src:t[45].profile_image_url,width:"2rem",strokeColor:"white",strokeWidth:"13"}});function u(){return t[18](t[45])}return{c(){n=A("div"),Oe(s.$$.fragment),a=U(),o=A("div"),i=Se(e),this.h()},l(h){n=H(h,"DIV",{class:!0});var _=X(n);Re(s.$$.fragment,_),a=K(_),o=H(_,"DIV",{});var Y=X(o);i=Te(Y,e),Y.forEach(k),_.forEach(k),this.h()},h(){m(n,"class","text-shadow text-center flex gap-2 justify-center items-center svelte-1xgvwrg")},m(h,_){J(h,n,_),Ce(s,n,null),L(n,a),L(n,o),L(o,i),f=!0,l||(d=q(n,"click",u),l=!0)},p(h,_){t=h;const Y={};_[0]&1&&(Y.src=t[45].profile_image_url),s.$set(Y),(!f||_[0]&1)&&e!==(e=t[45].display_name+"")&&We(i,e)},i(h){f||(O(s.$$.fragment,h),f=!0)},o(h){F(s.$$.fragment,h),f=!1},d(h){h&&k(n),ze(s),l=!1,d()}}}function Pe(t){let n=Math.abs(t[1]-t[47])<=1,s,a,o=n&&Me(t);return{c(){o&&o.c(),s=ve()},l(e){o&&o.l(e),s=ve()},m(e,i){o&&o.m(e,i),J(e,s,i),a=!0},p(e,i){i[0]&2&&(n=Math.abs(e[1]-e[47])<=1),n?o?(o.p(e,i),i[0]&2&&O(o,1)):(o=Me(e),o.c(),O(o,1),o.m(s.parentNode,s)):o&&(ge(),F(o,1,1,()=>{o=null}),_e())},i(e){a||(O(o),a=!0)},o(e){F(o),a=!1},d(e){e&&k(s),o&&o.d(e)}}}function gt(t){let n,s,a,o,e=ae(t[0]),i=[];for(let l=0;l<e.length;l+=1)i[l]=Pe(ke(t,e,l));const f=l=>F(i[l],1,1,()=>{i[l]=null});return{c(){n=A("div");for(let l=0;l<i.length;l+=1)i[l].c();this.h()},l(l){n=H(l,"DIV",{class:!0});var d=X(n);for(let u=0;u<i.length;u+=1)i[u].l(d);d.forEach(k),this.h()},h(){m(n,"class","bg-black w-screen h-screen")},m(l,d){J(l,n,d);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(n,null);s=!0,a||(o=q(n,"contextmenu",Je(t[15])),a=!0)},p(l,d){if(d[0]&8191){e=ae(l[0]);let u;for(u=0;u<e.length;u+=1){const h=ke(l,e,u);i[u]?(i[u].p(h,d),O(i[u],1)):(i[u]=Pe(h),i[u].c(),O(i[u],1),i[u].m(n,null))}for(ge(),u=e.length;u<i.length;u+=1)f(u);_e()}},i(l){if(!s){for(let d=0;d<e.length;d+=1)O(i[d]);s=!0}},o(l){i=i.filter(Boolean);for(let d=0;d<i.length;d+=1)F(i[d]);s=!1},d(l){l&&k(n),pe(i,l),a=!1,o()}}}const _t=30,vt=10,Xe=10,Ve=300;function he(t){return"touches"in t||"changedTouches"in t}function wt(t,n,s){let a;Qe(t,ht,r=>s(29,a=r));let o=a.url.searchParams.get("type"),{posts:e=[]}=n,{dontMoveVertically:i=!1}=n,{keyboardY:f=0}=n,{index:l=0}=n,d=!0,u=!1,h=!1,_=0,Y=0,V={width:0,height:0},R=!1;async function te(){s(14,R=!0);const r=a.url.searchParams.get("userIdx"),c=a.url.searchParams.get("placeIdx"),w=await mt.getCurrentOrLastLocation(),T=e.length,W=_t,N=r?`&userIdx=${r}`:"",ue=c?`&placeIdx=${c}`:"",$=w?`&location=${[w==null?void 0:w.longitude,w==null?void 0:w.latitude].join(",")}`:"",ee=`&offset=${T}`,B=`&limit=${W}`,fe=(await fetch(`${ot}/posts?${N}${ue}${ee}${B}${$}`).then(de=>de.json()).then(de=>de.data)).map(de=>({...de,mediaIdx:0}));s(0,e=[...e,...fe]),s(14,R=!1)}async function y(){ut({mediaIdx:`${e[l].mediaIdx}`,postIdx:`${e[l].idx}`},{replace:!0})}function se(r){const c=V.height;if(l===0&&r>0){s(4,_=r*.3);return}if(l===e.length-1&&r<0){s(4,_=r*.3);return}s(4,_=Math.max(Math.min(r,c),-c))}function oe(r){document.querySelectorAll("textarea").forEach(T=>{z({target:T})}),s(3,d=!1),V.height;let c=0;he(r)?c=r.changedTouches[0].clientY-G:c=r.clientY-G;const w=Ee(2);c>w&&l>0?(s(1,l-=1),u=!0,y()):-c>w&&l<e.length-1&&(s(1,l+=1),u=!0,y()),s(4,_=0)}function ne(r){const c=V.width;if(r=Math.max(Math.min(r,c),-c),e[l].mediaIdx===0&&r>0||e[l].mediaIdx===e[l].media.length-1&&r<0){s(5,Y=r*.3);return}s(5,Y=r)}function le(r){V.width,s(3,d=!1);let c=0;he(r)?c=r.changedTouches[0].clientX-Z:c=r.clientX-Z;const w=Ee(2);if(c>w&&e[l].mediaIdx>0){const T=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:T},e),s(0,e=[...e]),h=!0,y()}else if(-c>w&&e[l].mediaIdx<e[l].media.length-1){const T=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:T},e),s(0,e=[...e]),h=!0,y()}s(5,Y=0)}let M=!1,Z=-1,G=-1,D,b=!1;at.on("blockSwipeInViewer",r=>M=r);function I(r){M||u||h||(b=!0,D=void 0,me.set(!0),he(r)?(Z=r.touches[0].clientX,G=r.touches[0].clientY):(Z=r.clientX,G=r.clientY,window.addEventListener("mousemove",E,{passive:!1}),window.addEventListener("mouseup",g)))}function E(r){if(M||!b||u||h)return;let c=0,w=0;he(r)?(c=r.touches[0].clientX,w=r.touches[0].clientY):(c=r.clientX,w=r.clientY);let T=c-Z,W=w-G;D===void 0&&(D=Math.abs(W)>=Math.abs(T)?"post":"media"),!i&&D==="post"?se(W):D==="media"&&ne(T)}function g(r){M||!b||u||h||(b=!1,D==="post"?oe(r):D==="media"?le(r):me.set(!1),he(r)||(window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",g)))}let C=[],j=[];function ie(r){if(M||u||h)return;r.preventDefault();const c=Date.now(),w=Math.abs(r.deltaX),T=Math.abs(r.deltaY);if(w>T){if(j.push({deltaX:r.deltaX,timestamp:c}),j=j.filter(W=>c-W.timestamp<=Ve),j.length>=2){const W=j[0],N=j[j.length-1],ue=Math.abs(W.deltaX),$=Math.abs(N.deltaX),ee=$-ue;if(ee<0)return;if(ee>=0&&$>=Xe){let B=!1;if(N.deltaX>0&&e[l].mediaIdx<e[l].media.length-1){const fe=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:fe},e),s(0,e=[...e]),s(3,d=!1),y(),B=!0}else if(N.deltaX<0&&e[l].mediaIdx>0){const fe=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:fe},e),s(0,e=[...e]),s(3,d=!1),y(),B=!0}j=[],B&&(h=!0)}}}else if(C.push({deltaY:r.deltaY,timestamp:c}),C=C.filter(W=>c-W.timestamp<=Ve),C.length>=2){const W=C[0],N=C[C.length-1],ue=Math.abs(W.deltaY),$=Math.abs(N.deltaY),ee=$-ue;if(ee<0)return;if(ee>=0&&$>=Xe){let B=!1;N.deltaY>0&&l<e.length-1?(s(3,d=!1),s(1,l+=1),y(),B=!0):N.deltaY<0&&l>0&&(s(3,d=!1),s(1,l-=1),y(),B=!0),C=[],B&&(u=!0)}}}function v(r){if(!(M||u||h))switch(r.key){case"ArrowUp":l>0&&(s(3,d=!1),s(1,l-=1),u=!0,y());break;case"ArrowDown":l<e.length-1&&(s(3,d=!1),s(1,l+=1),u=!0,y());break;case"ArrowLeft":if(e[l].mediaIdx>0){const c=e[l].mediaIdx-1;s(0,e[l]={...e[l],mediaIdx:c},e),s(0,e=[...e]),s(3,d=!1),h=!0,y()}break;case"ArrowRight":if(e[l].mediaIdx<e[l].media.length-1){const c=e[l].mediaIdx+1;s(0,e[l]={...e[l],mediaIdx:c},e),s(0,e=[...e]),s(3,d=!1),h=!0,y()}break}}function p(){s(6,V={width:document.body.clientWidth,height:document.body.clientHeight})}function S(){const r=Number(a.url.searchParams.get("mediaIdx")||0);r&&e[l].media[r]?(s(0,e[l]={...e[l],mediaIdx:r},e),s(0,e=[...e])):(s(0,e[l]={...e[l],mediaIdx:0},e),s(0,e=[...e])),y()}function z(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.style.height="16px";let w=c.scrollHeight;w>window.innerHeight/3&&(w=window.innerHeight/3),c.style.height=`${w}px`}$e(async()=>{p(),window.addEventListener("resize",p),P(),S(),await et(),document.querySelectorAll("textarea").forEach(r=>{z({target:r})})}),tt(()=>{window.removeEventListener("resize",p),x()});function P(){document.addEventListener("touchstart",I,{passive:!1}),document.addEventListener("touchmove",E,{passive:!1}),document.addEventListener("touchend",g),document.addEventListener("mousedown",I,{passive:!1}),document.addEventListener("wheel",ie,{passive:!1}),document.addEventListener("keydown",v)}function x(){document.removeEventListener("touchstart",I),document.removeEventListener("touchmove",E),document.removeEventListener("touchend",g),document.removeEventListener("mousedown",I),document.removeEventListener("wheel",ie),document.removeEventListener("keydown",v)}function Q(){s(3,d=!0),u=!1,h=!1,me.set(!1)}function ce(r){if(o==="post"||o==="patch")return;const c=r.target;c instanceof HTMLTextAreaElement&&(c.scrollHeight<=c.clientHeight||(c.hasAttribute("open")?(c.style.height="",c.removeAttribute("open")):(c.style.height=`${window.innerHeight/3}px`,c.setAttribute("open",""))))}function Ne(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.hasAttribute("open")||(c.style.height=`${window.innerHeight/3}px`,c.setAttribute("open",""))}function qe(r){if(o!=="post"&&o!=="patch")return;const c=r.target;c.hasAttribute("open")&&(c.style.height="",c.removeAttribute("open"))}function Ze(r){st.call(this,t,r)}function Be(r,c){r[c].text=this.value,s(0,e)}const Ge=r=>z(r),Ue=r=>{r.user_idx&&ct(`/users/${r.user_idx}`)},Ke=r=>{r.place_idx&&it(`/places/${r.place_idx}`)};return t.$$set=r=>{"posts"in r&&s(0,e=r.posts),"dontMoveVertically"in r&&s(13,i=r.dontMoveVertically),"keyboardY"in r&&s(2,f=r.keyboardY),"index"in r&&s(1,l=r.index)},t.$$.update=()=>{t.$$.dirty[0]&16387&&l>=e.length-vt&&!R&&te()},[e,l,f,d,_,Y,V,o,z,Q,ce,Ne,qe,i,R,Ze,Be,Ge,Ue,Ke]}class Pt extends lt{constructor(n){super(),rt(this,n,wt,gt,Fe,{posts:0,dontMoveVertically:13,keyboardY:2,index:1},null,[-1,-1])}}export{Pt as V};
