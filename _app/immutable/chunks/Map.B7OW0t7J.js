import{_ as w}from"./preload-helper.D6kgxu3v.js";import{s as N,e as O,a as V,p as I,c as S,b as R,f as x,g as z,l as k,i as _,q as F,u as U,n as L,r as X,k as Y,v as Z,w as q,x as D}from"./scheduler.nR6IvPDU.js";import{S as W,i as J}from"./index.BYRHYcqC.js";import{s as G,m as p,g as H}from"./map.CGHko_W_.js";import{e as g}from"./emitter.ayfdCPcU.js";import{g as K}from"./search.Dnh_fa8P.js";import{p as Q}from"./stores.BobLgOAO.js";import{g as $}from"./entry.Z5ixVeuu.js";/* empty css                                          */function ee(t,o=500,r=10){let n,l,f;const s=m=>{const{clientX:v,clientY:h}=m instanceof MouseEvent?m:m.touches[0];l=v,f=h,n=setTimeout(()=>{t.dispatchEvent(new CustomEvent("longpress",{detail:m}))},o)},d=m=>{const{clientX:v,clientY:h}=m instanceof MouseEvent?m:m.touches[0],b=Math.abs(v-l),E=Math.abs(h-f);(b>r||E>r)&&clearTimeout(n)},i=()=>{clearTimeout(n)};return t.addEventListener("mousedown",s),t.addEventListener("mousemove",d),t.addEventListener("mouseup",i),t.addEventListener("mouseleave",i),t.addEventListener("touchstart",s),t.addEventListener("touchmove",d),t.addEventListener("touchend",i),t.addEventListener("touchcancel",i),{destroy(){t.removeEventListener("mousedown",s),t.removeEventListener("mousemove",d),t.removeEventListener("mouseup",i),t.removeEventListener("mouseleave",i),t.removeEventListener("touchstart",s),t.removeEventListener("touchmove",d),t.removeEventListener("touchend",i),t.removeEventListener("touchcancel",i)}}}function te(t){let o,r,n,l,f;return{c(){o=O("div"),r=V(),n=I(),this.h()},l(s){o=S(s,"DIV",{id:!0,class:!0}),R(o).forEach(x),r=z(s),n=I(),this.h()},h(){k(o,"id","map"),k(o,"class","svelte-4dod2t")},m(s,d){_(s,o,d),t[7](o),_(s,r,d),_(s,n,d),l||(f=[F(ee.call(null,o,500)),U(o,"longpress",t[8])],l=!0)},p(s,[d]){},i:L,o:L,d(s){s&&(x(o),x(r),x(n)),t[7](null),l=!1,X(f)}}}function P(t){t.preventDefault()}function ae(t,o,r){let n;Y(t,Q,e=>r(2,n=e));let{onMark:l=!1}=o;async function f(){const{default:e}=await w(async()=>{const{default:a}=await import("./feed_read.LNY5rkFx.js");return{default:a}},[],import.meta.url);g.emit("addIcon",{image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"circle",type:"feed",link:"/boxes?feed=true&type=feed",rank:2,name:"읽은 피드의 장소명",width:62,height:67,backgroundImage:e,displacement:[0,3.5]})}async function s(){const{default:e}=await w(async()=>{const{default:a}=await import("./feed_unread.BwN6XzLy.js");return{default:a}},[],import.meta.url);g.emit("addIcon",{coordinate:[126.97785,37.578019],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"circle",type:"feed",link:"/boxes?feed=true&type=feed",rank:1,name:"안읽은 피드의 장소명",width:62,height:67,backgroundImage:e,displacement:[0,3.5]})}async function d(){g.emit("addIcon",{coordinate:[126.97685,37.576519],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"waterdrop",type:"place",link:"/boxes?feed=true&type=feed",rank:3,name:"장소명",width:56,height:61})}let i;function m(){if(i){const e=p.getView().getZoom()||0;r(0,i.innerText=`ZOOM: ${e.toString()}`,i)}}G.refresh();function v(){const e=p.getView().calculateExtent(p.getSize()),a=H(e),c=Number(a[0].toFixed(6)),u=Number(a[1].toFixed(6));g.emit("addIcon",{coordinate:[c,u],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"waterdrop",type:"place",link:"/boxes?feed=true&type=feed",rank:1,name:"추가된 장소",width:56,height:61}),fetch("https://azit.surflux.studio/places",{method:"POST",body:JSON.stringify([{name:"testname",location:{lon:c,lat:u}}])}).then(async y=>{console.log(await y.json())}).catch(y=>{console.log(y)})}let h;async function b(){try{h&&h.abort();const e=n.url.searchParams.get("tags");if(!e)return;h=new AbortController,(await K({tags:e,bbox:p.getView().calculateExtent().join(),abortController:h})).forEach(c=>{const u={idx:c.idx,coordinate:c.location.replace("POINT(","").replace(")","").split(" ").map(Number),image:`https://picsum.photos/112/116?random=${c.idx}`,shape:"waterdrop",type:"place",link:`/places/${c.idx}`,rank:3,name:c.name,width:56,height:61};g.emit("addIcon",u)})}catch(e){(e==null?void 0:e.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",e)}}function E(){m(),b()}p.on("moveend",E),b();let C;Z(()=>{p.setTarget(C),C.addEventListener("contextmenu",P),n.url.searchParams.has("location")&&M(),n.url.searchParams.has("placeIdx")&&A()}),q(()=>{p.un("moveend",E),C.removeEventListener("contextmenu",P)});function M(){const e=n.url.searchParams.get("location"),a=e==null?void 0:e.split(","),c=a[0],u=a[1];c&&u&&p.getView().setCenter([Number(c),Number(u)])}async function A(){const e=n.url.searchParams.get("placeIdx"),a=await fetch(`https://azit.surflux.studio/places/${e}`).then(u=>u.json()).then(u=>u.data).catch(u=>{console.error(u)}),c={idx:a.placeIdx,coordinate:[a.longitude,a.latitude],image:`https://picsum.photos/112/116?random=${a.placeIdx}`,shape:"waterdrop",type:"place",link:`/places/${a.placeIdx}`,rank:5,name:a.name,width:56,height:61};g.emit("addIcon",c)}function T(e){D[e?"unshift":"push"](()=>{C=e,r(1,C)})}const B=e=>{const a=p.getEventCoordinate(e.detail);g.emit("flyTo",{longitude:a[0],latitude:a[1]}),n.url.pathname!=="/map/edit"&&$("/map/edit")};function j(e){D[e?"unshift":"push"](()=>{i=e,r(0,i)})}return t.$$set=e=>{"onMark"in e&&r(6,l=e.onMark)},t.$$.update=()=>{t.$$.dirty&64&&l&&(r(6,l=!1),v())},[i,C,n,f,s,d,l,T,B,j]}class me extends W{constructor(o){super(),J(this,o,ae,te,N,{onMark:6})}}export{me as M};
