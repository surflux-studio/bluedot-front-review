import{_ as I}from"./preload-helper.D6kgxu3v.js";import{s as O,e as S,a as V,u as k,c as R,b as U,f as x,g as z,l as L,i as w,v as F,w as X,n as D,r as Y,k as Z,o as W,x as q,y as M}from"./scheduler.BFzxWJSn.js";import{S as J,i as G}from"./index.DXXOSJvz.js";import{s as H,m as p,g as K}from"./map._4ThwQJB.js";import{e as g}from"./emitter.E5P-NQ8u.js";import{g as Q}from"./search.x7sEnQCQ.js";import{p as $}from"./stores.BMzH1F7a.js";import{a as y}from"./searchParams.SCCyDLHQ.js";import{g as ee}from"./entry.ESfJ-tmN.js";/* empty css                                          */function te(t,n=500,i=10){let r,d,f;const o=m=>{const{clientX:v,clientY:h}=m instanceof MouseEvent?m:m.touches[0];d=v,f=h,r=setTimeout(()=>{t.dispatchEvent(new CustomEvent("longpress",{detail:m}))},n)},l=m=>{const{clientX:v,clientY:h}=m instanceof MouseEvent?m:m.touches[0],b=Math.abs(v-d),E=Math.abs(h-f);(b>i||E>i)&&clearTimeout(r)},s=()=>{clearTimeout(r)};return t.addEventListener("mousedown",o),t.addEventListener("mousemove",l),t.addEventListener("mouseup",s),t.addEventListener("mouseleave",s),t.addEventListener("touchstart",o),t.addEventListener("touchmove",l),t.addEventListener("touchend",s),t.addEventListener("touchcancel",s),{destroy(){t.removeEventListener("mousedown",o),t.removeEventListener("mousemove",l),t.removeEventListener("mouseup",s),t.removeEventListener("mouseleave",s),t.removeEventListener("touchstart",o),t.removeEventListener("touchmove",l),t.removeEventListener("touchend",s),t.removeEventListener("touchcancel",s)}}}function ae(t){let n,i,r,d,f;return{c(){n=S("div"),i=V(),r=k(),this.h()},l(o){n=R(o,"DIV",{id:!0,class:!0}),U(n).forEach(x),i=z(o),r=k(),this.h()},h(){L(n,"id","map"),L(n,"class","svelte-4dod2t")},m(o,l){w(o,n,l),t[7](n),w(o,i,l),w(o,r,l),d||(f=[F(te.call(null,n,500)),X(n,"longpress",t[8])],d=!0)},p(o,[l]){},i:D,o:D,d(o){o&&(x(n),x(i),x(r)),t[7](null),d=!1,Y(f)}}}function A(t){t.preventDefault()}function ne(t,n,i){let r;Z(t,$,e=>i(2,r=e));let{onMark:d=!1}=n;async function f(){const{default:e}=await I(async()=>{const{default:a}=await import("./feed_read.LNY5rkFx.js");return{default:a}},[],import.meta.url);g.emit("addIcon",{image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"circle",type:"feed",link:"/boxes?feed=true&type=feed",rank:2,name:"읽은 피드의 장소명",width:62,height:67,backgroundImage:e,displacement:[0,3.5]})}async function o(){const{default:e}=await I(async()=>{const{default:a}=await import("./feed_unread.BwN6XzLy.js");return{default:a}},[],import.meta.url);g.emit("addIcon",{coordinate:[126.97785,37.578019],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"circle",type:"feed",link:"/boxes?feed=true&type=feed",rank:1,name:"안읽은 피드의 장소명",width:62,height:67,backgroundImage:e,displacement:[0,3.5]})}async function l(){g.emit("addIcon",{coordinate:[126.97685,37.576519],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"waterdrop",type:"place",link:"/boxes?feed=true&type=feed",rank:3,name:"장소명",width:56,height:61})}let s;function m(){if(s){const e=p.getView().getZoom()||0;i(0,s.innerText=`ZOOM: ${e.toString()}`,s)}}H.refresh();function v(){const e=p.getView().calculateExtent(p.getSize()),a=K(e),c=Number(a[0].toFixed(6)),u=Number(a[1].toFixed(6));g.emit("addIcon",{coordinate:[c,u],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"waterdrop",type:"place",link:"/boxes?feed=true&type=feed",rank:1,name:"추가된 장소",width:56,height:61}),fetch("https://azit.surflux.studio/places",{method:"POST",body:JSON.stringify([{name:"testname",location:{lon:c,lat:u}}])}).then(async _=>{console.log(await _.json())}).catch(_=>{console.log(_)})}let h;async function b(){try{h&&h.abort();const e=r.url.searchParams.get("tags");if(!e)return;h=new AbortController,(await Q({tags:e,bbox:p.getView().calculateExtent().join(),abortController:h})).forEach(c=>{const u={idx:c.idx,coordinate:c.location.replace("POINT(","").replace(")","").split(" ").map(Number),image:`https://picsum.photos/112/116?random=${c.idx}`,shape:"waterdrop",type:"place",link:`/places/${c.idx}`,rank:3,name:c.name,width:56,height:61};g.emit("addIcon",u)})}catch(e){(e==null?void 0:e.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",e)}}function E(){m(),b()}p.on("moveend",E),b();let C;W(()=>{p.setTarget(C),C.addEventListener("contextmenu",A),y("location")&&P(),y("placeIdx")&&T()}),q(()=>{p.un("moveend",E),C.removeEventListener("contextmenu",A)});function P(){const e=y("location"),a=e==null?void 0:e.split(","),c=a[0],u=a[1];c&&u&&p.getView().setCenter([Number(c),Number(u)])}async function T(){const e=y("placeIdx"),a=await fetch(`https://azit.surflux.studio/places/${e}`).then(u=>u.json()).then(u=>u.data).catch(u=>{console.error(u)}),c={idx:a.placeIdx,coordinate:[a.longitude,a.latitude],image:`https://picsum.photos/112/116?random=${a.placeIdx}`,shape:"waterdrop",type:"place",link:`/places/${a.placeIdx}`,rank:5,name:a.name,width:56,height:61};g.emit("addIcon",c)}function B(e){M[e?"unshift":"push"](()=>{C=e,i(1,C)})}const j=e=>{const a=p.getEventCoordinate(e.detail);g.emit("flyTo",{longitude:a[0],latitude:a[1]}),r.url.pathname!=="/map/edit"&&ee("/map/edit")};function N(e){M[e?"unshift":"push"](()=>{s=e,i(0,s)})}return t.$$set=e=>{"onMark"in e&&i(6,d=e.onMark)},t.$$.update=()=>{t.$$.dirty&64&&d&&(i(6,d=!1),v())},[s,C,r,f,o,l,d,B,j,N]}class he extends J{constructor(n){super(),G(this,n,ne,ae,O,{onMark:6})}}export{he as M};
