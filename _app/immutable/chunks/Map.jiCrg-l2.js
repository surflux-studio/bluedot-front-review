import{s as B,m as G,e as M,c as k,b as j,f as x,v as w,E as z,i as L,F as N,A as Z,u as q,o as F,p as O,G as R,k as T,w as U,x as W,y as H}from"./scheduler.5W7zuegH.js";import{S as J,i as K,t as Q,a as X}from"./index.6ch9Ev20.js";import{a as v,m as l}from"./map.BOZXGrcN.js";import{e as _,A as Y}from"./sign.B0sGg__T.js";import{g as $}from"./search.HHO2iXO4.js";import{p as ee}from"./stores.cuRlGAbM.js";import{l as te}from"./longPress.C9F0mLoM.js";import{g as oe}from"./entry.Db-OMiWN.js";import{s as ne}from"./searchParams.C12rW0MO.js";import{a as P,f as I}from"./proj.DXH8zrwl.js";import{s as S}from"./s32cloudfront.V6T8osDJ.js";/* empty css                                          */function ae(s){let n,r,i,h;const d=s[5].default,a=G(d,s,s[4],null);return{c(){n=M("div"),a&&a.c(),this.h()},l(o){n=k(o,"DIV",{id:!0,class:!0});var c=j(n);a&&a.l(c),c.forEach(x),this.h()},h(){w(n,"id","map"),w(n,"class",z("absolute w-full h-full z-[1]")+" svelte-mehtzq")},m(o,c){L(o,n,c),a&&a.m(n,null),s[6](n),r=!0,i||(h=[N(te.call(null,n,500)),Z(n,"longpress",s[7])],i=!0)},p(o,[c]){a&&a.p&&(!r||c&16)&&q(a,d,o,o[4],r?O(d,o[4],c,null):F(o[4]),null)},i(o){r||(Q(a,o),r=!0)},o(o){X(a,o),r=!1},d(o){o&&x(n),a&&a.d(o),s[6](null),i=!1,R(h)}}}function y(s){s.preventDefault()}function se(s,n,r){let i;T(s,ee,e=>r(2,i=e));let{$$slots:h={},$$scope:d}=n,{onSelect:a=()=>{}}=n,{onMoveend:o=()=>{}}=n;v.refresh(),_.on("explorePlaces",C);let c="",g;async function C(){var e;if(!(l.getView().getZoom()<16))try{g&&g.abort("new request");const t=(e=window.location.search.split("tags=")[1])==null?void 0:e.split("&")[0];if(!t)return;const m=decodeURIComponent(t);if(!m)return;c!==m&&(v.refresh(),c=m),g=new AbortController;const u=await $({tags:c,bbox:P(l.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join(),abortController:g});_.emit("addIcons",u.map(p=>({idx:p.idx,coordinate:I(p.location.replace("POINT(","").replace(")","").split(" ").map(Number)),image:S(p.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${p.idx}`,rank:3,name:p.name,width:38,height:46,onlyMain:!0})))}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}l.on("moveend",E);function E(){var e,t;C(),ne({location:((e=l.getView().getCenter())==null?void 0:e.join(","))??"",zoom:((t=l.getView().getZoom())==null?void 0:t.toFixed(2))??""}),o(P(l.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}C();let f;U(()=>{l.setTarget(f),f.addEventListener("contextmenu",y),i.url.searchParams.has("location")&&D(),i.url.searchParams.has("placeIdx")&&b(i.url.searchParams.get("placeIdx")),o(P(l.getView().calculateExtent(),"EPSG:3857","EPSG:4326").join())}),W(()=>{l.un("moveend",E),f.removeEventListener("contextmenu",y)});function D(){const e=i.url.searchParams.get("location"),t=i.url.searchParams.get("zoom"),m=e==null?void 0:e.split(",").map(Number);m&&l.getView().setCenter(m),t&&l.getView().setZoom(Number(t))}_.on("addIconByPlaceIdx",b);async function b(e){const t=await fetch(`${Y}/places/${e}`).then(u=>u.json()).then(u=>u.data).catch(u=>{console.error(u)}),m={idx:t.placeIdx,coordinate:I([t.longitude,t.latitude]),image:S(t.thumbnail,500)||"",shape:"point",type:"place",link:`/places/${t.placeIdx}`,rank:5,name:t.name,width:38,height:46};_.emit("addIcon",m)}function V(e){H[e?"unshift":"push"](()=>{f=e,r(1,f)})}const A=e=>{const t=l.getEventCoordinate(e.detail);i.url.pathname!=="/map/edit"?oe(`/map/edit?location=${t[0]},${t[1]}`):a(t)};return s.$$set=e=>{"onSelect"in e&&r(0,a=e.onSelect),"onMoveend"in e&&r(3,o=e.onMoveend),"$$scope"in e&&r(4,d=e.$$scope)},[a,f,i,o,d,h,V,A]}class Ce extends J{constructor(n){super(),K(this,n,se,ae,B,{onSelect:0,onMoveend:3})}}export{Ce as M};
