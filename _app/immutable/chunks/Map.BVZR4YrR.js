import{s as P,w as I,e as y,c as D,b as B,f as b,m as w,H as V,i as z,x as A,q as S,z as k,A as T,B as j,u as N,k as q,E as X,G as Y,o as Z}from"./scheduler.C_RmZE3P.js";import{S as F,i as U,t as G,b as H}from"./index.pf-sDz8f.js";import{s as O,m}from"./Chip.svelte_svelte_type_style_lang.YebYFo9-.js";import{e as _}from"./units.D6cS1jHK.js";import{g as W}from"./search.D2ADIJNu.js";import{p as J}from"./stores.Bldzq8Fj.js";import{g as K}from"./entry.ByILCBPu.js";import{s as Q}from"./searchParams.CqMuYFPd.js";/* empty css                                            *//* empty css                                           */import"./ImageShaper.BEKfM5ww.js";import"./heic2any.CtMe41Yr.js";/* empty css                                                    *//* empty css                                                  *//* empty css                                                     *//* empty css                                          */function R(e,a=500,l=10){let r,f,h;const n=u=>{const{clientX:v,clientY:d}=u instanceof MouseEvent?u:u.touches[0];f=v,h=d,r=setTimeout(()=>{e.dispatchEvent(new CustomEvent("longpress",{detail:u}))},a)},o=u=>{const{clientX:v,clientY:d}=u instanceof MouseEvent?u:u.touches[0],E=Math.abs(v-f),g=Math.abs(d-h);(E>l||g>l)&&clearTimeout(r)},s=()=>{clearTimeout(r)};return e.addEventListener("mousedown",n),e.addEventListener("mousemove",o),e.addEventListener("mouseup",s),e.addEventListener("mouseleave",s),e.addEventListener("touchstart",n),e.addEventListener("touchmove",o),e.addEventListener("touchend",s),e.addEventListener("touchcancel",s),{destroy(){e.removeEventListener("mousedown",n),e.removeEventListener("mousemove",o),e.removeEventListener("mouseup",s),e.removeEventListener("mouseleave",s),e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",o),e.removeEventListener("touchend",s),e.removeEventListener("touchcancel",s)}}}function $(e){let a,l,r,f;const h=e[5].default,n=I(h,e,e[4],null);return{c(){a=y("div"),n&&n.c(),this.h()},l(o){a=D(o,"DIV",{id:!0,class:!0});var s=B(a);n&&n.l(s),s.forEach(b),this.h()},h(){w(a,"id","map"),w(a,"class",V("absolute w-full h-full z-[1]")+" svelte-mehtzq")},m(o,s){z(o,a,s),n&&n.m(a,null),e[6](a),l=!0,r||(f=[A(R.call(null,a,500)),S(a,"longpress",e[7])],r=!0)},p(o,[s]){n&&n.p&&(!l||s&16)&&k(n,h,o,o[4],l?j(h,o[4],s,null):T(o[4]),null)},i(o){l||(G(n,o),l=!0)},o(o){H(n,o),l=!1},d(o){o&&b(a),n&&n.d(o),e[6](null),r=!1,N(f)}}}function x(e){e.preventDefault()}function ee(e,a,l){let r;q(e,J,t=>l(2,r=t));let{$$slots:f={},$$scope:h}=a,{onSelect:n=void 0}=a,{onMoveend:o=()=>{}}=a;O.refresh();let s;async function u(){try{s&&s.abort("new request");const t=r.url.searchParams.get("tags");if(!t)return;s=new AbortController,(await W({tags:t,bbox:m.getView().calculateExtent().join(),abortController:s})).forEach(c=>{const p={idx:c.idx,coordinate:c.location.replace("POINT(","").replace(")","").split(" ").map(Number),image:`https://picsum.photos/112/116?random=${c.idx}`,shape:"waterdrop",type:"place",link:`/places/${c.idx}`,rank:3,name:c.name,width:56,height:61};_.emit("addIcon",p)})}catch(t){(t==null?void 0:t.name)==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",t)}}m.on("moveend",v);function v(){var t,i;u(),Q({location:((t=m.getView().getCenter())==null?void 0:t.map(c=>c.toFixed(5)).join(","))??"",zoom:((i=m.getView().getZoom())==null?void 0:i.toFixed(2))??""}),o(m.getView().calculateExtent().join())}u();let d;X(()=>{m.setTarget(d),d.addEventListener("contextmenu",x),r.url.searchParams.has("location")&&E(),r.url.searchParams.has("placeIdx")&&g(r.url.searchParams.get("placeIdx")),o(m.getView().calculateExtent().join())}),Y(()=>{m.un("moveend",v),d.removeEventListener("contextmenu",x)});function E(){const t=r.url.searchParams.get("location"),i=r.url.searchParams.get("zoom"),c=t==null?void 0:t.split(","),p=c[0],C=c[1];p&&C&&m.getView().setCenter([Number(p),Number(C)]),i&&m.getView().setZoom(Number(i))}_.on("addIconByPlaceIdx",g);async function g(t){const i=await fetch(`https://azit.surflux.studio/places/${t}`).then(p=>p.json()).then(p=>p.data).catch(p=>{console.error(p)}),c={idx:i.placeIdx,coordinate:[i.longitude,i.latitude],image:`https://picsum.photos/112/116?random=${i.placeIdx}`,shape:"waterdrop",type:"place",link:`/places/${i.placeIdx}`,rank:5,name:i.name,width:56,height:61};_.emit("addIcon",c)}function L(t){Z[t?"unshift":"push"](()=>{d=t,l(1,d)})}const M=t=>{const[i,c]=m.getEventCoordinate(t.detail);r.url.pathname!=="/map/edit"?K(`/map/edit?longitude=${i}&latitude=${c}`):n&&n(i,c)};return e.$$set=t=>{"onSelect"in t&&l(0,n=t.onSelect),"onMoveend"in t&&l(3,o=t.onMoveend),"$$scope"in t&&l(4,h=t.$$scope)},[n,d,r,o,h,f,L,M]}class ge extends F{constructor(a){super(),U(this,a,ee,$,P,{onSelect:0,onMoveend:3})}}export{ge as M};
