import{_ as y}from"./preload-helper.D6kgxu3v.js";import{s as T,n as _,c as M,o as O,a as S,b as x}from"./scheduler.mTkvHAFM.js";import{S as V,i as j,e as N,s as R,q as k,c as F,a as z,d as h,f as U,r as w,g as C}from"./index.DrH1dKcj.js";import{s as Z,m as r,g as q,a as L}from"./search.B4k_5Y7I.js";import{e as d}from"./emitter.E5P-NQ8u.js";import{p as J}from"./stores.CF-qi5Yx.js";function G(s){let a,n,i;return{c(){a=N("div"),n=R(),i=k(),this.h()},l(t){a=F(t,"DIV",{id:!0,class:!0}),z(a).forEach(h),n=U(t),i=k(),this.h()},h(){w(a,"id","map"),w(a,"class","svelte-9hheuy")},m(t,c){C(t,a,c),s[6](a),C(t,n,c),C(t,i,c)},p(t,[c]){},i:_,o:_,d(t){t&&(h(a),h(n),h(i)),s[6](null)}}}function H(s,a,n){let i;M(s,J,e=>n(9,i=e));let{onMark:t=!1}=a;async function c(){const{default:e}=await y(async()=>{const{default:o}=await import("./feed_read.LNY5rkFx.js");return{default:o}},[],import.meta.url);d.emit("addIcon",{image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"circle",type:"feed",link:"/boxes?feed=true&type=feed",rank:2,name:"읽은 피드의 장소명",width:62,height:67,backgroundImage:e,displacement:[0,3.5]})}async function D(){const{default:e}=await y(async()=>{const{default:o}=await import("./feed_unread.BwN6XzLy.js");return{default:o}},[],import.meta.url);d.emit("addIcon",{coordinate:[126.97785,37.578019],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"circle",type:"feed",link:"/boxes?feed=true&type=feed",rank:1,name:"안읽은 피드의 장소명",width:62,height:67,backgroundImage:e,displacement:[0,3.5]})}async function E(){d.emit("addIcon",{coordinate:[126.97685,37.576519],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"waterdrop",type:"place",link:"/boxes?feed=true&type=feed",rank:3,name:"장소명",width:56,height:61})}let u;function I(){if(u){const e=r.getView().getZoom()||0;n(0,u.innerText=`ZOOM: ${e.toString()}`,u)}}Z.refresh();function A(){const e=r.getView().calculateExtent(r.getSize()),o=q(e);console.log(o);const p=Number(o[0].toFixed(6)),b=Number(o[1].toFixed(6));d.emit("addIcon",{coordinate:[p,b],image:"https://github.githubassets.com/assets/video-thumbnail-22873af1c902.jpg",shape:"waterdrop",type:"place",link:"/boxes?feed=true&type=feed",rank:1,name:"추가된 장소",width:56,height:61}),fetch("https://azit.surflux.studio/places",{method:"POST",body:JSON.stringify([{name:"testname",location:{lon:p,lat:b}}])}).then(async f=>{console.log(await f.json())}).catch(f=>{console.log(f)})}let l;async function B(){try{l&&l.abort(),l=new AbortController,(await L({tags:i.url.searchParams.get("tags")||"",bbox:r.getView().calculateExtent(),abortController:l})).forEach(o=>{const p={coordinate:o.location.replace("POINT(","").replace(")","").split(" ").map(Number),image:`https://picsum.photos/200/300?random=${o.idx}`,shape:"waterdrop",type:"place",link:`/places/${o.idx}`,rank:3,name:o.name,width:56,height:61};d.emit("addIcon",p)})}catch(e){e.name==="AbortError"?console.log("이전 explorePlaces 요청이 취소되었습니다."):console.error("explorePlaces 중 에러 발생:",e)}}function g(){I(),B()}r.on("moveend",g);let m;O(()=>{r.setTarget(m)}),S(()=>{r.un("moveend",g)});function v(e){x[e?"unshift":"push"](()=>{m=e,n(1,m)})}function P(e){x[e?"unshift":"push"](()=>{u=e,n(0,u)})}return s.$$set=e=>{"onMark"in e&&n(5,t=e.onMark)},s.$$.update=()=>{s.$$.dirty&32&&t&&(n(5,t=!1),A())},[u,m,c,D,E,t,v,P]}class ee extends V{constructor(a){super(),j(this,a,H,G,T,{onMark:5})}}export{ee as M};
